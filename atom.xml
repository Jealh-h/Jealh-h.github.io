<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Jealh&#39;s Blog</title>
  
  <subtitle>ğ“£ğ“±ğ“²ğ“¼ ğ“²ğ“¼ ğ“ª ğ“«ğ“®ğ“ªğ“¾ğ“½ğ“²ğ“¯ğ“¾ğ“µ ğ“¼ğ“¾ğ“«ğ“½ğ“²ğ“½ğ“µğ“®</subtitle>
  <link href="https://jealh.xyz/atom.xml" rel="self"/>
  
  <link href="https://jealh.xyz/"/>
  <updated>2023-05-19T09:07:29.789Z</updated>
  <id>https://jealh.xyz/</id>
  
  <author>
    <name>Jealh</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>seajsæºç é˜…è¯»</title>
    <link href="https://jealh.xyz/2023/04/28/seajs%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB/"/>
    <id>https://jealh.xyz/2023/04/28/seajs%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB/</id>
    <published>2023-04-28T06:56:41.000Z</published>
    <updated>2023-05-19T09:07:29.789Z</updated>
    
    <content type="html"><![CDATA[<p>ä»‹ç»ï¼šjs æ¨¡å—åŠ è½½å™¨ã€‚è¿™ä¸ªå¼€æºé¡¹ç›®åº”è¯¥æ˜¯å¤šå¹´å‰çš„äº†ï¼Œæœ€æ–°ç‰ˆæœ¬ä¹Ÿæ˜¯åœ¨ 2014-03-06 çš„ 2.2.0 ç‰ˆæœ¬äº†ã€‚æ‰€ä»¥ï¼Œå¯¹äºç°åœ¨çš„æµè§ˆå™¨ï¼Œä½¿ç”¨ script æ ‡ç­¾çš„ type=â€moduleâ€ <a href="https://hacks.mozilla.org/2015/08/es6-in-depth-modules/">es6-in-depth-modules</a>,ä¾¿å¯ä»¥ä½¿ç”¨æ¨¡å—åŒ–äº†ã€‚</p><blockquote><p>è¿™ç¯‡èµ·å› æ˜¯åˆ·åˆ°äº†ç‰ä¼¯å¤§ä½¬ç¦»èŒçš„æ¶ˆæ¯ï¼Œäº†è§£åˆ° seajs è¿™ä¸ªæ¨¡å—åŠ è½½å™¨æ˜¯ä»–å†™çš„ï¼Œæ‰€ä»¥å°±é˜…è¯»äº†ä¸€æ‰‹ï¼Œå¦‚æœ‰å†’çŠ¯ï¼Œæ³è¯·åŸè°…ã€‚</p></blockquote><p>ä¾æ—§å»¶ç»­ä¸Šæ¬¡çš„æ–¹æ³•ï¼Œæˆ‘ä»¬å…ˆä»ä½¿ç”¨æ–¹å¼å¼€å§‹ã€‚</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å®šä¹‰æ¨¡å—</span></span><br><span class="line">define(<span class="function"><span class="keyword">function</span> (<span class="params"><span class="built_in">require</span>, <span class="built_in">exports</span>, <span class="built_in">module</span></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> $ = <span class="built_in">require</span>(<span class="string">&quot;jquery&quot;</span>);</span><br><span class="line">  <span class="keyword">var</span> Spinning = <span class="built_in">require</span>(<span class="string">&quot;./spinning&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">exports</span>.moduleParam = <span class="string">&quot;param&quot;</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>ä¸Šé¢å°±æ˜¯ Sea.js æ¨èçš„ CMD æ¨¡å—ä¹¦å†™æ ¼å¼ã€‚å¦‚æœä½ æœ‰ä½¿ç”¨è¿‡ Node.jsï¼Œä¸€åˆ‡éƒ½å¾ˆè‡ªç„¶ã€‚</p><h2 id="æ–‡ä»¶ç›®å½•ç»“æ„"><a href="#æ–‡ä»¶ç›®å½•ç»“æ„" class="headerlink" title="æ–‡ä»¶ç›®å½•ç»“æ„"></a>æ–‡ä»¶ç›®å½•ç»“æ„</h2><p>å†…éƒ¨ä½¿ç”¨äº†å°è£…çš„ seatools npm åŒ…ï¼Œä½¿ç”¨çš„æ˜¯ Grunt æ‰“åŒ…ï¼Œä½¿ç”¨äº†å…¶ä¸­çš„ contact file åŠŸèƒ½ã€‚å…¶ä¼šè¿›è¡Œæ–‡ä»¶åˆå¹¶æ“ä½œï¼Œæ‰€ä»¥ä¼šè§åˆ°æºç çš„ intro.js ä¸ outro.js é‚£ç§ä¸å®Œæ•´çš„å†™æ³•ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">concat: &#123;</span><br><span class="line">      <span class="attr">dist</span>: &#123;</span><br><span class="line">        <span class="attr">src</span>: [</span><br><span class="line">          <span class="string">&#x27;src/intro.js&#x27;</span>,</span><br><span class="line">          <span class="string">&#x27;src/sea.js&#x27;</span>,</span><br><span class="line">          <span class="string">&#x27;src/util-lang.js&#x27;</span>,</span><br><span class="line">          <span class="string">&#x27;src/util-events.js&#x27;</span>,</span><br><span class="line">          <span class="string">&#x27;src/util-path.js&#x27;</span>,</span><br><span class="line">          <span class="string">&#x27;src/util-request.js&#x27;</span>,</span><br><span class="line">          <span class="string">&#x27;src/util-cs.js&#x27;</span>,</span><br><span class="line">          <span class="string">&#x27;src/util-deps.js&#x27;</span>,</span><br><span class="line">          <span class="string">&#x27;src/module.js&#x27;</span>,</span><br><span class="line">          <span class="string">&#x27;src/config.js&#x27;</span>,</span><br><span class="line">          <span class="string">&#x27;src/outro.js&#x27;</span></span><br><span class="line">        ],</span><br><span class="line">        <span class="attr">dest</span>: <span class="string">&#x27;dist/sea-debug.js&#x27;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><span id="more"></span><h2 id="å‘å¸ƒè®¢é˜…"><a href="#å‘å¸ƒè®¢é˜…" class="headerlink" title="å‘å¸ƒè®¢é˜…"></a>å‘å¸ƒè®¢é˜…</h2><p>seajs ä½¿ç”¨äº†å‘å¸ƒè®¢é˜…æ¨¡å¼ï¼Œå†…ç½®äº†å¦‚ä¸‹äº‹ä»¶ï¼š</p><ul><li>config</li><li>load</li><li>exec</li><li>fetch</li><li>request</li><li>resolve</li><li>define</li><li>save</li><li>error</li></ul><p>å¦‚éœ€è¦å¤„ç†è¿™äº›äº‹ä»¶ï¼Œå¯ä»¥ä½¿ç”¨ <code>seajs.on</code> æ·»åŠ å¯¹åº”äº‹ä»¶å›è°ƒã€‚è¿™äº›äº‹ä»¶ä¼šåœ¨ç‰¹å®šçš„æ—¶æœºè§¦å‘ï¼Œå¦‚ configï¼Œä¼šåœ¨ seajs.config å‡½æ•°é‡Œè§¦å‘ã€‚<strong>è¿™ç§éå¸¸é€‚åˆæ’ä»¶ç³»ç»Ÿ</strong></p><h2 id="seajs-å…¨å±€å¯¹è±¡"><a href="#seajs-å…¨å±€å¯¹è±¡" class="headerlink" title="seajs å…¨å±€å¯¹è±¡"></a>seajs å…¨å±€å¯¹è±¡</h2><p><img src="https://cdn.jsdelivr.net/gh/PancakeDogLLL/imageBed/img/202305040833.png" alt="img"></p><h3 id="seajs-config"><a href="#seajs-config" class="headerlink" title="seajs.config"></a>seajs.config</h3><p>è¿›è¡Œé…ç½®ï¼Œé…ç½®çš„å±æ€§ä¼šä¿ç•™åœ¨ seajs.data ä¸Šé¢</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">seajs.config(&#123;</span><br><span class="line">  <span class="comment">// è®¾ç½®è·¯å¾„ï¼Œæ–¹ä¾¿è·¨ç›®å½•è°ƒç”¨</span></span><br><span class="line">  <span class="attr">paths</span>: &#123;</span><br><span class="line">    <span class="attr">arale</span>: <span class="string">&quot;https://a.alipayobjects.com/arale&quot;</span>,</span><br><span class="line">    <span class="attr">jquery</span>: <span class="string">&quot;https://a.alipayobjects.com/jquery&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è®¾ç½®åˆ«åï¼Œæ–¹ä¾¿è°ƒç”¨</span></span><br><span class="line">  <span class="attr">alias</span>: &#123;</span><br><span class="line">    <span class="attr">class</span>: <span class="string">&quot;arale/class/1.0.0/class&quot;</span>,</span><br><span class="line">    <span class="attr">jquery</span>: <span class="string">&quot;jquery/jquery/1.10.1/jquery&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="seajs-request"><a href="#seajs-request" class="headerlink" title="seajs.request"></a>seajs.request</h3><p>åˆ†ä¸º webWorker ä¸ é webWorker ç¯å¢ƒ,é€šè¿‡<code>importScripts</code>åˆ¤æ–­æ˜¯å¦æ˜¯ webWorker ç¯å¢ƒ</p><ul><li>é webWorker</li></ul><p>é worker ç¯å¢ƒä½¿ç”¨ script æ ‡ç­¾å¯¼å…¥ã€‚ å¹¶ä½¿ç”¨ async å±æ€§å¹¶è¡Œè¯·æ±‚è„šæœ¬ã€‚åŒæ—¶æ·»åŠ  onload äº‹ä»¶ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> doc = <span class="built_in">document</span>;</span><br><span class="line"><span class="keyword">var</span> head =</span><br><span class="line">  doc.head || doc.getElementsByTagName(<span class="string">&quot;head&quot;</span>)[<span class="number">0</span>] || doc.documentElement;</span><br><span class="line"><span class="keyword">var</span> baseElement = head.getElementsByTagName(<span class="string">&quot;base&quot;</span>)[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">request</span>(<span class="params">url, callback, charset, crossorigin</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> node = doc.createElement(<span class="string">&quot;script&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (charset) &#123;</span><br><span class="line">    node.charset = charset;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!isUndefined(crossorigin)) &#123;</span><br><span class="line">    node.setAttribute(<span class="string">&quot;crossorigin&quot;</span>, crossorigin);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  addOnload(node, callback, url);</span><br><span class="line"></span><br><span class="line">  node.async = <span class="literal">true</span>;</span><br><span class="line">  node.src = url;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// For some cache cases in IE 6-8, the script executes IMMEDIATELY after</span></span><br><span class="line">  <span class="comment">// the end of the insert execution, so use `currentlyAddingScript` to</span></span><br><span class="line">  <span class="comment">// hold current node, for deriving url in `define` call</span></span><br><span class="line">  currentlyAddingScript = node;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ref: #185 &amp; http://dev.jquery.com/ticket/2709</span></span><br><span class="line">  baseElement ? head.insertBefore(node, baseElement) : head.appendChild(node);</span><br><span class="line"></span><br><span class="line">  currentlyAddingScript = <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">addOnload</span>(<span class="params">node, callback, url</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> supportOnload = <span class="string">&quot;onload&quot;</span> <span class="keyword">in</span> node;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (supportOnload) &#123;</span><br><span class="line">    node.onload = onload;</span><br><span class="line">    node.onerror = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      emit(<span class="string">&quot;error&quot;</span>, &#123; <span class="attr">uri</span>: url, <span class="attr">node</span>: node &#125;);</span><br><span class="line">      onload(<span class="literal">true</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    node.onreadystatechange = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="regexp">/loaded|complete/</span>.test(node.readyState)) &#123;</span><br><span class="line">        onload();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">onload</span>(<span class="params">error</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// Ensure only run once and handle memory leak in IE</span></span><br><span class="line">    node.onload = node.onerror = node.onreadystatechange = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Remove the script to reduce memory leak</span></span><br><span class="line">    <span class="keyword">if</span> (!data.debug) &#123;</span><br><span class="line">      head.removeChild(node);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Dereference the node</span></span><br><span class="line">    node = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    callback(error);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>webWorker</li></ul><p>webWorker ç¯å¢ƒä¸‹ï¼Œä½¿ç”¨ importScripts å¯¼å…¥ js è„šæœ¬</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">requestFromWebWorker</span>(<span class="params">url, callback, charset, crossorigin</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// Load with importScripts</span></span><br><span class="line">  <span class="keyword">var</span> error;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    importScripts(url);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    error = e;</span><br><span class="line">  &#125;</span><br><span class="line">  callback(error);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="seajs-data"><a href="#seajs-data" class="headerlink" title="seajs.data"></a>seajs.data</h3><p>ä¸€ä¸ªå¯¹è±¡ï¼Œå­˜æ”¾ä¸€äº›è·¯å¾„ã€charset ç­‰ä¿¡æ¯ã€‚</p><ul><li>base: root path for id2url</li><li>dir: loaderâ€™s full path</li><li>cwd: current working directory</li><li>charset: charset for requesting files</li><li>crossorigin: The CORS options, Donâ€™t set CORS on default.</li><li>alias: An object containing shorthands of module id</li><li>paths: An object containing path shorthands in module id</li><li>vars: The {xxx} variables in module id</li><li>map: An array containing rules to map module uri</li><li>debug: Debug mode. The default value is false</li></ul><h3 id="seajs-resolve"><a href="#seajs-resolve" class="headerlink" title="seajs.resolve"></a>seajs.resolve</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">id2Uri</span>(<span class="params">id, refUri</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!id) <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">  id = parseAlias(id); <span class="comment">// å¦‚æœæœ‰ Alias, å°±ä½¿ç”¨ alias ä¸­çš„è·¯å¾„</span></span><br><span class="line">  id = parsePaths(id); <span class="comment">// å¦‚æœ data.paths ä¸­æœ‰ï¼Œåˆ™ä½¿ç”¨ paths ä¸­çš„è·¯å¾„</span></span><br><span class="line">  id = parseAlias(id);</span><br><span class="line">  id = parseVars(id);</span><br><span class="line">  id = parseAlias(id);</span><br><span class="line">  id = normalize(id);</span><br><span class="line">  id = parseAlias(id);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> uri = addBase(id, refUri);</span><br><span class="line">  uri = parseAlias(uri);</span><br><span class="line">  uri = parseMap(uri);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> uri;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="define"><a href="#define" class="headerlink" title="define"></a>define</h2><p>ç”±å¼€å§‹çš„ä¾‹å­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå…¨å±€å®šä¹‰äº† define æ–¹æ³•ï¼Œå…¶ä½œç”¨æ˜¯ç”¨æ¥å®šä¹‰æ¨¡å—ã€‚é‚£æˆ‘ä»¬å°±ä» define å¼€å§‹ã€‚åœ¨è°ˆ define å‰ï¼Œæˆ‘ä»¬è¦å…ˆçœ‹çœ‹ Module å¯¹è±¡ï¼Œå› ä¸º define å–çš„æ˜¯ Module çš„ define æ–¹æ³• ğŸ˜‚ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// èµ‹å€¼åˆ°window</span></span><br><span class="line"><span class="built_in">global</span>.define = Module.define;</span><br><span class="line"></span><br><span class="line"><span class="comment">// define æ¨¡å—</span></span><br><span class="line">Module.define = <span class="function"><span class="keyword">function</span> (<span class="params">id, deps, factory</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> argsLen = <span class="built_in">arguments</span>.length;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// define(factory)</span></span><br><span class="line">  <span class="keyword">if</span> (argsLen === <span class="number">1</span>) &#123;</span><br><span class="line">    factory = id;</span><br><span class="line">    id = <span class="literal">undefined</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (argsLen === <span class="number">2</span>) &#123;</span><br><span class="line">    factory = deps;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// define(deps, factory)</span></span><br><span class="line">    <span class="keyword">if</span> (isArray(id)) &#123;</span><br><span class="line">      deps = id;</span><br><span class="line">      id = <span class="literal">undefined</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// define(id, factory)</span></span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">      deps = <span class="literal">undefined</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Parse dependencies according to the module factory code</span></span><br><span class="line">  <span class="keyword">if</span> (!isArray(deps) &amp;&amp; isFunction(factory)) &#123;</span><br><span class="line">    deps =</span><br><span class="line">      <span class="keyword">typeof</span> parseDependencies === <span class="string">&quot;undefined&quot;</span></span><br><span class="line">        ? []</span><br><span class="line">        : parseDependencies(factory.toString());</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> meta = &#123;</span><br><span class="line">    <span class="attr">id</span>: id,</span><br><span class="line">    <span class="attr">uri</span>: Module.resolve(id),</span><br><span class="line">    <span class="attr">deps</span>: deps,</span><br><span class="line">    <span class="attr">factory</span>: factory,</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Try to derive uri in IE6-9 for anonymous modules</span></span><br><span class="line">  <span class="keyword">if</span> (</span><br><span class="line">    !isWebWorker &amp;&amp;</span><br><span class="line">    !meta.uri &amp;&amp;</span><br><span class="line">    doc.attachEvent &amp;&amp;</span><br><span class="line">    <span class="keyword">typeof</span> getCurrentScript !== <span class="string">&quot;undefined&quot;</span></span><br><span class="line">  ) &#123;</span><br><span class="line">    <span class="keyword">var</span> script = getCurrentScript();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (script) &#123;</span><br><span class="line">      meta.uri = script.src;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// <span class="doctag">NOTE:</span> If the id-deriving methods above is failed, then falls back</span></span><br><span class="line">    <span class="comment">// to use onload event to get the uri</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Emit `define` event, used in nocache plugin, seajs node version etc</span></span><br><span class="line">  emit(<span class="string">&quot;define&quot;</span>, meta);</span><br><span class="line"></span><br><span class="line">  meta.uri</span><br><span class="line">    ? Module.save(meta.uri, meta)</span><br><span class="line">    : <span class="comment">// Save information for &quot;saving&quot; work in the script onload event</span></span><br><span class="line">      (anonymousMeta = meta);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>define æ”¯æŒå¤šç§å‚æ•°ï¼Œå…¶åˆ¤æ–­ä¾æ®æ˜¯æ ¹æ®å‚æ•°é•¿åº¦</p><ul><li>define(factory)</li><li>define(deps, factory)</li><li>define(id, factory)</li></ul><p>åœ¨ deps ä¸ä¸ºæ•°ç»„æ—¶ï¼Œä¼šä½¿ç”¨ parseDependencies æ–¹æ³•å°† factory é‡Œçš„ require ä¾èµ–çš„æå–å‡ºæ¥ã€‚</p><p>åœ¨ Module.resolve ä¸­ï¼Œä½¿ç”¨ <a href="#seajsresolve">seajs.resolve</a> è½¬æ¢è·¯å¾„ã€‚åŒæ—¶åˆ›å»º meta å¯¹è±¡ï¼Œä¿å­˜æ¨¡å—çš„ id, uri, deps, factoryã€‚ç„¶åæ‰§è¡Œ <a href="#modulesave">Module.save</a> æ–¹æ³•ï¼Œå°† mod ä¿å­˜åœ¨ cachedMods å¯¹è±¡é‡Œè¾¹ã€‚ é‚£ factory ä¼šåœ¨ä»€ä¹ˆæ—¶å€™æ‰§è¡Œå‘¢ï¼Œç»§ç»­çœ‹ã€‚</p><blockquote><p>å½“æˆ‘ä»¬å®šä¹‰å¥½æ¨¡å—åï¼Œé‚£æ¥ä¸‹æ¥æˆ‘ä»¬å°±åº”è¯¥å»ä½¿ç”¨æ¨¡å—äº†ã€‚</p></blockquote><h2 id="seajs-use"><a href="#seajs-use" class="headerlink" title="seajs.use"></a>seajs.use</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">seajs.use = <span class="function"><span class="keyword">function</span> (<span class="params">ids, callback</span>) </span>&#123;</span><br><span class="line">  Module.use(ids, callback, data.cwd + <span class="string">&quot;_use_&quot;</span> + cid());</span><br><span class="line">  <span class="keyword">return</span> seajs;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>å†…éƒ¨è°ƒç”¨ <a href="#moduleuse">Module.use</a> é™æ€æ–¹æ³•, ä¼ å…¥ ids, callback, uriã€‚</p><h2 id="Module"><a href="#Module" class="headerlink" title="Module"></a>Module</h2><p>ä¸€ä¸ªæ¨¡å—å¯¹è±¡ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Module</span>(<span class="params">uri, deps</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.uri = uri;</span><br><span class="line">  <span class="built_in">this</span>.dependencies = deps || [];</span><br><span class="line">  <span class="built_in">this</span>.deps = &#123;&#125;; <span class="comment">// Ref the dependence modules</span></span><br><span class="line">  <span class="built_in">this</span>.status = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">this</span>._entry = [];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶æä¾›äº†å¦‚ä¸‹é™æ€æ–¹æ³•ï¼š</p><ul><li>resolve</li><li>define</li><li>save</li><li>get</li><li>use</li></ul><p>é‚£ä»€ä¹ˆæ—¶å€™å»åˆ›å»º Module å®ä¾‹å‘¢ï¼Œæ˜¯åœ¨ seajs.use æ—¶ã€‚</p><h3 id="Module-use"><a href="#Module-use" class="headerlink" title="Module.use"></a>Module.use</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">Module.use = <span class="function"><span class="keyword">function</span> (<span class="params">ids, callback, uri</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> mod = Module.get(uri, isArray(ids) ? ids : [ids]);</span><br><span class="line"></span><br><span class="line">  mod._entry.push(mod);</span><br><span class="line">  mod.history = &#123;&#125;;</span><br><span class="line">  mod.remain = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">  mod.callback = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> <span class="built_in">exports</span> = [];</span><br><span class="line">    <span class="keyword">var</span> uris = mod.resolve();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, len = uris.length; i &lt; len; i++) &#123;</span><br><span class="line">      <span class="built_in">exports</span>[i] = cachedMods[uris[i]].exec();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (callback) &#123;</span><br><span class="line">      callback.apply(<span class="built_in">global</span>, <span class="built_in">exports</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">delete</span> mod.callback;</span><br><span class="line">    <span class="keyword">delete</span> mod.history;</span><br><span class="line">    <span class="keyword">delete</span> mod.remain;</span><br><span class="line">    <span class="keyword">delete</span> mod._entry;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  mod.load();</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ <a href="#moduleget">Module.get</a> ä» cachedMods è·å– moduleã€‚å°†è‡ªèº«æ·»åŠ åˆ° _entry é‡Œï¼Œæœ€åæ‰§è¡Œ mod çš„ load æ–¹æ³•ï¼Œ ä¹Ÿå°±æ˜¯ <a href="#moduleprototypeload">Module.prototype.load</a></p><h3 id="Module-save"><a href="#Module-save" class="headerlink" title="Module.save"></a>Module.save</h3><p>å°† meta å¯¹è±¡æ•°æ®ä¿å­˜åœ¨ cachedMods é‡Œã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Module.save = <span class="function"><span class="keyword">function</span> (<span class="params">uri, meta</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> mod = Module.get(uri);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Do NOT override already saved modules</span></span><br><span class="line">  <span class="keyword">if</span> (mod.status &lt; STATUS.SAVED) &#123;</span><br><span class="line">    mod.id = meta.id || uri;</span><br><span class="line">    mod.dependencies = meta.deps || [];</span><br><span class="line">    mod.factory = meta.factory;</span><br><span class="line">    mod.status = STATUS.SAVED;</span><br><span class="line"></span><br><span class="line">    emit(<span class="string">&quot;save&quot;</span>, mod);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="Module-get"><a href="#Module-get" class="headerlink" title="Module.get"></a>Module.get</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Module.get = <span class="function"><span class="keyword">function</span> (<span class="params">uri, deps</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> cachedMods[uri] || (cachedMods[uri] = <span class="keyword">new</span> Module(uri, deps));</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="Module-resolve"><a href="#Module-resolve" class="headerlink" title="Module.resolve"></a>Module.resolve</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Resolve id to uri</span></span><br><span class="line">Module.resolve = <span class="function"><span class="keyword">function</span> (<span class="params">id, refUri</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// Emit `resolve` event for plugins such as text plugin</span></span><br><span class="line">  <span class="keyword">var</span> emitData = &#123; <span class="attr">id</span>: id, <span class="attr">refUri</span>: refUri &#125;;</span><br><span class="line">  emit(<span class="string">&quot;resolve&quot;</span>, emitData);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> emitData.uri || seajs.resolve(emitData.id, refUri);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="Module-prototype-load"><a href="#Module-prototype-load" class="headerlink" title="Module.prototype.load"></a>Module.prototype.load</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Load module.dependencies and fire onload when all done</span></span><br><span class="line">Module.prototype.load = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> mod = <span class="built_in">this</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// If the module is being loaded, just wait it onload call</span></span><br><span class="line">  <span class="keyword">if</span> (mod.status &gt;= STATUS.LOADING) &#123;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  mod.status = STATUS.LOADING;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Emit `load` event for plugins such as combo plugin</span></span><br><span class="line">  <span class="keyword">var</span> uris = mod.resolve();</span><br><span class="line">  emit(<span class="string">&quot;load&quot;</span>, uris);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, len = uris.length; i &lt; len; i++) &#123;</span><br><span class="line">    mod.deps[mod.dependencies[i]] = Module.get(uris[i]);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Pass entry to it&#x27;s dependencies</span></span><br><span class="line">  mod.pass();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// If module has entries not be passed, call onload</span></span><br><span class="line">  <span class="keyword">if</span> (mod._entry.length) &#123;</span><br><span class="line">    mod.onload();</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Begin parallel loading</span></span><br><span class="line">  <span class="keyword">var</span> requestCache = &#123;&#125;;</span><br><span class="line">  <span class="keyword">var</span> m;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">    m = cachedMods[uris[i]];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (m.status &lt; STATUS.FETCHING) &#123;</span><br><span class="line">      m.fetch(requestCache);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (m.status === STATUS.SAVED) &#123;</span><br><span class="line">      m.load();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Send all requests at last to avoid cache bug in IE6-9. Issues#808</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> requestUri <span class="keyword">in</span> requestCache) &#123;</span><br><span class="line">    <span class="keyword">if</span> (requestCache.hasOwnProperty(requestUri)) &#123;</span><br><span class="line">      requestCache[requestUri]();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>å…ˆåˆ¤æ–­ mod çš„ status æ˜¯å¦æ˜¯åŠ è½½ä¸­ï¼Œå¦‚æœæ˜¯ï¼Œå°±ç”± emit äº‹ä»¶å¤„ç†ã€‚ç„¶åé€šè¿‡ <a href="#moduleprototyperesolve">Module.prototype.resolve</a> è·å–ä¾èµ–æ¨¡å—çš„ uri åˆ—è¡¨ã€‚èµ‹å€¼ç»™ mod.depsã€‚mod.dependencies åœ¨ factory å‡½æ•°å°±ä¼šé€šè¿‡æ­£åˆ™è·å–ä¾èµ–ã€‚mod.deps å°±å½¢å¦‚ <code>&#123;&quot;jquery&quot;: Module &#125;</code>ã€‚æ¥ä¸‹æ¥å°±è°ƒç”¨ <a href="#moduleprototypepass">Module.prototype.pass</a> è¿›è¡Œ entry åˆ° dependence çš„è½¬æ¢ã€‚å¦‚æœ dependence é‡Œé¢éƒ½ loaded äº†ï¼Œå°±è§¦å‘ <a href="Module.prototype.onload">Module.prototype.onload</a>ã€‚æœ€ååˆ¤æ–­ cachedMods çš„çŠ¶æ€ï¼Œå¦‚æœ å°äº FETCHING å°±å¼€å§‹å¹¶è¡ŒåŠ è½½ï¼Œè°ƒç”¨ <a href="#moduleprototypefetch">Module.prototype.fetch</a>,å¦‚æœçŠ¶æ€ç­‰äº SAVED å°±è°ƒç”¨ <a href="#moduleprototypeload">Module.prototype.load</a></p><h3 id="Module-prototype-resolve"><a href="#Module-prototype-resolve" class="headerlink" title="Module.prototype.resolve"></a>Module.prototype.resolve</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Resolve module.dependencies</span></span><br><span class="line">Module.prototype.resolve = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> mod = <span class="built_in">this</span>;</span><br><span class="line">  <span class="keyword">var</span> ids = mod.dependencies;</span><br><span class="line">  <span class="keyword">var</span> uris = [];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, len = ids.length; i &lt; len; i++) &#123;</span><br><span class="line">    uris[i] = Module.resolve(ids[i], mod.uri);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> uris;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>è·å– dependencies çš„ uri</p><h3 id="Module-prototype-pass"><a href="#Module-prototype-pass" class="headerlink" title="Module.prototype.pass"></a>Module.prototype.pass</h3><p>å°†å½“å‰ mod çš„ _entry æ·»åŠ åˆ° dependcies çš„_entry é‡Œè¾¹ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">Module.prototype.pass = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> mod = <span class="built_in">this</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> len = mod.dependencies.length;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; mod._entry.length; i++) &#123;</span><br><span class="line">    <span class="keyword">var</span> entry = mod._entry[i];</span><br><span class="line">    <span class="keyword">var</span> count = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> j = <span class="number">0</span>; j &lt; len; j++) &#123;</span><br><span class="line">      <span class="keyword">var</span> m = mod.deps[mod.dependencies[j]];</span><br><span class="line">      <span class="comment">// If the module is unload and unused in the entry, pass entry to it</span></span><br><span class="line">      <span class="keyword">if</span> (m.status &lt; STATUS.LOADED &amp;&amp; !entry.history.hasOwnProperty(m.uri)) &#123;</span><br><span class="line">        entry.history[m.uri] = <span class="literal">true</span>;</span><br><span class="line">        count++;</span><br><span class="line">        m._entry.push(entry);</span><br><span class="line">        <span class="keyword">if</span> (m.status === STATUS.LOADING) &#123;</span><br><span class="line">          m.pass();</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// If has passed the entry to it&#x27;s dependencies, modify the entry&#x27;s count and del it in the module</span></span><br><span class="line">    <span class="keyword">if</span> (count &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      entry.remain += count - <span class="number">1</span>;</span><br><span class="line">      mod._entry.shift();</span><br><span class="line">      i--;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>è¿™æ®µä»£ç å…ˆè·å–<code>mod.dependencies.length</code>ã€‚ç„¶åéå† <code>mod._entry</code>, äºŒå±‚å¾ªç¯éå† <code>mod.dependencies</code>ï¼Œå¦‚æœ dependencies é‡Œæœ‰æœªåŠ è½½çš„ä¸” entry.history æ²¡æœ‰ä¿ç•™ï¼Œé‚£ä¹ˆå°±å°† entry push åˆ°å½“å‰ dependence çš„ _entry é‡Œï¼Œå¦‚æœå½“å‰ dependence çš„çŠ¶æ€æ˜¯ loading, å°± é€’å½’ passã€‚</p><h3 id="Module-prototype-onload"><a href="#Module-prototype-onload" class="headerlink" title="Module.prototype.onload"></a>Module.prototype.onload</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Call this method when module is loaded</span></span><br><span class="line">Module.prototype.onload = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> mod = <span class="built_in">this</span>;</span><br><span class="line">  mod.status = STATUS.LOADED;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// When sometimes cached in IE, exec will occur before onload, make sure len is an number</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, len = (mod._entry || []).length; i &lt; len; i++) &#123;</span><br><span class="line">    <span class="keyword">var</span> entry = mod._entry[i];</span><br><span class="line">    <span class="keyword">if</span> (--entry.remain === <span class="number">0</span>) &#123;</span><br><span class="line">      entry.callback();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">delete</span> mod._entry;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>å°† mod çš„ status å˜æˆ STATUS.LOADEDã€‚åœ¨ mod.remain ä¸º 1 æ—¶ï¼Œä¹Ÿå°±æ˜¯åªæœ‰ mod è‡ªå·±æ—¶ï¼Œæ‰§è¡Œ mod.callback</p><h3 id="Module-prototype-exec"><a href="#Module-prototype-exec" class="headerlink" title="Module.prototype.exec"></a>Module.prototype.exec</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">Module.prototype.exec = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> mod = <span class="built_in">this</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// When module is executed, DO NOT execute it again. When module</span></span><br><span class="line">  <span class="comment">// is being executed, just return `module.exports` too, for avoiding</span></span><br><span class="line">  <span class="comment">// circularly calling</span></span><br><span class="line">  <span class="keyword">if</span> (mod.status &gt;= STATUS.EXECUTING) &#123;</span><br><span class="line">    <span class="keyword">return</span> mod.exports;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  mod.status = STATUS.EXECUTING;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (mod._entry &amp;&amp; !mod._entry.length) &#123;</span><br><span class="line">    <span class="keyword">delete</span> mod._entry;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//non-cmd module has no property factory and exports</span></span><br><span class="line">  <span class="keyword">if</span> (!mod.hasOwnProperty(<span class="string">&quot;factory&quot;</span>)) &#123;</span><br><span class="line">    mod.non = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Create require</span></span><br><span class="line">  <span class="keyword">var</span> uri = mod.uri;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">require</span>(<span class="params">id</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> m = mod.deps[id] || Module.get(<span class="built_in">require</span>.resolve(id));</span><br><span class="line">    <span class="keyword">if</span> (m.status == STATUS.ERROR) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;module was broken: &quot;</span> + m.uri);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> m.exec();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">require</span>.resolve = <span class="function"><span class="keyword">function</span> (<span class="params">id</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> Module.resolve(id, uri);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">require</span>.async = <span class="function"><span class="keyword">function</span> (<span class="params">ids, callback</span>) </span>&#123;</span><br><span class="line">    Module.use(ids, callback, uri + <span class="string">&quot;_async_&quot;</span> + cid());</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">require</span>;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Exec factory</span></span><br><span class="line">  <span class="keyword">var</span> factory = mod.factory;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> <span class="built_in">exports</span> = isFunction(factory)</span><br><span class="line">    ? factory.call((mod.exports = &#123;&#125;), <span class="built_in">require</span>, mod.exports, mod)</span><br><span class="line">    : factory;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">exports</span> === <span class="literal">undefined</span>) &#123;</span><br><span class="line">    <span class="built_in">exports</span> = mod.exports;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Reduce memory leak</span></span><br><span class="line">  <span class="keyword">delete</span> mod.factory;</span><br><span class="line"></span><br><span class="line">  mod.exports = <span class="built_in">exports</span>;</span><br><span class="line">  mod.status = STATUS.EXECUTED;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Emit `exec` event</span></span><br><span class="line">  emit(<span class="string">&quot;exec&quot;</span>, mod);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> mod.exports;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œ factory å‡½æ•°ï¼Œè¿”å›ä¸€ä¸ªå¯¹è±¡ï¼ŒåŒ…å« factory ä¸­ exports çš„å˜é‡ã€‚<br>åœ¨ exec ä¸­ï¼Œä¼šåˆ¤æ–­ mod çš„çŠ¶æ€å¦‚æœæ˜¯ EXECUTING æˆ–è€… EXECUTEDï¼Œå°±ç›´æ¥è¿”å› mod.exportsï¼Œ é¿å…äº†é‡å¤æ‰§è¡Œã€‚å†æ¬¡åˆ¤æ–­ mod._entry, å¦‚æœä¸ºç©ºå°± delete æ‰ã€‚è¿™é‡Œä¼šå°† mod.exports ä¸ factory ä¸­æ”¹å˜çš„ exports è¿›è¡Œä¸€ä¸ªåŒæ­¥ã€‚</p><h3 id="Module-prototype-fetch"><a href="#Module-prototype-fetch" class="headerlink" title="Module.prototype.fetch"></a>Module.prototype.fetch</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Fetch a module</span></span><br><span class="line">Module.prototype.fetch = <span class="function"><span class="keyword">function</span> (<span class="params">requestCache</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> mod = <span class="built_in">this</span>;</span><br><span class="line">  <span class="keyword">var</span> uri = mod.uri;</span><br><span class="line"></span><br><span class="line">  mod.status = STATUS.FETCHING;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Emit `fetch` event for plugins such as combo plugin</span></span><br><span class="line">  <span class="keyword">var</span> emitData = &#123; <span class="attr">uri</span>: uri &#125;;</span><br><span class="line">  emit(<span class="string">&quot;fetch&quot;</span>, emitData);</span><br><span class="line">  <span class="keyword">var</span> requestUri = emitData.requestUri || uri;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Empty uri or a non-CMD module</span></span><br><span class="line">  <span class="keyword">if</span> (!requestUri || fetchedList.hasOwnProperty(requestUri)) &#123;</span><br><span class="line">    mod.load();</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (fetchingList.hasOwnProperty(requestUri)) &#123;</span><br><span class="line">    callbackList[requestUri].push(mod);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  fetchingList[requestUri] = <span class="literal">true</span>;</span><br><span class="line">  callbackList[requestUri] = [mod];</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Emit `request` event for plugins such as text plugin</span></span><br><span class="line">  emit(</span><br><span class="line">    <span class="string">&quot;request&quot;</span>,</span><br><span class="line">    (emitData = &#123;</span><br><span class="line">      <span class="attr">uri</span>: uri,</span><br><span class="line">      <span class="attr">requestUri</span>: requestUri,</span><br><span class="line">      <span class="attr">onRequest</span>: onRequest,</span><br><span class="line">      <span class="attr">charset</span>: isFunction(data.charset)</span><br><span class="line">        ? data.charset(requestUri)</span><br><span class="line">        : data.charset,</span><br><span class="line">      <span class="attr">crossorigin</span>: isFunction(data.crossorigin)</span><br><span class="line">        ? data.crossorigin(requestUri)</span><br><span class="line">        : data.crossorigin,</span><br><span class="line">    &#125;)</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!emitData.requested) &#123;</span><br><span class="line">    requestCache</span><br><span class="line">      ? (requestCache[emitData.requestUri] = sendRequest)</span><br><span class="line">      : sendRequest();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">sendRequest</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    seajs.request(</span><br><span class="line">      emitData.requestUri,</span><br><span class="line">      emitData.onRequest,</span><br><span class="line">      emitData.charset,</span><br><span class="line">      emitData.crossorigin</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">onRequest</span>(<span class="params">error</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">delete</span> fetchingList[requestUri];</span><br><span class="line">    fetchedList[requestUri] = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Save meta data of anonymous module</span></span><br><span class="line">    <span class="keyword">if</span> (anonymousMeta) &#123;</span><br><span class="line">      Module.save(uri, anonymousMeta);</span><br><span class="line">      anonymousMeta = <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Call callbacks</span></span><br><span class="line">    <span class="keyword">var</span> m,</span><br><span class="line">      mods = callbackList[requestUri];</span><br><span class="line">    <span class="keyword">delete</span> callbackList[requestUri];</span><br><span class="line">    <span class="keyword">while</span> ((m = mods.shift())) &#123;</span><br><span class="line">      <span class="comment">// When 404 occurs, the params error will be true</span></span><br><span class="line">      <span class="keyword">if</span> (error === <span class="literal">true</span>) &#123;</span><br><span class="line">        m.error();</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        m.load();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>æ ¹æ® mod.uri è¿›è¡Œ fetch æ“ä½œï¼Œå¦‚æœ uri ä¸ºç©ºæˆ–è€…ï¼Œ fetchedList å·²ç» fetch äº†ï¼Œå°±æ‰§è¡Œ mod.loadã€‚è¿™é‡Œçš„ request å°±ç›´æ¥æ‰§è¡Œ <a href="#seajsrequest">seajs.request</a>ã€‚è¿›è¡Œè„šæœ¬è¯·æ±‚ã€‚æœ€åæ‰§è¡Œ <a href="#moduleprototypeload">Module.prototype.load</a></p><h2 id="mod-callback"><a href="#mod-callback" class="headerlink" title="mod.callback"></a>mod.callback</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">mod.callback = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> <span class="built_in">exports</span> = [];</span><br><span class="line">  <span class="keyword">var</span> uris = mod.resolve();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, len = uris.length; i &lt; len; i++) &#123;</span><br><span class="line">    <span class="built_in">exports</span>[i] = cachedMods[uris[i]].exec();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (callback) &#123;</span><br><span class="line">    callback.apply(<span class="built_in">global</span>, <span class="built_in">exports</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">delete</span> mod.callback;</span><br><span class="line">  <span class="keyword">delete</span> mod.history;</span><br><span class="line">  <span class="keyword">delete</span> mod.remain;</span><br><span class="line">  <span class="keyword">delete</span> mod._entry;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>è°ƒç”¨æ¯ä¸ªä¾èµ–æ¨¡å—çš„ <a href="#moduleprototypeexec">exec</a> æ–¹æ³•ã€‚å¦‚æœ seajs.use ä¼ å…¥äº† callback, é‚£ä¹ˆä¼šä¼ å…¥ exports çš„å¯¹è±¡ä¸º callback çš„å‚æ•°ã€‚åˆ é™¤ callback, history, remain, _entry å±æ€§ï¼Œå‡å°‘å†…å­˜ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;ä»‹ç»ï¼šjs æ¨¡å—åŠ è½½å™¨ã€‚è¿™ä¸ªå¼€æºé¡¹ç›®åº”è¯¥æ˜¯å¤šå¹´å‰çš„äº†ï¼Œæœ€æ–°ç‰ˆæœ¬ä¹Ÿæ˜¯åœ¨ 2014-03-06 çš„ 2.2.0 ç‰ˆæœ¬äº†ã€‚æ‰€ä»¥ï¼Œå¯¹äºç°åœ¨çš„æµè§ˆå™¨ï¼Œä½¿ç”¨ script æ ‡ç­¾çš„ type=â€moduleâ€ &lt;a href=&quot;https://hacks.mozilla.org/2015/08/es6-in-depth-modules/&quot;&gt;es6-in-depth-modules&lt;/a&gt;,ä¾¿å¯ä»¥ä½¿ç”¨æ¨¡å—åŒ–äº†ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;è¿™ç¯‡èµ·å› æ˜¯åˆ·åˆ°äº†ç‰ä¼¯å¤§ä½¬ç¦»èŒçš„æ¶ˆæ¯ï¼Œäº†è§£åˆ° seajs è¿™ä¸ªæ¨¡å—åŠ è½½å™¨æ˜¯ä»–å†™çš„ï¼Œæ‰€ä»¥å°±é˜…è¯»äº†ä¸€æ‰‹ï¼Œå¦‚æœ‰å†’çŠ¯ï¼Œæ³è¯·åŸè°…ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ä¾æ—§å»¶ç»­ä¸Šæ¬¡çš„æ–¹æ³•ï¼Œæˆ‘ä»¬å…ˆä»ä½¿ç”¨æ–¹å¼å¼€å§‹ã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight ts&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// å®šä¹‰æ¨¡å—&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;define(&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt; (&lt;span class=&quot;params&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;require&lt;/span&gt;, &lt;span class=&quot;built_in&quot;&gt;exports&lt;/span&gt;, &lt;span class=&quot;built_in&quot;&gt;module&lt;/span&gt;&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; $ = &lt;span class=&quot;built_in&quot;&gt;require&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&amp;quot;jquery&amp;quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; Spinning = &lt;span class=&quot;built_in&quot;&gt;require&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&amp;quot;./spinning&amp;quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;built_in&quot;&gt;exports&lt;/span&gt;.moduleParam = &lt;span class=&quot;string&quot;&gt;&amp;quot;param&amp;quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;ä¸Šé¢å°±æ˜¯ Sea.js æ¨èçš„ CMD æ¨¡å—ä¹¦å†™æ ¼å¼ã€‚å¦‚æœä½ æœ‰ä½¿ç”¨è¿‡ Node.jsï¼Œä¸€åˆ‡éƒ½å¾ˆè‡ªç„¶ã€‚&lt;/p&gt;
&lt;h2 id=&quot;æ–‡ä»¶ç›®å½•ç»“æ„&quot;&gt;&lt;a href=&quot;#æ–‡ä»¶ç›®å½•ç»“æ„&quot; class=&quot;headerlink&quot; title=&quot;æ–‡ä»¶ç›®å½•ç»“æ„&quot;&gt;&lt;/a&gt;æ–‡ä»¶ç›®å½•ç»“æ„&lt;/h2&gt;&lt;p&gt;å†…éƒ¨ä½¿ç”¨äº†å°è£…çš„ seatools npm åŒ…ï¼Œä½¿ç”¨çš„æ˜¯ Grunt æ‰“åŒ…ï¼Œä½¿ç”¨äº†å…¶ä¸­çš„ contact file åŠŸèƒ½ã€‚å…¶ä¼šè¿›è¡Œæ–‡ä»¶åˆå¹¶æ“ä½œï¼Œæ‰€ä»¥ä¼šè§åˆ°æºç çš„ intro.js ä¸ outro.js é‚£ç§ä¸å®Œæ•´çš„å†™æ³•ã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;concat: &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;attr&quot;&gt;dist&lt;/span&gt;: &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;attr&quot;&gt;src&lt;/span&gt;: [&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &lt;span class=&quot;string&quot;&gt;&amp;#x27;src/intro.js&amp;#x27;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &lt;span class=&quot;string&quot;&gt;&amp;#x27;src/sea.js&amp;#x27;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &lt;span class=&quot;string&quot;&gt;&amp;#x27;src/util-lang.js&amp;#x27;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &lt;span class=&quot;string&quot;&gt;&amp;#x27;src/util-events.js&amp;#x27;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &lt;span class=&quot;string&quot;&gt;&amp;#x27;src/util-path.js&amp;#x27;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &lt;span class=&quot;string&quot;&gt;&amp;#x27;src/util-request.js&amp;#x27;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &lt;span class=&quot;string&quot;&gt;&amp;#x27;src/util-cs.js&amp;#x27;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &lt;span class=&quot;string&quot;&gt;&amp;#x27;src/util-deps.js&amp;#x27;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &lt;span class=&quot;string&quot;&gt;&amp;#x27;src/module.js&amp;#x27;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &lt;span class=&quot;string&quot;&gt;&amp;#x27;src/config.js&amp;#x27;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &lt;span class=&quot;string&quot;&gt;&amp;#x27;src/outro.js&amp;#x27;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ],&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;attr&quot;&gt;dest&lt;/span&gt;: &lt;span class=&quot;string&quot;&gt;&amp;#x27;dist/sea-debug.js&amp;#x27;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="æºç é˜…è¯»" scheme="https://jealh.xyz/categories/%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB/"/>
    
    
    <category term="æºç " scheme="https://jealh.xyz/tags/%E6%BA%90%E7%A0%81/"/>
    
  </entry>
  
  <entry>
    <title>koaæºç é˜…è¯»</title>
    <link href="https://jealh.xyz/2023/04/10/koa%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB/"/>
    <id>https://jealh.xyz/2023/04/10/koa%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB/</id>
    <published>2023-04-10T07:03:45.000Z</published>
    <updated>2023-04-11T07:08:48.250Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>å‰è¨€ï¼škoa ä½œä¸ºä¸€ä¸ªè½»é‡ç‰ˆçš„ node æœåŠ¡ç«¯æ¡†æ¶ï¼Œå…¶ç‹¬ç‰¹çš„æ´‹è‘±åœˆæ¨¡å‹æ˜¯å€¼å¾—ä¸€æ¢ç©¶ç«Ÿçš„ã€‚è¿™ç¯‡ blog å°±æ¥å­¦ä¹ ä¸€ä¸‹å…¶ä¸­çš„å¥¥å¦™å§ã€‚</p></blockquote><h2 id="å¼€å§‹"><a href="#å¼€å§‹" class="headerlink" title="å¼€å§‹"></a>å¼€å§‹</h2><p>é¦–å…ˆï¼Œæˆ‘ä»¬å¯ä»¥ä»å…¶ä½¿ç”¨æ–¹å¼å¼€å§‹ã€‚é€šè¿‡å¼•å…¥ koa, åˆ›å»ºä¸€ä¸ª app å®ä¾‹ï¼Œé€šè¿‡ use æ–¹æ³•ï¼Œæ‹¦æˆªè¯·æ±‚ã€‚ç„¶å listen ç«¯å£ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Koa = <span class="built_in">require</span>(<span class="string">&quot;koa&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa();</span><br><span class="line"></span><br><span class="line">app.use(<span class="keyword">async</span> (ctx) =&gt; &#123;</span><br><span class="line">  ctx.body = <span class="string">&quot;Hello World&quot;</span>;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">3000</span>);</span><br></pre></td></tr></table></figure><p>æ‰“å¼€æºç å¯ä»¥å‘ç°ï¼Œé»˜è®¤å¯¼å‡ºçš„æ˜¯ä¸€ä¸ª Application å¯¹è±¡ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="class"><span class="keyword">class</span> <span class="title">Application</span> <span class="keyword">extends</span> <span class="title">Emitter</span> </span>&#123;&#125;;</span><br></pre></td></tr></table></figure><span id="more"></span><h3 id="Application-å¯¹è±¡"><a href="#Application-å¯¹è±¡" class="headerlink" title="Application å¯¹è±¡"></a>Application å¯¹è±¡</h3><h4 id="constructor-NaN"><a href="#constructor-NaN" class="headerlink" title="constructor"></a>constructor</h4><p>åœ¨æ„é€ å‡½æ•°ä¸­ï¼Œä¸»è¦åšçš„å°±æ˜¯åˆ›å»º middleware æ•°ç»„ï¼Œå†…ç½® contextã€requestã€response å¯¹è±¡ã€‚åŒæ—¶å¯ä»¥ä¼ å…¥å¦‚ä¸‹ option</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">constructor</span> <span class="title">options</span> = &#123;</span><br><span class="line">  <span class="attr">env</span>: string, <span class="comment">// Environment</span></span><br><span class="line">  <span class="attr">keys</span>: string[], <span class="comment">// Signed cookie keys</span></span><br><span class="line">  <span class="attr">proxy</span>: boolean, <span class="comment">// Trust proxy headers</span></span><br><span class="line">  <span class="attr">subdomainOffset</span>: number, <span class="comment">// Subdomain offset</span></span><br><span class="line">  <span class="attr">proxyIpHeader</span>: string, <span class="comment">// Proxy IP header,defaults to X-Forwarded-For</span></span><br><span class="line">  <span class="attr">maxIpsCount</span>: number, <span class="comment">// Max IPs read from proxy IPheader, default to 0 (means infinity)</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ”¯æŒåŠ¨æ€è®¾å®šå‚æ•°ã€‚å› ä¸ºåœ¨æ„é€ å‡½æ•°ä¸­ä¼šæŠŠ option çš„å±æ€§èµ‹å€¼åˆ°å±æ€§ä¸Š <code>this.proxy = options.proxy || false</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Koa = <span class="built_in">require</span>(<span class="string">&quot;koa&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa(&#123; <span class="attr">proxy</span>: <span class="literal">true</span> &#125;);</span><br><span class="line">app.proxy = <span class="literal">false</span>; <span class="comment">// åŠ¨æ€è®¾ç½®å‚æ•°</span></span><br></pre></td></tr></table></figure><p>è®¾ç½®å®Œä¸€äº›é…ç½®åï¼Œä¼šè®¾ç½®å†…ç½®çš„ middlewareã€contextã€responseã€request å±æ€§ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">this</span>.middleware = [];</span><br><span class="line"><span class="comment">// context request response ä¸º koaçš„å†…ç½®å¯¹è±¡ï¼Œåˆ†åˆ«åœ¨context.js request.js response.js æ–‡ä»¶ä¸­</span></span><br><span class="line"><span class="built_in">this</span>.context = <span class="built_in">Object</span>.create(context);</span><br><span class="line"><span class="built_in">this</span>.request = <span class="built_in">Object</span>.create(request);</span><br><span class="line"><span class="built_in">this</span>.response = <span class="built_in">Object</span>.create(response);</span><br></pre></td></tr></table></figure><h4 id="use"><a href="#use" class="headerlink" title="use"></a>use</h4><p>use æ–¹æ³•æ˜¯å°†æä¾›çš„ middleware æ·»åŠ åˆ° <code>this.middleware</code> é‡Œé¢ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œuse æ¥å—çš„å‚æ•°å¿…é¡»æ˜¯å‡½æ•°ã€‚</p><p>åœ¨æœ€ä¸Šè¾¹ï¼Œæˆ‘ä»¬æ·»åŠ äº†ä¸€ä¸ª middlewareã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> (ctx) =&gt; &#123;</span><br><span class="line">  ctx.body = <span class="string">&quot;Hello World&quot;</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h4 id="listen"><a href="#listen" class="headerlink" title="listen"></a>listen</h4><p>listen æ˜¯ <code>http.createServer(app.callback()).listen(3000)</code> çš„è¯­æ³•ç³–ã€‚æ‰€ä»¥ï¼Œå…¶å†…éƒ¨å°±æ˜¯åˆ›å»ºä¸€ä¸ª http.Server, ç„¶åè°ƒç”¨è°ƒç”¨ listen æ–¹æ³•ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">listen (...args) &#123;</span><br><span class="line">  debug(<span class="string">&#x27;listen&#x27;</span>)</span><br><span class="line">  <span class="keyword">const</span> server = http.createServer(<span class="built_in">this</span>.callback())</span><br><span class="line">  <span class="keyword">return</span> server.listen(...args)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="callback"><a href="#callback" class="headerlink" title="callback"></a>callback</h4><p>è¿™ä¸ªæ–¹æ³•åœ¨ listen æ–¹æ³•ä¸­è°ƒç”¨ã€‚è¿”å›ä¸€ä¸ª handleRequest å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°çš„å‚æ•°å°±æ˜¯ createServer é‡Œçš„ <code>http.IncomingMessage</code>, <code>http.ServerResponse</code>å¯¹è±¡ã€‚é€šè¿‡è¿™ä¸¤ä¸ªå¯¹è±¡ï¼Œ koa ä¼šåˆ›å»ºè‡ªå·±çš„ context å¯¹è±¡ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">callback () &#123;</span><br><span class="line">  <span class="keyword">const</span> fn = compose(<span class="built_in">this</span>.middleware)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!<span class="built_in">this</span>.listenerCount(<span class="string">&#x27;error&#x27;</span>)) <span class="built_in">this</span>.on(<span class="string">&#x27;error&#x27;</span>, <span class="built_in">this</span>.onerror)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> handleRequest = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> ctx = <span class="built_in">this</span>.createContext(req, res)</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.handleRequest(ctx, fn)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> handleRequest</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>compose è¿™ä¸ªæ–¹æ³•ä½¿ç”¨çš„æ˜¯ koa-compose åŒ…ï¼Œå…¶å†…éƒ¨æœ‰ä¸€ä¸¢ä¸¢å¤æ‚ã€‚æˆ‘ä»¬å¯ä»¥å…ˆçœ‹ handleRequest</p><h4 id="handleRequest"><a href="#handleRequest" class="headerlink" title="handleRequest"></a>handleRequest</h4><p>è¿™æ˜¯å®é™…å¤„ç†è¯·æ±‚çš„å‡½æ•°ã€‚ä¼ å…¥çš„æ˜¯ context, ä»¥åŠ compose å‡½æ•°è¿”å›çš„ä¸€ä¸ª fnMiddlewareã€‚<br>å‡½æ•°é‡Œé¢å°±é€šè¿‡ context è·å–åŸå§‹çš„ <code>http.IncomingMessage</code> å¯¹è±¡ï¼Œç„¶åå…ˆè®¾ç½®<br>statusCode = 404,(è¿™é‡Œæ˜¾å¼åœ°è®¾ç½® 404ï¼Œæƒ³æƒ³åé¢åœ¨å“ªè®¾ç½® 200 å‘¢ï¼Ÿæç¤ºï¼šgetter/setter) æœ€åé€šè¿‡ respond å‡½æ•°</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">handleRequest (ctx, fnMiddleware) &#123;</span><br><span class="line">  <span class="keyword">const</span> res = ctx.res</span><br><span class="line">  res.statusCode = <span class="number">404</span></span><br><span class="line">  <span class="keyword">const</span> onerror = <span class="function"><span class="params">err</span> =&gt;</span> ctx.onerror(err)</span><br><span class="line">  <span class="keyword">const</span> handleResponse = <span class="function">() =&gt;</span> respond(ctx)</span><br><span class="line">  onFinished(res, onerror)</span><br><span class="line">  <span class="keyword">return</span> fnMiddleware(ctx).then(handleResponse).catch(onerror)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ° compose å‡½æ•°è¿”å›çš„æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå¹¶ä¸”ä¼šæ¥å— context å‚æ•°ã€‚</p><h5 id="compose"><a href="#compose" class="headerlink" title="compose"></a>compose</h5><p>ä»ä¸Šé¢ï¼Œæˆ‘ä»¬çŸ¥é“äº† compose è¿”å›çš„æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå¹¶ä¸”ä¼šæ¥å— context å‚æ•°ï¼Œé‚£ä¸‹é¢å°±æ¥ä¸€ç¹å…¨è²Œå§ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">compose</span>(<span class="params">middleware</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!<span class="built_in">Array</span>.isArray(middleware))</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">TypeError</span>(<span class="string">&quot;Middleware stack must be an array!&quot;</span>);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> fn <span class="keyword">of</span> middleware) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> fn !== <span class="string">&quot;function&quot;</span>)</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">TypeError</span>(<span class="string">&quot;Middleware must be composed of functions!&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;Object&#125;</span> <span class="variable">context</span></span></span></span><br><span class="line"><span class="comment">   * <span class="doctag">@return <span class="type">&#123;Promise&#125;</span></span></span></span><br><span class="line"><span class="comment">   * <span class="doctag">@api <span class="variable">public</span></span></span></span><br><span class="line"><span class="comment">   * è¿™é‡Œä¼šæ¥å— context,è€Œä¸”è¿˜å¯ä»¥æ¥å—ä¸€ä¸ª next</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">context, next</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// last called middleware #</span></span><br><span class="line">    <span class="keyword">let</span> index = -<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> dispatch(<span class="number">0</span>);</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">dispatch</span>(<span class="params">i</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (i &lt;= index)</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;next() called multiple times&quot;</span>));</span><br><span class="line">      index = i;</span><br><span class="line">      <span class="keyword">let</span> fn = middleware[i];</span><br><span class="line">      <span class="keyword">if</span> (i === middleware.length) fn = next;</span><br><span class="line">      <span class="keyword">if</span> (!fn) <span class="keyword">return</span> <span class="built_in">Promise</span>.resolve();</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Promise</span>.resolve(fn(context, dispatch.bind(<span class="literal">null</span>, i + <span class="number">1</span>)));</span><br><span class="line">      &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(err);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…‰çœ‹ä»£ç æ˜¯æœ‰ç‚¹æŠ½è±¡çš„ï¼Œæœ€å¥½çš„æ–¹æ³•å°±æ˜¯æ¨¡æ‹Ÿä¸€éï¼Œæˆ‘ä»¬å°±ä»¥æœ€å¼€å§‹çš„ä»£ç ä¸ºä¾‹ã€‚</p><ol><li>é¦–å…ˆ middleware æ•°ç»„æ˜¯è¿™æ ·çš„,åªæœ‰ä¸€ä¸ªå…ƒç´ ï¼Œé‚£æˆ‘ä»¬å¼€å§‹æ‰§è¡Œ composeã€‚</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">  <span class="keyword">async</span> (ctx) =&gt; &#123;</span><br><span class="line">    ctx.body = <span class="string">&quot;Hello World&quot;</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">];</span><br></pre></td></tr></table></figure><ol start="2"><li>compose å•å•åªæ˜¯è¿”å›ä¸€ä¸ªå‡½æ•° <code>function (context, next) &#123;...&#125;</code>ï¼Œåªæœ‰åœ¨ handleRequest ä¸­æ‰ä¼šæ‰§è¡Œã€‚å¹¶ä¸”è¿™é‡Œåªä¼ å…¥äº† context, next = undefinedã€‚<br>å³æ˜¯ï¼š</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fnMiddleware(ctx).then(handleResponse).catch(onerror);</span><br></pre></td></tr></table></figure><ol start="3"><li>è¿›å…¥ fnMiddleware å‡½æ•°é‡Œï¼Œä¼šæ‰§è¡Œ <code>dispatch(0)</code></li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">dispatch</span>(<span class="params">i</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (i &lt;= index)</span><br><span class="line">    <span class="comment">// i = 0, index = -1</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;next() called multiple times&quot;</span>));</span><br><span class="line">  index = i;</span><br><span class="line">  <span class="keyword">let</span> fn = middleware[i];</span><br><span class="line">  <span class="keyword">if</span> (i === middleware.length) fn = next;</span><br><span class="line">  <span class="keyword">if</span> (!fn) <span class="keyword">return</span> <span class="built_in">Promise</span>.resolve();</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Promise</span>.resolve(fn(context, dispatch.bind(<span class="literal">null</span>, i + <span class="number">1</span>)));</span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(err);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå°±ä¼šæ‰§è¡Œ, ä¹Ÿå°±æ˜¯æˆ‘ä»¬è‡ªå·±çš„ä¸­é—´ä»¶ï¼Œä»ä¸Šé¢å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬è‡ªå·±å†™çš„ä¸­é—´ä»¶å‡½æ•°ä¼šé»˜è®¤ä¼ å…¥ä¸¤ä¸ªå‚æ•° <code>fn(context, dispatch.bind(null, i + 1))</code>, context ä¸ dispatch.bind(null, i+1)ã€‚è¿™é‡Œçš„ dispatch å°±æ˜¯æˆ‘ä»¬ä¸­é—´ä»¶é‡Œé¢çš„ nextã€‚</p><p>ä»è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå¦‚æœåœ¨æˆ‘ä»¬å†™çš„ä¸­é—´ä»¶é‡Œé¢ä¸æ‰§è¡Œ next çš„è¯ï¼Œé‚£å°±åªä¼šæ‰§è¡Œç¬¬ä¸€æ¬¡ use æ·»åŠ çš„å‡½æ•°äº†ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> (ctx) =&gt; &#123;</span><br><span class="line">    ctx.body = <span class="string">&quot;Hello World&quot;</span>;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><ol start="4"><li>å†æ¥çœ‹çœ‹å¤šä¸ª middleware çš„æƒ…å†µã€‚</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">  <span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">    <span class="keyword">await</span> next();</span><br><span class="line">    ctx.body = <span class="string">&quot;Hello World&quot;</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="keyword">async</span> (ctx) =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;2&quot;</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">];</span><br></pre></td></tr></table></figure><p>è¿˜æ˜¯æ‰§è¡Œåˆ° <code>fn(context, dispatch.bind(null, i + 1))</code>ï¼Œè¿™é‡Œ fn å°±æ˜¯ç¬¬ä¸€ä¸ªä¸­é—´ä»¶ï¼Œåœ¨ç¬¬ä¸€ä¸ªä¸­é—´ä»¶é‡Œï¼Œæˆ‘ä»¬æ‰§è¡Œäº† next, ä¹Ÿå°±æ˜¯ <code>dispatch(1)</code>ã€‚åœ¨ <code>dispatch(1)</code> é‡Œï¼Œæˆ‘ä»¬åˆä¼šæ‰§è¡Œåˆ° <code>fn(context, dispatch.bind(null, i + 1))</code> è¿™é‡Œï¼Œåªä¸è¿‡ï¼Œè¿™é‡Œçš„ fn æ˜¯ middleware[1], ä¹Ÿå°±æ˜¯ console.log(â€œ2â€)è¿™ä¸ªä¸­é—´ä»¶ã€‚</p><p>åœ¨ç¬¬äºŒä¸ªä¸­é—´ä»¶é‡Œæˆ‘ä»¬æ²¡æœ‰æ‰§è¡Œ next å‡½æ•°äº†ï¼Œè¿™æ ·å°±å›æº¯åˆ°äº†ç¬¬ä¸€ä¸ªä¸­é—´ä»¶ <code>ctx.body = &quot;hello world&quot;</code> è¿™é‡Œäº†, è¿™é‡Œæ‰§è¡Œå®Œåï¼Œå°±ä¼šæ¥åˆ° <a href="#handlerequest">handleRequest</a> å‡½æ•° <code>fnMiddleware(ctx).then(handleResponse)</code> ç„¶åæ‰§è¡Œ handleResponse -&gt; respondã€‚</p><p>å¦‚æœæˆ‘ä»¬åœ¨ç¬¬äºŒä¸ªä¸­é—´ä»¶ä¸­ç»§ç»­æ‰§è¡Œ next å‘¢ã€‚è¿™é‡Œä¹Ÿå°±æ˜¯ dispatch(2), ä¼šè¿›å…¥ <code>if (i === middleware.length) fn = next;</code> è¿™é‡Œï¼Œè¿™é‡Œçš„ next æ˜¯æœ€å¼€å§‹ <code>fnMiddleware(ctx)</code> ä¼ å…¥çš„ï¼Œæ˜¾ç„¶æ˜¯ undefined, ç„¶åèµ° <code>if (!fn) return Promise.resolve();</code> è¿™ä¸ªé€»è¾‘ï¼Œç»“æŸé€’å½’ã€‚</p><h5 id="compose-çš„é™åˆ¶"><a href="#compose-çš„é™åˆ¶" class="headerlink" title="compose çš„é™åˆ¶"></a>compose çš„é™åˆ¶</h5><p>ä»ä¸Šé¢çš„ä¾‹å­åœ¨æ‰©å±•ä¸‹ï¼Œå¦‚æœæˆ‘ä»¬æ‰§è¡Œåˆ° dispatch(2) å†å»æ‰§è¡Œä¸€ä¸‹ next, ä¼šæ€æ ·å‘¢ï¼Ÿ</p><p>åˆ«å¿˜äº†ï¼Œæˆ‘ä»¬è¿˜æœ‰ä¸€ä¸ªåˆ†æ”¯æ²¡æœ‰èµ°åˆ°å‘¢ï¼</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (i &lt;= index)</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;next() called multiple times&quot;</span>));</span><br></pre></td></tr></table></figure><p>åœ¨ dispatch(2) åï¼Œå†å»æ‰§è¡Œä¸€æ¬¡ next, ç›¸å½“äºå†æ‰§è¡Œä¸€æ¬¡ dispatch(2)ã€‚ä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´å‘¢ï¼Œå› ä¸ºåœ¨æœ€åä¸€ä¸ªä¸­é—´ä»¶é‡Œé¢ï¼Œæˆ‘ä»¬çš„ next å‡½æ•°å°±æ˜¯ fnMiddleware é‡Œçš„ç¬¬äºŒä¸ªå‚æ•°ï¼Œå³ undefined äº†ï¼Œè¿™é‡Œèµ°çš„é€»è¾‘æ˜¯ <code>if (!fn) return Promise.resolve();</code>, ç›´æ¥ resolve æ‰äº†ã€‚å¹¶æ²¡æœ‰æ‰§è¡Œ <code>dispatch.bind(null, i + 1)</code> è¿™é‡Œã€‚ç„¶è€Œä¸åŒçš„æ˜¯ compose å‡½æ•°é‡Œé¢çš„é—­åŒ… indexã€‚index çš„å«ä¹‰å…¶å®æ˜¯ä¸Šä¸€æ¬¡çš„ iã€‚</p><p>å½“æˆ‘ä»¬åœ¨æœ€åä¸€ä¸ªä¸­é—´ä»¶ä¸­æ‰§è¡Œä¸¤æ¬¡ next æ—¶ï¼Œç¬¬äºŒæ¬¡ next å°±æ»¡è¶³äº† <code>i &lt;= index</code> è¿™ä¸ªæ¡ä»¶,æŠ›å‡º <code>&quot;next() called multiple times&quot;</code> é”™è¯¯ã€‚</p><p>å› æ­¤ï¼Œè¿™ä¹Ÿå°±é™åˆ¶äº† next çš„æ‰§è¡Œæ¬¡æ•°ï¼Œå…¶å®å¯æƒ³è€ŒçŸ¥ï¼Œè‚¯å®šä¸ä¼šè®©ä½ æ‰§è¡Œè¶…è¿‡ middleware é•¿åº¦çš„ next äº†å•Š</p><h4 id="respond"><a href="#respond" class="headerlink" title="respond"></a>respond</h4><p>å›åˆ° handleRequest é‡Œé¢ï¼Œæ‰§è¡Œå®Œæ‰€æœ‰çš„ middleware åï¼Œå°±ä¼šå¼€å§‹æ‰§è¡Œ handleResponse äº†ï¼Œä¹Ÿå°±æ˜¯ <code>respond(ctx)</code> äº†ã€‚</p><p>åœ¨è¿™ä¸ªå‡½æ•°é‡Œé¢ï¼Œå¦‚æœè®¾ç½® <code>ctx.respond = false</code>, å°±ä»£è¡¨è¦æˆ‘ä»¬è‡ªå·±å¤„ç†å“åº”æ•°æ®ã€‚ä¸€èˆ¬æ¥è¯´éƒ½æ˜¯ koa æ¥å¤„ç†ï¼Œå®˜æ–¹ä¹Ÿä¸å»ºè®®è‡ªå·±å»å¤„ç†<a href="https://koajs.com/#ctx-respond">https://koajs.com/#ctx-respond</a>ã€‚</p><p>ç„¶åå°±æ˜¯å¤„ç†ä¸€äº›æ¯”å¦‚ï¼š</p><ul><li>å“åº” body éœ€è¦ä¸ºç©ºçš„çŠ¶æ€ç ï¼ˆ304 ç¼“å­˜ã€204 æ— å†…å®¹ï¼‰å°±æ¸…ç©º body</li><li>HEAD è¯·æ±‚å“åº”æ ‡å¤´æœªå‘é€æ—¶å¹¶ä¸” response æ‹¥æœ‰ Content-Length æ—¶è®¾ç½® ctx çš„ length å±æ€§</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">respond</span>(<span class="params">ctx</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// allow bypassing koa</span></span><br><span class="line">  <span class="keyword">if</span> (ctx.respond === <span class="literal">false</span>) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!ctx.writable) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> res = ctx.res;</span><br><span class="line">  <span class="keyword">let</span> body = ctx.body;</span><br><span class="line">  <span class="keyword">const</span> code = ctx.status;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ignore body</span></span><br><span class="line">  <span class="keyword">if</span> (statuses.empty[code]) &#123;</span><br><span class="line">    <span class="comment">// strip headers</span></span><br><span class="line">    ctx.body = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">return</span> res.end();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (ctx.method === <span class="string">&quot;HEAD&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!res.headersSent &amp;&amp; !ctx.response.has(<span class="string">&quot;Content-Length&quot;</span>)) &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123; length &#125; = ctx.response;</span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">Number</span>.isInteger(length)) ctx.length = length;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res.end();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// status body</span></span><br><span class="line">  <span class="keyword">if</span> (body == <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (ctx.response._explicitNullBody) &#123;</span><br><span class="line">      ctx.response.remove(<span class="string">&quot;Content-Type&quot;</span>);</span><br><span class="line">      ctx.response.remove(<span class="string">&quot;Transfer-Encoding&quot;</span>);</span><br><span class="line">      ctx.length = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">return</span> res.end();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (ctx.req.httpVersionMajor &gt;= <span class="number">2</span>) &#123;</span><br><span class="line">      body = <span class="built_in">String</span>(code);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      body = ctx.message || <span class="built_in">String</span>(code);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!res.headersSent) &#123;</span><br><span class="line">      ctx.type = <span class="string">&quot;text&quot;</span>;</span><br><span class="line">      ctx.length = Buffer.byteLength(body);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res.end(body);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// responses</span></span><br><span class="line">  <span class="keyword">if</span> (Buffer.isBuffer(body)) <span class="keyword">return</span> res.end(body);</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> body === <span class="string">&quot;string&quot;</span>) <span class="keyword">return</span> res.end(body);</span><br><span class="line">  <span class="keyword">if</span> (body <span class="keyword">instanceof</span> Stream) <span class="keyword">return</span> body.pipe(res);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// body: json</span></span><br><span class="line">  body = <span class="built_in">JSON</span>.stringify(body);</span><br><span class="line">  <span class="keyword">if</span> (!res.headersSent) &#123;</span><br><span class="line">    ctx.length = Buffer.byteLength(body);</span><br><span class="line">  &#125;</span><br><span class="line">  res.end(body);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>åˆ°æ­¤ï¼Œä¸€æ¡ç»è¿‡ä¸­é—´ä»¶çš„è¯·æ±‚å“åº”è¿‡ç¨‹å°±ç»“æŸäº†ï¼Œä¾èµ–ä¸­é—´ä»¶ï¼Œå¯ä»¥å®ç°å…¶ä»–å¼ºå¤§çš„åŠŸèƒ½ï¼Œå¦‚ï¼šè·¯ç”±ã€‚ä¸‹é¢å°±ä»‹ç»ä¸‹ koa ä¸­çš„å†…ç½®å¯¹è±¡å§ã€‚</p></blockquote><h3 id="Context-å¯¹è±¡"><a href="#Context-å¯¹è±¡" class="headerlink" title="Context å¯¹è±¡"></a>Context å¯¹è±¡</h3><p>context æ˜¯ä¸€ä¸ªæ¯”è¾ƒé‡è¦çš„å¯¹è±¡ï¼Œå¯ä»¥è¯´æ˜¯è´¯ç©¿å…¨æ–‡çš„ï¼Œå…¶åˆ›å»ºå®ä¾‹ä½äº <a href="#handlerequest">handleRequest</a> ä¸­è°ƒç”¨ <code>createContext(req,res)</code>ã€‚å…¶å®å°±æ˜¯å­˜å‚¨ä¸€äº›ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œæ¯”å¦‚ node åŸå§‹çš„ <code>http.IncomingMessage</code>, <code>http.ServerResponse</code> å¯¹è±¡ï¼Œkoa å†…ç½®çš„ <code>Application.BaseRequest</code>, <code>Application.BaseResponse</code> å¯¹è±¡ç­‰ç­‰ã€‚</p><p>å…ˆçœ‹ä¸€ä¸‹å¤§ä½“ç»“æ„</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">app</span>: Application,</span><br><span class="line">  <span class="attr">req</span>: IncomingMessage,</span><br><span class="line">  <span class="attr">res</span>: ServerResponse,</span><br><span class="line">  <span class="attr">state</span>: &#123;&#125;,</span><br><span class="line">  <span class="attr">originalUrl</span>:IncomingMessage.url,</span><br><span class="line">  <span class="attr">request</span>: &#123;</span><br><span class="line">    <span class="attr">prototype</span>: Application.BaseRequest</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">response</span>: &#123;</span><br><span class="line">    <span class="attr">prototype</span>: Application.BaseResponse</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">prototype</span>: &#123;</span><br><span class="line">    <span class="attr">prototype</span>: &#123;</span><br><span class="line">      <span class="attr">inspect</span>: <span class="built_in">Function</span>,</span><br><span class="line">      <span class="attr">toJSON</span>: <span class="built_in">Function</span>,</span><br><span class="line">      <span class="attr">assert</span>: httpAssert,</span><br><span class="line">      <span class="attr">throw</span>: <span class="built_in">Function</span>,</span><br><span class="line">      <span class="attr">onerror</span>: <span class="built_in">Function</span>,</span><br><span class="line">      get cookie: <span class="built_in">Function</span>,</span><br><span class="line">      set cookie: <span class="built_in">Function</span>,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»¥åŠé€šè¿‡ <a href="https://www.npmjs.com/package/delegates">delegates</a>, ä¸€ä¸ªä»£ç†å±æ€§çš„åº“ ä»£ç†çš„å±æ€§ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Response delegation.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line">delegate(proto, <span class="string">&quot;response&quot;</span>)</span><br><span class="line">  .method(<span class="string">&quot;attachment&quot;</span>)</span><br><span class="line">  .method(<span class="string">&quot;redirect&quot;</span>)</span><br><span class="line">  .method(<span class="string">&quot;remove&quot;</span>)</span><br><span class="line">  .method(<span class="string">&quot;vary&quot;</span>)</span><br><span class="line">  .method(<span class="string">&quot;has&quot;</span>)</span><br><span class="line">  .method(<span class="string">&quot;set&quot;</span>)</span><br><span class="line">  .method(<span class="string">&quot;append&quot;</span>)</span><br><span class="line">  .method(<span class="string">&quot;flushHeaders&quot;</span>)</span><br><span class="line">  .access(<span class="string">&quot;status&quot;</span>)</span><br><span class="line">  .access(<span class="string">&quot;message&quot;</span>)</span><br><span class="line">  .access(<span class="string">&quot;body&quot;</span>)</span><br><span class="line">  .access(<span class="string">&quot;length&quot;</span>)</span><br><span class="line">  .access(<span class="string">&quot;type&quot;</span>)</span><br><span class="line">  .access(<span class="string">&quot;lastModified&quot;</span>)</span><br><span class="line">  .access(<span class="string">&quot;etag&quot;</span>)</span><br><span class="line">  .getter(<span class="string">&quot;headerSent&quot;</span>)</span><br><span class="line">  .getter(<span class="string">&quot;writable&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Request delegation.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line">delegate(proto, <span class="string">&quot;request&quot;</span>)</span><br><span class="line">  .method(<span class="string">&quot;acceptsLanguages&quot;</span>)</span><br><span class="line">  .method(<span class="string">&quot;acceptsEncodings&quot;</span>)</span><br><span class="line">  .method(<span class="string">&quot;acceptsCharsets&quot;</span>)</span><br><span class="line">  .method(<span class="string">&quot;accepts&quot;</span>)</span><br><span class="line">  .method(<span class="string">&quot;get&quot;</span>)</span><br><span class="line">  .method(<span class="string">&quot;is&quot;</span>)</span><br><span class="line">  .access(<span class="string">&quot;querystring&quot;</span>)</span><br><span class="line">  .access(<span class="string">&quot;idempotent&quot;</span>)</span><br><span class="line">  .access(<span class="string">&quot;socket&quot;</span>)</span><br><span class="line">  .access(<span class="string">&quot;search&quot;</span>)</span><br><span class="line">  .access(<span class="string">&quot;method&quot;</span>)</span><br><span class="line">  .access(<span class="string">&quot;query&quot;</span>)</span><br><span class="line">  .access(<span class="string">&quot;path&quot;</span>)</span><br><span class="line">  .access(<span class="string">&quot;url&quot;</span>)</span><br><span class="line">  .access(<span class="string">&quot;accept&quot;</span>)</span><br><span class="line">  .getter(<span class="string">&quot;origin&quot;</span>)</span><br><span class="line">  .getter(<span class="string">&quot;href&quot;</span>)</span><br><span class="line">  .getter(<span class="string">&quot;subdomains&quot;</span>)</span><br><span class="line">  .getter(<span class="string">&quot;protocol&quot;</span>)</span><br><span class="line">  .getter(<span class="string">&quot;host&quot;</span>)</span><br><span class="line">  .getter(<span class="string">&quot;hostname&quot;</span>)</span><br><span class="line">  .getter(<span class="string">&quot;URL&quot;</span>)</span><br><span class="line">  .getter(<span class="string">&quot;header&quot;</span>)</span><br><span class="line">  .getter(<span class="string">&quot;headers&quot;</span>)</span><br><span class="line">  .getter(<span class="string">&quot;secure&quot;</span>)</span><br><span class="line">  .getter(<span class="string">&quot;stale&quot;</span>)</span><br><span class="line">  .getter(<span class="string">&quot;fresh&quot;</span>)</span><br><span class="line">  .getter(<span class="string">&quot;ips&quot;</span>)</span><br><span class="line">  .getter(<span class="string">&quot;ip&quot;</span>);</span><br></pre></td></tr></table></figure><p>ä¹‹å‰ statusCode = 404ï¼Œ è€Œåé¢è¿”å›çš„ç¡®å® 200ï¼Œè¿™å…¶å®æ˜¯åœ¨ ctx.body = xxx, æ—¶è®¾ç½®äº†çŠ¶æ€ç ï¼Œè€Œ ctx.body æ˜¯åœ¨ Application.BaseResponse å¯¹è±¡ä¸­è®¾ç½®çš„ getter, setter å±æ€§ã€‚</p><h3 id="Application-BaseResponse-å¯¹è±¡"><a href="#Application-BaseResponse-å¯¹è±¡" class="headerlink" title="Application.BaseResponse å¯¹è±¡"></a>Application.BaseResponse å¯¹è±¡</h3><p>é€šè¿‡å¯¹åŸç”Ÿ http.ServerResponse è¿›è¡Œä»£ç†ï¼Œè®¾ç½®å“åº”ç›¸å…³çš„é…ç½®ã€‚</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">prototype</span>: &#123;</span><br><span class="line">    get socket: http.ServerResponse.socket,</span><br><span class="line">    get header: http.ServerResponse.getHeaders | http.IncomingMessage._headers,</span><br><span class="line">    get headers: <span class="built_in">this</span>.header,</span><br><span class="line">    get status: http.IncomingMessage.statusCode,</span><br><span class="line">    set status: <span class="built_in">Function</span>, <span class="comment">// 1. æ ¹æ®çŠ¶æ€ç è®¾ç½® body 2. è®¾ç½®http.IncomingMessage.statusCode</span></span><br><span class="line">    get message: http.IncomingMessage.statusMessage | statuses[<span class="built_in">this</span>.status],</span><br><span class="line">    set message: <span class="built_in">Function</span>, <span class="comment">// è®¾ç½® http.IncomingMessage.statusMessage</span></span><br><span class="line">    get body: <span class="built_in">this</span>._body,</span><br><span class="line">    set body: <span class="built_in">Function</span>,<span class="comment">// è®¾ç½® _body æœ‰ streamã€stringã€jsonç­‰,ä»¥åŠä¸€äº›å“åº”å¤´</span></span><br><span class="line">    get length: http.ServerResponse.getHeader(<span class="string">&#x27;Content-Length&#x27;</span>) | Buffer.byteLength(<span class="built_in">JSON</span>.stringify(body)),</span><br><span class="line">    set length: http.ServerResponse.setHeader(<span class="string">&#x27;Content-Length&#x27;</span>),</span><br><span class="line">    get headerSent: http.ServerResponse.headersSent, <span class="comment">// æ ‡è®°å“åº”å¤´æ˜¯å¦å·²å‘é€</span></span><br><span class="line">    <span class="attr">vary</span>: <span class="built_in">Function</span>, <span class="comment">// è®¾ç½® vary header</span></span><br><span class="line">    <span class="attr">redirect</span>: <span class="built_in">Function</span>, <span class="comment">// è®¾ç½®é‡å®šå‘ç›¸å…³çš„å¦‚302ï¼Œ Location å¤´</span></span><br><span class="line">    <span class="attr">attachment</span>: <span class="built_in">Function</span>, <span class="comment">// Content-Disposition æ–‡ä»¶ä¸‹è½½ç›¸å…³</span></span><br><span class="line">    set <span class="keyword">type</span>: <span class="built_in">Function</span>, <span class="comment">// Content-type</span></span><br><span class="line">    get <span class="keyword">type</span>: <span class="built_in">Function</span>,</span><br><span class="line">    set lastModified: <span class="built_in">Function</span>, <span class="comment">// Last-Modified</span></span><br><span class="line">    get etag: <span class="built_in">Function</span>,</span><br><span class="line">    set etag: <span class="built_in">Function</span>,</span><br><span class="line">    <span class="attr">has</span>: <span class="built_in">Function</span>, <span class="comment">// åˆ¤æ–­å“åº”å¤´æ˜¯å¦æœ‰æŒ‡å®šå­—æ®µ</span></span><br><span class="line">    <span class="attr">set</span>: <span class="built_in">Function</span>, <span class="comment">// è®¾ç½®å“åº”å¤´æ˜¯æŒ‡å®šå­—æ®µ</span></span><br><span class="line">    <span class="attr">append</span>: <span class="built_in">Function</span>, <span class="comment">// è¿½åŠ å“åº”å¤´æŸä¸ªå­—æ®µ</span></span><br><span class="line">    <span class="attr">remove</span>: <span class="built_in">Function</span>, <span class="comment">// ä¸€å¤„æŸä¸ªå“åº”å¤´å­—æ®µ</span></span><br><span class="line">    <span class="attr">writable</span>: http.ServerResponse.socket.writable | http.ServerResponse.writableEnded/finished,</span><br><span class="line">    <span class="attr">toJSON</span>: <span class="built_in">Function</span>,</span><br><span class="line">    <span class="attr">flushHeaders</span>: http.ServerResponse.flushHeaders,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="Application-BaseRequest-å¯¹è±¡"><a href="#Application-BaseRequest-å¯¹è±¡" class="headerlink" title="Application.BaseRequest å¯¹è±¡"></a>Application.BaseRequest å¯¹è±¡</h3><p>ä¸ BaseResponse å¯¹è±¡ç±»ä¼¼ï¼Œè¿™é‡Œæ˜¯å¯¹ http.IncomingMessage è¿›è¡Œçš„ä¸€ä¸ªä¸­é—´ä»£ç†ã€‚</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">prototype</span>: &#123;</span><br><span class="line">    get header: http.IncomingMessage.headers,</span><br><span class="line">    set header: http.IncomingMessage.headers,</span><br><span class="line">    get headers: http.IncomingMessage.headers,</span><br><span class="line">    set headers: http.IncomingMessage.headers,</span><br><span class="line">    get url: http.IncomingMessage.url,</span><br><span class="line">    set url: http.IncomingMessage.url,</span><br><span class="line">    get origin: <span class="string">`<span class="subst">$&#123;<span class="built_in">this</span>.protocol&#125;</span>://<span class="subst">$&#123;<span class="built_in">this</span>.host&#125;</span>`</span>,</span><br><span class="line">    get href: <span class="built_in">this</span>.originalUrl | <span class="built_in">this</span>.origin + <span class="built_in">this</span>.originalUrl,</span><br><span class="line">    get method: http.IncomingMessage.method,</span><br><span class="line">    set method: http.IncomingMessage.method,</span><br><span class="line">    get path: http.IncomingMessage.pathname,</span><br><span class="line">    set path: http.IncomingMessage.url,</span><br><span class="line">    get query: <span class="built_in">String</span>, <span class="comment">// è¿”å› queryString</span></span><br><span class="line">    set query: <span class="built_in">String</span>, <span class="comment">// è®¾ç½® this.querystring</span></span><br><span class="line">    get querystring: <span class="built_in">Function</span>, <span class="comment">// è¿”å› http.IncomingMessage.query || &#x27;&#x27;</span></span><br><span class="line">    set querystring: <span class="built_in">Function</span>, <span class="comment">// è®¾ç½® this.url</span></span><br><span class="line">    get search: <span class="string">`?<span class="subst">$&#123;<span class="built_in">this</span>.querystring&#125;</span>`</span>,</span><br><span class="line">    set search: <span class="built_in">this</span>.querystring = str,</span><br><span class="line">    get host: <span class="built_in">String</span>, <span class="comment">// è¯·æ±‚å¤´çš„ hostï¼Œ æ”¯æŒ x-Forwarded-Host</span></span><br><span class="line">    get hostname:  <span class="built_in">String</span>, <span class="comment">// host ä¸å¸¦ç«¯å£</span></span><br><span class="line">    get URL: URL,</span><br><span class="line">    get fresh: <span class="built_in">Function</span>, <span class="comment">// åˆ¤æ–­å®¢æˆ·ç«¯æ˜¯å¦è¿‡æœŸ</span></span><br><span class="line">    get stale: !<span class="built_in">this</span>.fresh,</span><br><span class="line">    get idempotent: <span class="comment">// æ£€æŸ¥è¯·æ±‚æ˜¯å¦æ˜¯å¹‚ç­‰çš„</span></span><br><span class="line">    get socket: http.IncomingMessage.socket,</span><br><span class="line">    get charset: <span class="built_in">String</span>, <span class="comment">// è·å– content-type ä¸­çš„ charset</span></span><br><span class="line">    get length: Content-Length,</span><br><span class="line">    get protocol: <span class="built_in">String</span>, <span class="comment">// è¿”å›åè®®å­—ç¬¦ä¸²â€œhttpâ€æˆ–â€œhttpsâ€</span></span><br><span class="line">    get secure: <span class="built_in">Boolean</span>, <span class="comment">// this.protocol === &quot;https&quot;</span></span><br><span class="line">    get ips: <span class="built_in">Array</span>, <span class="comment">// å«æœ‰ app.proxy = true æ—¶</span></span><br><span class="line">    get ip: <span class="built_in">String</span>, <span class="comment">// this.socket.remoteAddress || this.ips[0]</span></span><br><span class="line">    get subdomains: <span class="built_in">String</span>[], <span class="comment">// è¿”å›å­åŸŸ[]</span></span><br><span class="line">    get accept: <span class="built_in">Object</span>, <span class="comment">// Get accept object.</span></span><br><span class="line">    set accept: <span class="built_in">Function</span>, <span class="comment">// Set this._accept</span></span><br><span class="line">    <span class="attr">accepts</span>: <span class="built_in">Function</span>,</span><br><span class="line">    <span class="attr">acceptsEncodings</span>: <span class="built_in">Function</span>, <span class="comment">// Return accepted encodings or best fit based on `encodings`</span></span><br><span class="line">    <span class="attr">acceptsCharsets</span>: <span class="built_in">Function</span>, <span class="comment">// Return accepted charsets or best fit based on `charsets`</span></span><br><span class="line">    <span class="attr">acceptsLanguages</span>: <span class="built_in">Function</span>, <span class="comment">// Return accepted languages or best fit based on `langs`</span></span><br><span class="line">    <span class="attr">is</span>: <span class="built_in">Function</span>, <span class="comment">// æ£€æŸ¥ä¼ å…¥è¯·æ±‚æ˜¯å¦åŒ…å«â€œContent Typeâ€æ ‡å¤´å­—æ®µï¼Œä»¥åŠæ˜¯å¦åŒ…å«ä»»ä½•ç»™å®šçš„mimeâ€œTypeâ€ã€‚å¦‚æœæ²¡æœ‰è¯·æ±‚æ­£æ–‡ï¼Œåˆ™è¿”å›â€œnullâ€ã€‚å¦‚æœæ²¡æœ‰å†…å®¹ç±»å‹ï¼Œåˆ™è¿”å›â€œfalseâ€ã€‚å¦åˆ™ï¼Œå®ƒå°†è¿”å›ç¬¬ä¸€ä¸ªåŒ¹é…çš„â€œç±»å‹â€ã€‚</span></span><br><span class="line">    get <span class="keyword">type</span>: <span class="built_in">String</span>, <span class="comment">// Content-type</span></span><br><span class="line">    <span class="attr">get</span>: <span class="built_in">Function</span>, <span class="comment">// è·å–è¯·æ±‚å¤´çš„æŸä¸ªå­—æ®µ</span></span><br><span class="line">    <span class="attr">toJSON</span>: <span class="built_in">Function</span>,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p><a href="https://www.npmjs.com/package/statuses">https://www.npmjs.com/package/statuses</a><br><a href="https://www.npmjs.com/package/vary">https://www.npmjs.com/package/vary</a><br><a href="https://www.npmjs.com/package/delegates">https://www.npmjs.com/package/delegates</a><br><a href="https://www.npmjs.com/package/content-type">https://www.npmjs.com/package/content-type</a></p>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;å‰è¨€ï¼škoa ä½œä¸ºä¸€ä¸ªè½»é‡ç‰ˆçš„ node æœåŠ¡ç«¯æ¡†æ¶ï¼Œå…¶ç‹¬ç‰¹çš„æ´‹è‘±åœˆæ¨¡å‹æ˜¯å€¼å¾—ä¸€æ¢ç©¶ç«Ÿçš„ã€‚è¿™ç¯‡ blog å°±æ¥å­¦ä¹ ä¸€ä¸‹å…¶ä¸­çš„å¥¥å¦™å§ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;å¼€å§‹&quot;&gt;&lt;a href=&quot;#å¼€å§‹&quot; class=&quot;headerlink&quot; title=&quot;å¼€å§‹&quot;&gt;&lt;/a&gt;å¼€å§‹&lt;/h2&gt;&lt;p&gt;é¦–å…ˆï¼Œæˆ‘ä»¬å¯ä»¥ä»å…¶ä½¿ç”¨æ–¹å¼å¼€å§‹ã€‚é€šè¿‡å¼•å…¥ koa, åˆ›å»ºä¸€ä¸ª app å®ä¾‹ï¼Œé€šè¿‡ use æ–¹æ³•ï¼Œæ‹¦æˆªè¯·æ±‚ã€‚ç„¶å listen ç«¯å£ã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; Koa = &lt;span class=&quot;built_in&quot;&gt;require&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&amp;quot;koa&amp;quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; app = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Koa();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;app.use(&lt;span class=&quot;keyword&quot;&gt;async&lt;/span&gt; (ctx) =&amp;gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  ctx.body = &lt;span class=&quot;string&quot;&gt;&amp;quot;Hello World&amp;quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;app.listen(&lt;span class=&quot;number&quot;&gt;3000&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;æ‰“å¼€æºç å¯ä»¥å‘ç°ï¼Œé»˜è®¤å¯¼å‡ºçš„æ˜¯ä¸€ä¸ª Application å¯¹è±¡ã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;module&lt;/span&gt;.exports = &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Application&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Emitter&lt;/span&gt; &lt;/span&gt;&amp;#123;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="æºç é˜…è¯»" scheme="https://jealh.xyz/categories/%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB/"/>
    
    
  </entry>
  
  <entry>
    <title>ã€è¯‘ã€‘Inside Fiberï¼šæ·±å…¥æ¦‚è¿° React ä¸­çš„æ–°åè°ƒç®—æ³•</title>
    <link href="https://jealh.xyz/2023/03/26/%E3%80%90%E8%AF%91%E3%80%91Inside%20Fiber%EF%BC%9A%E6%B7%B1%E5%85%A5%E6%A6%82%E8%BF%B0%20React%20%E4%B8%AD%E7%9A%84%E6%96%B0%E5%8D%8F%E8%B0%83%E7%AE%97%E6%B3%95/"/>
    <id>https://jealh.xyz/2023/03/26/%E3%80%90%E8%AF%91%E3%80%91Inside%20Fiber%EF%BC%9A%E6%B7%B1%E5%85%A5%E6%A6%82%E8%BF%B0%20React%20%E4%B8%AD%E7%9A%84%E6%96%B0%E5%8D%8F%E8%B0%83%E7%AE%97%E6%B3%95/</id>
    <published>2023-03-26T15:47:04.000Z</published>
    <updated>2023-04-11T07:09:05.354Z</updated>
    
    <content type="html"><![CDATA[<p>åŸæ–‡é“¾æ¥ï¼š<a href="https://indepth.dev/posts/1008/inside-fiber-in-depth-overview-of-the-new-reconciliation-algorithm-in-react">https://indepth.dev/posts/1008/inside-fiber-in-depth-overview-of-the-new-reconciliation-algorithm-in-react</a></p><blockquote><p>æ·±å…¥ç ”ç©¶ React çš„åä¸º Fiber çš„æ–°æ¶æ„ï¼Œäº†è§£æ–°åè°ƒç®—æ³•çš„ä¸¤ä¸ªä¸»è¦é˜¶æ®µã€‚æˆ‘ä»¬å°†è¯¦ç»†äº†è§£ React å¦‚ä½•æ›´æ–° state å’Œ props ä»¥åŠå¤„ç† childrenã€‚</p></blockquote><span id="more"></span><p>React æ˜¯ä¸€ä¸ªç”¨äºæ„å»ºç”¨æˆ·ç•Œé¢çš„ JavaScript åº“ã€‚å…¶æ ¸å¿ƒæ˜¯è·Ÿè¸ªç»„ä»¶çŠ¶æ€å˜åŒ–å¹¶å°†æ›´æ–°åçš„çŠ¶æ€æŠ•å°„åˆ°å±å¹•çš„æœºåˆ¶ã€‚åœ¨ React ä¸­ï¼Œæˆ‘ä»¬å°†æ­¤è¿‡ç¨‹ç§°ä¸ºåè°ƒã€‚æˆ‘ä»¬è°ƒç”¨ setState æ–¹æ³•ï¼Œæ¡†æ¶æ£€æŸ¥çŠ¶æ€æˆ–é“å…·æ˜¯å¦å·²æ›´æ”¹å¹¶åœ¨ UI ä¸Šé‡æ–°å‘ˆç°ç»„ä»¶ã€‚</p><p>React çš„æ–‡æ¡£å¾ˆå¥½åœ°æ¦‚æ‹¬äº†è¯¥æœºåˆ¶ï¼šReact å…ƒç´ çš„ä½œç”¨ã€ç”Ÿå‘½å‘¨æœŸæ–¹æ³•å’Œæ¸²æŸ“æ–¹æ³•ï¼Œä»¥åŠåº”ç”¨äºç»„ä»¶å­ç»„ä»¶çš„å·®å¼‚ç®—æ³•ã€‚ä» render æ–¹æ³•è¿”å›çš„ä¸å¯å˜ React å…ƒç´ æ ‘é€šå¸¸è¢«ç§°ä¸ºâ€œè™šæ‹Ÿ DOMâ€ã€‚è¯¥æœ¯è¯­æœ‰åŠ©äºæ—©æœŸå‘äººä»¬è§£é‡Š Reactï¼Œä½†å®ƒä¹Ÿå¼•èµ·äº†æ··æ·†ï¼Œå¹¶ä¸”ä¸å†åœ¨ React æ–‡æ¡£ä¸­ä½¿ç”¨ã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘å°†åšæŒç§°å…¶ä¸º React å…ƒç´ æ ‘ã€‚</p><p>é™¤äº† React å…ƒç´ æ ‘ä¹‹å¤–ï¼Œæ¡†æ¶å§‹ç»ˆæœ‰ä¸€ä¸ªå†…éƒ¨å®ä¾‹æ ‘ï¼ˆç»„ä»¶ã€DOM èŠ‚ç‚¹ç­‰ï¼‰ç”¨äºä¿æŒçŠ¶æ€ã€‚ä»ç‰ˆæœ¬ 16 å¼€å§‹ï¼ŒReact æ¨å‡ºäº†è¯¥å†…éƒ¨å®ä¾‹æ ‘å’Œç®—æ³•çš„æ–°å®ç°ç®¡ç†å®ƒçš„ä»£å·ä¸º Fiberã€‚è¦äº†è§£ Fiber æ¶æ„å¸¦æ¥çš„ä¼˜åŠ¿ï¼Œè¯·æŸ¥çœ‹<a href="https://indepth.dev/posts/1007/the-how-and-why-on-reacts-usage-of-linked-list-in-fiber-to-walk-the-components-tree">React åœ¨ Fiber ä¸­ä½¿ç”¨é“¾è¡¨çš„æ–¹å¼å’ŒåŸå› ã€‚</a></p><p>è¿™æ˜¯æœ¬ç³»åˆ—çš„ç¬¬ä¸€ç¯‡æ–‡ç« ï¼Œæ—¨åœ¨å‘æ‚¨ä»‹ç» React çš„å†…éƒ¨æ¶æ„ã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘æƒ³æ·±å…¥æ¦‚è¿°ä¸ç®—æ³•ç›¸å…³çš„é‡è¦æ¦‚å¿µå’Œæ•°æ®ç»“æ„ã€‚ä¸€æ—¦æˆ‘ä»¬æœ‰äº†è¶³å¤Ÿçš„èƒŒæ™¯çŸ¥è¯†ï¼Œæˆ‘ä»¬å°†æ¢ç´¢ç”¨äºéå†å’Œå¤„ç† fiber æ ‘çš„ç®—æ³•å’Œä¸»è¦å‡½æ•°ã€‚æœ¬ç³»åˆ—çš„ä¸‹ä¸€ç¯‡æ–‡ç« å°†æ¼”ç¤º React å¦‚ä½•ä½¿ç”¨è¯¥ç®—æ³•æ¥æ‰§è¡Œåˆå§‹æ¸²æŸ“å’Œå¤„ç†çŠ¶æ€ä»¥åŠé“å…·æ›´æ–°ã€‚ä»é‚£é‡Œæˆ‘ä»¬å°†ç»§ç»­è®¨è®ºè°ƒåº¦ç¨‹åºçš„ç»†èŠ‚ã€å­åè°ƒè¿‡ç¨‹å’Œæ„å»ºæ•ˆæœåˆ—è¡¨çš„æœºåˆ¶ã€‚</p><p>æˆ‘è¦åœ¨è¿™é‡Œç»™ä½ ä¸€äº›éå¸¸é«˜çº§çš„çŸ¥è¯†ï¼Ÿæˆ‘é¼“åŠ±æ‚¨é˜…è¯»å®ƒä»¥äº†è§£ Concurrent React å†…éƒ¨å·¥ä½œåŸç†èƒŒåçš„é­”åŠ›ã€‚å¦‚æœæ‚¨æ‰“ç®—å¼€å§‹ä¸º React åšè´¡çŒ®ï¼Œæœ¬ç³»åˆ—æ–‡ç« ä¹Ÿå°†ä¸ºæ‚¨æä¾›å¾ˆå¥½çš„æŒ‡å¯¼ã€‚æˆ‘åšä¿¡é€†å‘å·¥ç¨‹ï¼Œå› æ­¤ä¼šæœ‰å¾ˆå¤šé“¾æ¥æŒ‡å‘æœ€æ–°ç‰ˆæœ¬ 16.6.0 çš„æºä»£ç ã€‚</p><p>è¦å¸æ”¶çš„ä¸œè¥¿è‚¯å®šå¾ˆå¤šï¼Œæ‰€ä»¥å¦‚æœæ‚¨ä¸èƒ½ç«‹å³ç†è§£æŸäº›å†…å®¹ï¼Œè¯·ä¸è¦æ„Ÿåˆ°å‹åŠ›ã€‚ä¸€åˆ‡éƒ½å€¼å¾—èŠ±æ—¶é—´ã€‚è¯·æ³¨æ„ï¼Œæ‚¨æ— éœ€äº†è§£ä»»ä½•å†…å®¹å³å¯ä½¿ç”¨ Reactã€‚è¿™ç¯‡æ–‡ç« æ˜¯å…³äº React å†…éƒ¨å¦‚ä½•å·¥ä½œçš„ã€‚</p><h2 id="Setting-the-background"><a href="#Setting-the-background" class="headerlink" title="Setting the background"></a>Setting the background</h2><p>è¿™æ˜¯ä¸€ä¸ªç®€å•çš„åº”ç”¨ç¨‹åºï¼Œæˆ‘å°†åœ¨æ•´ä¸ªç³»åˆ—ä¸­ä½¿ç”¨ã€‚æˆ‘ä»¬æœ‰ä¸€ä¸ªæŒ‰é’®ï¼Œå¯ä»¥ç®€å•åœ°å¢åŠ å±å¹•ä¸Šå‘ˆç°çš„æ•°å­—ï¼š</p><p><img src="https://images.indepth.dev/images/2019/07/tmp1.gif" alt="https://images.indepth.dev/images/2019/07/tmp1.gif"></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ClickCounter</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">props</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>(props);</span><br><span class="line">    <span class="built_in">this</span>.state = &#123; <span class="attr">count</span>: <span class="number">0</span> &#125;;</span><br><span class="line">    <span class="built_in">this</span>.handleClick = <span class="built_in">this</span>.handleClick.bind(<span class="built_in">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">handleClick</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.setState(<span class="function">(<span class="params">state</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> &#123; <span class="attr">count</span>: state.count + <span class="number">1</span> &#125;;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> [</span><br><span class="line">      <span class="xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">key</span>=<span class="string">&quot;1&quot;</span> <span class="attr">onClick</span>=<span class="string">&#123;this.handleClick&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">        Update counter</span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span>,</span><br><span class="line">      <span class="xml"><span class="tag">&lt;<span class="name">span</span> <span class="attr">key</span>=<span class="string">&quot;2&quot;</span>&gt;</span>&#123;this.state.count&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span>,</span><br><span class="line">    ];</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½ å¯ä»¥åœ¨ <a href="https://stackblitz.com/edit/react-t4rdmh?file=index.js">è¿™é‡Œ</a> ç©ã€‚å¦‚æ‚¨æ‰€è§ï¼Œå®ƒæ˜¯ä¸€ä¸ªç®€å•çš„ç»„ä»¶ï¼Œä» render æ–¹æ³•è¿”å›ä¸¤ä¸ªå­å…ƒç´  button å’Œ spanã€‚åªè¦å•å‡»æŒ‰é’®ï¼Œç»„ä»¶çš„çŠ¶æ€å°±ä¼šåœ¨å¤„ç†ç¨‹åºä¸­æ›´æ–°ã€‚è¿™åè¿‡æ¥ä¼šå¯¼è‡´ span å…ƒç´ çš„æ–‡æœ¬æ›´æ–°ã€‚</p><p>React åœ¨ <strong>reconciliation</strong> æœŸé—´æ‰§è¡Œå„ç§æ´»åŠ¨ã€‚ä¾‹å¦‚ï¼Œåœ¨æˆ‘ä»¬çš„ç®€å•åº”ç”¨ç¨‹åºä¸­ï¼Œè¿™æ˜¯ React åœ¨ç¬¬ä¸€æ¬¡æ¸²æŸ“æœŸé—´å’ŒçŠ¶æ€æ›´æ–°ä¹‹åæ‰§è¡Œçš„é«˜çº§æ“ä½œï¼š</p><ul><li>æ›´æ–° ClickCounter çŠ¶æ€ä¸‹çš„è®¡æ•°å±æ€§</li><li>æ£€ç´¢å¹¶æ¯”è¾ƒ ClickCounter çš„å­é¡¹åŠå…¶é“å…·</li><li>æ›´æ–° span å…ƒç´ çš„ props</li></ul><p>åœ¨<strong>reconciliation</strong>æœŸé—´æ‰§è¡Œå…¶ä»–æ´»åŠ¨ï¼Œä¾‹å¦‚è°ƒç”¨ç”Ÿå‘½å‘¨æœŸæ–¹æ³•æˆ–æ›´æ–°å¼•ç”¨ã€‚æ‰€æœ‰è¿™äº›æ´»åŠ¨åœ¨ Fiber æ¶æ„ä¸­ç»Ÿç§°ä¸ºâ€œworkâ€ã€‚work ç±»å‹é€šå¸¸å–å†³äº React å…ƒç´ çš„ç±»å‹ã€‚ä¾‹å¦‚ï¼Œå¯¹äºç±»ç»„ä»¶ï¼ŒReact éœ€è¦åˆ›å»ºä¸€ä¸ªå®ä¾‹ï¼Œè€Œå¯¹äºåŠŸèƒ½ç»„ä»¶åˆ™ä¸éœ€è¦ã€‚å¦‚ä½ æ‰€çŸ¥ï¼Œæˆ‘ä»¬åœ¨ React ä¸­æœ‰å¾ˆå¤šç§å…ƒç´ ï¼Œä¾‹å¦‚ç±»å’ŒåŠŸèƒ½ç»„ä»¶ã€å®¿ä¸»ç»„ä»¶ï¼ˆDOM èŠ‚ç‚¹ï¼‰ã€portals ç­‰ã€‚React å…ƒç´ çš„ç±»å‹ç”± createElement å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°å®šä¹‰ã€‚è¿™ä¸ªå‡½æ•°ä¸€èˆ¬ç”¨åœ¨ render æ–¹æ³•ä¸­åˆ›å»ºä¸€ä¸ªå…ƒç´ ã€‚</p><p>åœ¨æˆ‘ä»¬å¼€å§‹æ¢ç´¢ Activity å’Œä¸»è¦çš„ Fiber ç®—æ³•ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å…ˆç†Ÿæ‚‰ä¸€ä¸‹ React å†…éƒ¨ä½¿ç”¨çš„æ•°æ®ç»“æ„ã€‚</p><h2 id="From-React-Elements-to-Fiber-nodes"><a href="#From-React-Elements-to-Fiber-nodes" class="headerlink" title="From React Elements to Fiber nodes"></a>From React Elements to Fiber nodes</h2><p>React ä¸­çš„æ¯ä¸ªç»„ä»¶éƒ½æœ‰ä¸€ä¸ª UI è¡¨ç¤ºï¼Œæˆ‘ä»¬å¯ä»¥è°ƒç”¨è§†å›¾æˆ–ä» render æ–¹æ³•è¿”å›çš„æ¨¡æ¿ã€‚è¿™æ˜¯æˆ‘ä»¬çš„ ClickCounter ç»„ä»¶çš„æ¨¡æ¿ï¼š</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;button key=<span class="string">&quot;1&quot;</span> onClick=&#123;<span class="built_in">this</span>.onClick&#125;&gt;Update counter&lt;/button&gt;</span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">span</span> <span class="attr">key</span>=<span class="string">&quot;2&quot;</span>&gt;</span>&#123;this.state.count&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br></pre></td></tr></table></figure><h2 id="React-Elements"><a href="#React-Elements" class="headerlink" title="React Elements"></a>React Elements</h2><p>ä¸€æ—¦æ¨¡æ¿é€šè¿‡ JSX ç¼–è¯‘å™¨ï¼Œä½ æœ€ç»ˆä¼šå¾—åˆ°ä¸€å † React elementã€‚è¿™æ˜¯ React ç»„ä»¶çš„ render æ–¹æ³•çœŸæ­£è¿”å›çš„å†…å®¹ï¼Œè€Œä¸æ˜¯ HTMLã€‚å› ä¸ºæˆ‘ä»¬ä¸éœ€è¦ä½¿ç”¨ JSXï¼Œæ‰€ä»¥æˆ‘ä»¬çš„ ClickCounter ç»„ä»¶çš„ render æ–¹æ³•å¯ä»¥è¿™æ ·é‡å†™ï¼š</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ClickCounter</span> </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> [</span><br><span class="line">            React.createElement(</span><br><span class="line">                <span class="string">&#x27;button&#x27;</span>,</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">key</span>: <span class="string">&#x27;1&#x27;</span>,</span><br><span class="line">                    <span class="attr">onClick</span>: <span class="built_in">this</span>.onClick</span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="string">&#x27;Update counter&#x27;</span></span><br><span class="line">            ),</span><br><span class="line">            React.createElement(</span><br><span class="line">                <span class="string">&#x27;span&#x27;</span>,</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">key</span>: <span class="string">&#x27;2&#x27;</span></span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="built_in">this</span>.state.count</span><br><span class="line">            )</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ render æ–¹æ³•ä¸­è°ƒç”¨ React.createElement å°†åˆ›å»ºä¸¤ä¸ªæ•°æ®ç»“æ„ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">$$typeof</span>: <span class="built_in">Symbol</span>(react.element),</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;button&#x27;</span>,</span><br><span class="line">        <span class="attr">key</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">        <span class="attr">props</span>: &#123;</span><br><span class="line">            <span class="attr">children</span>: <span class="string">&#x27;Update counter&#x27;</span>,</span><br><span class="line">            <span class="attr">onClick</span>: <span class="function">() =&gt;</span> &#123; ... &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">$$typeof</span>: <span class="built_in">Symbol</span>(react.element),</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;span&#x27;</span>,</span><br><span class="line">        <span class="attr">key</span>: <span class="string">&quot;2&quot;</span>,</span><br><span class="line">        <span class="attr">props</span>: &#123;</span><br><span class="line">            <span class="attr">children</span>: <span class="number">0</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>ä½ å¯ä»¥çœ‹åˆ° React ä¸ºè¿™äº›å¯¹è±¡æ·»åŠ äº†å±æ€§ $$typeof ä»¥å°†å®ƒä»¬å”¯ä¸€æ ‡è¯†ä¸º React å…ƒç´ ã€‚ç„¶åæˆ‘ä»¬æœ‰æè¿°å…ƒç´ çš„å±æ€§ typeã€key å’Œ propsã€‚è¿™äº›å€¼å–è‡ªæ‚¨ä¼ é€’ç»™ React.createElement å‡½æ•°çš„å†…å®¹ã€‚è¯·æ³¨æ„ React å¦‚ä½•å°†æ–‡æœ¬å†…å®¹è¡¨ç¤ºä¸º span å’Œ button èŠ‚ç‚¹çš„å­èŠ‚ç‚¹ã€‚ä»¥åŠç‚¹å‡»å¤„ç†ç¨‹åºå¦‚ä½•æˆä¸ºæŒ‰é’®å…ƒç´ é“å…·çš„ä¸€éƒ¨åˆ†ã€‚ React å…ƒç´ ä¸Šè¿˜æœ‰å…¶ä»–å­—æ®µï¼Œä¾‹å¦‚ ref å­—æ®µï¼Œè¶…å‡ºäº†æœ¬æ–‡çš„èŒƒå›´ã€‚</p><p>ClickCounter çš„ React å…ƒç´ æ²¡æœ‰ä»»ä½•å±æ€§æˆ–é”®ï¼š</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">$$typeof</span>: <span class="built_in">Symbol</span>(react.element),</span><br><span class="line">    <span class="attr">key</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">props</span>: &#123;&#125;,</span><br><span class="line">    <span class="attr">ref</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">type</span>: ClickCounter</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Fiber-nodes"><a href="#Fiber-nodes" class="headerlink" title="Fiber nodes"></a>Fiber nodes</h2><p>åœ¨<strong>reconciliation</strong>æœŸé—´ï¼Œä» render æ–¹æ³•è¿”å›çš„æ¯ä¸ª React å…ƒç´ çš„æ•°æ®è¢«åˆå¹¶åˆ° fiber èŠ‚ç‚¹æ ‘ä¸­ã€‚æ¯ä¸ª React å…ƒç´ éƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„ fiber èŠ‚ç‚¹ã€‚ä¸ React å…ƒç´ ä¸åŒï¼Œfiber ä¸ä¼šåœ¨æ¯æ¬¡æ¸²æŸ“æ—¶é‡æ–°åˆ›å»ºã€‚è¿™äº›æ˜¯å¯å˜æ•°æ®ç»“æ„ï¼Œç”¨äºä¿å­˜ç»„ä»¶çŠ¶æ€å’Œ DOMã€‚</p><p>æˆ‘ä»¬ä¹‹å‰è®¨è®ºè¿‡ï¼Œæ ¹æ® React å…ƒç´ çš„ç±»å‹ï¼Œæ¡†æ¶éœ€è¦æ‰§è¡Œä¸åŒçš„æ´»åŠ¨ã€‚åœ¨æˆ‘ä»¬çš„ç¤ºä¾‹åº”ç”¨ç¨‹åºä¸­ï¼Œå¯¹äºç±»ç»„ä»¶ ClickCounterï¼Œå®ƒè°ƒç”¨ç”Ÿå‘½å‘¨æœŸæ–¹æ³•å’Œæ¸²æŸ“æ–¹æ³•ï¼Œè€Œå¯¹äº span å®¿ä¸»ç»„ä»¶ï¼ˆDOM èŠ‚ç‚¹ï¼‰ï¼Œå®ƒæ‰§è¡Œ DOM å˜å¼‚ã€‚æ‰€ä»¥æ¯ä¸ª React å…ƒç´ éƒ½è¢«è½¬æ¢æˆå¯¹åº”ç±»å‹çš„ Fiber èŠ‚ç‚¹ï¼Œæè¿°éœ€è¦å®Œæˆçš„å·¥ä½œã€‚</p><p><strong>æ‚¨å¯ä»¥å°† fiber è§†ä¸ºä¸€ç§æ•°æ®ç»“æ„ï¼Œå®ƒä»£è¡¨ä¸€äº›è¦åšçš„å·¥ä½œï¼Œæˆ–è€…æ¢å¥è¯è¯´ï¼Œä¸€ä¸ªå·¥ä½œå•å…ƒã€‚ Fiber çš„æ¶æ„è¿˜æä¾›äº†ä¸€ç§æ–¹ä¾¿çš„æ–¹å¼æ¥è·Ÿè¸ªã€å®‰æ’ã€æš‚åœå’Œä¸­æ­¢å·¥ä½œã€‚</strong></p><p>å½“ React å…ƒç´ ç¬¬ä¸€æ¬¡è¢«è½¬æ¢ä¸º fiber èŠ‚ç‚¹æ—¶ï¼ŒReact ä½¿ç”¨å…ƒç´ ä¸­çš„æ•°æ®åœ¨ createFiberFromTypeAndProps å‡½æ•°ä¸­åˆ›å»ºä¸€ä¸ª fiberã€‚åœ¨éšåçš„æ›´æ–°ä¸­ï¼ŒReact é‡ç”¨äº† fiber èŠ‚ç‚¹ï¼Œå¹¶ä»…ä½¿ç”¨æ¥è‡ªç›¸åº” React å…ƒç´ çš„æ•°æ®æ›´æ–°äº†å¿…è¦çš„å±æ€§ã€‚å¦‚æœç›¸åº”çš„ React å…ƒç´ ä¸å†ä» render æ–¹æ³•è¿”å›ï¼ŒReact å¯èƒ½è¿˜éœ€è¦æ ¹æ® key prop ç§»åŠ¨å±‚æ¬¡ç»“æ„ä¸­çš„èŠ‚ç‚¹æˆ–å°†å…¶åˆ é™¤ã€‚</p><blockquote><p>æŸ¥çœ‹ ChildReconciler å‡½æ•°ä»¥æŸ¥çœ‹ React ä¸ºç°æœ‰ fiber èŠ‚ç‚¹æ‰§è¡Œçš„æ‰€æœ‰æ´»åŠ¨å’Œç›¸åº”å‡½æ•°çš„åˆ—è¡¨ã€‚</p></blockquote><p>å› ä¸º React ä¸ºæ¯ä¸ª React å…ƒç´ åˆ›å»ºäº†ä¸€ä¸ª fiberï¼Œå¹¶ä¸”ç”±äºæˆ‘ä»¬æœ‰ä¸€æ£µåŒ…å«è¿™äº›å…ƒç´ çš„æ ‘ï¼Œæ‰€ä»¥æˆ‘ä»¬å°†æœ‰ä¸€æ£µ fiber èŠ‚ç‚¹æ ‘ã€‚åœ¨æˆ‘ä»¬çš„ç¤ºä¾‹åº”ç”¨ç¨‹åºä¸­ï¼Œå®ƒçœ‹èµ·æ¥åƒè¿™æ ·ï¼š</p><p><img src="https://images.indepth.dev/images/2019/07/image-51.png" alt="https://images.indepth.dev/images/2019/07/image-51.png"></p><p>æ‰€æœ‰ fiber èŠ‚ç‚¹éƒ½é€šè¿‡é“¾è¡¨è¿æ¥ï¼Œä½¿ç”¨ fiber èŠ‚ç‚¹ä¸Šçš„ä»¥ä¸‹å±æ€§ï¼šchildã€sibling å’Œ returnã€‚æœ‰å…³å®ƒä¸ºä½•ä»¥è¿™ç§æ–¹å¼å·¥ä½œçš„æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹æˆ‘çš„æ–‡ç«  The how and why on Reactâ€™s usage of linked list in Fiber å¦‚æœæ‚¨è¿˜æ²¡æœ‰é˜…è¯»è¿‡å®ƒã€‚</p><h2 id="Current-and-work-in-progress-trees"><a href="#Current-and-work-in-progress-trees" class="headerlink" title="Current and work in progress trees"></a>Current and work in progress trees</h2><p>åœ¨ç¬¬ä¸€æ¬¡æ¸²æŸ“ä¹‹åï¼ŒReact æœ€ç»ˆå¾—åˆ°ä¸€ä¸ª fiber æ ‘ï¼Œå®ƒåæ˜ äº†ç”¨äºæ¸²æŸ“ UI çš„åº”ç”¨ç¨‹åºçš„çŠ¶æ€ã€‚è¿™æ£µæ ‘é€šå¸¸è¢«ç§°ä¸º currentã€‚å½“ React å¼€å§‹å¤„ç†æ›´æ–°æ—¶ï¼Œå®ƒä¼šæ„å»ºä¸€ä¸ªæ‰€è°“çš„ workInProgress æ ‘ï¼Œå®ƒåæ˜ äº†è¦åˆ·æ–°åˆ°å±å¹•çš„æœªæ¥çŠ¶æ€ã€‚</p><p>æ‰€æœ‰å·¥ä½œéƒ½åœ¨ workInProgress æ ‘ä¸­çš„ fiber ä¸Šæ‰§è¡Œã€‚å½“ React éå†å½“å‰æ ‘æ—¶ï¼Œå®ƒä¼šä¸ºæ¯ä¸ªç°æœ‰çš„ fiber èŠ‚ç‚¹åˆ›å»ºä¸€ä¸ªæ›¿ä»£èŠ‚ç‚¹ï¼Œè¯¥èŠ‚ç‚¹æ„æˆ workInProgress æ ‘ã€‚è¯¥èŠ‚ç‚¹æ˜¯ä½¿ç”¨ render æ–¹æ³•è¿”å›çš„ React å…ƒç´ çš„æ•°æ®åˆ›å»ºçš„ã€‚ä¸€æ—¦å¤„ç†å®Œæ›´æ–°å¹¶å®Œæˆæ‰€æœ‰ç›¸å…³å·¥ä½œï¼ŒReact å°†å‡†å¤‡å¥½å¤‡ç”¨æ ‘ä»¥åˆ·æ–°åˆ°å±å¹•ä¸Šã€‚ä¸€æ—¦è¿™ä¸ª workInProgress æ ‘å‘ˆç°åœ¨å±å¹•ä¸Šï¼Œå®ƒå°±æˆä¸º currentã€‚</p><p>React çš„æ ¸å¿ƒåŸåˆ™ä¹‹ä¸€æ˜¯ä¸€è‡´æ€§ã€‚ React æ€»æ˜¯ä¸€å£æ°”æ›´æ–° DOM - å®ƒä¸ä¼šæ˜¾ç¤ºéƒ¨åˆ†ç»“æœã€‚ WorkInprogress æ ‘æ˜¯ç”¨æˆ·çœ‹ä¸åˆ°çš„â€œè‰ç¨¿â€ï¼Œå› æ­¤ React å¯ä»¥é¦–å…ˆå¤„ç†æ‰€æœ‰ç»„ä»¶ï¼Œç„¶åå°†å…¶æ›´æ”¹å†²æ´—åˆ°å±å¹•ä¸Šã€‚</p><p>åœ¨æºä»£ç ä¸­ï¼Œæ‚¨ä¼šçœ‹åˆ°è®¸å¤šå‡½æ•°ä»å½“å‰æ ‘å’Œ workInProgress æ ‘ä¸­è·å– fiber èŠ‚ç‚¹ã€‚è¿™æ˜¯ä¸€ä¸ªè¿™æ ·çš„å‡½æ•°çš„ç­¾åï¼š</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">updateHostComponent</span>(<span class="params">current, workInProgress, renderExpirationTime</span>) </span>&#123;...&#125;</span><br></pre></td></tr></table></figure><p>æ¯ä¸ª fiber èŠ‚ç‚¹éƒ½åœ¨ alternate å­—æ®µä¸­ä¿å­˜å¯¹å¦ä¸€æ£µæ ‘çš„å¯¹åº”é¡¹çš„å¼•ç”¨ã€‚å½“å‰æ ‘ä¸­çš„èŠ‚ç‚¹æŒ‡å‘ workInProgress æ ‘ä¸­çš„èŠ‚ç‚¹ï¼Œåä¹‹äº¦ç„¶ã€‚</p><h2 id="side-effects"><a href="#side-effects" class="headerlink" title="side effects"></a>side effects</h2><p>æˆ‘ä»¬å¯ä»¥å°† React ä¸­çš„ç»„ä»¶è§†ä¸ºä½¿ç”¨ state å’Œ props æ¥è®¡ç®— UI è¡¨ç¤ºçš„å‡½æ•°ã€‚æ¯ä¸ªå…¶ä»–æ´»åŠ¨ï¼Œå¦‚æ”¹å˜ DOM æˆ–è°ƒç”¨ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ï¼Œéƒ½åº”è¢«è§†ä¸ºå‰¯ä½œç”¨ï¼Œæˆ–è€…ç®€ç§°ä¸ºæ•ˆæœã€‚æ–‡æ¡£ä¸­è¿˜æåˆ°äº†æ•ˆæœï¼š</p><blockquote><p>æ‚¨ä¹‹å‰å¯èƒ½å·²ç»ä» React ç»„ä»¶æ‰§è¡Œè¿‡æ•°æ®è·å–ã€è®¢é˜…æˆ–æ‰‹åŠ¨æ›´æ”¹ DOMã€‚æˆ‘ä»¬ç§°è¿™äº›æ“ä½œä¸ºâ€œside effectsâ€ï¼ˆæˆ–ç®€ç§°ä¸ºâ€œeffectâ€ï¼‰ï¼Œå› ä¸ºå®ƒä»¬ä¼šå½±å“å…¶ä»–ç»„ä»¶å¹¶ä¸”æ— æ³•åœ¨æ¸²æŸ“æœŸé—´å®Œæˆã€‚</p></blockquote><p>æ‚¨å¯ä»¥çœ‹åˆ°å¤§å¤šæ•°çŠ¶æ€å’Œé“å…·æ›´æ–°å°†å¦‚ä½•å¯¼è‡´å‰¯ä½œç”¨ã€‚ç”±äºåº”ç”¨æ•ˆæœæ˜¯ä¸€ç§å·¥ä½œï¼Œå› æ­¤ fiber èŠ‚ç‚¹æ˜¯ä¸€ç§é™¤äº†æ›´æ–°ä¹‹å¤–è¿˜å¯ä»¥è·Ÿè¸ª effect çš„ä¾¿æ·æœºåˆ¶ã€‚æ¯ä¸ª fiber èŠ‚ç‚¹éƒ½å¯ä»¥æœ‰ä¸ä¹‹å…³è”çš„ effectã€‚å®ƒä»¬åœ¨ <code>effectTag</code> å­—æ®µä¸­ç¼–ç ã€‚</p><p>å› æ­¤ï¼ŒFiber ä¸­çš„ effect åŸºæœ¬ä¸Šå®šä¹‰äº†å¤„ç†æ›´æ–°åå®ä¾‹éœ€è¦å®Œæˆçš„å·¥ä½œã€‚å¯¹äºå®¿ä¸»ç»„ä»¶ï¼ˆDOM å…ƒç´ ï¼‰ï¼Œå·¥ä½œåŒ…æ‹¬æ·»åŠ ã€æ›´æ–°æˆ–åˆ é™¤å…ƒç´ ã€‚å¯¹äºç±»ç»„ä»¶ï¼ŒReact å¯èƒ½éœ€è¦æ›´æ–° refs å¹¶è°ƒç”¨ <code>componentDidMount</code> å’Œ <code>componentDidUpdate</code> ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ã€‚ä¹Ÿæœ‰å¯¹åº”äºå…¶ä»–ç±»å‹ fiber çš„å…¶ä»–ä½œç”¨ã€‚</p><h2 id="effects-list"><a href="#effects-list" class="headerlink" title="effects list"></a>effects list</h2><p>React å¤„ç†æ›´æ–°éå¸¸å¿«ï¼Œä¸ºäº†è¾¾åˆ°è¿™ç§æ€§èƒ½æ°´å¹³ï¼Œå®ƒé‡‡ç”¨äº†ä¸€äº›æœ‰è¶£çš„æŠ€æœ¯ã€‚å…¶ä¸­ä¹‹ä¸€æ˜¯æ„å»ºå…·æœ‰å¿«é€Ÿè¿­ä»£æ•ˆæœçš„ fiber èŠ‚ç‚¹çº¿æ€§åˆ—è¡¨ã€‚è¿­ä»£çº¿æ€§åˆ—è¡¨æ¯”æ ‘å¿«å¾—å¤šï¼Œå¹¶ä¸”æ— éœ€åœ¨æ²¡æœ‰å‰¯ä½œç”¨çš„èŠ‚ç‚¹ä¸ŠèŠ±è´¹æ—¶é—´ã€‚</p><p>æ­¤åˆ—è¡¨çš„ç›®æ ‡æ˜¯æ ‡è®°å…·æœ‰ DOM æ›´æ–°æˆ–ä¸å…¶å…³è”çš„å…¶ä»–æ•ˆæœçš„èŠ‚ç‚¹ã€‚æ­¤åˆ—è¡¨æ˜¯ <code>finishedWork</code> æ ‘çš„å­é›†ï¼Œå¹¶ä½¿ç”¨ <code>nextEffect</code> å±æ€§è€Œä¸æ˜¯ <code>current</code> å’Œ <code>workInProgress</code> æ ‘ä¸­ä½¿ç”¨çš„å­å±æ€§è¿›è¡Œé“¾æ¥ã€‚</p><p>Dan Abramov ä¸º effect list æä¾›äº†ä¸€ä¸ªç±»æ¯”ã€‚ä»–å–œæ¬¢æŠŠå®ƒæƒ³è±¡æˆä¸€æ£µåœ£è¯æ ‘ï¼Œç”¨â€œåœ£è¯ç¯â€å°†æ‰€æœ‰æœ‰æ•ˆèŠ‚ç‚¹æ†ç»‘åœ¨ä¸€èµ·ã€‚ä¸ºäº†å½¢è±¡åŒ–è¿™ä¸€ç‚¹ï¼Œè®©æˆ‘ä»¬æƒ³è±¡ä¸€ä¸‹ä¸‹é¢çš„ fiber èŠ‚ç‚¹æ ‘ï¼Œå…¶ä¸­çªå‡ºæ˜¾ç¤ºçš„èŠ‚ç‚¹æœ‰ä¸€äº›å·¥ä½œè¦åšã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬çš„æ›´æ–°å¯¼è‡´ c2 è¢«æ’å…¥ DOMï¼Œd2 å’Œ c1 æ”¹å˜å±æ€§ï¼Œb2 è§¦å‘ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ã€‚æ•ˆæœåˆ—è¡¨ä¼šå°†å®ƒä»¬é“¾æ¥åœ¨ä¸€èµ·ï¼Œä»¥ä¾¿ React ç¨åå¯ä»¥è·³è¿‡å…¶ä»–èŠ‚ç‚¹ï¼š</p><p><img src="https://images.indepth.dev/images/2019/07/image-52.png" alt="https://images.indepth.dev/images/2019/07/image-52.png"></p><p>æ‚¨å¯ä»¥çœ‹åˆ°å…·æœ‰ effects çš„èŠ‚ç‚¹æ˜¯å¦‚ä½•é“¾æ¥åœ¨ä¸€èµ·çš„ã€‚å½“éå†èŠ‚ç‚¹æ—¶ï¼ŒReact ä½¿ç”¨ firstEffect æŒ‡é’ˆæ¥ç¡®å®šåˆ—è¡¨çš„å¼€å§‹ä½ç½®ã€‚æ‰€ä»¥ä¸Šå›¾å¯ä»¥è¡¨ç¤ºä¸ºè¿™æ ·çš„çº¿æ€§åˆ—è¡¨ï¼š</p><p><img src="https://images.indepth.dev/images/2019/07/image-53.png" alt="https://images.indepth.dev/images/2019/07/image-53.png"></p><h2 id="Root-of-the-fiber-tree"><a href="#Root-of-the-fiber-tree" class="headerlink" title="Root of the fiber tree"></a>Root of the fiber tree</h2><p>æ¯ä¸ª React åº”ç”¨ç¨‹åºéƒ½æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªå……å½“å®¹å™¨çš„ DOM å…ƒç´ ã€‚åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œå®ƒæ˜¯å¸¦æœ‰ ID å®¹å™¨çš„ div å…ƒç´ ã€‚</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ReactDOM.render(React.createElement(ClickCounter), domContainer);</span><br></pre></td></tr></table></figure><p>React ä¸ºæ¯ä¸ª <code>container</code> (root èŠ‚ç‚¹) åˆ›å»ºä¸€ä¸ª fiber root å¯¹è±¡ã€‚æ‚¨å¯ä»¥ä½¿ç”¨å¯¹ DOM å…ƒç´ çš„å¼•ç”¨æ¥è®¿é—®å®ƒï¼š</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fiberRoot = query(<span class="string">&quot;#container&quot;</span>)._reactRootContainer._internalRoot;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ª fiber root æ˜¯ React ä¿å­˜å¯¹ fiber tree çš„å¼•ç”¨çš„åœ°æ–¹ã€‚å®ƒå­˜å‚¨åœ¨ fiber root çš„å½“å‰å±æ€§ä¸­ï¼š</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> hostRootFiberNode = fiberRoot.current;</span><br></pre></td></tr></table></figure><p>fiber æ ‘ä»¥ä¸€ç§ç‰¹æ®Šç±»å‹çš„ fiber èŠ‚ç‚¹å¼€å§‹ï¼Œå³ HostRootã€‚å®ƒæ˜¯åœ¨å†…éƒ¨åˆ›å»ºçš„ï¼Œå¹¶å……å½“æœ€é¡¶å±‚ç»„ä»¶çš„çˆ¶çº§ã€‚é€šè¿‡ stateNode å±æ€§ä» HostRoot fiber èŠ‚ç‚¹è¿”å›åˆ° FiberRoot æœ‰ä¸€ä¸ªé“¾æ¥ï¼š</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fiberRoot.current.stateNode === fiberRoot; <span class="comment">// true</span></span><br></pre></td></tr></table></figure><p>æ‚¨å¯ä»¥é€šè¿‡ fiber root è®¿é—®æœ€é¡¶å±‚çš„ HostRoot fiber èŠ‚ç‚¹æ¥æ¢ç´¢ fiber æ ‘ã€‚æˆ–è€…æ‚¨å¯ä»¥åƒè¿™æ ·ä»ç»„ä»¶å®ä¾‹ä¸­è·å–å•ä¸ª fiber èŠ‚ç‚¹ï¼š</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">compInstance._reactInternalFiber;</span><br></pre></td></tr></table></figure><h2 id="Fiber-node-structure"><a href="#Fiber-node-structure" class="headerlink" title="Fiber node structure"></a>Fiber node structure</h2><p>ç°åœ¨è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹ä¸º ClickCounter ç»„ä»¶åˆ›å»ºçš„ fiber èŠ‚ç‚¹çš„ç»“æ„ï¼š</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">stateNode</span>: <span class="keyword">new</span> ClickCounter,</span><br><span class="line">    <span class="attr">type</span>: ClickCounter,</span><br><span class="line">    <span class="attr">alternate</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">key</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">updateQueue</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">memoizedState</span>: &#123;<span class="attr">count</span>: <span class="number">0</span>&#125;,</span><br><span class="line">    <span class="attr">pendingProps</span>: &#123;&#125;,</span><br><span class="line">    <span class="attr">memoizedProps</span>: &#123;&#125;,</span><br><span class="line">    <span class="attr">tag</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">effectTag</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">nextEffect</span>: <span class="literal">null</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>span DOM å…ƒç´ ï¼š</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">stateNode</span>: <span class="keyword">new</span> HTMLSpanElement,</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&quot;span&quot;</span>,</span><br><span class="line">    <span class="attr">alternate</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">key</span>: <span class="string">&quot;2&quot;</span>,</span><br><span class="line">    <span class="attr">updateQueue</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">memoizedState</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">pendingProps</span>: &#123;<span class="attr">children</span>: <span class="number">0</span>&#125;,</span><br><span class="line">    <span class="attr">memoizedProps</span>: &#123;<span class="attr">children</span>: <span class="number">0</span>&#125;,</span><br><span class="line">    <span class="attr">tag</span>: <span class="number">5</span>,</span><br><span class="line">    <span class="attr">effectTag</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">nextEffect</span>: <span class="literal">null</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Fiber èŠ‚ç‚¹ä¸Šæœ‰ç›¸å½“å¤šçš„å­—æ®µã€‚æˆ‘åœ¨å‰é¢çš„éƒ¨åˆ†ä¸­æè¿°äº†å­—æ®µ alternateã€effectTag å’Œ nextEffect çš„ç”¨é€”ã€‚ç°åœ¨è®©æˆ‘ä»¬çœ‹çœ‹ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦å…¶ä»–äººã€‚</p><h2 id="stateNode"><a href="#stateNode" class="headerlink" title="stateNode"></a>stateNode</h2><p>æŒæœ‰å¯¹ç»„ä»¶ç±»å®ä¾‹ã€DOM èŠ‚ç‚¹æˆ–ä¸ Fiber èŠ‚ç‚¹å…³è”çš„å…¶ä»– React å…ƒç´ ç±»å‹çš„å¼•ç”¨ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬å¯ä»¥è¯´è¿™ä¸ªå±æ€§ç”¨äºä¿å­˜ä¸ fiber ç›¸å…³çš„å±€éƒ¨çŠ¶æ€ã€‚</p><h2 id="type"><a href="#type" class="headerlink" title="type"></a>type</h2><p>å®šä¹‰ä¸æ­¤ fiber å…³è”çš„å‡½æ•°æˆ–ç±»ã€‚å¯¹äºç±»ç»„ä»¶ï¼Œå®ƒæŒ‡å‘æ„é€ å‡½æ•°ï¼Œå¯¹äº DOM å…ƒç´ ï¼Œå®ƒæŒ‡å®š HTML æ ‡è®°ã€‚æˆ‘ç»å¸¸ä½¿ç”¨è¿™ä¸ªå­—æ®µæ¥äº†è§£ fiber èŠ‚ç‚¹ä¸ä»€ä¹ˆå…ƒç´ ç›¸å…³ã€‚</p><h2 id="tag"><a href="#tag" class="headerlink" title="tag"></a>tag</h2><p>å®šä¹‰ fiber çš„ç±»å‹ã€‚å®ƒåœ¨åè°ƒç®—æ³•ä¸­ç”¨äºç¡®å®šéœ€è¦å®Œæˆçš„å·¥ä½œã€‚å¦‚å‰æ‰€è¿°ï¼Œå·¥ä½œå›  React å…ƒç´ çš„ç±»å‹è€Œå¼‚ã€‚å‡½æ•° createFiberFromTypeAndProps å°† React å…ƒç´ æ˜ å°„åˆ°ç›¸åº”çš„ fiber èŠ‚ç‚¹ç±»å‹ã€‚åœ¨æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºä¸­ï¼ŒClickCounter ç»„ä»¶çš„å±æ€§æ ‡è®°ä¸º <code>1</code>ï¼Œè¡¨ç¤ºä¸€ä¸ª <code>ClassComponent</code>ï¼Œå¯¹äº <code>span</code> å…ƒç´ ï¼Œå®ƒçš„å±æ€§æ ‡è®°ä¸º<code>5</code>ï¼Œè¡¨ç¤ºä¸€ä¸ª <code>HostComponent</code>ã€‚</p><h2 id="updateQueue"><a href="#updateQueue" class="headerlink" title="updateQueue"></a>updateQueue</h2><p>çŠ¶æ€æ›´æ–°ã€å›è°ƒå’Œ DOM æ›´æ–°é˜Ÿåˆ—ã€‚(A queue of state updates, callbacks and DOM updates.)</p><h2 id="memoizedState"><a href="#memoizedState" class="headerlink" title="memoizedState"></a>memoizedState</h2><p>ç”¨äºåˆ›å»ºè¾“å‡ºçš„ fiber çš„çŠ¶æ€ã€‚åœ¨å¤„ç†æ›´æ–°æ—¶ï¼Œå®ƒä¼šåæ˜ å½“å‰åœ¨å±å¹•ä¸Šå‘ˆç°çš„çŠ¶æ€ã€‚</p><h2 id="memoizedProps"><a href="#memoizedProps" class="headerlink" title="memoizedProps"></a>memoizedProps</h2><p>åœ¨ä¸Šä¸€æ¬¡æ¸²æŸ“æœŸé—´ç”¨äºåˆ›å»ºè¾“å‡ºçš„ fiber çš„ propsã€‚</p><h2 id="pendingProps"><a href="#pendingProps" class="headerlink" title="pendingProps"></a>pendingProps</h2><p>å·²ä» React å…ƒç´ ä¸­çš„æ–°æ•°æ®æ›´æ–°å¹¶éœ€è¦åº”ç”¨äºå­ç»„ä»¶æˆ– DOM å…ƒç´ çš„é“å…·ã€‚</p><h2 id="key"><a href="#key" class="headerlink" title="key"></a>key</h2><p>å¸¦æœ‰ä¸€ç»„å­©å­çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œä»¥å¸®åŠ© React ç¡®å®šå“ªäº›é¡¹ç›®å·²æ›´æ”¹ï¼Œå·²æ·»åŠ æˆ–ä»åˆ—è¡¨ä¸­åˆ é™¤ã€‚å®ƒä¸æ­¤å¤„æè¿°çš„ React çš„â€œåˆ—è¡¨å’Œé”®â€åŠŸèƒ½æœ‰å…³ã€‚<br>æ‚¨å¯ä»¥åœ¨æ­¤å¤„æ‰¾åˆ° fiber èŠ‚ç‚¹çš„å®Œæ•´ç»“æ„ã€‚æˆ‘åœ¨ä¸Šé¢çš„è§£é‡Šä¸­çœç•¥äº†ä¸€å †å­—æ®µã€‚ç‰¹åˆ«æ˜¯ï¼Œæˆ‘è·³è¿‡äº†æ„æˆæˆ‘åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­æè¿°çš„æ ‘æ•°æ®ç»“æ„çš„æŒ‡é’ˆ <code>child</code>ã€<code>sibling</code> å’Œ <code>return</code>ã€‚è¿˜æœ‰ä¸€ç±»å­—æ®µï¼Œå¦‚ <code>expirationTime</code>ã€<code>childExpirationTime</code> å’Œç‰¹å®šäº <code>Scheduler</code> çš„æ¨¡å¼ã€‚</p><h2 id="General-algorithm"><a href="#General-algorithm" class="headerlink" title="General algorithm"></a>General algorithm</h2><p>React åœ¨ä¸¤ä¸ªä¸»è¦é˜¶æ®µæ‰§è¡Œå·¥ä½œï¼š <strong>render</strong> å’Œ <strong>commit</strong>ã€‚</p><p>åœ¨ç¬¬ä¸€ä¸ª <code>render</code> é˜¶æ®µï¼ŒReact å°†æ›´æ–°åº”ç”¨åˆ°é€šè¿‡ setState æˆ– React.render å®‰æ’çš„ç»„ä»¶ï¼Œå¹¶ç¡®å®š UI ä¸­éœ€è¦æ›´æ–°çš„å†…å®¹ã€‚å¦‚æœæ˜¯åˆå§‹æ¸²æŸ“ï¼ŒReact ä¼šä¸ºä»æ¸²æŸ“æ–¹æ³•è¿”å›çš„æ¯ä¸ªå…ƒç´ åˆ›å»ºä¸€ä¸ªæ–°çš„ fiber èŠ‚ç‚¹ã€‚åœ¨æ¥ä¸‹æ¥çš„æ›´æ–°ä¸­ï¼Œç°æœ‰ React å…ƒç´ çš„ fiber è¢«é‡æ–°ä½¿ç”¨å’Œæ›´æ–°ã€‚<strong>è¯¥é˜¶æ®µçš„ç»“æœæ˜¯æ ‡æœ‰å‰¯ä½œç”¨çš„ fiber èŠ‚ç‚¹æ ‘ã€‚æ•ˆæœæè¿°äº†åœ¨æ¥ä¸‹æ¥çš„æäº¤é˜¶æ®µéœ€è¦å®Œæˆçš„å·¥ä½œã€‚</strong>åœ¨æ­¤é˜¶æ®µï¼ŒReact è·å–æ ‡è®°æœ‰æ•ˆæœçš„ fiber æ ‘å¹¶å°†å®ƒä»¬åº”ç”¨äºå®ä¾‹ã€‚å®ƒéå†æ•ˆæœåˆ—è¡¨å¹¶æ‰§è¡Œ DOM æ›´æ–°å’Œç”¨æˆ·å¯è§çš„å…¶ä»–æ›´æ”¹ã€‚</p><p><strong>é‡è¦çš„æ˜¯è¦äº†è§£ç¬¬ä¸€ä¸ª render é˜¶æ®µçš„å·¥ä½œå¯ä»¥å¼‚æ­¥æ‰§è¡Œã€‚</strong> React å¯ä»¥æ ¹æ®å¯ç”¨æ—¶é—´å¤„ç†ä¸€ä¸ªæˆ–å¤šä¸ª fiber èŠ‚ç‚¹ï¼Œç„¶ååœæ­¢ä»¥å­˜å‚¨å®Œæˆçš„å·¥ä½œå¹¶ yield äºæŸä¸ªäº‹ä»¶ã€‚ç„¶åå®ƒä»åœæ­¢çš„åœ°æ–¹ç»§ç»­ã€‚ä½†æœ‰æ—¶ï¼Œå®ƒå¯èƒ½éœ€è¦æ”¾å¼ƒå·²å®Œæˆçš„å·¥ä½œå¹¶é‡æ–°ä»å¤´å¼€å§‹ã€‚è¿™äº›æš‚åœä¹‹æ‰€ä»¥æˆä¸ºå¯èƒ½ï¼Œæ˜¯å› ä¸ºåœ¨æ­¤é˜¶æ®µæ‰§è¡Œçš„å·¥ä½œä¸ä¼šå¯¼è‡´ä»»ä½•ç”¨æˆ·å¯è§çš„æ›´æ”¹ï¼Œä¾‹å¦‚ DOM æ›´æ–°ã€‚ç›¸åï¼Œæ¥ä¸‹æ¥çš„ <code>commit</code> é˜¶æ®µæ€»æ˜¯åŒæ­¥çš„ã€‚<strong>è¿™æ˜¯å› ä¸ºåœ¨æ­¤é˜¶æ®µæ‰§è¡Œçš„å·¥ä½œä¼šå¯¼è‡´ç”¨æˆ·å¯è§çš„æ›´æ”¹</strong>ï¼Œä¾‹å¦‚ DOM æ›´æ–°ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆ React éœ€è¦ä¸€æ¬¡å®Œæˆå®ƒä»¬ã€‚</p><p>è°ƒç”¨ç”Ÿå‘½å‘¨æœŸæ–¹æ³•æ˜¯ React æ‰§è¡Œçš„ä¸€ç§å·¥ä½œã€‚ä¸€äº›æ–¹æ³•åœ¨ render é˜¶æ®µè°ƒç”¨ï¼Œå…¶ä»–æ–¹æ³•åœ¨ commit é˜¶æ®µè°ƒç”¨ã€‚è¿™æ˜¯åœ¨ç¬¬ä¸€ä¸ªæ¸²æŸ“é˜¶æ®µå·¥ä½œæ—¶è°ƒç”¨çš„ç”Ÿå‘½å‘¨æœŸåˆ—è¡¨ï¼š</p><ul><li>[UNSAFE_]componentWillMount (deprecated)</li><li>[UNSAFE_]componentWillReceiveProps (deprecated)</li><li>getDerivedStateFromProps</li><li>shouldComponentUpdate</li><li>[UNSAFE_]componentWillUpdate (deprecated)</li><li>render</li></ul><p>å¦‚æ‚¨æ‰€è§ï¼Œä» 16.3 ç‰ˆæœ¬å¼€å§‹ï¼Œä¸€äº›åœ¨æ¸²æŸ“é˜¶æ®µæ‰§è¡Œçš„é—ç•™ç”Ÿå‘½å‘¨æœŸæ–¹æ³•è¢«æ ‡è®°ä¸ºä¸å®‰å…¨ã€‚å®ƒä»¬ç°åœ¨åœ¨æ–‡æ¡£ä¸­ç§°ä¸ºé—ç•™ç”Ÿå‘½å‘¨æœŸã€‚å®ƒä»¬å°†åœ¨æœªæ¥çš„ 16.x ç‰ˆæœ¬ä¸­è¢«å¼ƒç”¨ï¼Œæ²¡æœ‰ UNSAFE å‰ç¼€çš„å¯¹åº”ç‰ˆæœ¬å°†åœ¨ 17.0 ä¸­åˆ é™¤ã€‚æ‚¨å¯ä»¥åœ¨æ­¤å¤„é˜…è¯»æœ‰å…³è¿™äº›æ›´æ”¹å’Œå»ºè®®çš„è¿ç§»è·¯å¾„çš„æ›´å¤šä¿¡æ¯ã€‚</p><p>ä½ å¥½å¥‡è¿™æ˜¯ä»€ä¹ˆåŸå› å—ï¼Ÿ</p><p>å¥½å§ï¼Œæˆ‘ä»¬åˆšåˆšäº†è§£åˆ°ï¼Œç”±äº render é˜¶æ®µä¸ä¼šäº§ç”Ÿåƒ DOM æ›´æ–°é‚£æ ·çš„å‰¯ä½œç”¨ï¼Œå› æ­¤ React å¯ä»¥å¼‚æ­¥å¤„ç†å¯¹ç»„ä»¶çš„å¼‚æ­¥æ›´æ–°ï¼ˆç”šè‡³å¯èƒ½åœ¨å¤šä¸ªçº¿ç¨‹ä¸­è¿›è¡Œï¼‰ã€‚ä½†æ˜¯ï¼Œæ ‡æœ‰ UNSAFE çš„ç”Ÿå‘½å‘¨æœŸç»å¸¸æœ‰è¢«è¯¯è§£å’Œå·§å¦™åœ°è¯¯ç”¨ã€‚<strong>å¼€å‘äººå‘˜å€¾å‘äºå°†å¸¦æœ‰å‰¯ä½œç”¨çš„ä»£ç æ”¾åœ¨è¿™äº›æ–¹æ³•ä¸­ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´æ–°çš„å¼‚æ­¥æ¸²æŸ“æ–¹æ³•å‡ºç°é—®é¢˜ã€‚</strong>å°½ç®¡åªæœ‰æ²¡æœ‰ UNSAFE å‰ç¼€çš„å¯¹åº”é¡¹ä¼šè¢«åˆ é™¤ï¼Œä½†å®ƒä»¬ä»ç„¶å¯èƒ½ä¼šåœ¨å³å°†åˆ°æ¥çš„å¹¶å‘æ¨¡å¼ï¼ˆæ‚¨å¯ä»¥é€‰æ‹©é€€å‡ºï¼‰ä¸­å¼•èµ·é—®é¢˜ã€‚</p><p>ä¸‹é¢æ˜¯åœ¨ç¬¬äºŒä¸ªæäº¤é˜¶æ®µæ‰§è¡Œçš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•åˆ—è¡¨ï¼š</p><ul><li>getSnapshotBeforeUpdate</li><li>componentDidMount</li><li>componentDidUpdate</li><li>componentWillUnmount</li></ul><p>å› ä¸ºè¿™äº›æ–¹æ³•åœ¨åŒæ­¥ <code>commit</code> é˜¶æ®µæ‰§è¡Œï¼Œæ‰€ä»¥å®ƒä»¬å¯èƒ½åŒ…å«å‰¯ä½œç”¨å¹¶è§¦åŠ DOMã€‚</p><p>å¥½çš„ï¼Œç°åœ¨æˆ‘ä»¬äº†è§£äº†ç”¨äºéå†æ ‘å’Œæ‰§è¡Œå·¥ä½œçš„é€šç”¨ç®—æ³•çš„èƒŒæ™¯çŸ¥è¯†ã€‚è®©æˆ‘ä»¬å¼€å§‹å§ã€‚</p><h2 id="Render-Phase"><a href="#Render-Phase" class="headerlink" title="Render Phase"></a>Render Phase</h2><p>åè°ƒç®—æ³•å§‹ç»ˆä½¿ç”¨ renderRoot å‡½æ•°ä»æœ€é¡¶å±‚çš„ HostRoot fiber èŠ‚ç‚¹å¼€å§‹ã€‚ä½†æ˜¯ï¼ŒReact ä¼šè·³å‡ºï¼ˆè·³è¿‡ï¼‰å·²ç»å¤„ç†è¿‡çš„ fiber èŠ‚ç‚¹ï¼Œç›´åˆ°å®ƒæ‰¾åˆ°æœªå®Œæˆå·¥ä½œçš„èŠ‚ç‚¹ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨åœ¨ç»„ä»¶æ ‘æ·±å¤„è°ƒç”¨ setStateï¼ŒReact å°†ä»é¡¶éƒ¨å¼€å§‹ä½†ä¼šå¿«é€Ÿè·³è¿‡çˆ¶èŠ‚ç‚¹ï¼Œç›´åˆ°å®ƒæ‰¾åˆ°åˆ°è°ƒç”¨äº† setState æ–¹æ³•çš„ç»„ä»¶ã€‚</p><h2 id="Main-steps-of-the-work-loop"><a href="#Main-steps-of-the-work-loop" class="headerlink" title="Main steps of the work loop"></a>Main steps of the work loop</h2><p>æ‰€æœ‰ fiber èŠ‚ç‚¹éƒ½åœ¨å·¥ä½œå¾ªç¯ä¸­å¤„ç†ã€‚ä¸‹é¢æ˜¯å¾ªç¯åŒæ­¥éƒ¨åˆ†çš„å®ç°ï¼š</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">workLoop</span>(<span class="params">isYield</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!isYieldy) &#123;</span><br><span class="line">    <span class="keyword">while</span> (nextUnitOfWork !== <span class="literal">null</span>) &#123;</span><br><span class="line">      nextUnitOfWork = performUnitOfWork(nextUnitOfWork);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;...&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼ŒnextUnitOfWork æŒæœ‰å¯¹æ¥è‡ª workInProgress æ ‘çš„ fiber èŠ‚ç‚¹çš„å¼•ç”¨ï¼Œå®ƒæœ‰ä¸€äº›å·¥ä½œè¦åšã€‚å½“ React éå† Fibers æ ‘æ—¶ï¼Œå®ƒä½¿ç”¨è¿™ä¸ªå˜é‡æ¥äº†è§£æ˜¯å¦æœ‰ä»»ä½•å…¶ä»– fiber èŠ‚ç‚¹æœ‰æœªå®Œæˆçš„å·¥ä½œã€‚å½“å‰ fiber å¤„ç†å®Œæˆåï¼Œè¯¥å˜é‡å°†åŒ…å«å¯¹æ ‘ä¸­ä¸‹ä¸€ä¸ª fiber èŠ‚ç‚¹çš„å¼•ç”¨æˆ–ç©ºå€¼ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒReact é€€å‡ºå·¥ä½œå¾ªç¯å¹¶å‡†å¤‡å¥½æäº¤æ›´æ”¹ã€‚</p><p>æœ‰ 4 ä¸ªä¸»è¦å‡½æ•°ç”¨äºéå†æ ‘å¹¶å¯åŠ¨æˆ–å®Œæˆå·¥ä½œï¼š</p><ul><li>performUnitOfWork</li><li>beginWork</li><li>completeUnitOfWork</li><li>completeWork</li></ul><p>ä¸ºäº†æ¼”ç¤ºå¦‚ä½•ä½¿ç”¨å®ƒä»¬ï¼Œè¯·çœ‹ä¸‹é¢éå† fiber æ ‘çš„åŠ¨ç”»ã€‚æˆ‘åœ¨æ¼”ç¤ºä¸­ä½¿ç”¨äº†è¿™äº›åŠŸèƒ½çš„ç®€åŒ–å®ç°ã€‚æ¯ä¸ªå‡½æ•°éƒ½éœ€è¦ä¸€ä¸ª fiber èŠ‚ç‚¹æ¥å¤„ç†ï¼Œéšç€ React æ²¿ç€æ ‘å‘ä¸‹ç§»åŠ¨ï¼Œæ‚¨å¯ä»¥çœ‹åˆ°å½“å‰æ´»åŠ¨çš„ fiber èŠ‚ç‚¹å‘ç”Ÿå˜åŒ–ã€‚æ‚¨å¯ä»¥åœ¨è§†é¢‘ä¸­æ¸…æ¥šåœ°çœ‹åˆ°ç®—æ³•å¦‚ä½•ä»ä¸€ä¸ªåˆ†æ”¯è½¬åˆ°å¦ä¸€ä¸ªåˆ†æ”¯ã€‚å®ƒé¦–å…ˆå®Œæˆå­©å­çš„å·¥ä½œï¼Œç„¶åå†ç§»äº¤ç»™çˆ¶æ¯ã€‚</p><p><img src="https://images.indepth.dev/images/2019/08/tmp2.gif" alt="https://images.indepth.dev/images/2019/08/tmp2.gif"></p><blockquote><p>è¯·æ³¨æ„ï¼Œç¬”ç›´çš„å‚ç›´è¿æ¥è¡¨ç¤ºå…„å¼Ÿå§å¦¹ï¼Œè€Œå¼¯æ›²çš„è¿æ¥è¡¨ç¤ºå­©å­ï¼Œä¾‹å¦‚ b1 æ²¡æœ‰å­©å­ï¼Œè€Œ b2 æœ‰ä¸€ä¸ªå­©å­ c1ã€‚</p></blockquote><p>è¿™æ˜¯è§†é¢‘çš„é“¾æ¥ï¼Œæ‚¨å¯ä»¥åœ¨å…¶ä¸­æš‚åœæ’­æ”¾å¹¶æ£€æŸ¥å½“å‰èŠ‚ç‚¹å’ŒåŠŸèƒ½çŠ¶æ€ã€‚ä»æ¦‚å¿µä¸Šè®²ï¼Œæ‚¨å¯ä»¥å°†â€œå¼€å§‹â€è§†ä¸ºâ€œæ­¥å…¥â€ä¸€ä¸ªç»„ä»¶ï¼Œå°†â€œå®Œæˆâ€è§†ä¸ºâ€œèµ°å‡ºâ€å®ƒã€‚å½“æˆ‘è§£é‡Šè¿™äº›å‡½æ•°çš„ä½œç”¨æ—¶ï¼Œæ‚¨è¿˜å¯ä»¥å°è¯•æ­¤å¤„çš„ç¤ºä¾‹å’Œå®ç°ã€‚</p><p>è®©æˆ‘ä»¬ä»å‰ä¸¤ä¸ªå‡½æ•° performUnitOfWork å’Œ beginWork å¼€å§‹ï¼š</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">performUnitWork</span>(<span class="params">workInprogree</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> next = beginWork(workInProgress);</span><br><span class="line">  <span class="keyword">if</span> (next === <span class="literal">null</span>) &#123;</span><br><span class="line">    next = completeUnitOfWork(workInProgress);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> next;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">beginWork</span>(<span class="params">workInProgress</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;work performed for &quot;</span> + workInProgress.name);</span><br><span class="line">  <span class="keyword">return</span> workInProgress.child;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å‡½æ•° <code>performUnitOfWork</code> ä» <code>WorkInProgress</code> æ ‘æ¥æ”¶ä¸€ä¸ª fiber èŠ‚ç‚¹ï¼Œå¹¶é€šè¿‡è°ƒç”¨ <code>BeginWork</code> å‡½æ•°å¼€å§‹å·¥ä½œã€‚è¿™æ˜¯å¯åŠ¨æ‰€æœ‰éœ€è¦ä¸º fiber æ‰§è¡Œçš„æ´»åŠ¨çš„åŠŸèƒ½ã€‚å‡ºäºæ­¤æ¼”ç¤ºçš„ç›®çš„ï¼Œæˆ‘ä»¬ç®€å•åœ°è®°å½•äº† fiber çš„åç§°ï¼Œä»¥è¡¨ç¤ºå·¥ä½œå·²ç»å®Œæˆã€‚å‡½æ•° <code>beginWork</code> å¼€å§‹å·¥ä½œæ€»æ˜¯å°†æŒ‡é’ˆè¿”å›ä¸‹ä¸€ä¸ªå­©å­ä»¥åœ¨å¾ªç¯æˆ– null ä¸­è¿›è¡Œå¤„ç†ã€‚</p><p>å¦‚æœæœ‰ä¸‹ä¸€ä¸ªå­©å­ï¼Œå®ƒå°†è¢«åˆ†é…ç»™ <code>workLoop</code> å‡½æ•°ä¸­çš„å˜é‡ <code>nextUnitOfWork</code> ã€‚ç„¶è€Œï¼Œå¦‚æœæ²¡æœ‰å­èŠ‚ç‚¹ï¼ŒReact çŸ¥é“å®ƒåˆ°è¾¾äº†åˆ†æ”¯çš„æœ«å°¾ï¼Œå› æ­¤å®ƒå¯ä»¥å®Œæˆå½“å‰èŠ‚ç‚¹ã€‚<strong>ä¸€æ—¦èŠ‚ç‚¹å®Œæˆï¼Œå®ƒå°†éœ€è¦ä¸ºå…„å¼Ÿå§å¦¹æ‰§è¡Œå·¥ä½œï¼Œç„¶åå›æº¯åˆ°çˆ¶èŠ‚ç‚¹</strong>ã€‚è¿™æ˜¯åœ¨ <code>completeUnitOfWork</code> å‡½æ•°ä¸­å®Œæˆçš„ï¼š</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">completeUnitOfWork</span>(<span class="params">workInProgress</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> returnFiber = workInProgress.return;</span><br><span class="line">    <span class="keyword">let</span> siblingFiber = workInProgress.sibling;</span><br><span class="line"></span><br><span class="line">    nextUnitOfWork = completeWork(workInProgress);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (siblingFiber !== <span class="literal">null</span>) &#123;</span><br><span class="line">      <span class="comment">// If there is a sibling, return it</span></span><br><span class="line">      <span class="comment">// to perform work for this sibling</span></span><br><span class="line">      <span class="keyword">return</span> siblingFiber;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (returnFiber !== <span class="literal">null</span>) &#123;</span><br><span class="line">      <span class="comment">// If there&#x27;s no more work in this returnFiber,</span></span><br><span class="line">      <span class="comment">// continue the loop to complete the parent.</span></span><br><span class="line">      workInProgress = returnFiber;</span><br><span class="line">      <span class="keyword">continue</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// We&#x27;ve reached the root.</span></span><br><span class="line">      <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">completeWork</span>(<span class="params">workInProgress</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;work completed for &quot;</span> + workInProgress.name);</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‚¨å¯ä»¥çœ‹åˆ°è¯¥å‡½æ•°çš„è¦ç‚¹æ˜¯ä¸€ä¸ªå¤§çš„ while å¾ªç¯ã€‚å½“ <code>workInProgress</code> èŠ‚ç‚¹æ²¡æœ‰å­èŠ‚ç‚¹æ—¶ï¼ŒReact ä¼šè¿›å…¥æ­¤å‡½æ•°ã€‚å®Œæˆå½“å‰ fiber çš„å·¥ä½œåï¼Œå®ƒä¼šæ£€æŸ¥æ˜¯å¦æœ‰å…„å¼ŸèŠ‚ç‚¹ã€‚å¦‚æœæ‰¾åˆ°ï¼ŒReact é€€å‡ºè¯¥å‡½æ•°å¹¶è¿”å›æŒ‡å‘ <code>sibling</code> çš„æŒ‡é’ˆã€‚å®ƒå°†è¢«åˆ†é…ç»™ <code>nextUnitOfWork</code> å˜é‡ï¼ŒReact å°†æ‰§è¡Œä»è¿™ä¸ªå…„å¼Ÿå¼€å§‹çš„åˆ†æ”¯çš„å·¥ä½œã€‚<strong>é‡è¦çš„æ˜¯è¦æ˜ç™½ï¼Œæ­¤æ—¶ React åªå®Œæˆäº†å‰é¢å…„å¼Ÿå§å¦¹çš„å·¥ä½œã€‚å®ƒå°šæœªå®Œæˆçˆ¶èŠ‚ç‚¹çš„å·¥ä½œã€‚åªæœ‰ä»å­èŠ‚ç‚¹å¼€å§‹çš„æ‰€æœ‰åˆ†æ”¯éƒ½å®Œæˆåï¼Œå®ƒæ‰å®Œæˆçˆ¶èŠ‚ç‚¹å’Œå›æº¯çš„å·¥ä½œã€‚</strong></p><p>ä»å®ç°ä¸­å¯ä»¥çœ‹å‡ºï¼Œ<code>completeUnitOfWork</code> ä¸»è¦ç”¨äºè¿­ä»£ç›®çš„ï¼Œè€Œä¸»è¦æ´»åŠ¨å‘ç”Ÿåœ¨ <code>beginWork</code> å’Œ <code>completeWork</code> å‡½æ•°ä¸­ã€‚åœ¨æœ¬ç³»åˆ—çš„åç»­æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†äº†è§£å½“ React è¿›å…¥ <code>beginWork</code> å’Œ <code>completeWork</code> å‡½æ•°æ—¶ï¼ŒClickCounter ç»„ä»¶å’Œ span èŠ‚ç‚¹ä¼šå‘ç”Ÿä»€ä¹ˆã€‚</p><h2 id="Commit-Phase"><a href="#Commit-Phase" class="headerlink" title="Commit Phase"></a>Commit Phase</h2><p>è¯¥é˜¶æ®µä»å‡½æ•° <code>completeRoot</code> å¼€å§‹ã€‚è¿™æ˜¯ React æ›´æ–° DOM å¹¶è°ƒç”¨çªå˜å‰åç”Ÿå‘½å‘¨æœŸæ–¹æ³•çš„åœ°æ–¹ã€‚</p><p>å½“ React è¿›å…¥è¿™ä¸ªé˜¶æ®µæ—¶ï¼Œå®ƒæœ‰ 2 æ£µæ ‘å’Œ effect åˆ—è¡¨ã€‚ç¬¬ä¸€æ£µæ ‘è¡¨ç¤ºå½“å‰åœ¨å±å¹•ä¸Šå‘ˆç°çš„çŠ¶æ€ã€‚ç„¶ååœ¨æ¸²æŸ“é˜¶æ®µæ„å»ºäº†ä¸€ä¸ª alternate æ ‘ã€‚å®ƒåœ¨æºä»£ç ä¸­ç§°ä¸º <code>finishedWork</code> æˆ– <code>workInProgress</code> ï¼Œä»£è¡¨éœ€è¦åæ˜ åœ¨å±å¹•ä¸Šçš„çŠ¶æ€ã€‚è¿™ä¸ªå¤‡ç”¨æ ‘é€šè¿‡ <code>child</code> æŒ‡é’ˆå’Œ <code>sibling</code> æŒ‡é’ˆä¸å½“å‰æ ‘ç±»ä¼¼åœ°é“¾æ¥ã€‚</p><p>ç„¶åï¼Œæœ‰ä¸€ä¸ª effect åˆ—è¡¨ - é€šè¿‡ <code>nextEffect</code> æŒ‡é’ˆé“¾æ¥çš„ <code>finishedWork</code> çš„ä¸€ä¸ªèŠ‚ç‚¹å­é›†ã€‚è¯·è®°ä½ï¼Œæ•ˆæœåˆ—è¡¨æ˜¯è¿è¡Œæ¸²æŸ“é˜¶æ®µçš„ç»“æœã€‚<strong>æ¸²æŸ“çš„å…¨éƒ¨è¦ç‚¹æ˜¯ç¡®å®šéœ€è¦æ’å…¥ï¼Œæ›´æ–°æˆ–åˆ é™¤å“ªäº›èŠ‚ç‚¹ï¼Œå“ªäº›ç»„ä»¶éœ€è¦è°ƒç”¨å…¶ç”Ÿå‘½å‘¨æœŸæ–¹æ³•</strong>ã€‚è¿™å°±æ˜¯ effect list å‘Šè¯‰æˆ‘ä»¬çš„ã€‚æ­£æ˜¯åœ¨ <code>commit</code> é˜¶æ®µè¿­ä»£çš„ä¸€ç»„èŠ‚ç‚¹ã€‚</p><blockquote><p>å‡ºäºè°ƒè¯•ç›®çš„ï¼Œå¯ä»¥é€šè¿‡ fiber root çš„å½“å‰å±æ€§è®¿é—® <code>cuurent</code> æ ‘ã€‚å¯ä»¥é€šè¿‡å½“å‰æ ‘ä¸­ <code>HostFiber</code> èŠ‚ç‚¹çš„ <code>alternate</code> å±æ€§è®¿é—® <code>finishedWork</code> æ ‘ã€‚</p></blockquote><p>åœ¨ commit<br>é˜¶æ®µè¿è¡Œçš„ä¸»è¦å‡½æ•°æ˜¯ commitRootã€‚åŸºæœ¬ä¸Šï¼Œå®ƒæ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š</p><ul><li>Calls the <code>getSnapshotBeforeUpdate</code> lifecycle method on nodes tagged with the Snapshot effect</li><li>Calls the <code>componentWillUnmount</code> lifecycle method on nodes tagged with the Deletion effect</li><li>Performs all the DOM insertions, updates and deletions<br>Sets the <code>finishedWork</code> tree as current</li><li>Calls <code>componentDidMount</code> lifecycle method on nodes tagged with the Placement effect</li><li>Calls <code>componentDidUpdate</code> lifecycle method on nodes tagged with the Update effect</li></ul><p>åœ¨è°ƒç”¨ pre-mutation æ–¹æ³• <code>getSnapshotBeforeUpdate</code> ä¹‹åï¼ŒReact å°†æ‰€æœ‰å‰¯ä½œç”¨æäº¤åˆ°æ ‘ä¸­ã€‚å®ƒåˆ†ä¸¤æ¬¡å®Œæˆã€‚ç¬¬ä¸€éæ‰§è¡Œæ‰€æœ‰ DOMï¼ˆä¸»æœºï¼‰æ’å…¥ã€æ›´æ–°ã€åˆ é™¤å’Œå¼•ç”¨å¸è½½ã€‚ç„¶å React å°† <code>finishedWork</code> æ ‘åˆ†é…ç»™ FiberRootï¼Œå°† <code>workInProgress</code> æ ‘æ ‡è®°ä¸ºå½“å‰æ ‘ã€‚è¿™æ˜¯åœ¨æäº¤é˜¶æ®µçš„ç¬¬ä¸€éä¹‹åå®Œæˆçš„ï¼Œå› æ­¤å‰ä¸€æ£µæ ‘åœ¨ <code>componentWillUnmount</code> æœŸé—´ä»ç„¶æ˜¯å½“å‰çš„ï¼Œä½†åœ¨ç¬¬äºŒéä¹‹å‰ï¼Œå› æ­¤å®Œæˆçš„å·¥ä½œåœ¨ componentDidMount/Update æœŸé—´æ˜¯å½“å‰çš„ã€‚åœ¨ç¬¬äºŒéä¸­ï¼ŒReact è°ƒç”¨æ‰€æœ‰å…¶ä»–ç”Ÿå‘½å‘¨æœŸæ–¹æ³•å’Œ ref å›è°ƒã€‚è¿™äº›æ–¹æ³•ä½œä¸ºå•ç‹¬çš„ä¼ é€’æ‰§è¡Œï¼Œå› æ­¤æ•´ä¸ªæ ‘ä¸­çš„æ‰€æœ‰æ”¾ç½®ã€æ›´æ–°å’Œåˆ é™¤éƒ½å·²è¢«è°ƒç”¨ã€‚</p><p>è¿™æ˜¯è¿è¡Œä¸Šè¿°æ­¥éª¤çš„åŠŸèƒ½çš„è¦æ—¨ï¼š</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">commitRoot</span>(<span class="params">root, finishedWork</span>) </span>&#123;</span><br><span class="line">  commitBeforeMutationLifecycles();</span><br><span class="line">  commitAllHostEffects();</span><br><span class="line">  root.current = finishedWork;</span><br><span class="line">  commitAllLifeCycles();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™äº›å­å‡½æ•°ä¸­çš„æ¯ä¸€ä¸ªéƒ½å®ç°äº†ä¸€ä¸ªå¾ªç¯ï¼Œè¯¥å¾ªç¯éå† effect åˆ—è¡¨å¹¶æ£€æŸ¥æ•ˆæœçš„ç±»å‹ã€‚å½“å®ƒæ‰¾åˆ°ä¸å‡½æ•°ç›®çš„ç›¸å…³çš„æ•ˆæœæ—¶ï¼Œå®ƒå°±ä¼šåº”ç”¨å®ƒã€‚</p><h2 id="Pre-mutation-lifecycle-methods"><a href="#Pre-mutation-lifecycle-methods" class="headerlink" title="Pre-mutation lifecycle methods"></a>Pre-mutation lifecycle methods</h2><p>ä¾‹å¦‚ï¼Œä¸‹é¢æ˜¯éå† effect æ ‘å¹¶æ£€æŸ¥èŠ‚ç‚¹æ˜¯å¦å…·æœ‰ <code>Snapshot</code> effect çš„ä»£ç ï¼š</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">commitBeforeMutationLifecycles</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">while</span> (nextEffect !== <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> effectTag = nextEffect.effectTag;</span><br><span class="line">    <span class="keyword">if</span> (effectTag &amp; Snapshot) &#123;</span><br><span class="line">      <span class="keyword">const</span> current = nextEffect.alternate;</span><br><span class="line">      commitBeforeMutationLifeCycles(current, nextEffect);</span><br><span class="line">    &#125;</span><br><span class="line">    nextEffect = nextEffect.nextEffect;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯¹äºç±»ç»„ä»¶ï¼Œè¿™ç§æ•ˆæœæ„å‘³ç€è°ƒç”¨ getSnapshotBeforeUpdate ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ã€‚</p><h2 id="DOM-updates"><a href="#DOM-updates" class="headerlink" title="DOM updates"></a>DOM updates</h2><p><code>commitAllHostEffects</code> æ˜¯ React æ‰§è¡Œ DOM æ›´æ–°çš„å‡½æ•°ã€‚è¯¥å‡½æ•°åŸºæœ¬ä¸Šå®šä¹‰äº†éœ€è¦ä¸ºèŠ‚ç‚¹å®Œæˆçš„æ“ä½œç±»å‹å¹¶æ‰§è¡Œå®ƒï¼š</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">commitAllHostEffects</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">switch</span> (primaryEffectTag) &#123;</span><br><span class="line">        <span class="keyword">case</span> Placement: &#123;</span><br><span class="line">            commitPlacement(nextEffect);</span><br><span class="line">            ...</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">case</span> PlacementAndUpdate: &#123;</span><br><span class="line">            commitPlacement(nextEffect);</span><br><span class="line">            commitWork(current, nextEffect);</span><br><span class="line">            ...</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">case</span> Update: &#123;</span><br><span class="line">            commitWork(current, nextEffect);</span><br><span class="line">            ...</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">case</span> Deletion: &#123;</span><br><span class="line">            commitDeletion(nextEffect);</span><br><span class="line">            ...</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ‰è¶£çš„æ˜¯ï¼ŒReact åœ¨ <code>commitDeletion</code> å‡½æ•°ä¸­è°ƒç”¨ <code>componentWillUnmount</code> æ–¹æ³•ä½œä¸ºåˆ é™¤è¿‡ç¨‹çš„ä¸€éƒ¨åˆ†ã€‚</p><h2 id="Post-mutation-lifecycle-methods"><a href="#Post-mutation-lifecycle-methods" class="headerlink" title="Post-mutation lifecycle methods"></a>Post-mutation lifecycle methods</h2><p>commitAllLifecycles æ˜¯ React è°ƒç”¨æ‰€æœ‰å‰©ä½™ç”Ÿå‘½å‘¨æœŸæ–¹æ³• <code>componentDidUpdate</code> å’Œ <code>componentDidMount</code> çš„å‡½æ•°ã€‚</p><p>æˆ‘ä»¬ç»ˆäºå®Œæˆäº†ã€‚è®©æˆ‘çŸ¥é“æ‚¨å¯¹è¿™ç¯‡æ–‡ç« çš„çœ‹æ³•æˆ–åœ¨è¯„è®ºä¸­æé—®ã€‚æŸ¥çœ‹ç³»åˆ—ä¸­çš„ä¸‹ä¸€ç¯‡æ–‡ç« æ·±å…¥è§£é‡Š React ä¸­çš„çŠ¶æ€å’Œé“å…·æ›´æ–°ã€‚æˆ‘è¿˜æœ‰å¾ˆå¤šæ–‡ç« åœ¨ä¸ºè°ƒåº¦ç¨‹åºã€å­åè°ƒè¿‡ç¨‹ä»¥åŠå¦‚ä½•æ„å»ºæ•ˆæœåˆ—è¡¨æä¾›æ·±å…¥çš„è§£é‡Šã€‚æˆ‘è¿˜è®¡åˆ’åˆ¶ä½œä¸€ä¸ªè§†é¢‘ï¼Œå±•ç¤ºå¦‚ä½•ä»¥æœ¬æ–‡ä¸ºåŸºç¡€è°ƒè¯•åº”ç”¨ç¨‹åºã€‚</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;åŸæ–‡é“¾æ¥ï¼š&lt;a href=&quot;https://indepth.dev/posts/1008/inside-fiber-in-depth-overview-of-the-new-reconciliation-algorithm-in-react&quot;&gt;https://indepth.dev/posts/1008/inside-fiber-in-depth-overview-of-the-new-reconciliation-algorithm-in-react&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;æ·±å…¥ç ”ç©¶ React çš„åä¸º Fiber çš„æ–°æ¶æ„ï¼Œäº†è§£æ–°åè°ƒç®—æ³•çš„ä¸¤ä¸ªä¸»è¦é˜¶æ®µã€‚æˆ‘ä»¬å°†è¯¦ç»†äº†è§£ React å¦‚ä½•æ›´æ–° state å’Œ props ä»¥åŠå¤„ç† childrenã€‚&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="è¯‘æ–‡" scheme="https://jealh.xyz/categories/%E8%AF%91%E6%96%87/"/>
    
    
  </entry>
  
  <entry>
    <title>JavaScript çš„éšå¼è½¬æ¢</title>
    <link href="https://jealh.xyz/2023/03/09/JavaScript-%E7%9A%84%E9%9A%90%E5%BC%8F%E8%BD%AC%E6%8D%A2/"/>
    <id>https://jealh.xyz/2023/03/09/JavaScript-%E7%9A%84%E9%9A%90%E5%BC%8F%E8%BD%AC%E6%8D%A2/</id>
    <published>2023-03-09T13:28:10.000Z</published>
    <updated>2023-03-09T13:37:57.735Z</updated>
    
    <content type="html"><![CDATA[<p>å¯¹äº JavaScript ä¸­çš„ä¸€äº›è¿ç®—ç¬¦ï¼ˆå¦‚ï¼š==ï¼‰æ¥è¯´æ˜¯æ¯”è¾ƒè¿·æƒ‘çš„ã€‚å®ƒä»¬äº§ç”Ÿçš„ç»“æœæœ‰æ—¶ä¼šè®©æˆ‘ä»¬å˜å¾—æ··æ·†ï¼Œé‚£è¿™ä¸€åˆ‡çš„èƒŒåå°±æ˜¯â€œéšå¼è½¬æ¢â€åœ¨ä½œç¥Ÿäº†ã€‚</p><h2 id="å‰ç½®"><a href="#å‰ç½®" class="headerlink" title="å‰ç½®"></a>å‰ç½®</h2><h3 id="Number-å¼ºåˆ¶è½¬æ¢"><a href="#Number-å¼ºåˆ¶è½¬æ¢" class="headerlink" title="Number å¼ºåˆ¶è½¬æ¢"></a>Number å¼ºåˆ¶è½¬æ¢</h3><table><thead><tr><th align="center">target</th><th align="center">number</th></tr></thead><tbody><tr><td align="center">undefined</td><td align="center">NaN</td></tr><tr><td align="center">null</td><td align="center">0</td></tr><tr><td align="center">true/false</td><td align="center">1/0</td></tr><tr><td align="center">string</td><td align="center">è§£æå¤±è´¥è¿”å› NaN</td></tr><tr><td align="center">BigInt</td><td align="center">TypeError</td></tr><tr><td align="center">Symbol</td><td align="center">TypeError</td></tr><tr><td align="center">Object</td><td align="center"><a href="%22number%22">@@toPrimitive</a> â†’ valueOf() â†’ toString()</td></tr></tbody></table><p><strong>string è§£æå¤±è´¥ï¼š</strong></p><ul><li>å¿½ç•¥å‰å¯¼ä¸å°¾éšçš„ç©ºæ ¼/è¡Œç»ˆæ­¢ç¬¦</li><li>å‰å¯¼ 0 ä¸ä¼šè¯†åˆ«ä¸ºå…«è¿›åˆ¶æ–‡æœ¬</li><li>+å’Œ-å…è®¸åœ¨å­—ç¬¦ä¸²å¼€å¤´ï¼Œä¸”åªèƒ½å‡ºç°ä¸€æ¬¡ï¼Œåé¢ä¸èƒ½è·Ÿç©ºæ ¼</li><li>Infinity å’Œ -Infinity å½“ä½œå­—é¢é‡</li><li>ç©ºä¸²æˆ–å…¨ä¸ºç©ºæ ¼è§£ææˆ 0</li><li>ä¸èƒ½å«æ•°å­—åˆ†å‰²ç¬¦</li></ul><span id="more"></span><h3 id="å¼ºåˆ¶-boolean-è½¬æ¢"><a href="#å¼ºåˆ¶-boolean-è½¬æ¢" class="headerlink" title="å¼ºåˆ¶ boolean è½¬æ¢"></a>å¼ºåˆ¶ boolean è½¬æ¢</h3><table><thead><tr><th align="center">target</th><th align="center">Boolean</th></tr></thead><tbody><tr><td align="center">0 / -0</td><td align="center">false</td></tr><tr><td align="center">null</td><td align="center">false</td></tr><tr><td align="center">NaN</td><td align="center">false</td></tr><tr><td align="center">undefined</td><td align="center">false</td></tr><tr><td align="center">â€œâ€</td><td align="center">false</td></tr><tr><td align="center">Object / â€œanything but not emptyâ€</td><td align="center">true</td></tr></tbody></table><h3 id="å¤æ‚ç±»å‹è½¬æ¢æˆåŸå§‹ç±»å‹"><a href="#å¤æ‚ç±»å‹è½¬æ¢æˆåŸå§‹ç±»å‹" class="headerlink" title="å¤æ‚ç±»å‹è½¬æ¢æˆåŸå§‹ç±»å‹"></a>å¤æ‚ç±»å‹è½¬æ¢æˆåŸå§‹ç±»å‹</h3><p>å¤æ‚æ•°æ®ç±»å‹è½¬æ¢ä¸ºåŸå§‹ç±»å‹æœ‰ä»¥ä¸‹è§„åˆ™ï¼š</p><ul><li>å¼ºåˆ¶åŸå§‹å€¼è½¬æ¢ï¼š<a href="%22default%22">@@toPrimitive</a> â†’ valueOf() â†’ toString()</li><li>å¼ºåˆ¶æ•°å­—ç±»å‹è½¬æ¢ã€å¼ºåˆ¶ number ç±»å‹è½¬æ¢ã€å¼ºåˆ¶ BigInt ç±»å‹è½¬æ¢ï¼š<a href="%22number%22">@@toPrimitive</a> â†’ valueOf() â†’ toString()</li><li>å¼ºåˆ¶å­—ç¬¦ä¸²ç±»å‹è½¬æ¢ï¼š<a href="%22string%22">@@toPrimitive</a> â†’ toString() â†’ valueOf()</li><li>Date å’Œ Symbol å¯¹è±¡æ˜¯å”¯ä¸€é‡å†™ [@@toPrimitive] æ–¹æ³•çš„å¯¹è±¡ã€‚Date.prototype[@@toPrimitive] å°† â€œdefaultâ€ hint è§†ä¸º â€œstringâ€ï¼Œè€Œ Symbol.prototype[@@toPrimitive] å¿½ç•¥ hint å¹¶å§‹ç»ˆè¿”å›ä¸€ä¸ª symbolã€‚</li></ul><p>å…¶ä¸­ [@@toPrimitive] ä¸ºä¸€ä¸ªå†…ç½®çš„ Symbol å±æ€§ï¼Œå…¶éƒ¨ç½²æ–¹å¼ä¸ºï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">  [<span class="built_in">Symbol</span>.toPrimitive](hint) &#123;</span><br><span class="line">    <span class="keyword">if</span> (hint === <span class="string">&quot;number&quot;</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="number">10</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (hint === <span class="string">&quot;string&quot;</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// &#x27;default&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é‚£ä¹ˆå½“é‡åˆ°åŸå§‹ç±»å‹è½¬æ¢æ—¶å°±ç›¸å½“äºè‡ªå®šä¹‰è½¬åŒ–äº†</span></span><br><span class="line"><span class="keyword">const</span> num = +obj;</span><br><span class="line"><span class="comment">// hintä¸º number, ç»“æœï¼š 10</span></span><br></pre></td></tr></table></figure><h2 id="æ“ä½œç¬¦"><a href="#æ“ä½œç¬¦" class="headerlink" title="æ“ä½œç¬¦"></a>æ“ä½œç¬¦</h2><h3 id=""><a href="#" class="headerlink" title="=="></a>==</h3><p>é¦–å½“å…¶å†²çš„è‚¯å®šæ˜¯ â€==â€œï¼Œ æƒ³å¿…å…¶å·²ç»è‡­åæ˜­è‘—äº†ã€‚é‚£ä¹ˆæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹å®ƒçš„ä¸€äº›å‘å‘å§ ğŸ˜€ã€‚</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#125; == []</span><br><span class="line"><span class="literal">null</span> == <span class="literal">undefined</span></span><br><span class="line"><span class="keyword">new</span> <span class="built_in">String</span>(<span class="string">&quot;str&quot;</span>) == <span class="literal">true</span></span><br></pre></td></tr></table></figure><p>é¦–å…ˆï¼Œæˆ‘ä»¬æ˜ç¡®ä¸€ä¸‹ == çš„è§„åˆ™ï¼Œé‚£ä¹ˆå°±éå¸¸å®¹æ˜“å»åˆ¤æ–­ç»“æœäº†ï¼Œå…¶è§„åˆ™ä¸ºï¼š</p><ol><li><span id="same primitve">ç›¸åŒç±»å‹</span>ï¼š</li></ol><ul><li>Object ç±»å‹ï¼šæ¯”è¾ƒå¼•ç”¨åœ°å€</li><li>Number: æœ‰ NaN åˆ™è¿”å› false, +0 ä¸ -0 ç›¸ç­‰ï¼Œæ“ä½œæ•°ç›¸ç­‰åˆ™è¿”å› trueã€‚</li><li>Stringï¼šåªæœ‰å½“ä¸¤ä¸ªæ“ä½œæ•°å…·æœ‰ç›¸åŒçš„å­—ç¬¦ä¸”é¡ºåºç›¸åŒæ—¶æ‰è¿”å› trueã€‚</li><li>Booleanï¼šä»…å½“æ“ä½œæ•°éƒ½ä¸º true æˆ–éƒ½ä¸º false æ—¶è¿”å› trueã€‚</li><li>BigIntï¼šä»…å½“ä¸¤ä¸ªæ“ä½œæ•°å€¼ç›¸åŒæ—¶è¿”å› trueã€‚</li><li>Symbolï¼šä»…å½“ä¸¤ä¸ªæ“ä½œæ•°å¼•ç”¨ç›¸åŒçš„ç¬¦å·æ—¶è¿”å› trueã€‚</li><li>null: å¦ä¸€ä¸ªæ•°ä¸º undefined æˆ– null æ‰è¿”å› trueã€‚å¦åˆ™è¿”å› falseã€‚</li><li>undefined: å¦ä¸€ä¸ªæ•°ä¸º undefined æˆ– null æ‰è¿”å› trueã€‚å¦åˆ™è¿”å› falseã€‚</li></ul><ol start="2"><li><p>å…¶ä¸­ä¸€ä¸ªæ˜¯å¯¹è±¡ï¼Œå¦ä¸€ä¸ªæ˜¯åŸºæœ¬ç±»å‹ã€‚ä¼šæŒ‰ç…§**<a href="#å‰ç½®">å‰ç½®</a>**çš„è§„åˆ™è¿›è¡Œè½¬æ¢æˆåŸºæœ¬ç±»å‹ã€‚</p></li><li><p>è¿™æ—¶éƒ½æ˜¯<strong>åŸºæœ¬ç±»å‹</strong>äº†ï¼Œé‚£ä¹ˆæœ‰å¦‚ä¸‹è§„åˆ™ã€‚</p></li></ol><ul><li>éƒ½æ˜¯åŸºæœ¬ç±»å‹ï¼ŒæŒ‰ç…§<a href="#same primitve">è§„åˆ™ 1</a>è¿›è¡Œå¯¹æ¯”ã€‚</li><li>å…¶ä¸­ä¸€ä¸ªæ˜¯ Symbol, å¦ä¸€ä¸ªä¸æ˜¯ï¼Œè¿”å› falseã€‚</li><li>å…¶ä¸­ä¸€ä¸ªæ˜¯ boolean, å¦ä¸€ä¸ªä¸æ˜¯ï¼Œåˆ™å°† boolean è½¬æ¢æˆæ•°å­—ã€‚</li><li>Number ä¸ String å¯¹æ¯”ï¼šä½¿ç”¨ä¸ <a href="#Number å¼ºåˆ¶è½¬æ¢">Number() æ„é€ å‡½æ•°ç›¸åŒçš„ç®—æ³•</a>å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºæ•°å­—ã€‚è½¬æ¢å¤±è´¥å°†å¯¼è‡´ NaNï¼Œè¿™å°†ä¿è¯ç›¸ç­‰æ˜¯ falseã€‚</li><li>Number ä¸ BigInt å¯¹æ¯”ï¼šæŒ‰æ•°å€¼è¿›è¡Œæ¯”è¾ƒã€‚å¦‚æœæ•°å€¼ä¸º Â±âˆ æˆ– NaNï¼Œè¿”å› falseã€‚</li><li>String ä¸ BigInt å¯¹æ¯”ï¼šä½¿ç”¨ä¸ BigInt() æ„é€ å‡½æ•°ç›¸åŒçš„ç®—æ³•å°†å­—ç¬¦ä¸²è½¬æ¢ä¸º BigIntã€‚å¦‚æœè½¬æ¢å¤±è´¥ï¼Œè¿”å› falseã€‚</li></ul><h4 id="å›åˆ°ä¸Šé¢˜"><a href="#å›åˆ°ä¸Šé¢˜" class="headerlink" title="å›åˆ°ä¸Šé¢˜"></a>å›åˆ°ä¸Šé¢˜</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#125; == []</span><br><span class="line"><span class="comment">// ç›¸åŒç±»å‹éƒ½æ˜¯ Object, æ¯”è¾ƒå¼•ç”¨åœ°å€ï¼Œå› æ­¤è¿”å› false</span></span><br><span class="line"></span><br><span class="line"><span class="literal">null</span> == <span class="literal">undefined</span></span><br><span class="line"><span class="comment">// null ä¸ undefined è¿”å› true</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="built_in">String</span>(<span class="string">&quot;str&quot;</span>) == <span class="literal">true</span></span><br><span class="line"><span class="comment">// ä¸åŒç±»å‹</span></span><br><span class="line"><span class="comment">// å…ˆå°† new String(&quot;str&quot;) è½¬æ¢æˆåŸºæœ¬ç±»å‹ï¼ˆå¼ºåˆ¶å­—ç¬¦ä¸²ç±»å‹è½¬æ¢ï¼‰å¾—åˆ°ï¼š</span></span><br><span class="line"><span class="comment">// &quot;str&quot; == true</span></span><br><span class="line"><span class="comment">//å…¶ä¸­ä¸€ä¸ªæ˜¯ boolean ç±»å‹ï¼Œè½¬æˆ number</span></span><br><span class="line"><span class="comment">// &quot;str&quot; == 1</span></span><br><span class="line"><span class="comment">// å°† string è£…æ¢æˆ number</span></span><br><span class="line"><span class="comment">// NaN == 1</span></span><br><span class="line"><span class="comment">// æœ€åï¼šfalse</span></span><br></pre></td></tr></table></figure><h3 id="-1"><a href="#-1" class="headerlink" title="+"></a>+</h3><p><strong>åœ¨æ±‚å€¼æ—¶ï¼Œå®ƒé¦–å…ˆå°†ä¸¤ä¸ªæ“ä½œæ•°å¼ºåˆ¶è½¬æ¢ä¸ºåŸºæœ¬ç±»å‹ã€‚ç„¶åï¼Œæ£€æŸ¥ä¸¤ä¸ªæ“ä½œæ•°çš„ç±»å‹</strong>:</p><ul><li>å¤šä¸ªå€¼è¿ç®—ï¼Œè¿›è¡Œç›¸åŠ æ“ä½œï¼Œå¦‚æœå…¶ä¸­æœ‰ä¸€ä¸ªæ˜¯å­—ç¬¦ä¸²ï¼Œé‚£ä¹ˆä¼šå°†å¦ä¸€ä¸ªæ•°è½¬æ¢æˆå­—ç¬¦ä¸²ï¼Œè¿›è¡Œå­—ç¬¦ä¸²è¿æ¥ã€‚</li><li>å¤šä¸ªå€¼è¿ç®—ï¼Œéƒ½æ˜¯ BigInt, æ‰§è¡Œ BigInt åŠ æ³•ï¼Œä¸€æ–¹æ˜¯ BigInt,å¦ä¸€ä¸ªä¸æ˜¯ï¼ŒæŠ›å‡º TypeErrorã€‚</li><li>å¤šä¸ªå€¼è¿ç®—ï¼Œæ²¡æœ‰ Stringã€BigInt, éƒ½è½¬ä¸ºæ•°å­—ã€‚</li><li>å•å€¼è¿ç®—ï¼Œè½¬æ¢æˆæ•°å­—</li></ul><h4 id="ä¸‹é¢æ¥çœ‹ä¸€ä¸‹å¸¸è§çš„è¿ç®—-ğŸ˜"><a href="#ä¸‹é¢æ¥çœ‹ä¸€ä¸‹å¸¸è§çš„è¿ç®—-ğŸ˜" class="headerlink" title="ä¸‹é¢æ¥çœ‹ä¸€ä¸‹å¸¸è§çš„è¿ç®— ğŸ˜"></a>ä¸‹é¢æ¥çœ‹ä¸€ä¸‹å¸¸è§çš„è¿ç®— ğŸ˜</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#125; + [] + &#123;&#125; + []</span><br><span class="line"><span class="comment">// è¿™é‡Œæœ‰ä¸€ä¸ªå‘å°±æ˜¯ &#123;&#125; ä¼šè¯†åˆ«ä¸ºä¸€ä¸ª block, ç„¶åå°±æˆäº†ä¸‹é¢è¿™ç§æƒ…å†µ</span></span><br><span class="line"><span class="comment">// + [] + &#123;&#125; + []</span></span><br><span class="line"><span class="comment">// å‰éƒ¨åˆ†å°±ç›¸å½“äºå•ç›®è¿ç®—ï¼Œè½¬æ¢æˆæ•°å­—ç±»å‹ []--valueOf--&gt;[]--toString--&gt;&#x27;&#x27;--toNumber--&gt;0</span></span><br><span class="line"><span class="comment">// 0 + &#123;&#125; + []</span></span><br><span class="line"><span class="comment">// å…ˆè½¬æ¢æˆåŸºæœ¬ç±»å‹</span></span><br><span class="line"><span class="comment">// 0 + &#x27;[object Object]&#x27; + []</span></span><br><span class="line"><span class="comment">// &#x27;0[object Object]&#x27; + []</span></span><br><span class="line"><span class="comment">// è½¬æ¢æˆåŸºæœ¬ç±»å‹</span></span><br><span class="line"><span class="comment">// &#x27;0[object Object]&#x27; + &#x27;&#x27;</span></span><br><span class="line"><span class="comment">// æ‹¼æ¥</span></span><br><span class="line"><span class="comment">//&#x27;0[object Object]&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="literal">true</span> + <span class="number">1</span></span><br><span class="line"><span class="comment">// å·²ç»éƒ½æ˜¯åŸºæœ¬ç±»å‹äº†</span></span><br><span class="line"><span class="comment">// æ²¡æœ‰ Stringã€BigIntï¼Œéƒ½è½¬æ¢æˆæ•°å­—</span></span><br><span class="line"><span class="comment">// 1 + 1</span></span><br><span class="line"><span class="comment">// 2</span></span><br><span class="line"></span><br><span class="line"><span class="literal">NaN</span> + <span class="number">1</span></span><br><span class="line"><span class="comment">// å·²ç»éƒ½æ˜¯åŸºæœ¬ç±»å‹äº†</span></span><br><span class="line"><span class="comment">// æ²¡æœ‰ Stringã€BigIntï¼Œéƒ½è½¬æ¢æˆæ•°å­—</span></span><br><span class="line"><span class="comment">// NaN + 1</span></span><br><span class="line"><span class="comment">// NaN</span></span><br><span class="line"></span><br><span class="line">[] + &#123;&#125;</span><br><span class="line"><span class="comment">// è£…æ¢æˆåŸºæœ¬ç±»å‹</span></span><br><span class="line"><span class="comment">// &#x27;&#x27; + &#x27;[object Object]&#x27;</span></span><br><span class="line"><span class="comment">// [object Object]</span></span><br><span class="line"></span><br><span class="line">&#123;&#125; + []</span><br><span class="line"><span class="comment">// åŒæ ·çš„å‘å°±æ˜¯ &#123;&#125; ä¼šè¯†åˆ«ä¸ºä¸€ä¸ª block, ç„¶åå°±æˆäº†ä¸‹é¢è¿™ç§æƒ…å†µ</span></span><br><span class="line"><span class="comment">// + []</span></span><br><span class="line"><span class="comment">// è¿™é‡Œæˆäº†å•ç›®è¿ç®—ï¼Œå°†åé¢çš„è½¬æ¢ä¸ºæ•°å€¼</span></span><br><span class="line"><span class="comment">// 0</span></span><br><span class="line"></span><br><span class="line">ï¼ˆ&#123;&#125;ï¼‰ + []</span><br><span class="line"><span class="comment">// è¿™ç§æƒ…å†µå°±ä¸ [] + &#123;&#125; ç±»ä¼¼äº†</span></span><br><span class="line"><span class="comment">// &#x27;[object Object]&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// &#123;&#125; + &#123;&#125;</span></span><br><span class="line"><span class="comment">// å‰é¢è¯†åˆ«ä¸º block</span></span><br><span class="line"><span class="comment">// + &#123;&#125;</span></span><br><span class="line"><span class="comment">// å•ç›®è¿ç®—ã€‚è½¬æ¢æˆæ•°å­—</span></span><br><span class="line"><span class="comment">// &#123;&#125; --valueOf--&gt;&#123;&#125;--toString--&gt;&#x27;[object Object]&#x27;--toNumber--&gt;NaN</span></span><br><span class="line"><span class="comment">// NaN</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// [] + []</span></span><br><span class="line"><span class="comment">// è½¬æ¢æˆåŸºæœ¬ç±»å‹</span></span><br><span class="line"><span class="comment">// &#x27;&#x27; + &#x27;&#x27;</span></span><br><span class="line"><span class="comment">// æ‹¼æ¥</span></span><br><span class="line"><span class="comment">// &#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="-2"><a href="#-2" class="headerlink" title="-"></a>-</h3><ul><li>ä¸¤ä¸ªæ“ä½œæ•°ï¼šå°†ä¸¤ä¸ªæ“ä½œæ•°è½¬æ¢ä¸ºæ•°å€¼ï¼Œå¹¶æ ¹æ®ä¸¤ä¸ªæ“ä½œæ•°çš„ç±»å‹æ‰§è¡Œæ•°å­—å‡æ³•æˆ– BigInt å‡æ³•ã€‚å¦‚æœç±»å‹ä¸åŒ¹é…ï¼Œåˆ™æŠ›å‡º TypeErrorã€‚</li><li>ä¸€ä¸ªæ“ä½œæ•°ï¼šæ•°å­—åˆ™å–åï¼Œå¦åˆ™è½¬æ¢æˆæ•°å­—ç±»å‹ã€‚</li></ul><h4 id="çœ‹çœ‹ä¾‹é¢˜"><a href="#çœ‹çœ‹ä¾‹é¢˜" class="headerlink" title="çœ‹çœ‹ä¾‹é¢˜"></a>çœ‹çœ‹ä¾‹é¢˜</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[] - &#123;&#125;;</span><br><span class="line"><span class="comment">// è½¬æˆæ•°å­—</span></span><br><span class="line"><span class="comment">// [] --valueOf--ã€‹ [] --toString--ã€‹ &quot;&quot; --toNumber--ã€‹ 0</span></span><br><span class="line"><span class="comment">// &#123;&#125;--valueOf--ã€‹ &#123;&#125;--toString--ã€‹ &#x27;[object Object]&#x27;--toNumber--ã€‹ NaN</span></span><br><span class="line"><span class="comment">// 0 - NaN</span></span><br><span class="line"><span class="comment">// NaN</span></span><br></pre></td></tr></table></figure><h3 id="-3"><a href="#-3" class="headerlink" title="!"></a>!</h3><ul><li>è¿ç®—ç¬¦å°†çœŸå€¼æˆ–å‡å€¼è½¬æ¢ä¸ºå¯¹åº”çš„ç›¸åå€¼</li><li>å½“ä¸éå¸ƒå°”å€¼ä½¿ç”¨æ—¶ï¼Œå¦‚æœå…¶æ“ä½œæ•°å¯ä»¥è½¬åŒ–ä¸º trueï¼Œåˆ™è¿”å› falseï¼Œå¦åˆ™è¿”å› trueã€‚</li></ul><h4 id="-4"><a href="#-4" class="headerlink" title="!!"></a>!!</h4><p>åŒéè¿ç®—ç¬¦ï¼Œå°†è¿ç®—å€¼è½¬æ¢æˆç›¸åº”çš„ boolean ç±»å‹ã€‚</p><h4 id="çœ‹çœ‹ä¾‹é¢˜-1"><a href="#çœ‹çœ‹ä¾‹é¢˜-1" class="headerlink" title="çœ‹çœ‹ä¾‹é¢˜"></a>çœ‹çœ‹ä¾‹é¢˜</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">![];</span><br><span class="line"><span class="comment">// å°† [] è½¬æˆ boolean, æ ¹æ®å¼ºåˆ¶Booleanè½¬æ¢(Objectç±»å‹ï¼‰ï¼š[] --&gt; true</span></span><br><span class="line"><span class="comment">// !true</span></span><br><span class="line"><span class="comment">// false</span></span><br></pre></td></tr></table></figure><h3 id="gt-lt"><a href="#gt-lt" class="headerlink" title="&gt; / &lt;"></a>&gt; / &lt;</h3><p><strong>æ‰€æœ‰çš„æ¯”è¾ƒæ“ä½œç¬¦éƒ½æ˜¯å…ˆå¼ºåˆ¶è½¬åŒ–å·¦æ“ä½œæ•°å†å¼ºåˆ¶è½¬åŒ–å³æ“ä½œæ•°ã€‚</strong><br>é¦–å…ˆï¼Œé€šè¿‡ä¾æ¬¡è°ƒç”¨å…¶ [@@toPrimitive]ï¼ˆä»¥ â€œnumberâ€ ä½œä¸ºæç¤ºï¼‰ã€valueOf() å’Œ toString() æ–¹æ³•ï¼Œå°†å¯¹è±¡è½¬æ¢ä¸ºåŸå§‹ç±»å‹ã€‚å·¦è¾¹çš„æ“ä½œæ•°æ€»æ˜¯åœ¨å³è¾¹çš„æ“ä½œæ•°ä¹‹å‰è¢«å¼ºåˆ¶è½¬æ¢ã€‚</p><ul><li>å¦‚æœä¸¤ä¸ªå€¼éƒ½æ˜¯å­—ç¬¦ä¸²ï¼Œåˆ™æ ¹æ®å®ƒä»¬æ‰€åŒ…å«çš„ Unicode ç ä½çš„å€¼ï¼Œå°†å®ƒä»¬ä½œä¸ºå­—ç¬¦ä¸²è¿›è¡Œæ¯”è¾ƒã€‚</li><li>å¦åˆ™ï¼Œå°è¯•å°†éæ•°å€¼ç±»å‹è½¬åŒ–ä¸ºæ•°å€¼ç±»å‹ã€‚</li><li>å¦‚æœä¸€ä¸ªä¸º NaN, è¿”å› falseã€‚</li></ul><h4 id="çœ‹çœ‹ä¾‹é¢˜-2"><a href="#çœ‹çœ‹ä¾‹é¢˜-2" class="headerlink" title="çœ‹çœ‹ä¾‹é¢˜"></a>çœ‹çœ‹ä¾‹é¢˜</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;a&quot;</span> &lt; <span class="number">3</span>;</span><br><span class="line"><span class="comment">// å…ˆå°†å·¦è¾¹è½¬åŒ–ä¸ºæ•°å€¼ç±»å‹</span></span><br><span class="line"><span class="comment">// NaN &lt; 3</span></span><br><span class="line"><span class="comment">// æœ‰ä¸€ä¸ªä¸ºNaN, è¿”å› false</span></span><br><span class="line"><span class="comment">// false</span></span><br><span class="line"></span><br><span class="line"><span class="number">0</span> &lt; [];</span><br><span class="line"><span class="comment">// å·¦è¾¹ä¸ºæ•°å­—ç±»å‹ï¼Œå°†å³è¾¹è½¬æ¢ä¸ºæ•°å­—ç±»å‹</span></span><br><span class="line"><span class="comment">// [] --toString--&gt; &#x27;&#x27; --toNumber--&gt; 0</span></span><br><span class="line"><span class="comment">// 0 &lt; 0</span></span><br><span class="line"><span class="comment">// false</span></span><br></pre></td></tr></table></figure><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>éšå¼è½¬æ¢çš„è§„åˆ™éå¸¸å¤šï¼Œä½†éƒ½æ˜¯å‘åŸºæœ¬ç±»å‹è½¬æ¢ï¼Œæ‰€ä»¥ç†è§£<a href="#å¤æ‚ç±»å‹è½¬æ¢æˆåŸå§‹ç±»å‹">å¤æ‚ç±»å‹è½¬æ¢æˆåŸå§‹ç±»å‹</a>æ¯”è¾ƒé‡è¦ï¼Œç‰¹åˆ«çš„è¿˜éœ€è¦æ³¨æ„ {} è¯†åˆ«ä¸ºä¸€ä¸ª block çš„æƒ…å†µã€‚</p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/Equality">https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/Equality</a></li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Data_structures#%E5%BC%BA%E5%88%B6%E5%8E%9F%E5%A7%8B%E5%80%BC%E8%BD%AC%E6%8D%A2">https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Data_structures#%E5%BC%BA%E5%88%B6%E5%8E%9F%E5%A7%8B%E5%80%BC%E8%BD%AC%E6%8D%A2</a></li><li><a href="https://www.zhihu.com/question/45478070">https://www.zhihu.com/question/45478070</a></li></ul>]]></content>
    
    
    <summary type="html">&lt;p&gt;å¯¹äº JavaScript ä¸­çš„ä¸€äº›è¿ç®—ç¬¦ï¼ˆå¦‚ï¼š==ï¼‰æ¥è¯´æ˜¯æ¯”è¾ƒè¿·æƒ‘çš„ã€‚å®ƒä»¬äº§ç”Ÿçš„ç»“æœæœ‰æ—¶ä¼šè®©æˆ‘ä»¬å˜å¾—æ··æ·†ï¼Œé‚£è¿™ä¸€åˆ‡çš„èƒŒåå°±æ˜¯â€œéšå¼è½¬æ¢â€åœ¨ä½œç¥Ÿäº†ã€‚&lt;/p&gt;
&lt;h2 id=&quot;å‰ç½®&quot;&gt;&lt;a href=&quot;#å‰ç½®&quot; class=&quot;headerlink&quot; title=&quot;å‰ç½®&quot;&gt;&lt;/a&gt;å‰ç½®&lt;/h2&gt;&lt;h3 id=&quot;Number-å¼ºåˆ¶è½¬æ¢&quot;&gt;&lt;a href=&quot;#Number-å¼ºåˆ¶è½¬æ¢&quot; class=&quot;headerlink&quot; title=&quot;Number å¼ºåˆ¶è½¬æ¢&quot;&gt;&lt;/a&gt;Number å¼ºåˆ¶è½¬æ¢&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&quot;center&quot;&gt;target&lt;/th&gt;
&lt;th align=&quot;center&quot;&gt;number&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td align=&quot;center&quot;&gt;undefined&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;NaN&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;center&quot;&gt;null&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;0&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;center&quot;&gt;true/false&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;1/0&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;center&quot;&gt;string&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;è§£æå¤±è´¥è¿”å› NaN&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;center&quot;&gt;BigInt&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;TypeError&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;center&quot;&gt;Symbol&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;TypeError&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;center&quot;&gt;Object&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;&lt;a href=&quot;%22number%22&quot;&gt;@@toPrimitive&lt;/a&gt; â†’ valueOf() â†’ toString()&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;string è§£æå¤±è´¥ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¿½ç•¥å‰å¯¼ä¸å°¾éšçš„ç©ºæ ¼/è¡Œç»ˆæ­¢ç¬¦&lt;/li&gt;
&lt;li&gt;å‰å¯¼ 0 ä¸ä¼šè¯†åˆ«ä¸ºå…«è¿›åˆ¶æ–‡æœ¬&lt;/li&gt;
&lt;li&gt;+å’Œ-å…è®¸åœ¨å­—ç¬¦ä¸²å¼€å¤´ï¼Œä¸”åªèƒ½å‡ºç°ä¸€æ¬¡ï¼Œåé¢ä¸èƒ½è·Ÿç©ºæ ¼&lt;/li&gt;
&lt;li&gt;Infinity å’Œ -Infinity å½“ä½œå­—é¢é‡&lt;/li&gt;
&lt;li&gt;ç©ºä¸²æˆ–å…¨ä¸ºç©ºæ ¼è§£ææˆ 0&lt;/li&gt;
&lt;li&gt;ä¸èƒ½å«æ•°å­—åˆ†å‰²ç¬¦&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="javascript" scheme="https://jealh.xyz/categories/javascript/"/>
    
    
    <category term="éšå¼è½¬æ¢" scheme="https://jealh.xyz/tags/%E9%9A%90%E5%BC%8F%E8%BD%AC%E6%8D%A2/"/>
    
  </entry>
  
  <entry>
    <title>ã€è¯‘ã€‘Javascript ä¸­çš„ CJSã€AMDã€UMD å’Œ ESM åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿ</title>
    <link href="https://jealh.xyz/2023/02/10/%E3%80%90%E8%AF%91%E3%80%91Javascript%20%E4%B8%AD%E7%9A%84%20CJS%E3%80%81AMD%E3%80%81UMD%20%E5%92%8C%20ESM%20%E5%88%B0%E5%BA%95%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F/"/>
    <id>https://jealh.xyz/2023/02/10/%E3%80%90%E8%AF%91%E3%80%91Javascript%20%E4%B8%AD%E7%9A%84%20CJS%E3%80%81AMD%E3%80%81UMD%20%E5%92%8C%20ESM%20%E5%88%B0%E5%BA%95%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F/</id>
    <published>2023-02-10T07:19:07.000Z</published>
    <updated>2023-04-11T07:08:57.818Z</updated>
    
    <content type="html"><![CDATA[<p>åŸæ–‡ï¼š<a href="https://dev.to/iggredible/what-the-heck-are-cjs-amd-umd-and-esm-ikm">https://dev.to/iggredible/what-the-heck-are-cjs-amd-umd-and-esm-ikm</a></p><p>ä¸€å¼€å§‹ï¼ŒJavascript æ²¡æœ‰å¯¼å…¥/å¯¼å‡ºæ¨¡å—çš„æ–¹æ³•ã€‚è¿™æ˜¯ä¸ªé—®é¢˜ã€‚æƒ³è±¡ä¸€ä¸‹åªåœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­ç¼–å†™æ‚¨çš„åº”ç”¨ç¨‹åºâ€”â€”é‚£å°†æ˜¯ä¸€åœºå™©æ¢¦ï¼</p><p>ç„¶åï¼Œæ¯”æˆ‘èªæ˜å¾—å¤šçš„äººè¯•å›¾ä¸º Javascript æ·»åŠ æ¨¡å—åŒ–ã€‚å…¶ä¸­ä¸€äº›æ˜¯ CJSã€AMDã€UMD å’Œ ESMã€‚æ‚¨å¯èƒ½å¬è¯´è¿‡å…¶ä¸­ä¸€äº›æ–¹æ³•ï¼ˆè¿˜æœ‰å…¶ä»–æ–¹æ³•ï¼Œä½†è¿™äº›éƒ½æ˜¯å¤§ç©å®¶ï¼‰ã€‚</p><span id="more"></span><h2 id="CJS"><a href="#CJS" class="headerlink" title="CJS"></a>CJS</h2><p>CJS æ˜¯ CommonJS çš„ç¼©å†™ã€‚è¿™æ˜¯å®ƒçš„æ ·å­ï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//importing</span></span><br><span class="line"><span class="keyword">const</span> doSomething = <span class="built_in">require</span>(<span class="string">&quot;./doSomething.js&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//exporting</span></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> <span class="title">doSomething</span>(<span class="params">n</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// do something</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ul><li>ä½ ä»¬ä¸­çš„ä¸€äº›äººå¯èƒ½ç«‹å³ä¼šè®¤ä¸º CJS è¯­æ³•æ¥è‡ªäº nodejsã€‚é‚£æ˜¯å› ä¸º nodejs ä½¿ç”¨ CJS æ¨¡å—æ ¼å¼ã€‚</li><li>CJS åŒæ­¥å¯¼å…¥æ¨¡å—ã€‚</li><li>æ‚¨å¯ä»¥ä»åº“ node_modules æˆ–æœ¬åœ°ç›®å½•å¯¼å…¥ã€‚é€šè¿‡ <code>const myLocalModule = require(&#39;./some/local/file.js&#39;)</code> æˆ– <code>var React = require(&#39;react&#39;);</code></li><li>å½“ CJS å¯¼å…¥æ—¶ï¼Œå®ƒä¼šç»™ä½ ä¸€ä¸ªå¯¼å…¥å¯¹è±¡çš„å‰¯æœ¬ã€‚ç›¸å½“äºä¸€ä¸ªå¼•ç”¨åœ°å€ã€‚</li><li>CJS å°†åœ¨æµè§ˆå™¨ä¸­ä¸èµ·ä½œç”¨ã€‚å®ƒå¿…é¡»è¢« transpiled and bundledã€‚</li></ul><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ============ foo.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="attr">foo</span>: <span class="string">&quot;from foo&quot;</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ============ bar.js</span></span><br><span class="line"><span class="keyword">const</span> foo = <span class="built_in">require</span>(<span class="string">&quot;./foo.js&quot;</span>);</span><br><span class="line"></span><br><span class="line">foo.foo = foo.foo + <span class="string">&quot; and from bar&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = foo;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ============ index.js</span></span><br><span class="line"><span class="keyword">const</span> foo = <span class="built_in">require</span>(<span class="string">&quot;./foo.js&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;before require bar:&quot;</span>, foo); <span class="comment">// &#123;foo: &#x27;from foo&#x27;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> bar = <span class="built_in">require</span>(<span class="string">&quot;./bar.js&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;after require bar:&quot;</span>, foo); <span class="comment">// &#123;foo: &#x27;from foo and from bar&#x27;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;definitely same memory address:&quot;</span>, bar === foo); <span class="comment">// true</span></span><br></pre></td></tr></table></figure><h2 id="AMD"><a href="#AMD" class="headerlink" title="AMD"></a>AMD</h2><p>AMD ä»£è¡¨å¼‚æ­¥æ¨¡å—å®šä¹‰ã€‚è¿™æ˜¯ä¸€ä¸ªç¤ºä¾‹ä»£ç ï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">define([<span class="string">&quot;dep1&quot;</span>, <span class="string">&quot;dep2&quot;</span>], <span class="function"><span class="keyword">function</span> (<span class="params">dep1, dep2</span>) </span>&#123;</span><br><span class="line">  <span class="comment">//Define the module value by returning a value.</span></span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>or</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// &quot;simplified CommonJS wrapping&quot; https://requirejs.org/docs/whyamd.html</span></span><br><span class="line">define(<span class="function"><span class="keyword">function</span> (<span class="params"><span class="built_in">require</span></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> dep1 = <span class="built_in">require</span>(<span class="string">&quot;dep1&quot;</span>),</span><br><span class="line">    dep2 = <span class="built_in">require</span>(<span class="string">&quot;dep2&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><ul><li>AMD å¼‚æ­¥å¯¼å…¥æ¨¡å—ï¼ˆå› æ­¤å¾—åï¼‰ã€‚</li><li>AMD æ˜¯ä¸ºå‰ç«¯è€Œç”Ÿçš„ï¼ˆå½“å®ƒè¢«æè®®æ—¶ï¼‰ï¼ˆè€Œ CJS æ˜¯åç«¯ï¼‰ã€‚</li><li>AMD è¯­æ³•ä¸å¦‚ CJS ç›´è§‚ã€‚æˆ‘è®¤ä¸º AMD ä¸ CJS å®Œå…¨ç›¸å.</li></ul><h2 id="UMD"><a href="#UMD" class="headerlink" title="UMD"></a>UMD</h2><p>UMD ä»£è¡¨é€šç”¨æ¨¡å—å®šä¹‰.</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">root, factory</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> define === <span class="string">&quot;function&quot;</span> &amp;&amp; define.amd) &#123;</span><br><span class="line">        define([<span class="string">&quot;jquery&quot;</span>, <span class="string">&quot;underscore&quot;</span>], factory);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="built_in">exports</span> === <span class="string">&quot;object&quot;</span>) &#123;</span><br><span class="line">        <span class="built_in">module</span>.exports = factory(<span class="built_in">require</span>(<span class="string">&quot;jquery&quot;</span>), <span class="built_in">require</span>(<span class="string">&quot;underscore&quot;</span>));</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        root.Requester = factory(root.$, root._);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;(<span class="built_in">this</span>, <span class="function"><span class="keyword">function</span> (<span class="params">$, _</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// this is where I defined my module implementation</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> Requester = &#123; <span class="comment">// ... &#125;;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> Requester;</span><br><span class="line">&#125;));</span><br></pre></td></tr></table></figure><ul><li>é€‚ç”¨äºå‰ç«¯å’Œåç«¯ï¼ˆå› æ­¤å¾—å universalï¼‰ã€‚</li><li>ä¸ CJS æˆ– AMD ä¸åŒï¼ŒUMD æ›´åƒæ˜¯ä¸€ç§é…ç½®å¤šä¸ªæ¨¡å—ç³»ç»Ÿçš„æ¨¡å¼ã€‚åœ¨<a href="https://github.com/umdjs/umd/">æ­¤å¤„</a>æŸ¥çœ‹æ›´å¤šæ¨¡å¼ã€‚</li><li>åœ¨ä½¿ç”¨ Rollup/Webpack ç­‰æ‰“åŒ…å™¨æ—¶ï¼ŒUMD é€šå¸¸ç”¨ä½œåå¤‡æ¨¡å—</li></ul><h2 id="ESM"><a href="#ESM" class="headerlink" title="ESM"></a>ESM</h2><p>ESM ä»£è¡¨ ES æ¨¡å—ã€‚å®ç°æ ‡å‡†çš„æ¨¡å—ç³»ç»Ÿæ˜¯ Javascript çš„æè®®ã€‚ç›¸ä¿¡å¾ˆå¤šäººéƒ½çœ‹è¿‡è¿™ä¸ªï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123;foo, bar&#125; <span class="keyword">from</span> <span class="string">&#x27;./myLib&#x27;</span>;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// your Function</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="function"><span class="title">function1</span>(<span class="params"></span>)</span> &#123;...&#125;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="function"><span class="title">function2</span>(<span class="params"></span>)</span> &#123;...&#125;;</span><br></pre></td></tr></table></figure><ul><li>é€‚ç”¨äºè®¸å¤šç°ä»£æµè§ˆå™¨</li><li>å®ƒå…¼å…·ä¸¤å…¨å…¶ç¾ï¼šç±»ä¼¼ CJS çš„ç®€å•è¯­æ³•å’Œ AMD çš„å¼‚æ­¥</li><li>Tree-shakeableï¼Œç”±äº ES6 çš„é™æ€æ¨¡å—ç»“æ„</li><li>ESM å…è®¸åƒ Rollup è¿™æ ·çš„æ‰“åŒ…å™¨åˆ é™¤ä¸å¿…è¦çš„ä»£ç ï¼Œå…è®¸ç«™ç‚¹å‘é€æ›´å°‘çš„ä»£ç ä»¥è·å¾—æ›´å¿«çš„åŠ è½½ã€‚</li><li>å¯ä»¥åœ¨ HTML ä¸­è°ƒç”¨ï¼Œåªéœ€æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š(script æ ‡ç­¾æ ‡æ³¨ type=â€™moduleâ€™)ï¼Œnode ç¯å¢ƒä¸‹å¯ä»¥åœ¨<code>package.json</code>ä¸­æ·»åŠ <code>type=&#39;module&#39;</code></li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;module&quot;</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> &#123; func1 &#125; <span class="keyword">from</span> <span class="string">&quot;my-lib&quot;</span>;</span></span><br><span class="line"><span class="javascript">  func1();</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æµè§ˆå™¨å…¼å®¹æ€§ï¼š</p><ul><li>Safari 10.1.</li><li>Chrome 61.</li><li>Firefox 60.</li><li>Edge 16.</li></ul><h3 id="å¼‚æ­¥æ€§"><a href="#å¼‚æ­¥æ€§" class="headerlink" title="å¼‚æ­¥æ€§"></a>å¼‚æ­¥æ€§</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ========== foo.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">foo</span>: <span class="string">&quot;from foo&quot;</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ========== bar.js</span></span><br><span class="line"><span class="keyword">import</span> foo <span class="keyword">from</span> <span class="string">&quot;./foo.js&quot;</span>;</span><br><span class="line"></span><br><span class="line">foo.foo = foo.foo + <span class="string">&quot; and from bar.js&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(foo);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> foo;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ========== index.js</span></span><br><span class="line"><span class="keyword">import</span> foo <span class="keyword">from</span> <span class="string">&quot;./foo.js&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(foo);</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> bar <span class="keyword">from</span> <span class="string">&quot;./bar.js&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¾“å‡ºï¼ˆimport bar from &#x27;./bar.js æå‰äº†ï¼‰</span></span><br><span class="line"><span class="comment">// bar: &#123; foo: &#x27;from foo and from bar.js&#x27; &#125;</span></span><br><span class="line"><span class="comment">// index: &#123; foo: &#x27;from foo and from bar.js&#x27; &#125;</span></span><br></pre></td></tr></table></figure><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><ul><li>ESM æ˜¯æœ€å¥½çš„æ¨¡å—æ ¼å¼ï¼Œè¿™è¦å½’åŠŸäºå…¶ç®€å•çš„è¯­æ³•ã€å¼‚æ­¥ç‰¹æ€§å’Œ tree-shakeabilityã€‚</li><li>UMD æ— å¤„ä¸åœ¨ï¼Œé€šå¸¸ç”¨ä½œ ESM ä¸èµ·ä½œç”¨æ—¶çš„åå¤‡æ–¹æ¡ˆã€‚</li><li>CJS æ˜¯åŒæ­¥çš„ï¼Œé€‚åˆåç«¯ã€‚</li><li>AMD æ˜¯å¼‚æ­¥çš„ï¼Œé€‚åˆå‰ç«¯ã€‚<br>æ„Ÿè°¢é˜…è¯»ï¼Œå¼€å‘è€…ï¼ä»¥åæ‰“ç®—æŠŠæ¯ä¸ªæ¨¡å—éƒ½å†™çš„å¾ˆæ·±å…¥ï¼Œå°¤å…¶æ˜¯ ESMï¼Œå› ä¸ºé‡Œé¢æœ‰å¾ˆå¤šç‰›é€¼ã€‚æ•¬è¯·å…³æ³¨ï¼<br>å¦‚æœæ‚¨å‘ç°ä»»ä½•é”™è¯¯ï¼Œè¯·å‘Šè¯‰æˆ‘ã€‚</li></ul>]]></content>
    
    
    <summary type="html">&lt;p&gt;åŸæ–‡ï¼š&lt;a href=&quot;https://dev.to/iggredible/what-the-heck-are-cjs-amd-umd-and-esm-ikm&quot;&gt;https://dev.to/iggredible/what-the-heck-are-cjs-amd-umd-and-esm-ikm&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;ä¸€å¼€å§‹ï¼ŒJavascript æ²¡æœ‰å¯¼å…¥/å¯¼å‡ºæ¨¡å—çš„æ–¹æ³•ã€‚è¿™æ˜¯ä¸ªé—®é¢˜ã€‚æƒ³è±¡ä¸€ä¸‹åªåœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­ç¼–å†™æ‚¨çš„åº”ç”¨ç¨‹åºâ€”â€”é‚£å°†æ˜¯ä¸€åœºå™©æ¢¦ï¼&lt;/p&gt;
&lt;p&gt;ç„¶åï¼Œæ¯”æˆ‘èªæ˜å¾—å¤šçš„äººè¯•å›¾ä¸º Javascript æ·»åŠ æ¨¡å—åŒ–ã€‚å…¶ä¸­ä¸€äº›æ˜¯ CJSã€AMDã€UMD å’Œ ESMã€‚æ‚¨å¯èƒ½å¬è¯´è¿‡å…¶ä¸­ä¸€äº›æ–¹æ³•ï¼ˆè¿˜æœ‰å…¶ä»–æ–¹æ³•ï¼Œä½†è¿™äº›éƒ½æ˜¯å¤§ç©å®¶ï¼‰ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="è¯‘æ–‡" scheme="https://jealh.xyz/categories/%E8%AF%91%E6%96%87/"/>
    
    
  </entry>
  
  <entry>
    <title>2022 å¹´ç»ˆæ€»ç»“</title>
    <link href="https://jealh.xyz/2022/12/31/2022-%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/"/>
    <id>https://jealh.xyz/2022/12/31/2022-%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/</id>
    <published>2022-12-31T09:53:46.000Z</published>
    <updated>2022-12-31T10:26:33.579Z</updated>
    
    <content type="html"><![CDATA[<p>2022 å¹´å°±è¦ç»“æŸäº†ï¼Œå›æƒ³è¿™ä¸€å¹´å¯è°“æ˜¯äº”å‘³æ‚é™ˆå•Šã€‚ä¹Ÿæ˜¯ç»å†è®¸å¤šç¬¬ä¸€æ¬¡çš„ä¸€å¹´å§ã€‚</p><span id="more"></span><h2 id="ç”Ÿæ´»"><a href="#ç”Ÿæ´»" class="headerlink" title="ç”Ÿæ´»"></a>ç”Ÿæ´»</h2><p>åœ¨è¿™å­¦æœŸå¼€å§‹ï¼Œä¹Ÿå°±æ˜¯å¤§ä¸‰ä¸‹ï¼Œç„¶åå¼€å§‹æ‰¾å®ä¹ äº†ã€‚åœ¨æ‰¾å®ä¹ çš„è¿‡ç¨‹ä¸­è¿˜ç®—åå·å§ï¼Œç»å†äº†äººç”Ÿçš„ç¬¬ä¸€æ¬¡é¢è¯•ã€‚å…¶å®æŠ•çš„å…¬å¸ä¸€ä¸ªæ‰‹èƒ½æ•°è¿‡æ¥ã€‚ç„¶åå°±åˆ†åˆ«é¢äº†å­—èŠ‚ã€ç½‘æ˜“ã€èš‚èšã€‚å…¶ä¸­å­—èŠ‚é¢äº†ä¸¤æ¬¡ï¼Œä¸€æ¬¡æ˜¯å›½é™…åŒ–ç”µå•†ï¼Œå¦ä¸€æ¬¡å°±æ˜¯æˆ‘ä¸‹åŠå¹´æ‰€å®ä¹ çš„éƒ¨é—¨æ‡‚è½¦å¸äº†ã€‚</p><p>æ›²æ›²æŠ˜æŠ˜ï¼Œè¿™ä¸€å¹´æœ€ç¾å¥½çš„ä¹Ÿå°±æ˜¯ä¸‹åŠå¹´å®ä¹ åŒ—æ¼‚çš„è¿™ä¸€æ®µæ—¶é—´äº†ï¼Œè·Ÿæˆ‘çš„å®éªŒå®¤åŒå­¦ã€å®¤å‹ã€ä¸€å¼€å§‹ä¸è®¤è¯†çš„åŒæ ¡åŒå­¦ï¼ˆå“ˆå“ˆå“ˆï¼Œè¿™ç§°å‘¼æ„Ÿè§‰æœ‰ç‚¹æ€ªæ€ªçš„ï¼‰ã€‚</p><h3 id="ç§Ÿæˆ¿ç¯‡"><a href="#ç§Ÿæˆ¿ç¯‡" class="headerlink" title="ç§Ÿæˆ¿ç¯‡"></a>ç§Ÿæˆ¿ç¯‡</h3><p>å»åŒ—äº¬æ€»å¾—ç§Ÿæˆ¿å§ã€‚æ˜¯çš„ï¼Œç„¶åæˆ‘ä»¬å°±è¢«ä¸­ä»‹â€¦(æ‡‚çš„éƒ½æ‡‚)ã€‚ç¬¬ä¸€æ¬¡ç§Ÿæˆ¿æ˜¯ä¸‰ä¸ªåˆç§Ÿçš„ï¼Œæˆ¿ç§Ÿ 8000 ä¸€æœˆï¼Œé¦–ä»˜ä¸€å…± 4 ä¸‡å¤šå§ï¼Œä¸‰ä¸ªæœˆã€‚å½“æ—¶è¿˜æ˜¯æŒºéœ‡æƒŠçš„ï¼Œç¬¬ä¸€æ¬¡æ‹¿å‡ºå»è¿™ä¹ˆå¤šé’± ğŸ˜‚ã€‚</p><p>æ€»çš„æ¥è¯´ï¼ŒåŒ—äº¬ç§Ÿæˆ¿æƒ³äº‹å°‘çš„è¯è¿˜æ˜¯èµ°ä¸€äº›å¹³å°ï¼Œæ¯”å¦‚è‡ªå¦‚ä»€ä¹ˆçš„ï¼Œè™½ç„¶è¯´æœ‰é‚£ä¹ˆäº¿ä¸¢ä¸¢è´µã€‚ä½†æ˜¯ä¼šæœ‰ä¸€äº›æœåŠ¡ä¹‹ç±»çš„ï¼Œæ¯”å¦‚æ‰“æ‰«æˆ¿é—´ã€‚å¥½åƒå°±æ‰“æ‰«æˆ¿é—´æœ‰ç”¨ ğŸ¤”ã€‚</p><h3 id="ä¸Šç­ç¯‡"><a href="#ä¸Šç­ç¯‡" class="headerlink" title="ä¸Šç­ç¯‡"></a>ä¸Šç­ç¯‡</h3><p><strong>å›¢é˜Ÿèšé¤</strong><br>æ‰‹åŠ¨è¡¥ä¸Š ä¿Šå“¥è·Ÿä¸œé˜³å“¥ ğŸ‘</p><p><img src="https://cdn.jsdelivr.net/gh/PancakeDogLLL/imageBed/img/202212311521.JPG" alt="team"></p><ul><li><p>åœ°ç‚¹ï¼šåŒ—äº¬å¸‚æµ·æ·€åŒºä¸­åŸ/ä¸­å…´å¤§å¦</p></li><li><p>äº¤é€šå·¥å…·ï¼šå¼€æ°´å›¢çš„è‡ªè¡Œè½¦å•Šå“ˆå“ˆå“ˆå“ˆå“ˆ</p></li></ul><p>ä¸€ä¸ªèŒåœºå°ç™½ï¼Œåˆå…¥èŒåœºï¼Œæœ‰å¾ˆå¤šä¸œè¥¿éœ€è¦å­¦ä¹ ï¼Œä¸è®ºæ˜¯ä¸“ä¸šçš„è¿˜æ˜¯éä¸“ä¸šçš„ã€‚ä»ä¸€ä¸ªæœˆå¼€å§‹çš„é™Œç”Ÿåˆ°åæ¥çš„è½»è½¦ç†Ÿè·¯ã€‚æ”¶è·é¢‡ä¸ºä¸°åšï¼Œåœ¨è¿™é‡Œå¿…é¡»è¦æ„Ÿè°¢ä¸‹æˆ‘çš„ mentorï¼ŒçœŸæ˜¯éå¸¸çš„ niceã€‚</p><p>æ”¶è·æ»¡æ»¡çš„ gitlab</p><p><img src="https://cdn.jsdelivr.net/gh/PancakeDogLLL/imageBed/img/202212311520.JPG" alt="gitlab commit"></p><p>å¾ˆé«˜å…´èƒ½åœ¨è¿™é‡Œå®ä¹ ï¼Œæ€»çš„æ¥è¯´ç´¯å¹¶å¿«ä¹ç€ï¼Œé—æ†¾å°±æ˜¯æœªèƒ½ç•™ä¸‹ç»§ç»­å‰è¡Œ ğŸ˜…ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/PancakeDogLLL/imageBed/img/202212311502.png" alt="waka time"></p><h3 id="å¨±ä¹ç¯‡"><a href="#å¨±ä¹ç¯‡" class="headerlink" title="å¨±ä¹ç¯‡"></a>å¨±ä¹ç¯‡</h3><p>è¿™æ³¢å•Šï¼Œè™½ç„¶åŒ—äº¬è·Ÿæˆ‘æƒ³è±¡çš„æœ‰ç‚¹ä¸ä¸€æ ·ï¼Œä½†è¿˜æ˜¯å¯ä»¥çš„</p><p><img src="https://cdn.jsdelivr.net/gh/PancakeDogLLL/imageBed/img/202212311522.PNG" alt="è·Ÿæœ‹å‹ä»¬åƒçš„ç¾é£Ÿ"></p><p>ç¬¬ä¸€æ¬¡çœ‹è§äº†â€œå¤§è£¤è¡©â€<br><img src="https://cdn.jsdelivr.net/gh/PancakeDogLLL/imageBed/img/202212311739.JPG" alt="å¤§è£¤è¡©"></p><p>å’Œæœ‹å‹ä»¬é€›äº†ä¸€å°ä¼šé¸Ÿå·¢<br><img src="https://cdn.jsdelivr.net/gh/PancakeDogLLL/imageBed/img/202212311740.png" alt="é¸Ÿå·¢"></p><p><strong>å›æƒ³èµ·æ¥çœŸæ˜¯å›å¿†æ»¡æ»¡</strong></p><h2 id="æ€æƒ³"><a href="#æ€æƒ³" class="headerlink" title="æ€æƒ³"></a>æ€æƒ³</h2><p>è¿™æ–¹é¢è¿˜æ˜¯å¾—å¤šæ€è€ƒå§ï¼Œä¹Ÿè¦å­¦ä¼š say noï¼ŒåŒæ—¶è¦æœ‰è‡ªå·±å¾—è§è§£ã€‚</p><h2 id="è§„åˆ’"><a href="#è§„åˆ’" class="headerlink" title="è§„åˆ’"></a>è§„åˆ’</h2><ul><li>åšæŒå†™ä½œï¼Œè¾“å‡ºè´¨é‡æ–‡ç« </li><li>å­¦ä¹ å›¾å½¢å­¦ï¼Œå‘å±•å¤šé¢†åŸŸ</li><li>æœ‰æœºä¼šå‘å‡ ä¸ª b ç«™è§†é¢‘ ğŸ¤”</li><li>positive</li></ul><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>2022 å……æ»¡å›å¿†çš„ä¸€å¹´ï¼Œæ„Ÿè°¢æˆ‘èº«è¾¹çš„æ¯ä¸€ä¸ªäººï¼Œä»–ä»¬æ•™ä¼šäº†æˆ‘è®¸å¤šï¼Œè®©æˆ‘æ˜ç™½äº†è®¸å¤šã€‚ Respectã€‚</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;2022 å¹´å°±è¦ç»“æŸäº†ï¼Œå›æƒ³è¿™ä¸€å¹´å¯è°“æ˜¯äº”å‘³æ‚é™ˆå•Šã€‚ä¹Ÿæ˜¯ç»å†è®¸å¤šç¬¬ä¸€æ¬¡çš„ä¸€å¹´å§ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="å¹´ç»ˆæ€»ç»“" scheme="https://jealh.xyz/categories/%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/"/>
    
    
  </entry>
  
  <entry>
    <title>ã€è¯‘ã€‘ä¼˜åŒ–é•¿ä»»åŠ¡ Optimize long tasks</title>
    <link href="https://jealh.xyz/2022/10/11/%E3%80%90%E8%AF%91%E3%80%91%E4%BC%98%E5%8C%96%E9%95%BF%E4%BB%BB%E5%8A%A1-Optimize-long-tasks/"/>
    <id>https://jealh.xyz/2022/10/11/%E3%80%90%E8%AF%91%E3%80%91%E4%BC%98%E5%8C%96%E9%95%BF%E4%BB%BB%E5%8A%A1-Optimize-long-tasks/</id>
    <published>2022-10-11T14:42:10.000Z</published>
    <updated>2023-04-11T07:09:08.974Z</updated>
    
    <content type="html"><![CDATA[<p>åŸæ–‡ï¼š<a href="https://web.dev/optimize-long-tasks/">https://web.dev/optimize-long-tasks/</a></p><blockquote><p>ä½ æ›¾è¢«å‘Šè¯‰è¿‡ï¼Œä¸è¦é˜»å¡ä¸»çº¿ç¨‹å¹¶ä¸”åˆ†è§£ä½ çš„é•¿ä»»åŠ¡ï¼Œä½†æ˜¯æœ‰æƒ³è¿‡è¿™æ ·åšçš„æ„ä¹‰å—ï¼Ÿ</p></blockquote><p>å¦‚æœä½ è¯»äº†å¾ˆå¤šå…³äºç½‘ç«™æ€§èƒ½çš„èµ„æ–™, ä¿æŒ JavasScript åº”ç”¨ç¨‹åºå¿«é€Ÿè¿è¡Œçš„å»ºè®®å¾€å¾€æ¶‰åŠä»¥ä¸‹çš„å»ºè®®ï¼š</p><ul><li>ä¸è¦é˜»å¡ä¸»çº¿ç¨‹</li><li>åˆ†è§£ä½ çš„é•¿ä»»åŠ¡</li></ul><p>é‚£è¿™äº›æ„å‘³ç€ä»€ä¹ˆï¼Ÿå‡å°‘ JavaScript æ˜¯å¥½çš„ï¼Œä½†è¿™æ˜¯å¦è‡ªåŠ¨ç­‰åŒåœ¨æ•´ä¸ªé¡µé¢ç”Ÿå‘½å‘¨æœŸä¸­æ›´å¿«é€Ÿçš„ç”¨æˆ·ç•Œé¢ï¼Ÿä¹Ÿè®¸æ˜¯ï¼Œä¹Ÿè®¸ä¸æ˜¯.</p><span id="more"></span><h2 id="ä¸€ä¸ª-task-æ˜¯ä»€ä¹ˆæ ·çš„ï¼Ÿ"><a href="#ä¸€ä¸ª-task-æ˜¯ä»€ä¹ˆæ ·çš„ï¼Ÿ" class="headerlink" title="ä¸€ä¸ª task æ˜¯ä»€ä¹ˆæ ·çš„ï¼Ÿ"></a>ä¸€ä¸ª task æ˜¯ä»€ä¹ˆæ ·çš„ï¼Ÿ</h2><p>ä¸€ä¸ª task æ˜¯æµè§ˆå™¨æ‰€åšçš„ä»»ä½•ç¦»æ•£çš„å·¥ä½œï¼Œtask åŒ…æ‹¬è§£æ HTML å’Œ CSS, è¿è¡Œ JavaScript ä»£ç , ä»¥åŠä¸€äº›ä½ ä¸èƒ½ç›´æ¥æ§åˆ¶çš„äº‹æƒ…ã€‚å¯¹äºæ‰€æœ‰çš„è¿™äº›ï¼Œä½ æ‰€ç¼–å†™çš„å¹¶ä¸”éƒ¨ç½²åˆ°æœåŠ¡å™¨çš„ JavaScript æ˜¯ä¸»è¦çš„ä»»åŠ¡æ¥æºã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/PancakeDogLLL/imageBed/img/2022-10-11%2019.23.12.png" alt="img_1"></p><p>Tasks ä»¥å¤šç§æ–¹å¼å½±å“æ€§èƒ½ã€‚ä¾‹å¦‚ï¼Œå½“æµè§ˆå™¨åœ¨å¯åŠ¨æ—¶ä¸‹è½½ js æ–‡ä»¶æ—¶ï¼Œæµè§ˆå™¨å°†ä»»åŠ¡è¿›è¡Œæ’é˜Ÿå¹¶ä¸”ç¼–è¯‘ js ä»¥è®©å…¶èƒ½è¢«æ‰§è¡Œã€‚ç„¶ååœ¨é¡µé¢çš„ç”Ÿå‘½å‘¨æœŸä¸­ï¼Œï¼ˆä¾‹å¦‚é€šè¿‡äº‹ä»¶å¤„ç†ç¨‹åºé©±åŠ¨äº¤äº’ã€JavaScript é©±åŠ¨çš„åŠ¨ç”»å’Œåå°æ´»åŠ¨ï¼ˆä¾‹å¦‚åˆ†ææ”¶é›†ï¼‰ï¼‰å¯åŠ¨ä»»åŠ¡ã€‚æ‰€æœ‰çš„è¿™äº›ä¸œè¥¿ï¼Œé™¤äº† web worker å’Œç±»ä¼¼çš„ API éƒ½å‘ç”Ÿåœ¨ä¸»çº¿ç¨‹ä¸Šã€‚</p><h2 id="ä¸»çº¿ç¨‹æ˜¯ä»€ä¹ˆ-ï¼Ÿ"><a href="#ä¸»çº¿ç¨‹æ˜¯ä»€ä¹ˆ-ï¼Ÿ" class="headerlink" title="ä¸»çº¿ç¨‹æ˜¯ä»€ä¹ˆ ï¼Ÿ"></a>ä¸»çº¿ç¨‹æ˜¯ä»€ä¹ˆ ï¼Ÿ</h2><p>ä¸»çº¿ç¨‹æ˜¯å¤§å¤šæ•°ä»»åŠ¡åœ¨æµè§ˆå™¨ä¸­è¿è¡Œçš„åœ°æ–¹ã€‚å®ƒè¢«ç§°ä¸ºä¸»çº¿ç¨‹çš„åŸå› æ˜¯ï¼šå®ƒæ˜¯æ‚¨ç¼–å†™çš„å‡ ä¹æ‰€æœ‰ JavaScript éƒ½åœ¨è¿™ä¸ªçº¿ç¨‹ä¸­å·¥ä½œã€‚</p><p>ä¸»çº¿ç¨‹ä¸€æ¬¡åªèƒ½å¤„ç†ä¸€ä¸ªä»»åŠ¡ã€‚å½“ä»»åŠ¡è¶…å‡ºæŸä¸ªç¡®å®šçš„ç‚¹ï¼ˆå‡†ç¡®æ¥è¯´æ˜¯ 50ms ï¼‰æ—¶,å®ƒä»¬è¢«å½’ç±»ä¸ºé•¿ä»»åŠ¡ã€‚å¦‚æœç”¨æˆ·åœ¨é•¿æ—¶é—´çš„ä»»åŠ¡è¿è¡Œæ—¶å°è¯•ä¸é¡µé¢äº¤äº’ â€” æˆ–è€…å¦‚æœéœ€è¦è¿›è¡Œé‡è¦çš„æ¸²æŸ“æ›´æ–° â€” æµè§ˆå™¨å°†å»¶è¿Ÿå¤„ç†è¯¥å·¥ä½œã€‚è¿™ä¼šå¯¼è‡´äº¤äº’æˆ–æ¸²æŸ“å»¶è¿Ÿã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/PancakeDogLLL/imageBed/img/2022-10-11%2019.42.24.png" alt="img_2"></p><p><em style="font-size:12px">Chrome æµè§ˆå™¨çš„æ€§èƒ½åˆ†æå™¨ä¸­æè¿°çš„é•¿ä»»åŠ¡ã€‚é•¿ä»»åŠ¡çš„è§’è½é‡Œæœ‰ä¸€ä¸ªçº¢è‰²çš„ä¸‰è§’å½¢ï¼Œä»»åŠ¡çš„é˜»å¡éƒ¨åˆ†ç”¨å¯¹è§’çº¿çš„çº¢è‰²æ¡çº¹å¡«å……</em></p><p>ä½ éœ€è¦åˆ†è§£ä»»åŠ¡ã€‚è¿™æ„å‘³ç€å°†ä¸€ä¸ªé•¿ä»»åŠ¡åˆ’åˆ†ä¸ºè¾ƒå°çš„ä»»åŠ¡ï¼Œè¿™äº›ä»»åŠ¡å•ç‹¬è¿è¡Œæ‰€éœ€çš„æ—¶é—´æ›´å°‘ã€‚</p><p><img src="https://web-dev.imgix.net/image/jL3OLOhcWUQDnR4XjewLBx4e3PC3/8Bhl9Ilki4tM0aC1nfn8.png?auto=format&w=1600" alt="img_3"></p><p><em style="font-size:12px">å•ä¸ªé•¿ä»»åŠ¡ä¸åŒä¸€ä»»åŠ¡åˆ†è§£ä¸ºäº”ä¸ªè¾ƒçŸ­ä»»åŠ¡çš„å¯è§†åŒ–</em></p><p>è¿™å¾ˆé‡è¦ï¼Œå› ä¸ºå½“ä»»åŠ¡è¢«åˆ†è§£æ—¶ï¼Œæµè§ˆå™¨æœ‰æ›´å¤šæœºä¼šå“åº”æ›´é«˜ä¼˜å…ˆçº§çš„å·¥ä½œâ€”â€”åŒ…æ‹¬ç”¨æˆ·äº¤äº’ã€‚</p><p><img src="https://web-dev.imgix.net/image/jL3OLOhcWUQDnR4XjewLBx4e3PC3/0yV0ynwW7FujIwvCbCxQ.png?auto=format&w=1600" alt="img_3"></p><p><em style="font-size:12px">å½“ä»»åŠ¡å¤ªé•¿ï¼Œæµè§ˆå™¨ä¸èƒ½å¯¹äº’åŠ¨åšå‡ºè¶³å¤Ÿå¿«çš„ååº”æ—¶ï¼Œä¸å°†è¾ƒé•¿çš„ä»»åŠ¡åˆ†è§£æˆè¾ƒå°çš„ä»»åŠ¡æ—¶ç›¸æ¯”ï¼Œäº’åŠ¨ä¼šå‘ç”Ÿä»€ä¹ˆæ ·çš„æƒ…å†µï¼Œè¿™æ˜¯ä¸€ä¸ªå¯è§†åŒ–çš„ç»“æœ</em></p><p>å¦‚ä¸Šå›¾çš„ä¸ŠåŠéƒ¨åˆ†æ‰€è¿°ï¼Œç”±ç”¨æˆ·äº¤äº’æ’é˜Ÿçš„äº‹ä»¶å¤„ç†ç¨‹åºå¿…é¡»ç­‰å¾…ä¸€ä¸ªé•¿ä»»åŠ¡æ‰èƒ½è¿è¡Œã€‚è¿™å»¶è¿Ÿäº†äº¤äº’çš„å‘ç”Ÿã€‚åœ¨ä¸‹åŠéƒ¨åˆ†ï¼Œäº‹ä»¶å¤„ç†ç¨‹åºæœ‰æœºä¼šæ›´å¿«åœ°è¿è¡Œã€‚å› ä¸ºäº‹ä»¶å¤„ç†ç¨‹åºæœ‰æœºä¼šåœ¨è¾ƒå°çš„ä»»åŠ¡ä¹‹é—´è¿è¡Œã€‚å®ƒè¿è¡Œå¾—æ¯”å®ƒå¿…é¡»ç­‰å¾…ä¸€ä¸ªå¾ˆé•¿çš„ä»»åŠ¡å®Œæˆè¦å¿«ã€‚åœ¨ä¸ŠåŠéƒ¨åˆ†ä¸­ï¼Œç”¨æˆ·å¯èƒ½å·²ç»æ„Ÿå—åˆ°äº†å»¶è¿Ÿï¼Œåœ¨ä¸‹åŠéƒ¨åˆ†ï¼Œäº¤äº’å¯èƒ½æ˜¯å³æ—¶çš„ã€‚</p><p>ç„¶è€Œï¼Œé—®é¢˜åœ¨äº â€œåˆ†è§£ä½ çš„é•¿ä»»åŠ¡â€ å’Œ â€œä¸è¦é˜»å¡ä¸»çº¿ç¨‹â€çš„å»ºè®®ä¸å¤Ÿå…·ä½“,é™¤éä½ å·²ç»çŸ¥é“å¦‚ä½•åšè¿™äº›äº‹æƒ…ï¼Œè¿™å°±æ˜¯æœ¬æŒ‡å—å°†è¦è§£é‡Šçš„å†…å®¹ã€‚</p><h2 id="ä»»åŠ¡ç®¡ç†ç­–ç•¥"><a href="#ä»»åŠ¡ç®¡ç†ç­–ç•¥" class="headerlink" title="ä»»åŠ¡ç®¡ç†ç­–ç•¥"></a>ä»»åŠ¡ç®¡ç†ç­–ç•¥</h2><p>åœ¨è½¯ä»¶æ¶æ„ä¸­ï¼Œä¸€ä¸ªå¸¸è§å»ºè®®æ˜¯å°†æ‚¨çš„å·¥ä½œåˆ†è§£æ›´å°çš„åŠŸèƒ½ã€‚è¿™ä¸ºæ‚¨æä¾›äº†æ›´å¥½çš„ä»£ç å¯è¯»æ€§å’Œé¡¹ç›®å¯ç»´æŠ¤æ€§çš„å¥½å¤„ã€‚è¿™ä½¿å¾—æµ‹è¯•æ›´å®¹æ˜“ç¼–å†™ã€‚</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">saveSettings</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  validateForm();</span><br><span class="line">  showSpinner();</span><br><span class="line">  saveToDatabase();</span><br><span class="line">  updateUI();</span><br><span class="line">  sendAnalytics();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œè¿™é‡Œçš„ saveSettings å‡½æ•°ï¼Œåœ¨å®ƒè°ƒç”¨æ—¶ï¼Œå®ƒè°ƒç”¨äº†å…¶ä»–äº”ä¸ªå‡½æ•°ã€‚ä»æ¦‚å¿µä¸Šè®²ï¼Œè¿™æ˜¯å¾ˆå¥½çš„æ¶æ„ï¼Œå¦‚æœä½ éœ€è¦è°ƒè¯•è¿™äº›å‡½æ•°ä¸­çš„ä¸€ä¸ªï¼Œä½ å¯ä»¥ä¾¿åˆ©é¡¹ç›®æ ‘ä»¥å¼„æ¸…æ¯ä¸ªå‡½æ•°çš„ä½œç”¨ã€‚</p><p>ç„¶è€Œï¼Œé—®é¢˜åœ¨äº JavaScript ä¸ä¼šå°†è¿™äº›å‡½æ•°ä¸­çš„æ¯ä¸€ä¸ªä½œä¸ºå•ç‹¬çš„ä»»åŠ¡è¿è¡Œï¼Œå› ä¸ºå®ƒä»¬æ˜¯åœ¨ savaSettings å‡½æ•°ä¸­æ‰§è¡Œçš„ã€‚<strong>è¿™æ„å‘³ç€æ‰€æœ‰äº”ä¸ªåŠŸèƒ½éƒ½ä½œä¸ºå•ç‹¬ä»»åŠ¡è¿è¡Œã€‚</strong></p><blockquote><p>JavaScript ä»¥è¿™ç§æ–¹å¼å·¥ä½œæ˜¯å› ä¸ºå®ƒä½¿ç”¨ä»»åŠ¡æ‰§è¡Œçš„è¿è¡Œåˆ°å®Œæˆæ¨¡å‹ã€‚è¿™æ„å‘³ç€æ¯ä¸ªä»»åŠ¡å°†ä¸€ç›´è¿è¡Œåˆ°å®Œæˆï¼Œæ— è®ºå®ƒé˜»å¡ä¸»çº¿ç¨‹å¤šé•¿æ—¶é—´ã€‚</p></blockquote><p><img src="https://web-dev.imgix.net/image/jL3OLOhcWUQDnR4XjewLBx4e3PC3/0c61l5DCix9y0GBa3pFj.png?auto=format&w=1600" alt="img_4"></p><p><em style="font-size:12px">è°ƒç”¨äº”ä¸ªå‡½æ•°çš„å•ä¸ªå‡½æ•° saveSettings()ã€‚è¿™é¡¹å·¥ä½œæ˜¯ä½œä¸ºä¸€é¡¹é•¿æœŸçš„æ•´ä½“ä»»åŠ¡çš„ä¸€éƒ¨åˆ†è¿è¡Œçš„</em></p><p>åœ¨æœ€å¥½çš„æƒ…å†µä¸‹ï¼Œå³ä½¿åªæ˜¯è¿™äº›åŠŸèƒ½ä¸­çš„ä¸€ä¸ªï¼Œä¹Ÿå¯ä»¥ä¸ºä»»åŠ¡çš„æ€»é•¿åº¦è´¡çŒ® 50 æ¯«ç§’æˆ–æ›´å¤šã€‚åœ¨æœ€åçš„æƒ…å†µä¸‹ï¼Œæ›´å¤šçš„è¿™äº›ä»»åŠ¡å¯ä»¥è¿è¡Œç›¸å½“é•¿çš„æ—¶é—´â€“ç‰¹åˆ«æ˜¯åœ¨èµ„æºæœ‰é™çš„è®¾å¤‡ä¸Šã€‚ä¸‹é¢æ˜¯ä¸€å¥—ç­–ç•¥ï¼Œä½ å¯ä»¥ç”¨æ¥åˆ†è§£å’Œä¼˜å…ˆå¤„ç†ä»»åŠ¡ã€‚</p><h2 id="æ‰‹åŠ¨å»¶è¿Ÿä»£ç æ‰§è¡Œ"><a href="#æ‰‹åŠ¨å»¶è¿Ÿä»£ç æ‰§è¡Œ" class="headerlink" title="æ‰‹åŠ¨å»¶è¿Ÿä»£ç æ‰§è¡Œ"></a>æ‰‹åŠ¨å»¶è¿Ÿä»£ç æ‰§è¡Œ</h2><p>å¼€å‘äººå‘˜ä½¿ç”¨çš„ä¸€ç§å°†ä»»åŠ¡åˆ†è§£æˆå°ä»»åŠ¡çš„æ–¹æ³•æ¶‰åŠåˆ° setTimeout(). ä½¿ç”¨è¿™ç§æŠ€æœ¯ï¼Œä½ æŠŠå‡½æ•°ä¼ ç»™ setTimeout è¿™å°†å›è°ƒçš„æ‰§è¡Œæ¨è¿Ÿåˆ°ä¸€ä¸ªå•ç‹¬çš„ä»»åŠ¡ä¸­ï¼Œå³æ—¶ä½ æŒ‡å®šçš„æ—¶é—´ä¸º 0ã€‚</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">saveSettings</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// å®Œæˆç”¨æˆ·å¯è§çš„å…³é”®å·¥ä½œ:</span></span><br><span class="line">  validateForm();</span><br><span class="line">  showSpinner();</span><br><span class="line">  updateUI();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å°†ç”¨æˆ·ä¸å¯è§çš„å·¥ä½œæ¨è¿Ÿåˆ°å•ç‹¬çš„ä»»åŠ¡:</span></span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    saveToDatabase();</span><br><span class="line">    sendAnalytics();</span><br><span class="line">  &#125;, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœæ‚¨æœ‰ä¸€ç³»åˆ—éœ€è¦æŒ‰é¡ºåºè¿è¡Œçš„å‡½æ•°ï¼Œè¿™å¾ˆæœ‰æ•ˆï¼Œä½†æ‚¨çš„ä»£ç å¯èƒ½å¹¶ä¸æ€»æ˜¯ä»¥è¿™ç§æ–¹å¼ç»„ç»‡ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯èƒ½æœ‰å¤§é‡æ•°æ®éœ€è¦å¾ªç¯å¤„ç†ï¼Œå¦‚æœæ‚¨æœ‰æ•°ç™¾ä¸‡ä¸ªé¡¹ç›®ï¼Œè¯¥ä»»åŠ¡å¯èƒ½éœ€è¦å¾ˆé•¿æ—¶é—´ã€‚</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">processData</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> item <span class="keyword">of</span> largeDataArray) &#123;</span><br><span class="line">    <span class="comment">// Process the individual item here.</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ setTimeout æ˜¯å­˜åœ¨é—®é¢˜çš„, å› ä¸ºå®ƒçš„äººæœºå·¥ç¨‹å­¦ï¼ˆè¿™æ˜¯ä»€ä¹ˆæ„æ€ ğŸ¤”ï¼ŒåŸæ–‡ï¼šergonomicsï¼‰ä½¿å…¶éš¾ä»¥å®ç°ï¼Œå¹¶ä¸”æ•´ä¸ªæ•°æ®æ•°ç»„å¯èƒ½éœ€è¦å¾ˆé•¿æ—¶é—´å¤„ç†ï¼Œå³ä½¿æ¯ä¸ªé¡¹ç›®éƒ½å¯ä»¥éå¸¸å¿«é€Ÿåœ°å¤„ç†ã€‚è¿™ä¸€åˆ‡åŠ èµ·æ¥ï¼ŒsetTimeout ä¸æ˜¯åˆé€‚çš„å·¥å…·ï¼Œè‡³å°‘åœ¨è¿™æ ·ä½¿ç”¨æ—¶ä¸æ˜¯ã€‚</p><p>é™¤äº† setTimeout ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€äº›å…¶ä»– API å…è®¸æ‚¨å°†ä»£ç æ‰§è¡Œæ¨è¿Ÿåˆ°åç»­ä»»åŠ¡ã€‚ ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨ postMessage æ¥åŠ å¿«è¶…æ—¶ã€‚æ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨ requestIdleCallback() æ¥åˆ†è§£å·¥ä½œã€‚ ä½†æ˜¯è¦æ³¨æ„ â€“ requestIdleCallback() ä»¥å°½å¯èƒ½ä½çš„ä¼˜å…ˆçº§å®‰æ’ä»»åŠ¡ï¼Œè€Œä¸”åªåœ¨æµè§ˆå™¨ç©ºé—²æ—¶é—´å†…è¿›è¡Œã€‚å½“ä¸»çº¿ç¨‹æ‹¥æŒ¤æ—¶,ç”¨ requestIdleCallback() å®‰æ’çš„ä»»åŠ¡å¯èƒ½æ°¸è¿œæ— æ³•è¿è¡Œã€‚</p><h2 id="ä½¿ç”¨-async-await-yield-points"><a href="#ä½¿ç”¨-async-await-yield-points" class="headerlink" title="ä½¿ç”¨ async/await yield points"></a>ä½¿ç”¨ async/await yield points</h2><p>åœ¨æœ¬æŒ‡å—çš„å…¶ä½™éƒ¨åˆ†ï¼Œä½ ä¼šçœ‹åˆ°ä¸€ä¸ªçŸ­è¯­æ˜¯ â€œyield to the main threadâ€ï¼Œä½†æ˜¯ï¼Œè¿™æ„å‘³ç€ä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆä½ è¦è¿™ä¹ˆåšï¼Ÿä½ ä»€ä¹ˆæ—¶å€™è¯¥è¿™æ ·åšï¼Ÿ</p><blockquote><p>å½“ä½  yield to the main threadï¼Œä½ ä¼šç»™å®ƒä¸€ä¸ªæœºä¼šæ¥å¤„ç†æ¯”å½“å‰æ’é˜Ÿçš„ä»»åŠ¡æ›´é‡è¦çš„ä»»åŠ¡ã€‚ç†æƒ³æƒ…å†µä¸‹ï¼ˆideallyï¼‰ï¼Œå½“ä½ æœ‰ä¸€äº›å…³é”®çš„é¢å‘ç”¨æˆ·çš„å·¥ä½œï¼Œéœ€è¦æ¯” yield æ›´æ—©åœ°æ‰§è¡Œæ—¶ï¼Œä½ åº”è¯¥ yield main threadï¼Œyield main thread å¯ä»¥ä¸ºå…³é”®å·¥ä½œåˆ›é€ æœºä¼šï¼Œä½¿å…¶æ›´å¿«åœ°è¿è¡Œã€‚</p></blockquote><p>å½“ä»»åŠ¡è¢«åˆ†è§£æ—¶ï¼Œå…¶ä»–ä»»åŠ¡å¯ä»¥é€šè¿‡æµè§ˆå™¨å†…éƒ¨ä¼˜å…ˆçº§æ–¹æ¡ˆæ›´å¥½åœ°è¿›è¡Œä¼˜å…ˆçº§æ’åºã€‚yield main thread çš„æ–¹æ³•æ¶‰åŠåˆ°ä½¿ç”¨ä¸€ä¸ª Promise çš„ç»„åˆï¼Œè¯¥ç»„åˆä¸å¯¹ setTimeout() è¿›è¡Œçš„è°ƒç”¨è¿›è¡Œè§£æã€‚</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">yieldToMain</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(resolve, <span class="number">0</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>è™½ç„¶è¿™ä¸ªä»£ç å®ä¾‹è¿”å›äº†ä¸€ä¸ªåœ¨è°ƒç”¨ setTimeout åè§£æçš„ Promise, ä½†è´Ÿè´£åœ¨æ–°ä»»åŠ¡ä¸­è¿è¡Œå¥‡é‡ä»£ç çš„å¹¶ä¸æ˜¯è¿™ä¸ª Promiseï¼Œè€Œæ˜¯ setTimeout è°ƒç”¨ã€‚Promise å›è°ƒä½œä¸ºå¾®ä»»åŠ¡è€Œä¸æ˜¯ä»»åŠ¡è¿è¡Œï¼Œå› æ­¤ä¸ä¼š yield main thread</p></blockquote><p>åœ¨ saveSettings() å‡½æ•°ä¸­ï¼Œå¦‚æœåœ¨æ¯æ¬¡å‡½æ•°è°ƒç”¨å await yieldToMain() å‡½æ•°ï¼Œåˆ™å¯ä»¥åœ¨æ¯æ¬¡å·¥ä½œå yield to the main</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">saveSettings</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// Create an array of functions to run:</span></span><br><span class="line">  <span class="keyword">const</span> tasks = [</span><br><span class="line">    validateForm,</span><br><span class="line">    showSpinner,</span><br><span class="line">    saveToDatabase,</span><br><span class="line">    updateUI,</span><br><span class="line">    sendAnalytics,</span><br><span class="line">  ];</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Loop over the tasks:</span></span><br><span class="line">  <span class="keyword">while</span> (tasks.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="comment">// Shift the first task off the tasks array:</span></span><br><span class="line">    <span class="keyword">const</span> task = tasks.shift();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Run the task:</span></span><br><span class="line">    task();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Yield to the main thread:</span></span><br><span class="line">    <span class="keyword">await</span> yieldToMain();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ä½ ä¸å¿…åœ¨æ¯æ¬¡å‡½æ•°è°ƒç”¨åéƒ½ yieldã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ è¿è¡Œçš„ä¸¤ä¸ªå‡½æ•°ä¼šå¯¼è‡´ç”¨æˆ·ç•Œé¢çš„å…³é”®æ€§æ›´æ–°ï¼Œä½ å¯èƒ½ä¸æƒ³åœ¨å®ƒä»¬ä¹‹é—´ yieldã€‚å¦‚æœå¯ä»¥çš„è¯ï¼Œè®©è¿™äº› tast å…ˆè¿è¡Œï¼Œç„¶åè€ƒè™‘åœ¨é‚£äº›ä¸é‚£ä¹ˆå…³é”®çš„æˆ–ç”¨æˆ·çœ‹ä¸åˆ°çš„åå°å·¥ä½œçš„å‡½æ•°ä¹‹é—´è¿›è¡Œ yieldã€‚</p></blockquote><p>ç»“æœæ˜¯æ›¾ç»å•ä¸€çš„ä»»åŠ¡ç°åœ¨è¢«åˆ†è§£ä¸ºå•ç‹¬çš„ä»»åŠ¡</p><p><img src="https://web-dev.imgix.net/image/jL3OLOhcWUQDnR4XjewLBx4e3PC3/wg0FW6S29CzOCbbwk9kK.png?auto=format&w=1600" alt="img_5"></p><p><em style="font-size:12px">saveSettings() å‡½æ•°ç°åœ¨å°†å…¶å­å‡½æ•°ä½œä¸ºå•ç‹¬çš„ä»»åŠ¡æ‰§è¡Œã€‚</em></p><p>ä½¿ç”¨åŸºäº Promise çš„æ–¹æ³•æ¥äº§ç”Ÿè€Œä¸æ˜¯æ‰‹åŠ¨ä½¿ç”¨ setTimeout() çš„å¥½å¤„æ˜¯æ›´å¥½çš„äººä½“å·¥ç¨‹å­¦ã€‚å±ˆæœç‚¹æˆä¸ºå£°æ˜æ€§çš„ï¼Œå› æ­¤æ›´å®¹æ˜“ç¼–å†™ã€é˜…è¯»å’Œç†è§£ã€‚</p><h2 id="ä»…åœ¨å¿…è¦æ—¶-yield"><a href="#ä»…åœ¨å¿…è¦æ—¶-yield" class="headerlink" title="ä»…åœ¨å¿…è¦æ—¶ yield"></a>ä»…åœ¨å¿…è¦æ—¶ yield</h2><p>å¦‚æœæ‚¨æœ‰ä¸€å †ä»»åŠ¡ï¼Œä½†æ‚¨åªæƒ³åœ¨ç”¨æˆ·å°è¯•ä¸é¡µé¢äº¤äº’æ—¶è®©æ­¥æ€ä¹ˆåŠï¼Ÿè¿™å°±æ˜¯ isInputPending() çš„ç”¨é€”ã€‚</p><p>isInputPending() æ˜¯ä¸€ä¸ªæ‚¨å¯ä»¥éšæ—¶è¿è¡Œä»¥ç¡®å®šç”¨æˆ·æ˜¯å¦æ­£åœ¨å°è¯•ä¸é¡µé¢å…ƒç´ äº¤äº’çš„å‡½æ•°ï¼šå¯¹ isInputPending() çš„è°ƒç”¨å°†è¿”å› trueã€‚å¦åˆ™è¿”å› falseã€‚</p><p>å‡è®¾æ‚¨å¯æœ‰ä¸€ä¸ªéœ€è¦è¿è¡Œçš„ä»»åŠ¡é˜Ÿåˆ—ï¼Œä½†æ‚¨ä¸æƒ³å¦¨ç¢ä»»ä½•è¾“å…¥ã€‚è¿™æ®µä»£ç  â€” å®ƒåŒæ—¶ä½¿ç”¨äº† isInputPending() å‡½æ•° â€” ç¡®ä¿åœ¨ç”¨æˆ·å°è¯•ä¸é¡µé¢äº¤äº’æ—¶è¾“å…¥ä¸ä¼šè¢«å»¶è¿Ÿã€‚</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">saveSettings</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// A task queue of functions</span></span><br><span class="line">  <span class="keyword">const</span> tasks = [</span><br><span class="line">    validateForm,</span><br><span class="line">    showSpinner,</span><br><span class="line">    saveToDatabase,</span><br><span class="line">    updateUI,</span><br><span class="line">    sendAnalytics,</span><br><span class="line">  ];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span> (tasks.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="comment">// Yield to a pending user input:</span></span><br><span class="line">    <span class="keyword">if</span> (navigator.scheduling.isInputPending()) &#123;</span><br><span class="line">      <span class="comment">// There&#x27;s a pending user input. Yield here:</span></span><br><span class="line">      <span class="keyword">await</span> yieldToMain();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// Shift the the task out of the queue:</span></span><br><span class="line">      <span class="keyword">const</span> task = tasks.shift();</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Run the task:</span></span><br><span class="line">      task();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“ saveSettings() è¿è¡Œæ—¶ï¼Œå®ƒå°†éå†é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ã€‚å¦‚æœ isInputPending() åœ¨å¾ªç¯æœŸé—´è¿”å› trueï¼Œåˆ™ saveSettings() å°†è°ƒç”¨ yieldToMain() ä»¥ä¾¿å¤„ç†ç”¨æˆ·è¾“å…¥ã€‚å¦åˆ™ï¼Œå®ƒå°†æŠŠä¸‹ä¸€ä¸ªä»»åŠ¡ç§»å‡ºé˜Ÿåˆ—çš„å‰é¢å¹¶ç»§ç»­è¿è¡Œå®ƒã€‚å®ƒå°†æ‰§è¡Œæ­¤æ“ä½œï¼Œç›´åˆ°æ²¡æœ‰å…¶ä»–ä»»åŠ¡ä¸ºæ­¢ã€‚</p><p><img src="https://web-dev.imgix.net/image/jL3OLOhcWUQDnR4XjewLBx4e3PC3/snMl3kRlWyJjdbL0qsqM.png?auto=format&w=1600" alt="img_5"></p><p><em style="font-size:12px">saveSettings()è¿è¡Œä¸€ä¸ªæœ‰äº”ä¸ªä»»åŠ¡çš„ä»»åŠ¡é˜Ÿåˆ—ï¼Œä½†åœ¨ç¬¬äºŒä¸ªå·¥ä½œé¡¹è¿è¡Œæ—¶ï¼Œç”¨æˆ·å·²ç»ç‚¹å‡»æ‰“å¼€äº†ä¸€ä¸ªèœå•ã€‚ isInputPending()è®©ä½äºä¸»çº¿ç¨‹æ¥å¤„ç†è¿™ä¸ªäº¤äº’ï¼Œå¹¶æ¢å¤è¿è¡Œå…¶ä½™çš„ä»»åŠ¡ã€‚</em></p><blockquote><p>isInputPending()ä¸ä¸€å®šåœ¨ç”¨æˆ·è¾“å…¥åç«‹å³è¿”å› trueã€‚è¿™æ˜¯å› ä¸ºæ“ä½œç³»ç»Ÿéœ€è¦æ—¶é—´æ¥å‘Šè¯‰æµè§ˆå™¨å‘ç”Ÿäº†äº¤äº’ã€‚è¿™æ„å‘³ç€å…¶ä»–ä»£ç å¯èƒ½å·²ç»å¼€å§‹æ‰§è¡Œäº†ï¼ˆæ­£å¦‚ä½ åœ¨ä¸Šé¢çš„æˆªå›¾ä¸­çœ‹åˆ°çš„ saveToDatabase()å‡½æ•°ï¼‰ã€‚å³ä½¿ä½ ä½¿ç”¨ isInputPending()ï¼Œä½ ä»ç„¶è¦é™åˆ¶æ¯ä¸ªå‡½æ•°çš„å·¥ä½œé‡ï¼Œè¿™æ˜¯è‡³å…³é‡è¦çš„ã€‚</p></blockquote><p>å°† isInputPending() ä¸è®©æ­¥æœºåˆ¶ç»“åˆä½¿ç”¨æ˜¯è®©æµè§ˆå™¨åœæ­¢å…¶æ­£åœ¨å¤„ç†çš„ä»»ä½•ä»»åŠ¡ä»¥å“åº”å…³é”®çš„é¢å‘ç”¨æˆ·çš„äº¤äº’çš„å¥½æ–¹æ³•ã€‚è¿™å¯ä»¥å¸®åŠ©æé«˜æ‚¨çš„é¡µé¢åœ¨è®¸å¤šä»»åŠ¡æ­£åœ¨è¿›è¡Œæ—¶åœ¨è®¸å¤šæƒ…å†µä¸‹å“åº”ç”¨æˆ·çš„èƒ½åŠ›ã€‚</p><p>å¦ä¸€ç§ä½¿ç”¨ isInputPending()çš„æ–¹æ³•â€“ç‰¹åˆ«æ˜¯å¦‚æœä½ æ‹…å¿ƒä¸ºä¸æ”¯æŒå®ƒçš„æµè§ˆå™¨æä¾›é€€è·¯â€“æ˜¯ä½¿ç”¨åŸºäºæ—¶é—´çš„æ–¹æ³•ä¸ å¯é€‰é“¾æ“ä½œç¬¦ ï¼ˆ?.ï¼‰</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">saveSettings</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// A task queue of functions</span></span><br><span class="line">  <span class="keyword">const</span> tasks = [</span><br><span class="line">    validateForm,</span><br><span class="line">    showSpinner,</span><br><span class="line">    saveToDatabase,</span><br><span class="line">    updateUI,</span><br><span class="line">    sendAnalytics,</span><br><span class="line">  ];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> deadline = performance.now() + <span class="number">50</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span> (tasks.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="comment">// Optional chaining operator used here helps to avoid</span></span><br><span class="line">    <span class="comment">// errors in browsers that don&#x27;t support `isInputPending`:</span></span><br><span class="line">    <span class="keyword">if</span> (</span><br><span class="line">      navigator.scheduling?.isInputPending() ||</span><br><span class="line">      performance.now() &gt;= deadline</span><br><span class="line">    ) &#123;</span><br><span class="line">      <span class="comment">// There&#x27;s a pending user input, or the</span></span><br><span class="line">      <span class="comment">// deadline has been reached. Yield here:</span></span><br><span class="line">      <span class="keyword">await</span> yieldToMain();</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Extend the deadline:</span></span><br><span class="line">      deadline += <span class="number">50</span>;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Stop the execution of the current loop and</span></span><br><span class="line">      <span class="comment">// move onto the next iteration:</span></span><br><span class="line">      <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Shift the the task out of the queue:</span></span><br><span class="line">    <span class="keyword">const</span> task = tasks.shift();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Run the task:</span></span><br><span class="line">    task();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡è¿™ç§æ–¹æ³•ï¼Œä½ å¯ä»¥ä¸ºä¸æ”¯æŒ isInputPending()çš„æµè§ˆå™¨æä¾›ä¸€ä¸ªåå¤‡æ–¹æ¡ˆï¼Œå³ä½¿ç”¨ï¼ˆå¹¶è°ƒæ•´ï¼‰ä¸€ä¸ªæˆªæ­¢æ—¥æœŸï¼Œä»¥ä¾¿åœ¨å¿…è¦æ—¶å°†å·¥ä½œåˆ†å¼€ï¼Œæ— è®ºæ˜¯é€šè¿‡å±ˆæœäºç”¨æˆ·è¾“å…¥ï¼Œè¿˜æ˜¯åœ¨æŸä¸ªæ—¶é—´ç‚¹ä¹‹å‰ã€‚</p><h2 id="å½“å‰-api-çš„å·®å¼‚"><a href="#å½“å‰-api-çš„å·®å¼‚" class="headerlink" title="å½“å‰ api çš„å·®å¼‚"></a>å½“å‰ api çš„å·®å¼‚</h2><p>åˆ°ç›®å‰ä¸ºæ­¢æåˆ°çš„ API å¯ä»¥å¸®åŠ©ä½ åˆ†è§£ä»»åŠ¡ï¼Œä½†å®ƒä»¬æœ‰ä¸€ä¸ªæ˜¾è‘—çš„ç¼ºç‚¹ï¼šå½“ä½ é€šè¿‡æ¨è¿Ÿä»£ç åœ¨åç»­ä»»åŠ¡ä¸­è¿è¡Œè€Œå±ˆæœäºä¸»çº¿ç¨‹æ—¶ï¼Œè¯¥ä»£ç ä¼šè¢«æ·»åŠ åˆ°ä»»åŠ¡é˜Ÿåˆ—çš„æœ€æœ«ç«¯ã€‚</p><p>å¦‚æœä½ æ§åˆ¶äº†ä½ é¡µé¢ä¸Šçš„æ‰€æœ‰ä»£ç ï¼Œå°±æœ‰å¯èƒ½åˆ›å»ºä½ è‡ªå·±çš„ scheduler ï¼ˆå‚è€ƒ react å—ï¼ŒğŸ˜¯ï¼‰ï¼Œå¹¶èƒ½å¯¹ä»»åŠ¡è¿›è¡Œä¼˜å…ˆæ’åºï¼Œä½†ç¬¬ä¸‰æ–¹è„šæœ¬ä¸ä¼šä½¿ç”¨ä½ çš„è°ƒåº¦å™¨ã€‚å®é™…ä¸Šï¼Œåœ¨è¿™æ ·çš„ç¯å¢ƒä¸­ï¼Œä½ å¹¶ä¸èƒ½çœŸæ­£åœ°å¯¹å·¥ä½œè¿›è¡Œä¼˜å…ˆæ’åºã€‚ä½ åªèƒ½æŠŠå®ƒåˆ†æˆå‡ å—ï¼Œæˆ–è€…æ˜ç¡®åœ°å±ˆä»äºç”¨æˆ·çš„äº’åŠ¨ã€‚</p><p>å¹¸è¿çš„æ˜¯ï¼Œç›®å‰æœ‰ä¸€ä¸ªä¸“é—¨çš„è°ƒåº¦å™¨ API æ­£åœ¨å¼€å‘ä¸­ï¼Œå¯ä»¥è§£å†³è¿™äº›é—®é¢˜ã€‚</p><h2 id="ä¸€ä¸ªä¸“é—¨çš„è°ƒåº¦ç¨‹åº-API"><a href="#ä¸€ä¸ªä¸“é—¨çš„è°ƒåº¦ç¨‹åº-API" class="headerlink" title="ä¸€ä¸ªä¸“é—¨çš„è°ƒåº¦ç¨‹åº API"></a>ä¸€ä¸ªä¸“é—¨çš„è°ƒåº¦ç¨‹åº API</h2><p>è°ƒåº¦å™¨ API ç›®å‰æä¾›äº† postTask()å‡½æ•°ï¼Œåœ¨æ’°å†™æœ¬æ–‡æ—¶ï¼Œè¯¥å‡½æ•°åœ¨ Chromium æµè§ˆå™¨å’Œ Firefox çš„ä¸€ä¸ªæ ‡å¿—åé¢å¯ç”¨ã€‚ postTask()å…è®¸å¯¹ä»»åŠ¡è¿›è¡Œæ›´ç²¾ç»†çš„è°ƒåº¦ï¼Œæ˜¯å¸®åŠ©æµè§ˆå™¨ç¡®å®šå·¥ä½œä¼˜å…ˆçº§çš„ä¸€ç§æ–¹æ³•ï¼Œè¿™æ ·ä½ä¼˜å…ˆçº§çš„ä»»åŠ¡å°±ä¼šè®©ä½äºä¸»çº¿ç¨‹ã€‚ postTask()ä½¿ç”¨ Promiseï¼Œå¹¶æ¥å—ä¸€ä¸ªä¼˜å…ˆçº§è®¾ç½®ã€‚</p><p>postTask() API å…·æœ‰ä¸‰ä¸ªå¯ä»¥ä½¿ç”¨çš„ priorities</p><ul><li>â€˜backgroundâ€™ : æœ€ä½ä¼˜å…ˆçº§ä»»åŠ¡ã€‚</li><li>â€˜user-visibleâ€™ : ä¸­ç­‰ä¼˜å…ˆçº§ä»»åŠ¡ï¼Œâ€œç”¨æˆ·å¯è§â€ï¼Œå¦‚æœæ²¡æœ‰è®¾ç½®ä¼˜å…ˆçº§ï¼Œè¿™æ˜¯é»˜è®¤è®¾ç½®ã€‚</li><li>â€˜user-blockingâ€™: ç”¨äºéœ€è¦é«˜ä¼˜å…ˆçº§è¿è¡Œçš„å…³é”®ä»»åŠ¡ã€‚</li></ul><p>ä»¥ä¸‹é¢çš„ä»£ç ä¸ºä¾‹ï¼ŒpostTask()API è¢«ç”¨æ¥ä»¥å°½å¯èƒ½é«˜çš„ä¼˜å…ˆçº§è¿è¡Œä¸‰ä¸ªä»»åŠ¡ï¼Œå¹¶ä»¥å°½å¯èƒ½ä½çš„ä¼˜å…ˆçº§è¿è¡Œå…¶ä½™ä¸¤ä¸ªä»»åŠ¡ã€‚</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">saveSettings</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// Validate the form at high priority</span></span><br><span class="line">  scheduler.postTask(validateForm, &#123; <span class="attr">priority</span>: <span class="string">&quot;user-blocking&quot;</span> &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Show the spinner at high priority:</span></span><br><span class="line">  scheduler.postTask(showSpinner, &#123; <span class="attr">priority</span>: <span class="string">&quot;user-blocking&quot;</span> &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Update the database in the background:</span></span><br><span class="line">  scheduler.postTask(saveToDatabase, &#123; <span class="attr">priority</span>: <span class="string">&quot;background&quot;</span> &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Update the user interface at high priority:</span></span><br><span class="line">  scheduler.postTask(updateUI, &#123; <span class="attr">priority</span>: <span class="string">&quot;user-blocking&quot;</span> &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Send analytics data in the background:</span></span><br><span class="line">  scheduler.postTask(sendAnalytics, &#123; <span class="attr">priority</span>: <span class="string">&quot;background&quot;</span> &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨è¿™é‡Œï¼Œä»»åŠ¡çš„ä¼˜å…ˆçº§ä»¥æµè§ˆå™¨ä¼˜å…ˆçº§ä»»åŠ¡ï¼ˆä¾‹å¦‚ç”¨æˆ·äº¤äº’ï¼‰å¯ä»¥æ­£å¸¸å·¥ä½œçš„æ–¹å¼å®‰æ’ã€‚</p><div style="color:red">å­ä»»åŠ¡æ‰§è¡Œé¡ºåºå·®å¼‚</div><p><img src="https://web-dev.imgix.net/image/jL3OLOhcWUQDnR4XjewLBx4e3PC3/ttvI1HqusI02CAdqhjWP.png?auto=format&w=1600" alt="img_6"></p><p><em style="font-size:12px">å½“ saveSettings()è¿è¡Œæ—¶ï¼Œè¯¥å‡½æ•°ä½¿ç”¨ postTask()å¯¹å„ä¸ªå‡½æ•°è¿›è¡Œè°ƒåº¦ã€‚é¢å‘ç”¨æˆ·çš„å…³é”®å·¥ä½œè¢«å®‰æ’åœ¨é«˜ä¼˜å…ˆçº§ï¼Œè€Œç”¨æˆ·ä¸çŸ¥é“çš„å·¥ä½œè¢«å®‰æ’åœ¨åå°è¿è¡Œã€‚è¿™ä½¿å¾—ç”¨æˆ·äº¤äº’çš„æ‰§è¡Œé€Ÿåº¦æ›´å¿«ï¼Œå› ä¸ºå·¥ä½œè¢«åˆ†å‰²å¼€æ¥å¹¶è¢«é€‚å½“åœ°å®‰æ’äº†ä¼˜å…ˆæ¬¡åºã€‚</em></p><p>è¿™æ˜¯ä¸€ä¸ªå¦‚ä½•ä½¿ç”¨ postTask() çš„ç®€å•ç¤ºä¾‹ã€‚å¯ä»¥å®ä¾‹åŒ–ä¸åŒçš„ TaskController å¯¹è±¡ï¼Œè¿™äº›å¯¹è±¡å¯ä»¥åœ¨ä»»åŠ¡ä¹‹é—´å…±äº«ä¼˜å…ˆçº§ï¼ŒåŒ…æ‹¬æ ¹æ®éœ€è¦æ›´æ”¹ä¸åŒ TaskController å®ä¾‹çš„ä¼˜å…ˆçº§çš„èƒ½åŠ›ã€‚</p><blockquote><p>å¹¶éæ‰€æœ‰æµè§ˆå™¨éƒ½æ”¯æŒ postTask()ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ç‰¹å¾æ£€æµ‹æ¥æŸ¥çœ‹å®ƒæ˜¯å¦å¯ç”¨ï¼Œæˆ–è€…è€ƒè™‘ä½¿ç”¨ polyfill</p></blockquote><h2 id="å†…ç½®çš„-yield"><a href="#å†…ç½®çš„-yield" class="headerlink" title="å†…ç½®çš„ yield"></a>å†…ç½®çš„ yield</h2><p>è°ƒåº¦å™¨ API çš„ä¸€ä¸ªæ‹Ÿè®®çš„éƒ¨åˆ†ï¼Œç›®å‰æ²¡æœ‰åœ¨ä»»ä½•æµè§ˆå™¨ä¸­å®ç°ï¼Œå°±æ˜¯ä¸€ä¸ªå†…ç½®çš„ yield æœºåˆ¶ã€‚å®ƒçš„ä½¿ç”¨ç±»ä¼¼äºæœ¬æ–‡å‰é¢æ¼”ç¤ºçš„ yieldToMain() å‡½æ•°ã€‚</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">saveSettings</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// Create an array of functions to run:</span></span><br><span class="line">  <span class="keyword">const</span> tasks = [</span><br><span class="line">    validateForm,</span><br><span class="line">    showSpinner,</span><br><span class="line">    saveToDatabase,</span><br><span class="line">    updateUI,</span><br><span class="line">    sendAnalytics,</span><br><span class="line">  ];</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Loop over the tasks:</span></span><br><span class="line">  <span class="keyword">while</span> (tasks.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="comment">// Shift the first task off the tasks array:</span></span><br><span class="line">    <span class="keyword">const</span> task = tasks.shift();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Run the task:</span></span><br><span class="line">    task();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Yield to the main thread with the scheduler</span></span><br><span class="line">    <span class="comment">// API&#x27;s own yielding mechanism:</span></span><br><span class="line">    <span class="keyword">await</span> scheduler.yield();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‚¨ä¼šæ³¨æ„åˆ°ï¼Œä¸Šé¢çš„ä»£ç éå¸¸ç†Ÿæ‚‰ï¼Œä½†æ˜¯æ‚¨æ²¡æœ‰ä½¿ç”¨ yieldToMain()ï¼Œè€Œæ˜¯è°ƒç”¨å¹¶ç­‰å¾… scheduler.yield()ã€‚</p><p><img src="https://web-dev.imgix.net/image/jL3OLOhcWUQDnR4XjewLBx4e3PC3/fyuvJqAV0mLxfZDM9tAm.png?auto=format&w=1294" alt="img_7"></p><p><em style="font-size:12px">ä¸€ä¸ªæ²¡æœ‰ yieldã€yieldã€yield å’Œ continuation çš„ä»»åŠ¡æ‰§è¡Œçš„å¯è§†åŒ–å›¾ã€‚å½“ä½¿ç”¨ scheduler.yield()æ—¶ï¼Œä»»åŠ¡çš„æ‰§è¡Œç”šè‡³åœ¨å±ˆæœç‚¹ä¹‹åè¿˜èƒ½ç»§ç»­æ‰§è¡Œã€‚</em></p><p>scheduler.yield() çš„å¥½å¤„æ˜¯ continuationï¼Œè¿™æ„å‘³ç€å¦‚æœä½ åœ¨ä¸€ç»„ä»»åŠ¡ä¸­é—´ yieldï¼Œå…¶ä»–çš„è®¡åˆ’ä»»åŠ¡ä¼šåœ¨ yield ç‚¹ä¹‹åä»¥åŒæ ·çš„é¡ºåºç»§ç»­æ‰§è¡Œã€‚è¿™å¯ä»¥é¿å…ç¬¬ä¸‰æ–¹è„šæœ¬ä¸­çš„ä»£ç ç¯¡å¤ºæ‚¨çš„ä»£ç æ‰§è¡Œé¡ºåºã€‚</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>ç®¡ç†ä»»åŠ¡æ˜¯å…·æœ‰æŒ‘æˆ˜æ€§çš„ï¼Œä½†è¿™æ ·åšæœ‰åŠ©äºä½ çš„é¡µé¢å¯¹ç”¨æˆ·çš„äº’åŠ¨ä½œå‡ºæ›´å¿«é€Ÿçš„ååº”ã€‚åœ¨ç®¡ç†å’Œç¡®å®šä»»åŠ¡çš„ä¼˜å…ˆæ¬¡åºæ–¹é¢ï¼Œæ²¡æœ‰å•ä¸€çš„å»ºè®®ã€‚ç›¸åï¼Œå®ƒæ˜¯ä¸€äº›ä¸åŒçš„æŠ€æœ¯ã€‚é‡ç”³ä¸€ä¸‹ï¼Œè¿™äº›æ˜¯ä½ åœ¨ç®¡ç†ä»»åŠ¡æ—¶è¦è€ƒè™‘çš„ä¸»è¦äº‹é¡¹ã€‚</p><ul><li><p>è®©ç»™ä¸»çº¿ç¨‹ä»¥å®Œæˆå…³é”®çš„ã€é¢å‘ç”¨æˆ·çš„ä»»åŠ¡ã€‚</p></li><li><p>å½“ç”¨æˆ·å°è¯•ä¸é¡µé¢äº¤äº’æ—¶ï¼Œä½¿ç”¨ isInputPending() è®©æ­¥ç»™ä¸»çº¿ç¨‹ã€‚</p></li><li><p>ä½¿ç”¨ postTask() å¯¹ä»»åŠ¡è¿›è¡Œä¼˜å…ˆçº§æ’åºã€‚</p></li><li><p>æœ€åï¼Œåœ¨ä½ çš„å‡½æ•°ä¸­åšå°½å¯èƒ½å°‘çš„å·¥ä½œã€‚</p></li></ul><p>æœ‰äº†è¿™äº›å·¥å…·ä¸­çš„ä¸€ä¸ªæˆ–å¤šä¸ªï¼Œä½ åº”è¯¥èƒ½å¤Ÿåœ¨ä½ çš„åº”ç”¨ç¨‹åºä¸­æ„é€ å·¥ä½œï¼Œä½¿å…¶ä¼˜å…ˆè€ƒè™‘ç”¨æˆ·çš„éœ€æ±‚ï¼ŒåŒæ—¶ç¡®ä¿ä¸å¤ªå…³é”®çš„å·¥ä½œä»ç„¶èƒ½å¤Ÿå®Œæˆã€‚è¿™å°†åˆ›é€ ä¸€ä¸ªæ›´å¥½çš„ç”¨æˆ·ä½“éªŒï¼Œå®ƒçš„å“åº”é€Ÿåº¦æ›´å¿«ï¼Œä½¿ç”¨èµ·æ¥æ›´æ„‰å¿«ã€‚</p><p>Special thanks to Philip Walton for his technical vetting of this article.</p><p>Hero image sourced from Unsplash, courtesy of Amirali Mirhashemian.</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;åŸæ–‡ï¼š&lt;a href=&quot;https://web.dev/optimize-long-tasks/&quot;&gt;https://web.dev/optimize-long-tasks/&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ä½ æ›¾è¢«å‘Šè¯‰è¿‡ï¼Œä¸è¦é˜»å¡ä¸»çº¿ç¨‹å¹¶ä¸”åˆ†è§£ä½ çš„é•¿ä»»åŠ¡ï¼Œä½†æ˜¯æœ‰æƒ³è¿‡è¿™æ ·åšçš„æ„ä¹‰å—ï¼Ÿ&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å¦‚æœä½ è¯»äº†å¾ˆå¤šå…³äºç½‘ç«™æ€§èƒ½çš„èµ„æ–™, ä¿æŒ JavasScript åº”ç”¨ç¨‹åºå¿«é€Ÿè¿è¡Œçš„å»ºè®®å¾€å¾€æ¶‰åŠä»¥ä¸‹çš„å»ºè®®ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸è¦é˜»å¡ä¸»çº¿ç¨‹&lt;/li&gt;
&lt;li&gt;åˆ†è§£ä½ çš„é•¿ä»»åŠ¡&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é‚£è¿™äº›æ„å‘³ç€ä»€ä¹ˆï¼Ÿå‡å°‘ JavaScript æ˜¯å¥½çš„ï¼Œä½†è¿™æ˜¯å¦è‡ªåŠ¨ç­‰åŒåœ¨æ•´ä¸ªé¡µé¢ç”Ÿå‘½å‘¨æœŸä¸­æ›´å¿«é€Ÿçš„ç”¨æˆ·ç•Œé¢ï¼Ÿä¹Ÿè®¸æ˜¯ï¼Œä¹Ÿè®¸ä¸æ˜¯.&lt;/p&gt;</summary>
    
    
    
    <category term="è¯‘æ–‡" scheme="https://jealh.xyz/categories/%E8%AF%91%E6%96%87/"/>
    
    
  </entry>
  
  <entry>
    <title>Scroll å¼€å‘å°è®°</title>
    <link href="https://jealh.xyz/2022/09/11/Scroll-%E5%BC%80%E5%8F%91%E5%B0%8F%E8%AE%B0/"/>
    <id>https://jealh.xyz/2022/09/11/Scroll-%E5%BC%80%E5%8F%91%E5%B0%8F%E8%AE%B0/</id>
    <published>2022-09-11T14:32:31.000Z</published>
    <updated>2022-12-31T10:26:33.580Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>èƒŒæ™¯ï¼šä¸€æ¬¡å·¦æ»‘åŠ è½½æ›´å¤šçš„çš„äº¤äº’å¼€å‘</p></blockquote><h2 id="å¡«å‘å¼€å§‹"><a href="#å¡«å‘å¼€å§‹" class="headerlink" title="å¡«å‘å¼€å§‹"></a>å¡«å‘å¼€å§‹</h2><p>åœ¨æœ€å¼€å§‹æ—¶ï¼Œæˆ‘å¾—åˆ°äº†ä¸€ä¸ªæç¤ºï¼Œå·¦æ»‘åŠ è½½æ›´å¤šç±»ä¼¼ä¸‹æ‹‰åˆ·æ–°ã€‚æƒ³äº†æƒ³ï¼Œå¥½å®¶ä¼™ï¼Œä¸å°±æ˜¯æŠŠä¸‹æ‹‰åˆ·æ–°æ¨ªè¿‡æ¥å˜›ï¼Œç¢°å·§ä¸‹æ‹‰åˆ·æ–°è¿˜æ˜¯å‰å‡ å¤©æ–°å¢çš„ä¸€ä¸ªç»„ä»¶ï¼Œè¿™å›å¯ä»¥å€Ÿé‰´å€Ÿé‰´äº† ğŸ˜ã€‚OK å¼€å¹²ï¼</p><span id="more"></span><h2 id="ä¸‹æ‹‰åˆ·æ–°ç»„ä»¶çš„è®¾è®¡"><a href="#ä¸‹æ‹‰åˆ·æ–°ç»„ä»¶çš„è®¾è®¡" class="headerlink" title="ä¸‹æ‹‰åˆ·æ–°ç»„ä»¶çš„è®¾è®¡"></a>ä¸‹æ‹‰åˆ·æ–°ç»„ä»¶çš„è®¾è®¡</h2><p>åœ¨æŸ¥çœ‹ç»„ä»¶çš„æºç åï¼Œå‘ç°ä¸‹æ‹‰åˆ·æ–°ç»„ä»¶çš„è®¾è®¡å…¶å®æ¯”è¾ƒç®€å•ã€‚è¿™é‡Œä½¿ç”¨äº† @use-gesture/react ç”¨åœ¨æ‰‹åŠ¿ä¸Šçš„ç»‘å®šï¼Œreact-spring ç”¨ä½œåŠ¨ç”»çš„å®ç°ã€‚ä¸‹é¢å°±ç®€å•ä»‹ç»ä¸‹å…¶è®¾è®¡æ€è·¯ã€‚</p><p>é¦–å…ˆæŠ›å‡ºå‡ ä¸ªé—®é¢˜</p><ul><li>ä»€ä¹ˆæ—¶å€™è§¦å‘åˆ·æ–° æˆ–è€…ä»€ä¹ˆæ—¶å€™è°ƒç”¨æ‰‹åŠ¿ï¼Ÿ</li><li>scroll å®¹å™¨æ»šåŠ¨æ—¶ä¸æ‰‹åŠ¿å†²çªã€‚</li><li>ä¸‹æ‹‰çš„é˜ˆå€¼ã€å›å¼¹åŠ¨ç”»</li></ul><ol><li><p>ä¸‹æ‹‰åˆ·æ–°ç»„ä»¶åœ¨è®¾è®¡æ—¶ï¼Œé‡‡ç”¨çš„æ˜¯æµè§ˆå™¨åŸç”Ÿæ»šåŠ¨åŠ ä¸Šè‡ªå®šä¹‰ç”¨æˆ·æ‰‹åŠ¿äº‹ä»¶ã€‚è¿™æ ·æˆ‘ä»¬å¾ˆå®¹æ˜“åˆ¤æ–­ä»€ä¹ˆæ—¶å€™è§¦å‘æ‰‹åŠ¿äº‹ä»¶äº†ã€‚å…¶ç­”æ¡ˆæ˜¯ï¼šåˆ¤æ–­ dom èŠ‚ç‚¹çš„ scrollTopï¼Œå½“ scrollTop ä¸º 0 æ—¶ï¼Œè¯´æ˜å·²ç»åˆ°é¡¶äº†ï¼Œç„¶ååœ¨å¾€ä¸‹æ‹‰æ—¶ï¼Œå°±å¼€å§‹è§¦å‘æ‰‹åŠ¿ï¼Œå½“æ‰‹åŠ¿ä¸‹æ‹‰çš„è·ç¦»è¶…è¿‡æŸä¸ªé˜ˆå€¼æ—¶ï¼Œå³å˜ä¸ºäº†å¯åˆ·æ–°çš„çŠ¶æ€ï¼Œæ¾æ‰‹åï¼Œç›´æ¥è§¦å‘ä¸‹æ‹‰å›è°ƒã€‚</p></li><li><p>ä»é—®é¢˜ 1 çš„ç­”æ¡ˆæˆ‘ä»¬å°±å¯ä»¥å¾ˆåˆç†åœ°è§„é¿åŸç”Ÿæ»šåŠ¨ä¸æ‰‹åŠ¿ä¸‹æ‹‰çš„å†²çªï¼ŒåŠ scrollTop ä¸ä¸º 0 æ—¶ï¼Œä¸ä¼šè§¦å‘æ‰‹åŠ¿äº‹ä»¶ã€‚</p></li><li><p>é€šè¿‡ use-gesture/react ä¸­çš„ rubberbandIfOutOfBounds å‡½æ•°åˆ›å»ºä¸€ä¸ªå¼¹ç°§æ•ˆæœï¼Œå›å¼¹åŠ¨ç”»å‘¢ï¼Œè¿™ä¸ªç»„ä»¶é‡‡ç”¨çš„æ˜¯è®¾ç½® loading çš„ height æ¥å®ç°ï¼Œè™½ç„¶å¯ä»¥ï¼Œä½†æˆ‘ç†è§£è¿™ç§åŠ¨æ€é«˜åº¦ä¸æ˜¯å¤ªé€‚åˆè¿™ç§æ»šåŠ¨åœºæ™¯ã€‚å› æ­¤åé¢ç»è¿‡å„ç§å®éªŒï¼ˆè¸©å‘ï¼‰åï¼Œä¸¢å¼ƒäº†è¿™ç§æ”¹å˜é«˜åº¦ï¼ˆå®½åº¦ï¼‰çš„æ–¹å¼å±•ç¤º loadingã€‚</p></li></ol><blockquote><p>å¤§æ¦‚çš„ä¸€ä¸ªæ¡†æ¶å›¾</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/PancakeDogLLL/imageBed/img/2022-09-01%2018.42.03.png" alt="img_1"></p><h2 id="æ¨ªæ»‘å®è·µ"><a href="#æ¨ªæ»‘å®è·µ" class="headerlink" title="æ¨ªæ»‘å®è·µ"></a>æ¨ªæ»‘å®è·µ</h2><p>æ¨ªæ»‘å¤šç®€å•å‘¢ï¼ŒæŠŠç«–ç€çš„æ¨ªè¿‡æ¥å°±æ˜¯äº† ğŸ˜Šã€‚å“ˆå“ˆï¼Œç¡®å®æ˜¯è¿™æ ·çš„ã€‚</p><h3 id="Version-1"><a href="#Version-1" class="headerlink" title="Version 1"></a>Version 1</h3><p>åŸºæœ¬å¥—è·¯ï¼š</p><ul><li>overflowï¼šhidden</li><li>transformï¼štranslate3d<br>åŸºäºä»¥ä¸Šå¥—è·¯ï¼Œç¬¬ä¸€ç‰ˆæ²¡æœ‰é‡‡ç”¨æµè§ˆå™¨çš„åŸç”Ÿæ»šåŠ¨ï¼Œç„¶åå…¨ç¨‹è§¦å‘æ‰‹åŠ¿äº‹ä»¶ï¼Œé€šè¿‡æ‰‹åŠ¿äº‹ä»¶æ§åˆ¶ react-spring çš„åŠ¨ç”»å‚æ•°ï¼Œå®ç°æ¨¡æ‹Ÿæ»šåŠ¨ã€‚æ˜¾ç„¶ï¼Œæ¨¡æ‹Ÿæ»šåŠ¨çš„æ•ˆæœä¸æ˜¯å¤ªå¥½ï¼Œå…¶åŸå› åœ¨äºæ»šåŠ¨é€Ÿç‡å˜åŒ–ã€æ»šåŠ¨æƒ¯æ€§ç­‰æ¯”è¾ƒéš¾æ§åˆ¶ï¼ˆå®é™…åŸå› ï¼šğŸ¥¬ ğŸ¶ï¼‰ã€‚<br>ä¸‹é¢æ¥çœ‹ä¸€ä¸‹åˆç‰ˆæ•ˆæœ:</li></ul><p><img src="https://cdn.jsdelivr.net/gh/PancakeDogLLL/imageBed/img/Sep-01-2022%2019-11-16.gif" alt="img_2"></p><p>ç›®æµ‹æ•ˆæœè¿˜è¡Œï¼Œä½†æ˜¯åœ¨çœŸæœºè°ƒè¯•ä¸Šå°±æ¯”è¾ƒæ‹‰èƒ¯äº†ï¼Œåœ¨çœŸæœºä¸Šï¼Œå®é™…ç§»åŠ¨çš„è·ç¦»æ˜¯æ‰‹æŒ‡ä¸€åŠ¨çš„è·ç¦»ï¼Œæ‰€ä»¥æ˜¯éå¸¸çš„æ…¢å¹¶ä¸”æ¯ä¸€æ¬¡æ»šåŠ¨çš„è·ç¦»ã€é€Ÿåº¦è¿™äº›æ¯”è¾ƒå—é™ã€‚</p><h3 id="Version-2"><a href="#Version-2" class="headerlink" title="Version 2"></a>Version 2</h3><p>å‚è€ƒ picker ç»„ä»¶ï¼Œåšä¸€ä¸ªæ»šåŠ¨æƒ¯æ€§ã€‚è¿™ç§æ»šåŠ¨å¯¹åº”çš„æ˜¯æ¯ä¸€æ¬¡ç§»åŠ¨ï¼Œç»ˆç‚¹ä½ç½®éƒ½æ˜¯ä¸€ä¸ªæ•´æ•°ä½ç½®ï¼ˆæœ€ç»ˆç§»åŠ¨åæ ‡æ˜¯ï¼š index * itemWidth æˆ–è€… itemHeightï¼‰ã€‚</p><h3 id="Version-3"><a href="#Version-3" class="headerlink" title="Version 3"></a>Version 3</h3><p>æ€è·¯ï¼šåŸç”Ÿæ»šåŠ¨ç»“åˆæ‰‹åŠ¿ï¼Œè¿™æ¬¾è®¾è®¡æ¯”è¾ƒåˆç†ï¼ŒåŸç”Ÿæ»šåŠ¨æ”¹å–„äº†é€Ÿåº¦é—®é¢˜ï¼Œæ¨ªå‘é•¿åˆ—è¡¨åœ¨æ»šåŠ¨æ—¶ï¼Œåªæœ‰åˆ°æ»šåŠ¨åˆ°æœ€å³è¾¹æ—¶æ‰è§¦å‘æ•´ä½“å®¹å™¨çš„ç§»åŠ¨ï¼Œç„¶åéœ²å‡º loadã€‚<br>æ³¨æ„ï¼šåŸç”Ÿæ»šåŠ¨é‡‡ç”¨ overflowï¼šautoã€‚åœ¨æ»šåŠ¨åˆ°æœ€å³è¾¹æ—¶ï¼Œè§¦å‘æ‰‹åŠ¿ï¼Œéœ€è¦è®¾ç½® overflowï¼šhiddenï¼Œä¸ç„¶å°±ä¼šå‘ç”Ÿæ»šåŠ¨é‡å ï¼ˆåŸç”Ÿçš„åœ¨æ»šåŠ¨ã€æ‰‹åŠ¿ä¹Ÿåœ¨ç§»åŠ¨ï¼‰ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/PancakeDogLLL/imageBed/img/2022-09-02%2020.17.02.png" alt="img_3"></p><p>çœ‹ä¼¼å¯ç”¨äº†ï¼Œç„¶è€Œ ios æœ‰ä¸ªå‘ç‚¹ï¼ŒåŸç”Ÿæ»šåŠ¨å…·æœ‰æƒ¯æ€§å›å¼¹ï¼Œæ‰€ä»¥ï¼Œå½“ä½ æ‹‡æŒ‡å¿«é€Ÿå·¦æ»‘æ—¶ï¼Œä¼šå‡ºç°ä¸€ä¸ªæ»šåŠ¨å›å¼¹ã€‚è¿™ä¸ªå›å¼¹ä¸ä¼šå°† load éœ²å‡ºæ¥ï¼Œåè€Œéœ²å‡ºçš„æ˜¯ä¸€ä¸ªç™½åº•ã€‚</p><h2 id="èƒ½ç”¨å¾…æ”¹å–„"><a href="#èƒ½ç”¨å¾…æ”¹å–„" class="headerlink" title="èƒ½ç”¨å¾…æ”¹å–„"></a>èƒ½ç”¨å¾…æ”¹å–„</h2><p>å¦‚æ ‡é¢˜æ‰€è¯´ï¼Œæœ€ç»ˆç‰ˆåªæ˜¯ä¸€ä¸ªèƒ½ç”¨çš„ç‰ˆæœ¬ã€‚å„ç§åŸå› ï¼Œé€‰æ‹©å°† load æ”¾åœ¨äº†åŸç”Ÿ scroll é‡Œé¢äº†ï¼ˆé‡Œå¤–å·®åˆ«ä¸å¤§ ğŸ˜…ï¼‰ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/PancakeDogLLL/imageBed/img/Sep-02-2022%2021-05-15.gif" alt="img_3"></p><p>å¾…ä¼˜åŒ–çš„ç‚¹</p><ul><li>åŸç”Ÿæ»šåŠ¨ä¸èƒ½æœ‰å›å¼¹æ•ˆæœï¼Œå¦‚æœéœ€è¦å¢åŠ å›å¼¹æ•ˆæœï¼Œéœ€è¦æ‰‹åŠ¨æ¨¡æ‹Ÿæ»šåŠ¨ï¼Œç„¶åå†æ·»åŠ å›å¼¹ã€‚(iosç‰¹å®šçš„è¾¹ç•Œå¼¹ç°§æ•ˆæœä¸èƒ½ç¦æ­¢)</li><li>è¾¹ç•Œ drag ä¸æµç•…ï¼Œæœ‰å¾…æ”¹è¿›ã€‚</li></ul>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;èƒŒæ™¯ï¼šä¸€æ¬¡å·¦æ»‘åŠ è½½æ›´å¤šçš„çš„äº¤äº’å¼€å‘&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;å¡«å‘å¼€å§‹&quot;&gt;&lt;a href=&quot;#å¡«å‘å¼€å§‹&quot; class=&quot;headerlink&quot; title=&quot;å¡«å‘å¼€å§‹&quot;&gt;&lt;/a&gt;å¡«å‘å¼€å§‹&lt;/h2&gt;&lt;p&gt;åœ¨æœ€å¼€å§‹æ—¶ï¼Œæˆ‘å¾—åˆ°äº†ä¸€ä¸ªæç¤ºï¼Œå·¦æ»‘åŠ è½½æ›´å¤šç±»ä¼¼ä¸‹æ‹‰åˆ·æ–°ã€‚æƒ³äº†æƒ³ï¼Œå¥½å®¶ä¼™ï¼Œä¸å°±æ˜¯æŠŠä¸‹æ‹‰åˆ·æ–°æ¨ªè¿‡æ¥å˜›ï¼Œç¢°å·§ä¸‹æ‹‰åˆ·æ–°è¿˜æ˜¯å‰å‡ å¤©æ–°å¢çš„ä¸€ä¸ªç»„ä»¶ï¼Œè¿™å›å¯ä»¥å€Ÿé‰´å€Ÿé‰´äº† ğŸ˜ã€‚OK å¼€å¹²ï¼&lt;/p&gt;</summary>
    
    
    
    
  </entry>
  
  <entry>
    <title>svgåŸºç¡€</title>
    <link href="https://jealh.xyz/2022/07/21/svg%E5%9F%BA%E7%A1%80/"/>
    <id>https://jealh.xyz/2022/07/21/svg%E5%9F%BA%E7%A1%80/</id>
    <published>2022-07-21T07:52:53.000Z</published>
    <updated>2022-12-31T10:26:33.590Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å®šä¹‰"><a href="#å®šä¹‰" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h2><p>svgï¼ˆScalable Vector Graphicsï¼‰å¯ç¼©æ”¾çš„çŸ¢é‡å›¾å½¢ï¼Œæ˜¯ W3C XML çš„åˆ†æ”¯è¯­è¨€ä¹‹ä¸€ï¼Œç”¨äºæ ‡è®°å¯ç¼©æ”¾çš„çŸ¢é‡å›¾å½¢ã€‚</p><span id="more"></span><h2 id="å‘½åç©ºé—´"><a href="#å‘½åç©ºé—´" class="headerlink" title="å‘½åç©ºé—´"></a>å‘½åç©ºé—´</h2><p>å®šä¹‰çš„å‘½åç©ºé—´å¯ä»¥æŠŠé€šé…ã€å…ƒç´ ã€å±æ€§é€‰æ‹©å™¨é™åˆ¶åœ¨æŒ‡å®šå‘½åç©ºé—´é‡Œçš„å…ƒç´ ã€‚</p><h3 id="å£°æ˜å‘½åç©ºé—´"><a href="#å£°æ˜å‘½åç©ºé—´" class="headerlink" title="å£°æ˜å‘½åç©ºé—´"></a>å£°æ˜å‘½åç©ºé—´</h3><p>ä½¿ç”¨xmlnså±æ€§è¿›è¡Œå‘½åç©ºé—´çš„å£°æ˜ï¼Œä¸‹é¢çš„å£°æ˜æ„å‘³ç€svgä»¥åŠå®ƒçš„å­èŠ‚ç‚¹éƒ½å±äºâ€œ<a href="http://www.w3.org/2000/svg%E2%80%9D%E8%BF%99%E4%B8%AAsvg%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4%E3%80%82">http://www.w3.org/2000/svgâ€è¿™ä¸ªsvgå‘½åç©ºé—´ã€‚</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;/svg&gt;</span><br></pre></td></tr></table></figure><h2 id="SVG-å…ƒç´ "><a href="#SVG-å…ƒç´ " class="headerlink" title="SVG å…ƒç´ "></a>SVG å…ƒç´ </h2><p>See moreï¼š<a href="https://developer.mozilla.org/zh-CN/docs/Web/SVG/Element#svg_%E5%85%83%E7%B4%A0%EF%BC%88%E6%8C%89%E7%B1%BB%E5%88%AB%E5%88%86%E7%B1%BB%EF%BC%89">mdn-svgå…ƒç´ å‚è€ƒ</a></p><blockquote><p>ä¸Šé¢åˆ—å‡ºäº†ä¸€äº›å¸¸è§ä»¥åŠå¸¸ç”¨çš„svgå…ƒç´ ï¼Œä¸‹é¢æˆ‘ä»¬å¯ä»¥æ¥çœ‹çœ‹å®ƒä»¬æ˜¯ä»€ä¹ˆæ ·å­çš„ä»¥åŠæ€ä¹ˆæ”¹å˜å®ƒä»¬çš„å±æ€§ã€‚</p></blockquote><h2 id="å›¾å½¢å…ƒç´ "><a href="#å›¾å½¢å…ƒç´ " class="headerlink" title="å›¾å½¢å…ƒç´ "></a>å›¾å½¢å…ƒç´ </h2><h3 id="åŸºç¡€å›¾å½¢å…ƒç´ "><a href="#åŸºç¡€å›¾å½¢å…ƒç´ " class="headerlink" title="åŸºç¡€å›¾å½¢å…ƒç´ "></a>åŸºç¡€å›¾å½¢å…ƒç´ </h3><iframe height="300" style="width: 100%;" scrolling="no" title="feDisplacementMap" src="https://codepen.io/l-jour/embed/RwMVwNE?default-tab=html%2Cresult" frameborder="no" loading="lazy" allowtransparency="true" allowfullscreen="true">  See the Pen <a href="https://codepen.io/l-jour/pen/RwMVwNE"></a> by L-jour (<a href="https://codepen.io/l-jour">@l-jour</a>)  on <a href="https://codepen.io">CodePen</a>.</iframe><h3 id="çº¿æ®µå±æ€§"><a href="#çº¿æ®µå±æ€§" class="headerlink" title="çº¿æ®µå±æ€§"></a>çº¿æ®µå±æ€§</h3><p>å¯¹äºstrokeå¡«å……çš„çº¿æ®µæ¥è¯´ï¼Œstroke-dasharrayä¸stroke-dashoffsetæ˜¯ä¸¤ä¸ªæ¯”è¾ƒæœ‰ç”¨çš„å±æ€§ã€‚</p><ul><li>  stroke-dasharrayï¼šæ§åˆ¶ç”¨æ§åˆ¶çº¿æ®µå®çº¿ä¸è™šçº¿çš„å•å…ƒé•¿åº¦ã€‚</li></ul><!----><ul><li>  stroke-dasharrayï¼šæ§åˆ¶è™šçº¿çš„åç§»</li></ul><blockquote><p>stroke-dasharrayç»“åˆanimateçš„ä¾‹å­</p></blockquote><iframe height="300" style="width: 100%;" scrolling="no" title="feDisplacementMap" src="https://codepen.io/l-jour/embed/ZExoMmN?default-tab=html%2Cresult" frameborder="no" loading="lazy" allowtransparency="true" allowfullscreen="true">  See the Pen <a href="https://codepen.io/l-jour/pen/ZExoMmN"></a> by L-jour (<a href="https://codepen.io/l-jour">@l-jour</a>)  on <a href="https://codepen.io">CodePen</a>.</iframe><blockquote><p>ä½¿ç”¨stroke-dashoffsetä¸animateTransformã€animateç»˜åˆ¶åŠ è½½åŠ¨ç”»</p></blockquote><p>ç”¨animateæ§åˆ¶stroke-dashoffsetè™šçº¿éƒ¨åˆ†çš„åç§»ï¼ŒåŒæ—¶animateTransformæ§åˆ¶æ•´ä¸ªåœ†ç¯çš„è‡ªè½¬ã€‚</p><iframe height="300" style="width: 100%;" scrolling="no" title="feDisplacementMap" src="https://codepen.io/l-jour/embed/ExELqMa?default-tab=html%2Cresult" frameborder="no" loading="lazy" allowtransparency="true" allowfullscreen="true">  See the Pen <a href="https://codepen.io/l-jour/pen/ExELqMa"></a> by L-jour (<a href="https://codepen.io/l-jour">@l-jour</a>)  on <a href="https://codepen.io">CodePen</a>.</iframe><blockquote><p>å¿ƒç”µå›¾</p></blockquote><p>è¿™é‡Œä¸»è¦æ€è·¯å°±æ˜¯ä½¿ç”¨polylineç»˜åˆ¶æŠ˜çº¿å›¾ï¼Œä½¿ç”¨stroke-dasharrayç»˜åˆ¶è™šçº¿ï¼Œstroke-dashoffsetæ§åˆ¶è™šçº¿ç©ºç™½å¤„çš„åç§»ï¼Œç„¶åç”¨animateæ§åˆ¶stroke-dashoffsetçš„å€¼ï¼Œå°±èƒ½çœ‹è§è¿™ç§çº¿æ®µç§»åŠ¨çš„æ•ˆæœäº†ğŸ«¥</p><iframe height="300" style="width: 100%;" scrolling="no" title="feDisplacementMap" src="https://codepen.io/l-jour/embed/qBoYyxL?default-tab=html%2Cresult" frameborder="no" loading="lazy" allowtransparency="true" allowfullscreen="true">  See the Pen <a href="https://codepen.io/l-jour/pen/qBoYyxL"></a> by L-jour (<a href="https://codepen.io/l-jour">@l-jour</a>)  on <a href="https://codepen.io">CodePen</a>.</iframe><h3 id="å¼ºå¤§çš„pathå…ƒç´ "><a href="#å¼ºå¤§çš„pathå…ƒç´ " class="headerlink" title="å¼ºå¤§çš„pathå…ƒç´ "></a>å¼ºå¤§çš„pathå…ƒç´ </h3><p>ä¸Šé¢çš„åŸºæœ¬å›¾å½¢éƒ½æ˜¯å¯ä»¥ç”¨pathæ¥åˆ›å»ºçš„ï¼Œè€Œpathçš„åŠŸèƒ½è¿œè¿œä¸æ­¢ä¸Šé¢è¿™äº›å›¾å½¢ğŸ˜ã€‚pathå…ƒç´ çš„å½¢çŠ¶é€šè¿‡å±æ€§dæ¥å®šä¹‰ï¼Œå±æ€§dçš„å€¼æ˜¯ä¸€ä¸ªâ€œå‘½ä»¤+å‚æ•°â€çš„åºåˆ—ã€‚ä¸‹é¢å°±åˆ—å‡ºäº†ä¸€äº›å¸¸ç”¨çš„å‘½ä»¤ã€‚</p><h4 id="ç›´çº¿å‘½ä»¤"><a href="#ç›´çº¿å‘½ä»¤" class="headerlink" title="ç›´çº¿å‘½ä»¤"></a>ç›´çº¿å‘½ä»¤</h4><ol><li><p>Moveto</p><ul><li> <code>M x,y</code> åœ¨è¿™é‡Œxå’Œyæ˜¯ç»å¯¹åæ ‡ï¼Œåˆ†åˆ«ä»£è¡¨æ°´å¹³åæ ‡å’Œå‚ç›´åæ ‡ã€‚</li><li> <code>m dx,dy</code> åœ¨è¿™é‡Œdxå’Œdyæ˜¯ç›¸å¯¹äºå½“å‰ç‚¹çš„è·ç¦»ï¼Œåˆ†åˆ«æ˜¯å‘å³å’Œå‘ä¸‹çš„è·ç¦»ã€‚</li></ul></li></ol><!----><ol start="2"><li><p>Lineto<br><code>Lineto</code>æŒ‡ä»¤å°†ç»˜åˆ¶ä¸€æ¡ç›´çº¿æ®µã€‚è¿™ä¸ªç›´çº¿æ®µä»å½“å‰ä½ç½®ç§»åˆ°æŒ‡å®šä½ç½®</p><ul><li>  <code>Lx,y</code> xä¸yæ˜¯ç»å¯¹åæ ‡ï¼Œåˆ†åˆ«ä»£è¡¨æ°´å¹³åæ ‡å’Œå‚ç›´åæ ‡</li><li>  <code>ldx,dy</code> dxå’Œdyæ˜¯ç›¸å¯¹äºå½“å‰ç‚¹çš„è·ç¦»ï¼Œåˆ†åˆ«æ˜¯å‘å³å’Œå‘ä¸‹çš„è·ç¦»</li><li>  <code>Hx</code> ç»å¯¹åæ ‡ï¼Œæ°´å¹³ç§»åŠ¨</li><li>  <code>Vy</code> ç»å¯¹åæ ‡ï¼Œå‚ç›´ç§»åŠ¨</li><li>  <code>hdx</code> æ°´å¹³ç§»åŠ¨ç›¸å¯¹è·ç¦»</li><li>  <code>vdy</code> å‚ç›´ç§»åŠ¨ç›¸å¯¹è·ç¦»</li></ul></li><li><p> Z or zï¼šé—­åˆè·¯å¾„</p></li></ol><iframe height="300" style="width: 100%;" scrolling="no" title="feDisplacementMap" src="https://codepen.io/l-jour/embed/NWYjyxL?default-tab=html%2Cresult" frameborder="no" loading="lazy" allowtransparency="true" allowfullscreen="true">  See the Pen <a href="https://codepen.io/l-jour/pen/NWYjyxL"></a> by L-jour (<a href="https://codepen.io/l-jour">@l-jour</a>)  on <a href="https://codepen.io">CodePen</a>.</iframe><h4 id="æ›²çº¿å‘½ä»¤"><a href="#æ›²çº¿å‘½ä»¤" class="headerlink" title="æ›²çº¿å‘½ä»¤"></a>æ›²çº¿å‘½ä»¤</h4><p>å°å†™çš„æŒ‡ä»¤æ„ä¹‰åŒä¸Šï¼Œéƒ½æ˜¯è·Ÿç›¸å¯¹çš„è·ç¦»</p><ol><li> Curveto</li></ol><ul><li> Â Â Cå‘½ä»¤åˆ›å»ºä¸€ä¸ªä¸‰æ¬¡è´å¡å°”æ›²çº¿ï¼Œå…¶ä¸­ (x1,y1) (x2,y2)ä¸ºæ§åˆ¶ç‚¹ï¼Œx,yä¸ºæ›²çº¿ç»ˆç‚¹</li><li> <code>C x1 y1, x2 y2, x y </code>or <code>c dx1 dy1, dx2 dy2, dx dy</code></li></ul><!----><ol start="2"><li> Smooth Curveto</li></ol><ul><li> Â Â Så‘½ä»¤å¯ä»¥ç”¨æ¥åˆ›å»ºäºä¸å‰é¢ä¸€æ ·çš„è´å¡å°”æ›²çº¿ï¼Œå¦‚æœSå‘½ä»¤è·Ÿåœ¨ä¸€ä¸ªCæˆ–Så‘½ä»¤åé¢ï¼Œåˆ™å®ƒçš„ç¬¬ä¸€ä¸ªæ§åˆ¶ç‚¹ä¼šè¢«å‡è®¾æˆå‰ä¸€ä¸ªå‘½ä»¤æ›²çº¿çš„ç¬¬äºŒä¸ªæ§åˆ¶ç‚¹çš„ä¸­å¿ƒå¯¹ç§°ç‚¹ã€‚å¦‚æœSå‘½ä»¤å•ç‹¬ä½¿ç”¨ï¼Œå‰é¢æ²¡æœ‰Cæˆ–è€…Så‘½ä»¤ï¼Œé‚£å½“å‰ç‚¹å°†ä½œä¸ºç¬¬ä¸€ä¸ªæ§åˆ¶ç‚¹ã€‚æœ€å¤§çš„ä½œç”¨å°±æ˜¯å…‰æ»‘åœ°è¿æ¥ä¸¤æ¡æ›²çº¿</li><li> <code>S x2 y2,x y</code> or <code>s dx2 dy2, dx dy</code></li></ul><blockquote><p>Cã€Så‘½ä»¤ä¾‹å­</p></blockquote><iframe height="300" style="width: 100%;" scrolling="no" title="feDisplacementMap" src="https://codepen.io/l-jour/embed/rNdmJma?default-tab=html%2Cresult" frameborder="no" loading="lazy" allowtransparency="true" allowfullscreen="true">  See the Pen <a href="https://codepen.io/l-jour/pen/rNdmJma"></a> by L-jour (<a href="https://codepen.io/l-jour">@l-jour</a>)  on <a href="https://codepen.io">CodePen</a>.</iframe><ol start="3"><li> Quadratic BÃ©zier curveto</li></ol><ul><li>  Qå‘½ä»¤ç”¨æ¥åˆ›å»ºä¸€æ¡äºŒæ¬¡è´å¡å°”æ›²çº¿ï¼Œåªéœ€è¦ä¸€ä¸ªæ§åˆ¶ç‚¹</li><li>  <code>Q x1 y1,x y</code> or <code>q dx1 dx2,dx dy</code></li></ul><ol start="4"><li> Smooth quadratic BÃ©zier curveto</li></ol><ul><li> Tå‘½ä»¤ç±»ä¼¼Så‘½ä»¤ï¼Œç”¨äºå¹³æ»‘é“¾æ¥äºŒæ¬¡è´å¡å°”æ›²çº¿</li><li> <code>T x1 y1 </code>or <code>t dx dy</code></li></ul><blockquote><p>Qã€Tå‘½ä»¤ä¾‹å­</p></blockquote><iframe height="300" style="width: 100%;" scrolling="no" title="feDisplacementMap" src="https://codepen.io/l-jour/embed/PoRJaqN?default-tab=html%2Cresult" frameborder="no" loading="lazy" allowtransparency="true" allowfullscreen="true">  See the Pen <a href="https://codepen.io/l-jour/pen/PoRJaqN"></a> by L-jour (<a href="https://codepen.io/l-jour">@l-jour</a>)  on <a href="https://codepen.io">CodePen</a>.</iframe><ol start="5"><li> Arc</li></ol><ul><li>Aå‘½ä»¤ä¹Ÿå¯ä»¥ç”¨äºç»˜åˆ¶æ›²çº¿<ul><li>  <code>A rx ry x-axis-rotation large-arc-flag sweep-flag x y</code> <code>a rx ry x-axis-rotation large-arc-flag sweep-flag dx dy</code></li><li>  Â Â å‚æ•°è¯´æ˜ï¼š</li><li>  Â Â rx ry: xã€yè½´åŠå¾„</li><li>  Â Â X-axis-rotation: ç»•xè½´æ—‹è½¬è§’åº¦</li><li>  Â Â large-arc-flagï¼š0-å¼§å°äº180åº¦ã€1-å¼§å¤§äº180åº¦</li><li>  Â Â sweep-flagï¼š0-é€†æ—¶é’ˆç”»å¼§ã€1-é¡ºæ—¶é’ˆç”»å¼§</li><li>  Â Â x yï¼šç»ˆç‚¹åæ ‡</li></ul></li></ul><h2 id="åŠ¨ç”»"><a href="#åŠ¨ç”»" class="headerlink" title="åŠ¨ç”»"></a>åŠ¨ç”»</h2><blockquote><p>æ”¾å…¥å½¢çŠ¶å…ƒç´ å†…éƒ¨ï¼Œåœ¨æŒ‡å®šçš„æ—¶é—´æ®µé‡Œï¼Œè®¾ç½®ç›¸å…³å±æ€§çš„å¼€å§‹ä¸ç»“æŸå€¼ï¼Œå˜åŒ–æ›²çº¿ç­‰ã€‚</p></blockquote><h3 id="åŠ¨ç”»å…ƒç´ "><a href="#åŠ¨ç”»å…ƒç´ " class="headerlink" title="åŠ¨ç”»å…ƒç´ "></a>åŠ¨ç”»å…ƒç´ </h3><ul><li>  animateï¼šç”¨æ¥å®šä¹‰ä¸€ä¸ªå…ƒç´ çš„æŸä¸ªå±æ€§åœ¨ç›¸åº”æ—¶é—´çš„å˜åŒ–</li><li>  animateTransformï¼šæ”¹å˜ç›®æ ‡å…ƒç´ ä¸Šçš„ä¸€ä¸ªå˜å½¢å±æ€§ï¼Œæ§åˆ¶æ—‹è½¬ã€ç¼©æ”¾ã€å¹³ç§»ã€æ–œåˆ‡å˜æ¢</li><li>  animateMotionï¼šå®šä¹‰ç›®æ ‡å…ƒç´ å¦‚ä½•æ²¿ä¸€ä¸ªè·¯å¾„è¿åŠ¨</li><li>  discardï¼šæŒ‡å®šåœ¨ä½•æ—¶ä¸¢å¼ƒç‰¹å®šå…ƒç´ ï¼Œä»è€Œå‡å°‘ SVG ç”¨æˆ·ä»£ç†æ‰€éœ€çš„èµ„æºã€‚</li><li>  mpathï¼šé…åˆanimateMotionï¼Œå¯ä»£æ›¿animateMotionçš„pathå±æ€§ï¼Œç”¨äºå¼•ç”¨ä¸€ä¸ªå¤–éƒ¨çš„path</li><li>  setï¼šå¯ä»¥ç”¨æ¥è®¾å®šä¸€ä¸ªå±æ€§å€¼ï¼Œå¹¶ä¸ºè¯¥å€¼èµ‹äºˆä¸€ä¸ªæŒç»­æ—¶é—´ã€‚å®ƒæ”¯æŒæ‰€æœ‰çš„å±æ€§ç±»å‹ï¼Œ åŒ…æ‹¬é‚£äº›åŸç†ä¸Šä¸èƒ½æ’å€¼çš„ï¼Œ ä¾‹å¦‚å€¼ä¸ºå­—ç¬¦ä¸²å’Œå¸ƒå°”ç±»å‹çš„å±æ€§ã€‚ set å…ƒç´ æ˜¯éå åŠ çš„ã€‚æ— æ³•åœ¨å…¶ä¸Šä½¿ç”¨ additive å±æ€§æˆ– accumulate å±æ€§ï¼Œå³ä½¿å£°æ˜äº†è¿™äº›å±æ€§ä¹Ÿä¼šè‡ªåŠ¨è¢«å¿½ç•¥ã€‚</li></ul><iframe height="300" style="width: 100%;" scrolling="no" title="feDisplacementMap" src="https://codepen.io/l-jour/embed/wvmrYLy?default-tab=html%2Cresult" frameborder="no" loading="lazy" allowtransparency="true" allowfullscreen="true">  See the Pen <a href="https://codepen.io/l-jour/pen/wvmrYLy"></a> by L-jour (<a href="https://codepen.io/l-jour">@l-jour</a>)  on <a href="https://codepen.io">CodePen</a>.</iframe><h3 id="åŠ¨ç”»å±æ€§"><a href="#åŠ¨ç”»å±æ€§" class="headerlink" title="åŠ¨ç”»å±æ€§"></a>åŠ¨ç”»å±æ€§</h3><p>è¿™é‡Œå¤§è‡´å¯ä»¥åˆ†ä¸ºä¸‰ç±»ï¼š</p><ol><li> å–å€¼å±æ€§ï¼šæ§åˆ¶è¦åŠ¨ç”»çš„å±æ€§ï¼ˆå¦‚xåæ ‡ï¼Œwidthç­‰å±æ€§ï¼‰çš„å€¼</li></ol><pre><code>-  **calcModeï¼š** è®¾ç½®åŠ¨ç”»çš„å˜åŒ–æ›²çº¿ï¼ˆdiscrete | linear | paced | splineï¼‰ï¼Œé™¤äº†animateMotioné»˜è®¤æ˜¯pacedå¤–ï¼Œå…¶ä»–æ˜¯é»˜è®¤linearï¼Œå½“ä¸€äº›ä¸æ”¯æŒçº¿æ€§å˜åŒ–çš„å±æ€§å€¼ï¼ˆstringç±»å‹çš„ï¼‰å°±ä¼šå˜ä¸ºdiscreteã€‚-  **valuesï¼š** å®šä¹‰åŠ¨ç”»è¿‡ç¨‹ä¸­çš„å€¼åºåˆ—ï¼ˆä¸€ä¸ªæˆ–å¤šä¸ªå€¼çš„åˆ†å·åˆ†éš”åˆ—è¡¨ï¼‰çš„å€¼ã€‚ å¦‚æœæŒ‡å®šäº†æ­¤å±æ€§ï¼Œåˆ™å°†å¿½ç•¥åœ¨å…ƒç´ ä¸Šè®¾ç½®çš„ä»»ä½• `from`, `to`, å’Œ `by` å±æ€§å€¼ã€‚-  **keyTimesï¼š** ä»¥åˆ†å·åˆ†éš”çš„æ—¶é—´å€¼åˆ—è¡¨ï¼Œç”¨äºæ§åˆ¶åŠ¨ç”»çš„æ‰§è¡Œæ­¥éª¤ã€‚åˆ—è¡¨ä¸­çš„æ¯ä¸ªå€¼ä¸`values`ä¸­çš„å€¼ä¸€ä¸€å¯¹åº”ï¼Œå®šä¹‰äº†`values`ä¸­çš„å€¼åœ¨åŠ¨ç”»ä¸­ä½•æ—¶æ‰§è¡Œï¼ŒkeyTimes åˆ—è¡¨ä¸­çš„æ¯ä¸€ä¸ªå€¼éƒ½æ˜¯æŒ‡å®šåœ¨ [0-1] ä¹‹é—´çš„æµ®ç‚¹æ•°ï¼Œè¡¨ç¤ºåŠ¨ç”»çš„å®Œæˆæ—¶é—´ã€‚æ¯ä¸€ä¸ªè¿ç»­çš„æ—¶é—´å€¼å¿…é¡»å¤§äºç­‰äºå‰ä¸€ä¸ªæ—¶é—´å€¼ã€‚    -   å¯¹äº linear å’Œ splineåŠ¨ç”»ï¼Œåˆ—è¡¨ä¸­çš„ç¬¬ä¸€ä¸ªæ—¶é—´å€¼å¿…é¡»ä¸º 0ï¼Œåˆ—è¡¨çš„æœ€åä¸€ä¸ªæ—¶é—´å€¼å¿…é¡»ä¸º 1ã€‚ä¸æ¯ä¸ª value å…³è”çš„æ—¶é—´å€¼å®šä¹‰äº†ä½•æ—¶è®¾ç½®è¯¥ valueï¼Œè¯¥ value åœ¨ keyTimes çš„æ—¶é—´ å€¼çš„ä¸­é—´æ’å€¼ã€‚    -   å¯¹äº discreteåŠ¨ç”»ï¼Œåˆ—è¡¨ä¸­çš„ç¬¬ä¸€ä¸ªå€¼å¿…é¡»ä¸º 0ã€‚ä¸æ¯ä¸ª value å…³è”çš„æ—¶é—´å€¼å®šä¹‰äº†ä½•æ—¶è®¾ç½®è¯¥ valueï¼ŒåŠ¨ç”»å‡½æ•°ä½¿ç”¨è¯¥ valueï¼Œç›´åˆ° keyTimes ä¸­å®šä¹‰çš„ä¸‹ä¸€ä¸ªæ—¶é—´å€¼ã€‚    -   å¦‚æœæ’å€¼æ¨¡å¼æ˜¯ pacedåŠ¨ç”»ï¼ŒkeyTimes å±æ€§è¢«å¿½ç•¥ã€‚-  **keySplinesï¼š** å®šä¹‰äº†ä¸€ç»„ä¸ keyTimes åˆ—è¡¨å…³è”çš„ BÃ©zier æ›²çº¿æ§åˆ¶ç‚¹ï¼Œå®šä¹‰äº†ä¸€ä¸ªæ§åˆ¶é—´éš”ï¼ˆkeyTimesçš„å€¼åˆ—è¡¨é•¿åº¦å‡1å³ä¸ºé—´éš”æ•°ï¼‰çš„ä¸‰æ¬¡ BÃ©zier å‡½æ•°ã€‚åªæœ‰splineåŠ¨ç”»æ‰ä¼šæœ‰æ•ˆã€‚-  **fromï¼š** æŒ‡å®šå±æ€§çš„å¼€å§‹å€¼-  **byï¼š** æŒ‡å®šå°†åœ¨åŠ¨ç”»æœŸé—´ä¿®æ”¹çš„å±æ€§çš„ç›¸å¯¹åç§»å€¼-  **toï¼š** è¡¨ç¤ºå°†åœ¨åŠ¨ç”»æœŸé—´ä¿®æ”¹çš„å±æ€§çš„æœ€ç»ˆå€¼</code></pre><blockquote><p>å–å€¼å±æ€§ä¾‹å­</p></blockquote>  <iframe height="300" style="width: 100%;" scrolling="no" title="feDisplacementMap" src="https://codepen.io/l-jour/embed/WNzdXNZ?default-tab=html%2Cresult" frameborder="no" loading="lazy" allowtransparency="true" allowfullscreen="true">    See the Pen <a href="https://codepen.io/l-jour/pen/WNzdXNZ"></a> by L-jour (<a href="https://codepen.io/l-jour">@l-jour</a>)    on <a href="https://codepen.io">CodePen</a>.  </iframe><ol start="2"><li> æ—¶é—´å±æ€§ï¼šæ§åˆ¶åŠ¨ç”»å¦‚ä½•å¼€å§‹ï¼Œä½•æ—¶å¼€å§‹ã€é‡å¤æ¬¡æ•°ç­‰</li></ol><pre><code>-  **beginï¼š** åŠ¨ç”»å¼€å§‹æ—¶é—´-  **endï¼š** åŠ¨ç”»ç»“æŸæ—¶é—´-  **durï¼š** åŠ¨ç”»æŒç»­æ—¶é—´-  **min/maxï¼š** é™åˆ¶åŠ¨ç”»çš„æœ€å°/å¤§æŒç»­æ—¶é—´-  **restartï¼š** æ§åˆ¶åŠ¨ç”»æ˜¯å¦å¯ä»¥é‡æ–°å¼€å§‹    -   `always` ï¼šä»»ä½•æ—¶å€™éƒ½å¯é‡æ–°å¼€å§‹    -   `whenNotActive` ï¼šéåŠ¨ç”»æ—¶å¯é‡æ–°å¼€å§‹    -   `never` ï¼šä»»ä½•æ—¶å€™éƒ½ä¸èƒ½é‡æ–°å¼€å§‹-  **repeatCountï¼š** æŒ‡å®šåŠ¨ç”»é‡å¤çš„æ¬¡æ•°ã€å€¼å¿…é¡»å¤§äº 0ã€‚-  **repeatDurï¼š** æŒ‡å®šåŠ¨ç”»çš„é‡å¤æ—¶é—´-  **fillï¼š** æ§åˆ¶åŠ¨ç”»ç»“æŸæ—¶çš„çŠ¶æ€ã€‚æœ‰ä¸¤ä¸ªå€¼å¯é€‰    -   removeï¼šåœ¨åŠ¨ç”»çš„æ¿€æ´»æŒç»­æ—¶é—´ç»“æŸåï¼ŒåŠ¨ç”»æ•ˆæœä¼šç§»é™¤ï¼ˆä¸å†åº”ç”¨ï¼‰ã€‚åœ¨åŠ¨ç”»çš„æ¿€æ´»ç»“æŸåï¼ŒåŠ¨ç”»ä¸å†å¯¹ç›®æ ‡å…ƒç´ æœ‰å½±å“ï¼ˆé™¤éåŠ¨ç”»é‡æ–°å¼€å§‹ï¼‰ã€‚    -   freezeï¼šåœ¨åŠ¨ç”»æ¿€æ´»æŒç»­æ—¶é—´ç»“æŸåï¼Œæ–‡æ¡£æŒç»­æ—¶é—´çš„å‰©ä½™æ—¶é—´é‡Œï¼ˆæˆ–è€…ç›´åˆ°åŠ¨ç”»é‡æ–°å¼€å§‹ï¼‰åŠ¨ç”»æ•ˆæœä¼šâ€œå†»ç»“â€ç€ã€‚ï¼ˆä¿æŒåŠ¨ç”»ç»ˆæ€ï¼‰</code></pre><ol start="3"><li> ç›®æ ‡å±æ€§ï¼šæ§åˆ¶è¦åŠ¨ç”»çš„å±æ€§</li></ol><pre><code>-  **ttributeTypeï¼š** å½“attributeType=&quot;XML&quot;æ—¶ï¼ŒattributeNameè¢«è®¤ä¸ºæ˜¯XMLçš„å±æ€§ï¼›å½“attributeType=&quot;CSS&quot;æ—¶ï¼ŒattributeNameè¢«è®¤ä¸ºæ˜¯cssçš„å±æ€§ï¼›ä¸æŒ‡å®šattributeTypeæ—¶ï¼Œé»˜è®¤ä¸º&quot;auto&quot;ï¼Œä¼šå…ˆå°†attributeNameä½œä¸ºcssçš„å±æ€§ï¼Œå¦‚æœæ— æ•ˆï¼Œå†å°†attributeNameä½œä¸ºXMLçš„å±æ€§ã€‚-  **attributeNameï¼š** è¦åŠ¨ç”»çš„å±æ€§å</code></pre><!----><ol start="4"><li> å…¶ä»–å±æ€§ï¼šadditiveã€accumulate</li></ol><pre><code>-  **additiveï¼š** æ§åˆ¶åŠ¨ç”»å±æ€§æ˜¯å¦æ˜¯é™„åŠ çš„ã€‚-  **accumulateï¼š** åœ¨åŸæ¥çš„ç»“æœçš„åŸºç¡€ä¸Šé‡å¤åŠ¨ç”»çš„æ—¶å€™æ¯ä¸€æ¬¡å¾ªç¯éƒ½ç´¯åŠ ã€‚è¿™ä¸ªå±æ€§å‘Šè¯‰åŠ¨ç”»æ˜¯å¦æ˜¯æ¯æ¬¡å¾ªç¯ï¼Œå‰ä¸€ä¸ªåŠ¨ç”»å±æ€§å€¼è¦åŠ ä¸Šå»ã€‚éœ€è¦è®¾ç½®fromä¸toå±æ€§ã€‚</code></pre><blockquote><p>additiveã€accumulateä¾‹å­</p></blockquote>  <iframe height="300" style="width: 100%;" scrolling="no" title="feDisplacementMap" src="https://codepen.io/l-jour/embed/PoREOjj?default-tab=html%2Cresult" frameborder="no" loading="lazy" allowtransparency="true" allowfullscreen="true">    See the Pen <a href="https://codepen.io/l-jour/pen/PoREOjj"></a> by L-jour (<a href="https://codepen.io/l-jour">@l-jour</a>)    on <a href="https://codepen.io">CodePen</a>.  </iframe><h2 id="ç»“æ„å…ƒç´ "><a href="#ç»“æ„å…ƒç´ " class="headerlink" title="ç»“æ„å…ƒç´ "></a>ç»“æ„å…ƒç´ </h2><blockquote><p>ç»“æ„å…ƒç´ å…³æ³¨çš„æ˜¯å¤ç”¨</p></blockquote><ul><li>  <strong>defsï¼š</strong> å®šä¹‰ä¸€ä¸ªå¤ç”¨çš„å›¾å½¢ã€‚åœ¨<code>defs</code>å…ƒç´ ä¸­å®šä¹‰çš„å›¾å½¢å…ƒç´ ä¸ä¼šç›´æ¥å‘ˆç°ã€‚ ä½ å¯ä»¥åœ¨ä½ çš„è§†å£çš„ä»»æ„åœ°æ–¹åˆ©ç”¨ <code>use</code>å…ƒç´ å‘ˆç°è¿™äº›å…ƒç´ ã€‚</li></ul><!----><ul><li>  <strong>gï¼š</strong> ç»„åˆå­å…ƒç´ çš„å®¹å™¨ï¼Œgå…ƒç´ çš„å±æ€§ä¼šè¢«å…¶æ‰€æœ‰çš„å­å…ƒç´ ç»§æ‰¿ ã€‚ä¸<code>defs</code>ç›¸æ¯”ï¼Œgå®šä¹‰çš„é™¤äº†å¤ç”¨å¤–ï¼Œåœ¨å®šä¹‰æ—¶ä¼šè¿›è¡Œæ¸²æŸ“ã€‚</li></ul><!----><ul><li>  <strong>symbolï¼š</strong> å®šä¹‰ä¸€ä¸ªå›¾å½¢æ¨¡ç‰ˆå¯¹è±¡ï¼Œä½¿ç”¨<code>use</code>å…ƒç´ å®ä¾‹åŒ–ã€‚<code>symbol</code>å…ƒç´ å¯¹å›¾å½¢çš„ä½œç”¨æ˜¯åœ¨åŒä¸€æ–‡æ¡£ä¸­å¤šæ¬¡ä½¿ç”¨ï¼Œæ·»åŠ ç»“æ„å’Œè¯­ä¹‰ã€‚symbolé€šè¿‡<code>use</code>è°ƒç”¨æ—¶ï¼Œ<code> &lt;use  ``/``&gt;</code>å¯ä»¥è®¾ç½®heightã€widthæ§åˆ¶å®é™…ç»˜åˆ¶çš„å¤§å°ã€‚</li></ul><!----><ul><li>  <strong>svg</strong> <strong>ï¼š</strong> å¦‚æœ <code>svg</code> ä¸æ˜¯æ ¹å…ƒç´ ï¼Œ<code>svg</code> å…ƒç´ å¯ä»¥ç”¨äºåœ¨å½“å‰æ–‡æ¡£ï¼ˆæ¯”å¦‚è¯´ï¼Œä¸€ä¸ª HTML æ–‡æ¡£ï¼‰å†…åµŒå¥—ä¸€ä¸ªç‹¬ç«‹çš„ svg ç‰‡æ®µ ã€‚ è¿™ä¸ªç‹¬ç«‹ç‰‡æ®µæ‹¥æœ‰ç‹¬ç«‹çš„è§†å£å’Œåæ ‡ç³»ç»Ÿã€‚</li></ul><!----><ul><li><p><strong>markerï¼š</strong> å®šä¹‰äº†åœ¨ç‰¹å®šçš„pathå…ƒç´ ã€lineå…ƒç´ ã€polylineå…ƒç´ æˆ–è€…polygonå…ƒç´ ä¸Šç»˜åˆ¶ç®­å¤´æˆ–è€…å¤šè¾¹å½¢æ ‡è®°å›¾å½¢ã€‚</p><ul><li>  refxï¼šå®šä¹‰å…ƒç´ å‚è€ƒç‚¹çš„xåæ ‡ (é»˜è®¤æ˜¯0)</li><li>  refyï¼šå®šä¹‰å…ƒç´ å‚è€ƒç‚¹çš„yåæ ‡ (é»˜è®¤æ˜¯0)</li><li>  markerWidthï¼šè¡¨ç¤ºæ ¹æ® viewBox å’Œ preserveAspectRatio å±æ€§æ¸²æŸ“ <code>&lt;marker&gt;</code> æ—¶è¦é€‚åˆçš„è§†å£å®½åº¦</li><li>  markerHeightï¼šè¡¨ç¤ºæ ¹æ® viewBox å’Œ preserveAspectRatio å±æ€§æ¸²æŸ“ <code>&lt;marker&gt; </code>æ—¶è¦é€‚åˆçš„è§†å£é«˜åº¦</li><li>  markerUnitsï¼šæŒ‡ç¤ºæ ‡è®°æ”¾ç½®åœ¨å½¢çŠ¶ä¸Šçš„ä½ç½®æ—¶å¦‚ä½•æ—‹è½¬</li></ul></li></ul><!----><ul><li>  mask</li></ul><iframe height="300" style="width: 100%;" scrolling="no" title="feDisplacementMap" src="https://codepen.io/l-jour/embed/GRxmgEN?default-tab=html%2Cresult" frameborder="no" loading="lazy" allowtransparency="true" allowfullscreen="true">  See the Pen <a href="https://codepen.io/l-jour/pen/GRxmgEN"></a> by L-jour (<a href="https://codepen.io/l-jour">@l-jour</a>)  on <a href="https://codepen.io">CodePen</a>.</iframe><h2 id="æ»¤é•œå…ƒç´ "><a href="#æ»¤é•œå…ƒç´ " class="headerlink" title="æ»¤é•œå…ƒç´ "></a>æ»¤é•œå…ƒç´ </h2><h3 id="ç›¸å…³æ ‡ç­¾"><a href="#ç›¸å…³æ ‡ç­¾" class="headerlink" title="ç›¸å…³æ ‡ç­¾"></a>ç›¸å…³æ ‡ç­¾</h3><blockquote><p>æ»¤é•œé€šè¿‡<code>&lt;filter&gt;</code>åœ¨<code>&lt;defs&gt;</code>ä¸­è¿›è¡Œå®šä¹‰ï¼Œåœ¨filteræ ‡ç­¾ä¸­æä¾›ä¸€ç³»åˆ—å›¾å…ƒï¼Œä½¿ç”¨æ»¤é•œåªéœ€ä¸ºsvgå…ƒç´ è®¾ç½®filterå±æ€§å³å¯ã€‚</p></blockquote><h3 id="å¸¸è§å±æ€§"><a href="#å¸¸è§å±æ€§" class="headerlink" title="å¸¸è§å±æ€§"></a>å¸¸è§å±æ€§</h3><p>  inï¼šæ ‡è¯†è¾“å…¥çš„åŸè¯­</p><pre><code>-   SourceGraphicï¼šè¯¥å…³é”®è¯è¡¨ç¤ºå›¾å½¢å…ƒç´ è‡ªèº«å°†ä½œä¸º`&lt;filter&gt;`åŸè¯­çš„åŸå§‹è¾“å…¥-   SourceAlphaï¼šè¯¥å…³é”®è¯è¡¨ç¤ºå›¾å½¢å…ƒç´ è‡ªèº«å°†ä½œä¸º`&lt;filter&gt;`åŸè¯­çš„åŸå§‹è¾“å…¥. SourceAlpha ä¸ SourceGraphic å…·æœ‰ç›¸åŒçš„è§„åˆ™é™¤äº† SourceAlpha åªä½¿ç”¨å…ƒç´ çš„é€æ˜åº¦ã€‚-   BackgroundImageï¼šè¯¥å…³é”®è¯è¡¨ç¤º filter å…ƒç´ å½“å‰åº•ä¸‹çš„åŒºåŸŸçš„å›¾å½¢å¿«ç…§å°†è¢«è°ƒç”¨ã€‚-   BackgroundAlphaï¼šBackgroundImage ç›¸åŒé™¤äº†åªä½¿ç”¨é€æ˜åº¦ã€‚-   FillPaintï¼šæ­¤å…³é”®å­—è¡¨ç¤ºè¿‡æ»¤æ•ˆæœçš„ç›®æ ‡å…ƒç´ ä¸Šçš„`fill`å±æ€§å€¼ã€‚åœ¨è®¸å¤šæƒ…å†µä¸‹ï¼ŒFillPaint åœ¨ä»»ä½•åœ°æ–¹éƒ½æ˜¯ä¸é€æ˜çš„ï¼Œä½†å¦‚æœå½¢çŠ¶æ˜¯ä½¿ç”¨æ¸å˜æˆ–å›¾æ¡ˆç»˜åˆ¶çš„ï¼Œå®ƒæœ¬èº«åŒ…æ‹¬é€æ˜æˆ–åŠé€æ˜éƒ¨åˆ†ï¼Œåˆ™æƒ…å†µå¯èƒ½å¹¶éå¦‚æ­¤ã€‚-   StrokePaintï¼šæ­¤å…³é”®å­—è¡¨ç¤ºæ»¤é•œæ•ˆæœçš„ç›®æ ‡å…ƒç´ ä¸Šçš„ç¬”ç”»å±æ€§çš„å€¼ã€‚åœ¨è®¸å¤šæƒ…å†µä¸‹ï¼ŒStrokePaint åœ¨ä»»ä½•åœ°æ–¹éƒ½æ˜¯ä¸é€æ˜çš„ï¼Œä½†å¦‚æœå½¢çŠ¶æ˜¯ä½¿ç”¨æ¸å˜æˆ–å›¾æ¡ˆç»˜åˆ¶çš„ï¼Œå®ƒæœ¬èº«åŒ…æ‹¬é€æ˜æˆ–åŠé€æ˜éƒ¨åˆ†ï¼Œåˆ™æƒ…å†µå¯èƒ½å¹¶éå¦‚æ­¤ã€‚</code></pre><!----><p>  in2ï¼šin2 å±æ€§æ ‡è¯†ç»™å®šfilteråŸè¯­çš„ç¬¬äºŒä¸ªè¾“å…¥ã€‚å®ƒçš„å·¥ä½œåŸç†ä¸ in å±æ€§å®Œå…¨ç›¸åŒã€‚</p><blockquote><p>colorMatrixé¢œè‰²çŸ©é˜µå˜æ¢</p></blockquote><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* R G B A 1 é¢œè‰²çŸ©é˜µè®¡ç®— */</span></span><br><span class="line"> <span class="number">1</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="comment">// R = 1*R + 0*G + 0*B + 0*A + 0 </span></span><br><span class="line"> <span class="number">0</span> <span class="number">1</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="comment">// G = 0*R + 1*G + 0*B + 0*A + 0 </span></span><br><span class="line"> <span class="number">0</span> <span class="number">0</span> <span class="number">1</span> <span class="number">0</span> <span class="number">0</span> <span class="comment">// B = 0*R + 0*G + 1*B + 0*A + 0 </span></span><br><span class="line"> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1</span> <span class="number">0</span> <span class="comment">// A = 0*R + 0*G + 0*B + 1*A + 0</span></span><br></pre></td></tr></table></figure><iframe height="300" style="width: 100%;" scrolling="no" title="feDisplacementMap" src="https://codepen.io/l-jour/embed/xxWzjde?default-tab=html%2Cresult" frameborder="no" loading="lazy" allowtransparency="true" allowfullscreen="true">  See the Pen <a href="https://codepen.io/l-jour/pen/xxWzjde"></a> by L-jour (<a href="https://codepen.io/l-jour">@l-jour</a>)  on <a href="https://codepen.io">CodePen</a>.</iframe><blockquote><p>ä½¿ç”¨feGaussianBlurã€feColorMatrixã€feBlendå®ç°ç²˜ç¨ æ•ˆæœ</p></blockquote><iframe height="300" style="width: 100%;" scrolling="no" title="feDisplacementMap" src="https://codepen.io/l-jour/embed/JjLZbQO?default-tab=html%2Cresult" frameborder="no" loading="lazy" allowtransparency="true" allowfullscreen="true">  See the Pen <a href="https://codepen.io/l-jour/pen/JjLZbQO"></a> by L-jour (<a href="https://codepen.io/l-jour">@l-jour</a>)  on <a href="https://codepen.io">CodePen</a>.</iframe><blockquote><p>ä½¿ç”¨feCompositeå¹¶è®¾ç½®operatorä¸ºinï¼Œæ§åˆ¶æ˜¾ç¤ºå›¾åƒçš„ä¸€éƒ¨åˆ†ã€‚</p></blockquote><p>å…³äºfeCompositeï¼Œæ›´å¤šå¯ä»¥çœ‹è¿™é‡Œï¼š<a href="https://apike.ca/prog_svg_filter_feComposite.html">feComposite</a></p><iframe height="300" style="width: 100%;" scrolling="no" title="feDisplacementMap" src="https://codepen.io/l-jour/embed/wvmXOwZ?default-tab=html%2Cresult" frameborder="no" loading="lazy" allowtransparency="true" allowfullscreen="true">  See the Pen <a href="https://codepen.io/l-jour/pen/wvmXOwZ"></a> by L-jour (<a href="https://codepen.io/l-jour">@l-jour</a>)  on <a href="https://codepen.io">CodePen</a>.</iframe><blockquote><p>feDisplacementMapã€feTurbulence</p></blockquote><p>feDisplacementMapæ¨èçœ‹è¿™ç¯‡ï¼š<a href="https://www.zhangxinxu.com/wordpress/2017/12/understand-svg-fedisplacementmap-filter/">æ·±å…¥ç†è§£SVG feDisplacementMapæ»¤é•œåŠå®é™…åº”ç”¨</a></p><p>feTurbulenceæ¨èçœ‹è¿™ç¯‡ï¼š<a href="https://zhuanlan.zhihu.com/p/366438535">è¯´è¯´SVGçš„feTurbulenceæ»¤é•œ</a></p><p>ä½ç½®è½¬æ¢å…¬å¼ï¼š</p><p><code>P&#39;(x,y) â† P(x + scale * (XC(x,y) - 0.5), y + scale * (YC(x,y) - 0.5))</code></p><iframe height="300" style="width: 100%;" scrolling="no" title="feDisplacementMap" src="https://codepen.io/l-jour/embed/OJvwJqV?default-tab=html%2Cresult" frameborder="no" loading="lazy" allowtransparency="true" allowfullscreen="true">  See the Pen <a href="https://codepen.io/l-jour/pen/OJvwJqV"></a> by L-jour (<a href="https://codepen.io/l-jour">@l-jour</a>)  on <a href="https://codepen.io">CodePen</a>.</iframe><h2 id="æ¸å˜å…ƒç´ "><a href="#æ¸å˜å…ƒç´ " class="headerlink" title="æ¸å˜å…ƒç´ "></a>æ¸å˜å…ƒç´ </h2><h3 id="linearGradientï¼šçº¿æ€§æ¸å˜"><a href="#linearGradientï¼šçº¿æ€§æ¸å˜" class="headerlink" title="linearGradientï¼šçº¿æ€§æ¸å˜"></a>linearGradientï¼šçº¿æ€§æ¸å˜</h3><ul><li>  gradientUnits: æ§åˆ¶æ¸å˜åæ ‡çš„å•ä½</li><li>  gradientTransform: å¯¹æ¸å˜åæ ‡ç³»è¿›è¡Œå˜æ¢ï¼ˆtranslateã€skewã€rotateã€‚ã€‚ã€‚ï¼‰</li><li>  x1ï¼šçº¿æ€§æ¸å˜èµ·ç‚¹xåæ ‡-   y1ï¼šçº¿æ€§æ¸å˜èµ·ç‚¹yåæ ‡</li><li>  x2ï¼šçº¿æ€§æ¸å˜ç»ˆç‚¹xåæ ‡-   y2ï¼šçº¿æ€§æ¸å˜ç»ˆç‚¹yåæ ‡</li><li>  spreadMethodï¼šå®šä¹‰å¦‚ä½•åœ¨æ¸å˜ä¹‹å¤–å¡«å……    -   padï¼šç”¨æ¸å˜ç»ˆç‚¹é¢œè‰²å»å¡«å……é¢å¤–åŒºåŸŸ    -   repeatï¼šæŒ‰ç…§å¼€å§‹çš„æ¸å˜é¡ºåºé‡å¤    -   reflectï¼šæŒ‰ç…§å¼€å§‹çš„æ¸å˜ç›¸åé¡ºåºé‡å¤</li></ul>  <iframe height="300" style="width: 100%;" scrolling="no" title="feDisplacementMap" src="https://codepen.io/l-jour/embed/JjLMMjR?default-tab=html%2Cresult" frameborder="no" loading="lazy" allowtransparency="true" allowfullscreen="true">    See the Pen <a href="https://codepen.io/l-jour/pen/JjLMMjR"></a> by L-jour (<a href="https://codepen.io/l-jour">@l-jour</a>)    on <a href="https://codepen.io">CodePen</a>.  </iframe><h3 id="radialGradientï¼šå¾„å‘æ¸å˜"><a href="#radialGradientï¼šå¾„å‘æ¸å˜" class="headerlink" title="radialGradientï¼šå¾„å‘æ¸å˜"></a>radialGradientï¼šå¾„å‘æ¸å˜</h3><ul><li>  gradientUnitsï¼šæ§åˆ¶æ¸å˜åæ ‡çš„å•ä½</li><li>  gradientTransformï¼šå¯¹æ¸å˜åæ ‡ç³»è¿›è¡Œå˜æ¢ï¼ˆtranslateã€skewã€rotateã€‚ã€‚ã€‚ï¼‰</li><li>  cx: ç”¨æ¥å®šä¹‰å¾„å‘æ¸å˜ç»ˆæ­¢åœ†çš„ x è½´åæ ‡(é»˜è®¤50%)ã€‚</li><li>  cyï¼šç”¨æ¥å®šä¹‰å¾„å‘æ¸å˜ç»ˆæ­¢åœ†çš„ y è½´åæ ‡ã€‚</li><li>  rï¼šç”¨æ¥å®šä¹‰å¾„å‘æ¸å˜ç»ˆæ­¢åœ†çš„åŠå¾„ã€‚</li><li>  fxï¼šç”¨æ¥å®šä¹‰å¾„å‘æ¸å˜çš„ç„¦ç‚¹çš„ x è½´åæ ‡</li><li>  fyï¼šç”¨æ¥å®šä¹‰å¾„å‘æ¸å˜çš„ç„¦ç‚¹çš„ y è½´åæ ‡</li><li>  spreadMethodï¼šç¡®å®šå¦‚ä½•åœ¨æ¸å˜çš„å®šä¹‰è¾¹ç¼˜ä¹‹å¤–å¡«å……å½¢çŠ¶ã€‚    -   padï¼šç”¨æ¸å˜ç»ˆç‚¹é¢œè‰²å»å¡«å……é¢å¤–åŒºåŸŸ    -   repeatï¼šæŒ‰ç…§å¼€å§‹çš„æ¸å˜é¡ºåºé‡å¤    -   reflectï¼šæŒ‰ç…§å¼€å§‹çš„æ¸å˜ç›¸åé¡ºåºé‡å¤</li><li>  stopï¼šæ¸å˜çš„é¢œè‰²å¡åº¦</li></ul><iframe height="300" style="width: 100%;" scrolling="no" title="svg-radialgradient" src="https://codepen.io/l-jour/embed/zYWWLBa?default-tab=html%2Cresult" frameborder="no" loading="lazy" allowtransparency="true" allowfullscreen="true">  See the Pen <a href="https://codepen.io/l-jour/pen/zYWWLBa">  svg-radialgradient</a> by L-jour (<a href="https://codepen.io/l-jour">@l-jour</a>)  on <a href="https://codepen.io">CodePen</a>.</iframe><h2 id="å…³äºsvgä¸canvas"><a href="#å…³äºsvgä¸canvas" class="headerlink" title="å…³äºsvgä¸canvas"></a>å…³äºsvgä¸canvas</h2><p>  å¯ä»¥çœ‹çœ‹msdnçš„æ–‡ç« <a href="https://docs.microsoft.com/zh-cn/previous-versions/msdn10/Hh377884(v=MSDN.10)">å¦‚ä½•ä¸ºæ‚¨çš„ç½‘ç«™åœ¨Canvaså’ŒSVGä¹‹é—´åšå‡ºé€‰æ‹©</a></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>  svgçš„ä¸–ç•Œéå¸¸ä¸°å¯Œï¼Œå¹¶ä¸”å¾ˆå¤šå±æ€§å¯ä»¥ä½œç”¨ä¸åŒçš„å…ƒç´ ã€æ‹¥æœ‰ä¸åŒçš„æ•ˆæœã€‚å…ƒç´ ç›´æ¥æœ‰å¯ä»¥æ­é…ä½¿ç”¨ï¼Œå¦‚å¤šä¸ªåŠ¨ç”»ï¼Œå¤šä¸ªæ»¤é•œç­‰ç­‰ï¼Œæ»¤é•œå…ƒç´ è¿˜æ¶‰åŠæ›´å¤šé¢†åŸŸçŸ¥è¯†ã€‚æ€»ä¹‹ï¼Œå…ƒç´ ç§ç±»ã€å…ƒç´ å±æ€§éå¸¸å¤šï¼Œè¿˜æ˜¯éœ€è¦å¾—æ…¢æ…¢åœ°å­¦ä¹ ã€é˜…è¯»ç›¸å…³çš„æ¡ˆä¾‹å¹¶æ“ä½œä¸€ä¸‹æ‰èƒ½æœ‰æ‰€æŒæ¡ã€‚</p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul><li>  <a href="https://apike.ca/prog_svg_filter_feComposite.html">feComposite</a></li><li>  <a href="https://zh.wikipedia.org/zh-cn/%E8%B2%9D%E8%8C%B2%E6%9B%B2%E7%B7%9A">è´å¡å°”æ›²çº¿-wiki</a></li></ul>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;å®šä¹‰&quot;&gt;&lt;a href=&quot;#å®šä¹‰&quot; class=&quot;headerlink&quot; title=&quot;å®šä¹‰&quot;&gt;&lt;/a&gt;å®šä¹‰&lt;/h2&gt;&lt;p&gt;svgï¼ˆScalable Vector Graphicsï¼‰å¯ç¼©æ”¾çš„çŸ¢é‡å›¾å½¢ï¼Œæ˜¯ W3C XML çš„åˆ†æ”¯è¯­è¨€ä¹‹ä¸€ï¼Œç”¨äºæ ‡è®°å¯ç¼©æ”¾çš„çŸ¢é‡å›¾å½¢ã€‚&lt;/p&gt;</summary>
    
    
    
    
  </entry>
  
  <entry>
    <title>reactäº‹ä»¶ç³»ç»Ÿ</title>
    <link href="https://jealh.xyz/2022/05/01/react%E5%90%88%E6%88%90%E4%BA%8B%E4%BB%B6/"/>
    <id>https://jealh.xyz/2022/05/01/react%E5%90%88%E6%88%90%E4%BA%8B%E4%BB%B6/</id>
    <published>2022-05-01T15:06:13.000Z</published>
    <updated>2022-12-31T10:26:33.588Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å¼€å§‹æ³¨å†Œäº‹ä»¶"><a href="#å¼€å§‹æ³¨å†Œäº‹ä»¶" class="headerlink" title="å¼€å§‹æ³¨å†Œäº‹ä»¶"></a>å¼€å§‹æ³¨å†Œäº‹ä»¶</h2><ul><li>è¿™é‡Œåªæ˜¯ç®€å•çš„è®¾ç½®ä¸€äº›å˜é‡å€¼ï¼Œè§ä¸‹é¢ä»£ç </li></ul><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ³¨å†Œäº‹ä»¶</span></span><br><span class="line"><span class="comment">// DOMPluginEventSystem.ts</span></span><br><span class="line">SimpleEventPlugin.registerEvents();</span><br><span class="line">EnterLeaveEventPlugin.registerEvents();</span><br><span class="line">ChangeEventPlugin.registerEvents();</span><br><span class="line">SelectEventPlugin.registerEvents();</span><br><span class="line">BeforeInputEventPlugin.registerEvents();</span><br></pre></td></tr></table></figure><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="attr">allNativeEvent</span>:<span class="built_in">Set</span>&lt;DOMEventName&gt; = &#123;<span class="string">&#x27;click&#x27;</span>,<span class="string">&#x27;keyup&#x27;</span>,<span class="string">&#x27;keydown&#x27;</span>,...&#125;;</span><br><span class="line"></span><br><span class="line">registrationNameDependencies[<span class="string">&quot;onClick&quot;</span>] = [<span class="string">&quot;click&quot;</span>];</span><br><span class="line">registrationNameDependencies[<span class="string">&#x27;onMouseEnter&#x27;</span>] = [<span class="string">&#x27;mouseout&#x27;</span>, <span class="string">&#x27;mouseover&#x27;</span>]; <span class="comment">//...</span></span><br><span class="line"></span><br><span class="line">topLevelEventsToReactNames:<span class="built_in">Map</span>&lt;DOMEventName,<span class="built_in">string</span>|<span class="literal">null</span>&gt; = &#123;<span class="string">&quot;click&quot;</span>:<span class="string">&quot;onClick&quot;</span>&#125;;</span><br></pre></td></tr></table></figure><span id="more"></span><h2 id="å¤§è‡´æµç¨‹"><a href="#å¤§è‡´æµç¨‹" class="headerlink" title="å¤§è‡´æµç¨‹"></a>å¤§è‡´æµç¨‹</h2><p><img src="https://cdn.jsdelivr.net/gh/PancakeDogLLL/imageBed/img/202205062357.png" alt="flowchart"></p><h2 id="listenToAllSupportedEvent"><a href="#listenToAllSupportedEvent" class="headerlink" title="listenToAllSupportedEvent"></a>listenToAllSupportedEvent</h2><ul><li>æ¥ä¸‹æ¥æ˜¯è®©rootå®¹å™¨ç›‘å¬æ‰€æœ‰æ”¯æŒçš„äº‹ä»¶</li></ul><p>éå§”æ‰˜äº‹ä»¶åªæœ‰æ•è·é˜¶æ®µã€‚<br>è€Œå§”æ‰˜äº‹ä»¶æ•è·å†’æ³¡éƒ½ä¼šç»‘å®šã€‚</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">allNativeEvents.forEach(<span class="function"><span class="params">domEventName</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// æˆ‘ä»¬å•ç‹¬å¤„ç†selectionchangeæ›´æ”¹ï¼Œå› ä¸ºå®ƒä¸ä¼šå†’æ³¡ï¼Œéœ€è¦å‡ºç°åœ¨documentä¸Š</span></span><br><span class="line">  <span class="keyword">if</span> (domEventName !== <span class="string">&#x27;selectionchange&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!nonDelegatedEvents.has(domEventName)) &#123;</span><br><span class="line">      <span class="comment">// ä¸æ•è·</span></span><br><span class="line">      listenToNativeEvent(domEventName, <span class="literal">false</span>, rootContainerElement);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// nonDelegatedEventsäº‹ä»¶æ˜¯æ˜¯æ•è·é˜¶æ®µç›‘å¬å™¨</span></span><br><span class="line">    <span class="comment">// delegatedEventsæ˜¯å†’æ³¡æ•è·éƒ½æœ‰</span></span><br><span class="line">    listenToNativeEvent(domEventName, <span class="literal">true</span>, rootContainerElement);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>**<em>æ³¨æ„ï¼š</em>**selectionChangeäº‹ä»¶æ˜¯ç›‘å¬åœ¨documentä¸Šçš„ï¼Œå› ä¸ºå®ƒä¸ä¼šå†’æ³¡ã€‚</p><h2 id="ç»‘å®šreactçš„listeneråˆ°root-documentä¸Š"><a href="#ç»‘å®šreactçš„listeneråˆ°root-documentä¸Š" class="headerlink" title="ç»‘å®šreactçš„listeneråˆ°root || documentä¸Š"></a>ç»‘å®šreactçš„listeneråˆ°root || documentä¸Š</h2><p>listenToNativeEvent <strong>â€“&gt;</strong> addTrappedEventListener <strong>â€“&gt;</strong> listener = createEventListenerWrapperWithPriority</p><h2 id="createEventListenerWrapperWithPriority"><a href="#createEventListenerWrapperWithPriority" class="headerlink" title="createEventListenerWrapperWithPriority"></a>createEventListenerWrapperWithPriority</h2><p>è¿™é‡Œè¿›è¡Œåˆ›å»ºlistener,listeneræœ‰å¦‚ä¸‹å‡ ç§ï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createEventListenerWrapperWithPriority</span>(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function">  targetContainer: EventTarget,</span></span></span><br><span class="line"><span class="params"><span class="function">  domEventName: DOMEventName,</span></span></span><br><span class="line"><span class="params"><span class="function">  eventSystemFlags: EventSystemFlags,</span></span></span><br><span class="line"><span class="params"><span class="function"></span>): <span class="title">Function</span> </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> eventPriority = getEventPriority(domEventName);</span><br><span class="line">  <span class="keyword">let</span> listenerWrapper;</span><br><span class="line">  <span class="keyword">switch</span> (eventPriority) &#123;</span><br><span class="line">    <span class="comment">// ä¸€èˆ¬äº‹ä»¶éƒ½æ˜¯DiscreteEventPriority</span></span><br><span class="line">    <span class="keyword">case</span> DiscreteEventPriority:</span><br><span class="line">      listenerWrapper = dispatchDiscreteEvent;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> ContinuousEventPriority:</span><br><span class="line">      listenerWrapper = dispatchContinuousEvent;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> DefaultEventPriority:</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      listenerWrapper = dispatchEvent;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> listenerWrapper.bind(</span><br><span class="line">    <span class="literal">null</span>,</span><br><span class="line">    domEventName,</span><br><span class="line">    eventSystemFlags,</span><br><span class="line">    targetContainer,</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸‰ç§listenerå­˜åœ¨ä¸€ä¸ªä¼˜å…ˆçº§çš„å·®åˆ«ã€‚<br>æœ€ç»ˆéƒ½ä¼šè°ƒç”¨dispatchEvent.</p><h2 id="dispatchEvent"><a href="#dispatchEvent" class="headerlink" title="dispatchEvent"></a>dispatchEvent</h2><ul><li>è¿™æ˜¯reactè¿›è¡Œè§¦å‘äº‹ä»¶ç›‘å¬å‡½æ•°çš„åœ°æ–¹ï¼Œè¿™é‡Œçš„listeneræ˜¯ç»‘å®šåˆ°ç»„ä»¶propsä¸Šçš„äº‹ä»¶å¤„ç†å‡½æ•°ã€‚</li></ul><p>é¦–å…ˆåˆ¤æ–­æ˜¯å¦æ˜¯allowReplayäº‹ä»¶ï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> allowReplay = (eventSystemFlags &amp; IS_CAPTURE_PHASE) === <span class="number">0</span>;</span><br><span class="line"><span class="comment">// eventSystemFlags captureæ—¶ç­‰äº4,bubbleæ—¶ç­‰äº0</span></span><br><span class="line"><span class="comment">// capture &amp; 4 = 4; bubble &amp; 4 = 0</span></span><br><span class="line"><span class="comment">// IS_CAPTURE_PHASE = 4</span></span><br></pre></td></tr></table></figure><p>ç„¶åæ˜¯å…ˆå»å°è¯•è°ƒåº¦äº‹ä»¶,åˆ¤å®šæ˜¯å¦ä¼šblockOnï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> blockedOn = attemptToDispatchEvent(</span><br><span class="line">  domEventName,</span><br><span class="line">  eventSystemFlags,</span><br><span class="line">  targetContainer,</span><br><span class="line">  nativeEvent,</span><br><span class="line">);</span><br></pre></td></tr></table></figure><h2 id="attemptToDispatchEvent"><a href="#attemptToDispatchEvent" class="headerlink" title="attemptToDispatchEvent"></a>attemptToDispatchEvent</h2><ol><li>å…ˆæ˜¯è·å–çœŸæ­£çš„äº‹ä»¶è§¦å‘å…ƒç´ ï¼še.targeï¼Œè¿™é‡Œç§°ä¸ºnativeEventTarget</li><li>è·å–nativeEventTargetä¸Šçš„Fiber,å³â€__reactFiber${Randomâ€¦}â€å±æ€§ã€‚è¿™é‡Œæ˜¯targetInst.</li><li>å¤„ç†è®©targetInstä¸ºnullçš„æƒ…å†µã€‚<ol><li>èŠ‚ç‚¹è¢«unmounted,å³ä¸èƒ½é€šè¿‡returnå±æ€§åˆ°è¾¾æ ¹èŠ‚ç‚¹ã€‚</li><li>å¦‚æœæœ€è¿‘çš„mountedæ˜¯SuspenseCompnent | HostRoot | æœ€è¿‘çš„mountedFiber  !== targetInst</li></ol></li></ol><p>æ¥ä¸‹æ¥è¿›å…¥çœŸæ­£çš„äº‹ä»¶è°ƒåº¦å‡½æ•°ã€‚</p><h2 id="dispatchEventForPluginEventSystem"><a href="#dispatchEventForPluginEventSystem" class="headerlink" title="dispatchEventForPluginEventSystem"></a>dispatchEventForPluginEventSystem</h2><ul><li>åœ¨è¿™é‡Œé¢ï¼Œä¼šæœ‰ä¸€ä¸ªmainLoop,å»å¯»æ‰¾ä¸€ä¸ªrootèŠ‚ç‚¹ï¼Œå› ä¸ºåœ¨rootèŠ‚ç‚¹ä¸Šï¼Œä¼šç»‘å®šä¸€äº›äº‹ä»¶ã€‚</li><li>éå†çš„æ–¹å¼æ˜¯ä»å½“å‰èŠ‚ç‚¹ä¸€ç›´å¾€ä¸Šï¼ˆreturnï¼‰.</li><li>æœ€åbatchedEventUpdates â€”&gt; dispatchEventsForPlugins</li></ul><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// DOMPluginEventSystem</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">dispatchEventForPluginEventSystem</span>(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function">  domEventName: DOMEventName,</span></span></span><br><span class="line"><span class="params"><span class="function">  eventSystemFlags: EventSystemFlags,</span></span></span><br><span class="line"><span class="params"><span class="function">  nativeEvent: AnyNativeEvent,</span></span></span><br><span class="line"><span class="params"><span class="function">  targetInst: <span class="literal">null</span> | Fiber, <span class="comment">// è§¦å‘äº‹ä»¶çš„Fiber</span></span></span></span><br><span class="line"><span class="params"><span class="function">  targetContainer: EventTarget, <span class="comment">// root</span></span></span></span><br><span class="line"><span class="params"><span class="function"></span>): <span class="title">void</span> </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> ancestorInst = targetInst;</span><br><span class="line">  <span class="keyword">if</span> (</span><br><span class="line">    (eventSystemFlags &amp; IS_EVENT_HANDLE_NON_MANAGED_NODE) === <span class="number">0</span> &amp;&amp;</span><br><span class="line">    (eventSystemFlags &amp; IS_NON_DELEGATED) === <span class="number">0</span></span><br><span class="line">  ) &#123;</span><br><span class="line">    <span class="keyword">const</span> targetContainerNode = targetContainer <span class="keyword">as</span> Node;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (targetInst !== <span class="literal">null</span>) &#123;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">let</span> node = targetInst;</span><br><span class="line">      mainLoop: <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">        <span class="comment">// ...æœç´¢root container</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  batchedEventUpdates(<span class="function">() =&gt;</span></span><br><span class="line">  <span class="comment">// è¿›å…¥åˆæˆäº‹ä»¶ç³»ç»Ÿ</span></span><br><span class="line">    dispatchEventsForPlugins(</span><br><span class="line">      domEventName,</span><br><span class="line">      eventSystemFlags,</span><br><span class="line">      nativeEvent,</span><br><span class="line">      ancestorInst,</span><br><span class="line">      targetContainer,</span><br><span class="line">    ),</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="dispatchEventsForPlugins"><a href="#dispatchEventsForPlugins" class="headerlink" title="dispatchEventsForPlugins"></a>dispatchEventsForPlugins</h2><ul><li>å°†nativeEventè½¬æ¢æˆsynthesizeEvent,å¹¶åŠ å…¥dispatchQueueï¼Œæœ€ç»ˆprocessDispatchQueueã€‚</li></ul><p><em>extractEvents:</em></p><blockquote><p>åˆ›å»ºDispatchEntry:{event:listeners}ï¼Œå¹¶æ·»åŠ åˆ°dispatchQueue</p></blockquote><ol><li>å·¥å‚æ¨¡å¼ç¡®å®šSyntheticEventCtor</li><li>accumulateSinglePhaseListenersä»targetåˆ°rootéå†ï¼Œè·å–ç»‘å®šåˆ°propsçš„äº‹ä»¶å¤„ç†å‡½æ•°ï¼Œæ·»åŠ ç”¨æˆ·è‡ªå·±æ·»åŠ çš„äº‹ä»¶å¤„ç†å‡½æ•°åˆ°listenersæ•°ç»„é‡Œå¹¶è¿”å›ã€‚</li><li>dispatchQueue.push({event,listeners})<br>è¿™é‡Œeventä¹Ÿå°±æ˜¯synthesizeEventå¯¹è±¡ï¼Œå³åœ¨äº‹ä»¶ç»‘å®šåçš„å›è°ƒå‡½æ•°çš„é»˜è®¤å‚æ•°event.</li></ol><p><em>processDispatchQueue:</em></p><blockquote><p>éå†dispatchQueue,å¤„ç†æ¯ä¸ªäº‹ä»¶çš„listenersæ•°ç»„</p></blockquote><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è°ƒç”¨processDispatchQueueItemsInOrderï¼Œæ‰§è¡Œäº‹ä»¶å¤„ç†å‡½æ•°</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Array&lt;&#123;</span></span></span></span><br><span class="line"><span class="type"><span class="doctag"><span class="comment"> * event: ReactSyntheticEvent,</span></span></span></span><br><span class="line"><span class="type"><span class="doctag"><span class="comment"> * listeners: Array&lt;&#123;</span></span></span></span><br><span class="line"><span class="type"><span class="doctag"><span class="comment"> * instance: null | Fiber,</span></span></span></span><br><span class="line"><span class="type"><span class="doctag"><span class="comment"> * listener: Function,</span></span></span></span><br><span class="line"><span class="type"><span class="doctag"><span class="comment"> * currentTarget: EventTarget,</span></span></span></span><br><span class="line"><span class="type"><span class="doctag"><span class="comment"> * &#125;</span></span>&gt;&#125;&#125; dispatchQueue</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;EventSystemFlags&#125;</span> <span class="variable">eventSystemFlags</span></span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">processDispatchQueue</span>(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function">  dispatchQueue: DispatchQueue,</span></span></span><br><span class="line"><span class="params"><span class="function">  eventSystemFlags: EventSystemFlags,</span></span></span><br><span class="line"><span class="params"><span class="function"></span>): <span class="title">void</span> </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> inCapturePhase = (eventSystemFlags &amp; IS_CAPTURE_PHASE) !== <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; dispatchQueue.length; i++) &#123;</span><br><span class="line">    <span class="comment">// &#123; event: ReactSyntheticEvent,listeners: Array &lt; DispatchListener &gt;&#125;;</span></span><br><span class="line">    <span class="keyword">const</span> &#123; event, listeners &#125; = dispatchQueue[i];</span><br><span class="line"></span><br><span class="line">    processDispatchQueueItemsInOrder(event, listeners, inCapturePhase);</span><br><span class="line">    <span class="comment">//  event system doesn&#x27;t use pooling.</span></span><br><span class="line">    <span class="comment">// äº‹ä»¶ç³»ç»Ÿä¸ä½¿ç”¨æ± ã€‚</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// This would be a good time to rethrow if any of the event handlers threw.</span></span><br><span class="line">  rethrowCaughtError();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>processDispatchQueueItemsInOrder</li></ul><blockquote><p>æ ¹æ®inCapturePhaseåˆ¤å®šæ˜¯captureè¿˜æ˜¯bubble,</p></blockquote><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ‰§è¡Œäº‹ä»¶é˜Ÿåˆ—ï¼Œæ ¹æ®æ˜¯å¦æ•è·ç¡®å®šäº‹ä»¶çš„æ‰§è¡Œé¡ºåº</span></span><br><span class="line"><span class="comment"> * []dispatchListeners</span></span><br><span class="line"><span class="comment"> * æ•è·ï¼šé‡æœ€åä¸€ä¸ªåˆ°ç¬¬ä¸€ä¸ª</span></span><br><span class="line"><span class="comment"> * å†’æ³¡ï¼šé‡0åˆ°æœ€åä¸€ä¸ª</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;ReactSyntheticEvent&#125;</span> <span class="variable">event</span></span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Array&lt;DispatchListener&gt;&#125;</span> <span class="variable">dispatchListeners</span></span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;boolean&#125;</span> <span class="variable">inCapturePhase</span></span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">processDispatchQueueItemsInOrder</span>(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function">  event: ReactSyntheticEvent,</span></span></span><br><span class="line"><span class="params"><span class="function">  dispatchListeners: <span class="built_in">Array</span>&lt;DispatchListener&gt;,</span></span></span><br><span class="line"><span class="params"><span class="function">  inCapturePhase: <span class="built_in">boolean</span>,</span></span></span><br><span class="line"><span class="params"><span class="function"></span>): <span class="title">void</span> </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> previousInstance;</span><br><span class="line">  <span class="comment">// æ•è·</span></span><br><span class="line">  <span class="comment">// å› ä¸ºæ·»åŠ dispatcheræ—¶æ˜¯ä»å½“å‰ç„¶åreturnåˆ°null,æ‰€ä»¥æ•è·æ˜¯å€’è¿‡æ¥çš„è¿è¡Œ</span></span><br><span class="line">  <span class="keyword">if</span> (inCapturePhase) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = dispatchListeners.length - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">      <span class="comment">// &#123; instance: null | Fiber,listener: Function,currentTarget: EventTarget&#125;;</span></span><br><span class="line">      <span class="keyword">const</span> &#123; instance, currentTarget, listener &#125; = dispatchListeners[i];</span><br><span class="line"></span><br><span class="line">      <span class="comment">// é˜»æ­¢å†’æ³¡stopPropagation</span></span><br><span class="line">      <span class="keyword">if</span> (instance !== previousInstance &amp;&amp; event.isPropagationStopped()) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      executeDispatch(event, listener, currentTarget);</span><br><span class="line">      previousInstance = instance;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; dispatchListeners.length; i++) &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123; instance, currentTarget, listener &#125; = dispatchListeners[i];</span><br><span class="line">      <span class="keyword">if</span> (instance !== previousInstance &amp;&amp; event.isPropagationStopped()) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      executeDispatch(event, listener, currentTarget);</span><br><span class="line">      previousInstance = instance;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="executeDispatch"><a href="#executeDispatch" class="headerlink" title="executeDispatch"></a>executeDispatch</h2><ul><li>æœ€ç»ˆè°ƒç”¨ç”¨æˆ·çš„å¤„ç†å‡½æ•°,å…¶ä¸­åŒ…å«ä¸€äº›reactçš„invokeå‡½æ•°ï¼Œä»¥åŠä¸€äº›åœ¨å¼€å‘ç¯å¢ƒä¸‹çš„createEventäº‹ä»¶ã€‚</li></ul><blockquote><p>æœ¬æ–‡è¿˜æœ‰è®¸å¤šç»†èŠ‚æ²¡æœ‰æåˆ°ï¼Œåªæ˜¯å¤§è‡´è¯´æ˜äº†äº‹ä»¶ç³»ç»Ÿçš„ä¸€ä¸ªæµç¨‹</p></blockquote><h2 id="æœªå®Œå¾…ç»­"><a href="#æœªå®Œå¾…ç»­" class="headerlink" title="æœªå®Œå¾…ç»­"></a>æœªå®Œå¾…ç»­</h2>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;å¼€å§‹æ³¨å†Œäº‹ä»¶&quot;&gt;&lt;a href=&quot;#å¼€å§‹æ³¨å†Œäº‹ä»¶&quot; class=&quot;headerlink&quot; title=&quot;å¼€å§‹æ³¨å†Œäº‹ä»¶&quot;&gt;&lt;/a&gt;å¼€å§‹æ³¨å†Œäº‹ä»¶&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;è¿™é‡Œåªæ˜¯ç®€å•çš„è®¾ç½®ä¸€äº›å˜é‡å€¼ï¼Œè§ä¸‹é¢ä»£ç &lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight typescript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// æ³¨å†Œäº‹ä»¶&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// DOMPluginEventSystem.ts&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;SimpleEventPlugin.registerEvents();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;EnterLeaveEventPlugin.registerEvents();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;ChangeEventPlugin.registerEvents();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;SelectEventPlugin.registerEvents();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;BeforeInputEventPlugin.registerEvents();&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;figure class=&quot;highlight typescript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;attr&quot;&gt;allNativeEvent&lt;/span&gt;:&lt;span class=&quot;built_in&quot;&gt;Set&lt;/span&gt;&amp;lt;DOMEventName&amp;gt; = &amp;#123;&lt;span class=&quot;string&quot;&gt;&amp;#x27;click&amp;#x27;&lt;/span&gt;,&lt;span class=&quot;string&quot;&gt;&amp;#x27;keyup&amp;#x27;&lt;/span&gt;,&lt;span class=&quot;string&quot;&gt;&amp;#x27;keydown&amp;#x27;&lt;/span&gt;,...&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;registrationNameDependencies[&lt;span class=&quot;string&quot;&gt;&amp;quot;onClick&amp;quot;&lt;/span&gt;] = [&lt;span class=&quot;string&quot;&gt;&amp;quot;click&amp;quot;&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;registrationNameDependencies[&lt;span class=&quot;string&quot;&gt;&amp;#x27;onMouseEnter&amp;#x27;&lt;/span&gt;] = [&lt;span class=&quot;string&quot;&gt;&amp;#x27;mouseout&amp;#x27;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&amp;#x27;mouseover&amp;#x27;&lt;/span&gt;]; &lt;span class=&quot;comment&quot;&gt;//...&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;topLevelEventsToReactNames:&lt;span class=&quot;built_in&quot;&gt;Map&lt;/span&gt;&amp;lt;DOMEventName,&lt;span class=&quot;built_in&quot;&gt;string&lt;/span&gt;|&lt;span class=&quot;literal&quot;&gt;null&lt;/span&gt;&amp;gt; = &amp;#123;&lt;span class=&quot;string&quot;&gt;&amp;quot;click&amp;quot;&lt;/span&gt;:&lt;span class=&quot;string&quot;&gt;&amp;quot;onClick&amp;quot;&lt;/span&gt;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="react" scheme="https://jealh.xyz/categories/react/"/>
    
    
  </entry>
  
  <entry>
    <title>ä¸€å°é˜¿é‡Œäº‘çš„å–èŒ¶é‚®ä»¶</title>
    <link href="https://jealh.xyz/2022/02/08/%E4%B8%80%E5%B0%81%E9%98%BF%E9%87%8C%E4%BA%91%E7%9A%84%E5%96%9D%E8%8C%B6%E9%82%AE%E4%BB%B6/"/>
    <id>https://jealh.xyz/2022/02/08/%E4%B8%80%E5%B0%81%E9%98%BF%E9%87%8C%E4%BA%91%E7%9A%84%E5%96%9D%E8%8C%B6%E9%82%AE%E4%BB%B6/</id>
    <published>2022-02-08T04:37:52.000Z</published>
    <updated>2022-12-31T10:26:33.596Z</updated>
    
    <content type="html"><![CDATA[<p>äº‹æƒ…æ˜¯è¿™æ ·çš„ï¼Œå°±åœ¨ä»Šå¤©æ—©ä¸Šï¼Œæ”¶åˆ°äº†ä¸€å°æ¥è‡ªé˜¿é‡Œäº‘çš„ã€å–èŒ¶ï¼ˆæ ¸æŸ¥ï¼‰é€šçŸ¥ã€‘ã€‚ä¸€çœ‹é‚®ä»¶ï¼Œå¾ˆæ˜æ˜¾å°±æ˜¯åŸŸåæ²¡æœ‰è§£æåˆ°å†…åœ°èŠ‚ç‚¹çš„æœåŠ¡å™¨ä¸Šé¢å‘¢ã€‚å›æƒ³ä¸€ä¸‹è‡ªå·±çš„è§£æï¼Œå®ƒè¯´çš„å¯¹ï¼ã€‚ã€‚ã€‚<br><img src="https://cdn.jsdelivr.net/gh/PancakeDogLLL/imageBed/img/202202081154.png" alt="why"></p><span id="more"></span><h2 id="åŸç”±"><a href="#åŸç”±" class="headerlink" title="åŸç”±"></a>åŸç”±</h2><p>åœ¨è€æ—©ä»¥å‰äº†ï¼Œæˆ‘ç”¨ hexo éƒ¨ç½² blog åœ¨ GitHub Page ä¸Šé¢ï¼Œç„¶åè§£æäº†è‡ªå·±çš„åŸŸååœ¨ gh-page ä¸Šï¼Œæ˜¾ç„¶ï¼ŒGitHub Page çš„æœåŠ¡å™¨ä¸åœ¨å†…åœ°ã€‚æˆ‘ä¸ºäº†è®¿é—®é€Ÿåº¦èƒ½å¿«é‚£ä¹ˆä¸€ä¸ç‚¹ï¼Œå°±ç»§ç»­ä½¿ç”¨äº† cloudflare çš„ cdn åŠ é€Ÿï¼Œå› æ­¤ä¹Ÿåœ¨ä¸Šé¢è®¾ç½®äº† DNSï¼Œä½†æ˜¯æˆ‘åœ¨ DNS ä¸Šä¹Ÿè§£æäº†ä¸€ä¸ªäºŒçº§åŸŸååˆ°äº†é˜¿é‡Œäº‘çš„æœåŠ¡å™¨ä¸Šå•Šã€‚æŒ‰ç…§ç½‘ä¸Šçš„è¯´æ³•ï¼Œè®¾ç½®ä¸€ä¸ªäºŒçº§åŸŸåè§£æåˆ°å†…åœ°æœåŠ¡å™¨å°±è¡Œäº†å‘¢ï¼Œç„¶åç‚¹å‡»å¤æŸ¥è¿æ¥åè¿˜æ˜¯æ£€æŸ¥æœ‰é—®é¢˜ã€‚</p><h2 id="è§£å†³"><a href="#è§£å†³" class="headerlink" title="è§£å†³"></a>è§£å†³</h2><p>é€šè¿‡åŸç”±çš„åˆ†æï¼Œæˆ‘è¿™æ¬¡å°†é—®é¢˜æ”¾åœ¨äº† cloudflare ä¸Šé¢ï¼Œçœ‹äº†ä¸€ä¸‹ DNS è®¾ç½®ã€‚<br><img src="https://cdn.jsdelivr.net/gh/PancakeDogLLL/imageBed/img/202202081207.png" alt="dns setting"><br>çœ‹åˆ°ä¸Šé¢çš„ä»£ç†çŠ¶æ€äº†å—ï¼Œæˆ‘å°±å¼€å§‹æ€€ç–‘æ˜¯è¿™ä¸ªçš„é—®é¢˜ï¼Œok,æŸ¥æŸ¥ä»€ä¹ˆæ„æ€ã€‚çœ‹åˆ°äº†ä¸‹é¢çš„ä¸€ä¸ªé—®é¢˜ã€‚<br><img src="https://cdn.jsdelivr.net/gh/PancakeDogLLL/imageBed/img/202202081210.png" alt="Q&amp;A proxy"><br>æŒ‰ç…§ä¸Šé¢çš„è¯´æ³•ï¼Œæ˜¾ç„¶ proxy å°±æ˜¯ä¸€ä¸ªä»£ç†ï¼Œè®¿é—®åŸŸåæ—¶ï¼Œå¦‚æœè®¾ç½®äº†ä»£ç†ï¼Œé‚£ä¹ˆå°±ä¼šèµ°ä»£ç†ï¼Œè€Œä¸æ˜¯ç›´æ¥èµ°è§£æåœ°å€ã€‚<br>é‚£æˆ‘ä»¬æ¥ ping ä¸€ä¸‹çœ‹çœ‹ã€‚<br><img src="https://cdn.jsdelivr.net/gh/PancakeDogLLL/imageBed/img/202202081213.png" alt="ping res"><br>ä¸Šé¢çš„ä¸¤ä¸ªåŸŸåå…¶å®æ˜¯åŒä¸€ä¸ª ip,ä½†æ˜¯ ping å‡ºæ¥å“åº”çš„ä¸ä¸€æ ·ï¼Œå› æ­¤ï¼Œç¡®å®æ˜¯æœ‰ä»£ç†çš„å­˜åœ¨ã€‚<br>æˆ‘è‡ªå·±çš„æœåŠ¡å™¨ ip æ˜¯ 47 å¼€å§‹çš„ï¼Œä¸Šé¢çš„ ping ç»“æœä¸€ä¸ªæ˜¯ cloudflare ä»£ç†çš„æœåŠ¡å™¨ï¼Œä¸€ä¸ªæ˜¯ gh-page çš„æœåŠ¡å™¨ã€‚<br>é‚£ä¹ˆå…³é—­ä»£ç†å°±å¯ä»¥äº†å—ï¼Ÿ<br>æ˜¯çš„ï¼Œå¯ä»¥äº†ã€‚<br><img src="https://cdn.jsdelivr.net/gh/PancakeDogLLL/imageBed/img/202202081229.jpg" alt="pre|left|350*0"><br><img src="https://cdn.jsdelivr.net/gh/PancakeDogLLL/imageBed/img/202202081231.png" alt="|right|250*0"><br><img src="https://cdn.jsdelivr.net/gh/PancakeDogLLL/imageBed/img/202202081217.png" alt="result"></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;äº‹æƒ…æ˜¯è¿™æ ·çš„ï¼Œå°±åœ¨ä»Šå¤©æ—©ä¸Šï¼Œæ”¶åˆ°äº†ä¸€å°æ¥è‡ªé˜¿é‡Œäº‘çš„ã€å–èŒ¶ï¼ˆæ ¸æŸ¥ï¼‰é€šçŸ¥ã€‘ã€‚ä¸€çœ‹é‚®ä»¶ï¼Œå¾ˆæ˜æ˜¾å°±æ˜¯åŸŸåæ²¡æœ‰è§£æåˆ°å†…åœ°èŠ‚ç‚¹çš„æœåŠ¡å™¨ä¸Šé¢å‘¢ã€‚å›æƒ³ä¸€ä¸‹è‡ªå·±çš„è§£æï¼Œå®ƒè¯´çš„å¯¹ï¼ã€‚ã€‚ã€‚&lt;br&gt;&lt;img src=&quot;https://cdn.jsdelivr.net/gh/PancakeDogLLL/imageBed/img/202202081154.png&quot; alt=&quot;why&quot;&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="ä¸€äº›è¶£äº‹çš„ğŸŒŸ" scheme="https://jealh.xyz/categories/%E4%B8%80%E4%BA%9B%E8%B6%A3%E4%BA%8B%E7%9A%84%F0%9F%8C%9F/"/>
    
    
  </entry>
  
  <entry>
    <title>èŠèŠJavaScriptäº‹ä»¶å¾ªç¯</title>
    <link href="https://jealh.xyz/2022/01/12/%E8%81%8A%E8%81%8AJavaScript%E4%BA%8B%E4%BB%B6%E5%BE%AA%E7%8E%AF/"/>
    <id>https://jealh.xyz/2022/01/12/%E8%81%8A%E8%81%8AJavaScript%E4%BA%8B%E4%BB%B6%E5%BE%AA%E7%8E%AF/</id>
    <published>2022-01-12T15:37:00.000Z</published>
    <updated>2022-12-31T10:26:33.600Z</updated>
    
    <content type="html"><![CDATA[<p><strong>äº‹æƒ…è¿˜å¾—ä»è¿™ä¹ˆä¸€é“é¢˜å¼€å§‹ï¼š</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> p = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;p&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;setTime&quot;</span>);</span><br><span class="line">&#125;, <span class="number">0</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;end&quot;</span>);</span><br></pre></td></tr></table></figure><p>å„ä½æƒ³æƒ³ä¸‹é¢çš„è¾“å‡ºé¡ºåºæ˜¯ä»€ä¹ˆå§ï¼Ÿ<br>æˆ‘å…ˆè¯´ä¸€ä¸‹æˆ‘çš„ç­”æ¡ˆå§ï¼š</p><blockquote><p>end<br>p<br>setTime</p></blockquote><p>ä¸Šé¢çš„è¾“å‡ºæ˜¯é”™è¯¯çš„ ğŸ˜¥ï¼Œæˆ‘æ˜¯æ€ä¹ˆä¹Ÿä¸å¼€å¿ƒå•Šï¼Œäºæ˜¯æˆ‘å°±å¼€å§‹ç¿»éå„ç§èµ„æ–™ï¼Œå…¶ä¸­åŒ…æ‹¬ä»»åŠ¡ã€å¾®ä»»åŠ¡ã€JavaScript äº‹ä»¶å¾ªç¯ã€Promise ç­‰ç­‰èµ„æ–™ã€‚ä¸‹é¢å°±è®©æˆ‘æ¥ç»†è¯´å§ã€‚</p><span id="more"></span><p><strong>é¦–å…ˆä»‹ç»å‡ ä¸ªé‡è¦çš„æ¦‚å¿µã€‚</strong></p><h2 id="ç›¸å…³æ¦‚å¿µ"><a href="#ç›¸å…³æ¦‚å¿µ" class="headerlink" title="ç›¸å…³æ¦‚å¿µ"></a>ç›¸å…³æ¦‚å¿µ</h2><h3 id="ä»»åŠ¡ï¼ˆå®ä»»åŠ¡ï¼‰"><a href="#ä»»åŠ¡ï¼ˆå®ä»»åŠ¡ï¼‰" class="headerlink" title="ä»»åŠ¡ï¼ˆå®ä»»åŠ¡ï¼‰"></a>ä»»åŠ¡ï¼ˆå®ä»»åŠ¡ï¼‰</h3><p>ä»»åŠ¡æœ‰ä»¥ä¸‹ä¸‰ç±»ï¼š</p><ul><li>ä¸€æ®µæ–°ç¨‹åºæˆ–å­ç¨‹åºè¢«ç›´æ¥æ‰§è¡Œæ—¶ï¼ˆæ¯”å¦‚ä»ä¸€ä¸ªæ§åˆ¶å°ï¼Œæˆ–åœ¨ä¸€ä¸ª &lt;script&gt; å…ƒç´ ä¸­è¿è¡Œä»£ç ï¼‰ã€‚</li><li>è§¦å‘äº†ä¸€ä¸ªäº‹ä»¶ï¼Œå°†å…¶<strong>å›è°ƒå‡½æ•°</strong>æ·»åŠ åˆ°ä»»åŠ¡é˜Ÿåˆ—æ—¶ã€‚</li><li>æ‰§è¡Œåˆ°ä¸€ä¸ªç”± setTimeout() æˆ– setInterval() åˆ›å»ºçš„ timeout æˆ– intervalï¼Œä»¥è‡´ç›¸åº”çš„<strong>å›è°ƒå‡½æ•°</strong>è¢«æ·»åŠ åˆ°ä»»åŠ¡é˜Ÿåˆ—æ—¶ã€‚</li><li>setImmediate()å›è°ƒï¼ˆnodejsï¼‰</li><li>I/O</li><li>UI</li><li>postMessage</li><li>requestAnimationFrame</li></ul><h3 id="å¾®ä»»åŠ¡"><a href="#å¾®ä»»åŠ¡" class="headerlink" title="å¾®ä»»åŠ¡"></a>å¾®ä»»åŠ¡</h3><ul><li>promise.then(callback)ä¸­çš„<strong>callback</strong>ã€‚</li><li>MutationObserver</li><li>process.nextTick(Node.js)</li></ul><h3 id="æ‰§è¡Œæ ˆ"><a href="#æ‰§è¡Œæ ˆ" class="headerlink" title="æ‰§è¡Œæ ˆ"></a>æ‰§è¡Œæ ˆ</h3><p>å‡½æ•°çš„äº’ç›¸è°ƒç”¨ä¼šè®©å‡½æ•°æ ‘å½¢æˆä¸€ä¸ªè°ƒç”¨æ ˆï¼Œè€Œå‡½æ•°çš„æ‰§è¡Œä¼šæŒ‰ç…§è¿™ä¸ªæ ˆæ¥æ‰§è¡Œï¼Œå³åè¿›å…ˆæ‰§è¡Œã€‚æ‰§è¡Œæ ˆä¼šå ç”¨ JavaScript çš„ run timeã€‚</p><h3 id="æ‰§è¡Œä¸Šä¸‹æ–‡"><a href="#æ‰§è¡Œä¸Šä¸‹æ–‡" class="headerlink" title="æ‰§è¡Œä¸Šä¸‹æ–‡"></a>æ‰§è¡Œä¸Šä¸‹æ–‡</h3><p>JavaScript åœ¨è¿è¡Œæ—¶ï¼Œæ˜¯è¿è¡Œåœ¨æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­çš„ï¼Œæ¯ä¸€ä¸ªä¸Šä¸‹æ–‡æ‹¥æœ‰è‡ªå·±çš„å˜é‡ã€å¯¹è±¡ï¼Œæ‰§è¡Œä¸Šä¸‹æ–‡æœ‰å¦‚ä¸‹å‡ ç±»ï¼š</p><ul><li>å…¨å±€ä¸Šä¸‹æ–‡ï¼šåœ¨ JavaScript å¼€å§‹æ‰§è¡Œæ—¶ä¾¿åˆ›å»ºï¼Œæ˜¯æœ€åŸºç¡€çš„ä¸Šä¸‹æ–‡ã€‚</li><li>å‡½æ•°ä¸Šä¸‹æ–‡ï¼ˆå±€éƒ¨ä¸Šä¸‹æ–‡ï¼‰ï¼šåœ¨å‡½æ•°è°ƒç”¨æ—¶ä¼šåˆ›å»ºï¼Œä¸€ä¸ªå‡½æ•°çš„æ‰§è¡Œï¼Œä¼´éšä¸€ä¸ªå‡½æ•°ä¸Šä¸‹æ–‡çš„äº§ç”Ÿã€‚</li><li>eval ä¸Šä¸‹æ–‡ï¼šä½¿ç”¨ eval å‡½æ•°æ‰€åˆ›å»ºçš„ä¸Šä¸‹æ–‡ã€‚</li></ul><h3 id="JavaScript-RunTime"><a href="#JavaScript-RunTime" class="headerlink" title="JavaScript RunTime"></a>JavaScript RunTime</h3><p>æ‰§è¡Œ js ä»£ç æ—¶ï¼Œè¿è¡Œæ—¶å¼•æ“æ‹¥æœ‰ä¸€ç³»åˆ—çš„ä»£ç†ï¼Œæ¯ä¸€ä¸ªä»£ç†ç”±ä¸€ç³»åˆ—çš„æ‰§è¡Œä¸Šä¸‹æ–‡ã€æ‰§è¡Œæ ˆã€ä¸»çº¿ç¨‹ã€é™„åŠ çº¿ç¨‹ï¼ˆworkerï¼‰ã€ä»»åŠ¡é˜Ÿåˆ—ã€å¾®ä»»åŠ¡é˜Ÿåˆ—ã€‚å¸¸è§çš„ JavaScript run time æœ‰ iframeã€web workerã€JavaScript ä¸»çº¿ç¨‹ã€‚</p><h3 id="äº‹ä»¶å¾ªç¯"><a href="#äº‹ä»¶å¾ªç¯" class="headerlink" title="äº‹ä»¶å¾ªç¯"></a>äº‹ä»¶å¾ªç¯</h3><p>äº‹ä»¶å¾ªç¯è´Ÿè´£æ”¶é›†ç”¨äº‹ä»¶ï¼ˆåŒ…æ‹¬ç”¨æˆ·äº‹ä»¶ä»¥åŠå…¶ä»–éç”¨æˆ·äº‹ä»¶ç­‰ï¼‰ã€å¯¹ä»»åŠ¡è¿›è¡Œæ’é˜Ÿä»¥ä¾¿åœ¨åˆé€‚çš„æ—¶å€™æ‰§è¡Œå›è°ƒã€‚ç„¶åå®ƒæ‰§è¡Œæ‰€æœ‰å¤„äºç­‰å¾…ä¸­çš„ JavaScript ä»»åŠ¡ï¼ˆå®ä»»åŠ¡ï¼‰ï¼Œç„¶åæ˜¯å¾®ä»»åŠ¡ï¼Œç„¶ååœ¨å¼€å§‹ä¸‹ä¸€æ¬¡å¾ªç¯ä¹‹å‰æ‰§è¡Œä¸€äº›å¿…è¦çš„æ¸²æŸ“å’Œç»˜åˆ¶æ“ä½œã€‚æ¯ä¸€ä¸ª JavaScript run time éƒ½ä¼šæ‹¥æœ‰è‡ªå·±çš„äº‹ä»¶å¾ªç¯ï¼ŒRunTime é‡Œé¢çš„ä»£ç†ç”±äº‹ä»¶å¾ªç¯æ‰€é©±åŠ¨ã€‚<br><strong>äº‹ä»¶å¾ªç¯åˆ†ä¸ºä¸‰ç±»ï¼š</strong></p><h4 id="window-event-loop"><a href="#window-event-loop" class="headerlink" title="window event loop"></a>window event loop</h4><p>é©±åŠ¨åŒæºçš„çª—å£ï¼ˆFrame,Tabï¼‰çš„äº‹ä»¶å¾ªç¯ï¼Œæ¥è‡ªç›¸åŒ origin çš„ window å¯èƒ½å…±äº«åŒä¸€ä¸ªäº‹ä»¶å¾ªç¯</p><h4 id="worker-event-loop"><a href="#worker-event-loop" class="headerlink" title="worker event loop"></a>worker event loop</h4><p>é©±åŠ¨ worker æ‰§è¡Œï¼ˆweb workersã€ shared workersã€service workersï¼‰worker æ‹¥æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªä¸ä¸»ç¨‹åºä¸åŒçš„ä»£ç†ã€‚</p><h4 id="worklet-event-loop"><a href="#worklet-event-loop" class="headerlink" title="worklet event loop"></a>worklet event loop</h4><p>é©±åŠ¨ worklet ä»£ç†çš„è¿è¡Œã€‚worklet çš„ç±»å‹åŒ…æ‹¬ï¼ˆWorkletã€AudioWorkletã€PaintWorkletï¼‰ã€‚</p><h3 id="Promise"><a href="#Promise" class="headerlink" title="Promise"></a>Promise</h3><p>ä¸€ç§å¼‚æ­¥ JavaScript çš„è§£å†³æ–¹æ¡ˆï¼Œæ˜¯å¯¹å¼‚æ­¥æ–¹æ³•çš„è¿”å›å€¼çš„ä¸€ç§æè¿°ï¼Œç”¨äºåœ¨å°†æ¥æŸä¸ªæ—¶åˆ»å°†å¼‚æ­¥ç»“æœè¿”å›ç»™ä½¿ç”¨è€…ï¼Œæœ€é‡è¦çš„ä¸€ç‚¹æ˜¯é€šè¿‡ then é“¾å¼è°ƒç”¨ã€‚</p><h2 id="äº‹ä»¶å¾ªç¯æœºåˆ¶"><a href="#äº‹ä»¶å¾ªç¯æœºåˆ¶" class="headerlink" title="äº‹ä»¶å¾ªç¯æœºåˆ¶"></a>äº‹ä»¶å¾ªç¯æœºåˆ¶</h2><p>åœ¨æ¯ä¸€è½®äº‹ä»¶å¾ªç¯å¼€å§‹æ—¶ï¼ŒRunTime ä¼šä»ä»»åŠ¡é˜Ÿåˆ—é‡Œé¢å–å‡ºä»»åŠ¡æ¥æ‰§è¡Œï¼Œå¦‚æœä»»åŠ¡é‡Œé¢åˆæ·»åŠ äº†æ–°ä»»åŠ¡åˆ°é˜Ÿåˆ—é‡Œé¢ï¼Œæ–°ä»»åŠ¡ä¸ä¼šå†æœ¬è½®äº‹ä»¶å¾ªç¯é‡Œå»æ‰§è¡Œã€‚å½“ä¸€ä¸ªä»»åŠ¡æ‰§è¡Œå®Œå¼¹å‡ºä»»åŠ¡é˜Ÿåˆ—æ—¶ï¼Œå¹¶ä¸”æ‰§è¡Œæ ˆä½ç©ºæ—¶ï¼Œè¿™æ—¶ä¼šå¼€å§‹æ‰§è¡Œå¾®ä»»åŠ¡é˜Ÿåˆ—ï¼Œå¾®ä»»åŠ¡ä¸ä¼šåƒä»»åŠ¡é‚£æ ·æ¯æ¬¡åªæ‰§è¡Œä¸€ä¸ªï¼Œè€Œæ˜¯å°†å¾®ä»»åŠ¡é˜Ÿåˆ—é‡Œçš„å¾®ä»»åŠ¡æ‰§è¡Œå®Œï¼Œå³ä½¿æ˜¯åœ¨æ‰§è¡Œå¾®ä»»åŠ¡æ—¶æœ‰æ–°çš„å¾®ä»»åŠ¡åŠ å…¥åˆ°å¾®ä»»åŠ¡é˜Ÿåˆ—ï¼Œåœ¨ä¸‹ä¸€ä¸ªä»»åŠ¡å¼€å§‹ä»¥åŠäº‹ä»¶å¾ªç¯è¿­ä»£ç»“æŸä¹‹å‰ä¾ç„¶ä¼šæ‰§è¡Œå¾®ä»»åŠ¡ã€‚<br>OKï¼Œè¯´åˆ°è¿™å„¿ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ¥åˆ†æä»¥ä¸‹åˆšæ‰çš„é¢˜äº†ã€‚</p><h2 id="é¢˜ç›®åˆ†æ"><a href="#é¢˜ç›®åˆ†æ" class="headerlink" title="é¢˜ç›®åˆ†æ"></a>é¢˜ç›®åˆ†æ</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> p = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;p&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;setTime&quot;</span>);</span><br><span class="line">&#125;, <span class="number">0</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;end&quot;</span>);</span><br></pre></td></tr></table></figure><p><strong>æœ€å¼€å§‹ï¼š</strong>å°†æ•´ä½“ä»£ç ï¼ˆä¸€æ®µæ–°ç¨‹åºï¼‰åŠ å…¥ä»»åŠ¡é˜Ÿåˆ—ã€‚æ­¤æ—¶çš„ JavaScript RunTime çš„æƒ…å†µå¦‚ä¸‹å›¾ï¼š<br><img src="https://cdn.jsdelivr.net/gh/PancakeDogLLL/imageBed/img/202201122218.png" alt="1"></p><p>æ­¤æ—¶ä»»åŠ¡é˜Ÿåˆ—é‡Œé¢ä»…æœ‰æ•´ä½“ç¨‹åºï¼Œè€Œå¾®ä»»åŠ¡é˜Ÿåˆ—é‡Œé¢ä»€ä¹ˆä¹Ÿæ²¡æœ‰ã€‚æ•´ä½“ç¨‹åºå°†è¿›å…¥æ‰§è¡Œæ ˆä¸­æ‰§è¡Œã€‚<br><strong>åˆ›å»º promise å¯¹è±¡ï¼š</strong>åœ¨åˆ›å»º promise å¯¹è±¡æ—¶ï¼Œä¼ å…¥äº†å¯é€‰å‚æ•°å³ï¼š</p><blockquote><p>(resolve,reject)=&gt;{<br>console.log(â€˜pâ€™);<br>}</p></blockquote><p>è€Œ Promise æ„é€ å™¨å°†ä¼šåœ¨è¿”å›æ–°å¯¹è±¡ä¹‹å‰æ‰§è¡Œä¼ å…¥çš„å‡½æ•°å‚æ•°ã€‚æ‰€ä»¥åœ¨æ‰§è¡Œæ ˆä¸­ä¼šæ‰§è¡Œ console.log(â€˜pâ€™)ï¼Œæ‰“å°å‡º â€˜pâ€™ã€‚<br><strong>æ‰§è¡Œå®šæ—¶å™¨ï¼š</strong>æ‰§è¡Œå®šæ—¶å™¨ï¼Œä¼šåœ¨ä¼ å…¥çš„å»¶è¿Ÿæ—¶é—´ä¹‹åå°†å›è°ƒå‡½æ•°åŠ å…¥é˜Ÿåˆ—ï¼ŒåŠ å…¥ä»€ä¹ˆé˜Ÿåˆ—å‘¢ï¼Œè¿™é‡ŒåŠ å…¥çš„æ˜¯ä»»åŠ¡é˜Ÿåˆ—ï¼Œå› ä¸º settimeoout çš„å›è°ƒå±äºå®ä»»åŠ¡ã€‚ä¹‹åï¼Œå½“å‰æ‰§è¡Œæ ˆä¸ä¸ºç©ºï¼Œä¼šç»§ç»­æ‰§è¡Œã€‚<br><strong>æ‰“å° end:<strong>åœ¨æ‰§è¡Œ console.log(â€˜endâ€™)åï¼Œç°åœ¨æ‰§è¡Œæ ˆä¸ºç©ºäº†ï¼Œæ•´ä½“ç¨‹åºå¼¹å‡ºä»»åŠ¡é˜Ÿåˆ—ã€‚æ­¤æ—¶ä»»åŠ¡é˜Ÿåˆ—æ˜¯</strong>ä¸ä¸ºç©ºçš„</strong>ï¼ˆåŒ…å«å®šæ—¶å™¨çš„å›è°ƒ()=&gt;{console.log(â€˜setTimeâ€™)}ï¼‰</p><p>æ­¤æ—¶çš„ JavaScript RunTime çš„æƒ…å†µå¦‚ä¸‹å›¾ï¼š<br><img src="https://cdn.jsdelivr.net/gh/PancakeDogLLL/imageBed/img/202201122230.png" alt="2"><br>è¿™æ—¶çš„ä»»åŠ¡é˜Ÿåˆ—åŒ…æ‹¬å®šæ—¶å™¨çš„å›è°ƒï¼Œè€Œå¾®ä»»åŠ¡é˜Ÿåˆ—ä¾ç„¶ä¸ºç©ºï¼ˆè¿™é“é¢˜å°±æ²¡æ¶‰åŠåˆ°å¾®ä»»åŠ¡ã€‚ã€‚ã€‚ï¼‰ã€‚éšåå®šæ—¶å™¨å›è°ƒå°†è¿›å…¥æ‰§è¡Œæ ˆï¼Œæ‰“å°å‡º setTimeã€‚æ‰€ä»¥æœ€ç»ˆçš„æ‰“å°ç»“æœä¸ºï¼š</p><blockquote><p>p<br>end<br>setTime</p></blockquote><p><strong>è¿™é‡Œå°±æ³¨æ„ promise çš„æ„å»ºå°±è¡Œäº†ï¼Œæ˜¯ç«‹å³æ‰§è¡Œï¼Œæˆ‘é”™çš„æ˜¯åº”ä¸ºå®ƒä¼šè¿›å…¥å¾®ä»»åŠ¡é˜Ÿåˆ—ã€‚è€Œ Promise è¿›å…¥å¾®ä»»åŠ¡çš„æ˜¯ then çš„å›è°ƒå‡½æ•°ã€‚</strong></p><h2 id="æ‰©å±•é¢˜ç›®"><a href="#æ‰©å±•é¢˜ç›®" class="headerlink" title="æ‰©å±•é¢˜ç›®"></a>æ‰©å±•é¢˜ç›®</h2><p>ä¸Šé¢çš„é¢˜æ²¡æœ‰æ¶‰åŠå¾®ä»»åŠ¡ï¼Œé‚£æˆ‘ä»¬æ”¹æ”¹åŸé¢˜ç›®çœ‹çœ‹ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> p_2 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">res, rej</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;p_2&quot;</span>);</span><br><span class="line">  <span class="comment">// å®šæ—¶å™¨1</span></span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    res(<span class="string">&quot;å®šæ—¶å™¨1&quot;</span>);</span><br><span class="line">  &#125;, <span class="number">0</span>);</span><br><span class="line">&#125;).then(<span class="function">(<span class="params">v</span>) =&gt;</span> <span class="built_in">console</span>.log(v));</span><br><span class="line"><span class="comment">// å®šæ—¶å™¨2</span></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;å®šæ—¶å™¨2&quot;</span>);</span><br><span class="line">&#125;, <span class="number">0</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;end&quot;</span>);</span><br></pre></td></tr></table></figure><p>ä¸Šé¢æ–°å¢çš„æ˜¯åœ¨åˆ›å»º Promise å¯¹è±¡æ—¶å¢åŠ äº†ä¸€ä¸ªå®šæ—¶å™¨ï¼Œä»¥åŠå¢åŠ äº†å¯¹ then çš„å›è°ƒã€‚<br>ä¾æ—§ä»æ•´ä½“ç¨‹åºå¼€å§‹ï¼Œè¿›å…¥ä»»åŠ¡é˜Ÿåˆ—ï¼Œå½“æ•´ä½“ç¨‹åºæ‰§è¡Œå®Œæ—¶ï¼Œè¿™æ—¶çš„ RunTime æƒ…å†µå¦‚ä¸‹ï¼š<br><img src="https://cdn.jsdelivr.net/gh/PancakeDogLLL/imageBed/img/202201122252.png" alt="3"><br>æ­¤æ—¶è¾“å‡ºä¸ºï¼š</p><blockquote><p>p_2<br>end</p></blockquote><p>æŒ‰ç…§é˜Ÿåˆ—å…ˆè¿›å…ˆå‡ºï¼Œå®šæ—¶å™¨ 1 å…ˆè¿›å…¥é˜Ÿåˆ—ï¼Œæ‰€ä»¥å…¶å…ˆäºå®šæ—¶å™¨ 2 æ‰§è¡Œã€‚æ­¤æ—¶å®šæ—¶å™¨ 1 çš„å›è°ƒè¿›å…¥æ‰§è¡Œæ ˆæ‰§è¡Œï¼Œæ‰§è¡Œ res(â€˜å®šæ—¶å™¨ 1â€™)æ”¹å˜ promise çš„çŠ¶æ€ä¸º resolve,å°† then çš„å›è°ƒåŠ å…¥å¾®ä»»åŠ¡é˜Ÿåˆ—ï¼Œæ­¤æ—¶ RunTime çš„æƒ…å†µå¦‚ä¸‹ï¼š<br><img src="https://cdn.jsdelivr.net/gh/PancakeDogLLL/imageBed/img/202201122258.png" alt="4"></p><p>å®šæ—¶å™¨ 1 æ‰§è¡Œå®Œæ¯•å¼¹å‡ºä»»åŠ¡é˜Ÿåˆ—ï¼Œä¸€ä¸ªä»»åŠ¡æ‰§è¡Œå®Œåï¼Œæ£€ç´¢å¾®ä»»åŠ¡é˜Ÿåˆ—ï¼Œè¿™æ—¶å¾®ä»»åŠ¡é˜Ÿåˆ—å­˜åœ¨ä¸€ä¸ª then å›è°ƒï¼Œæ‰€ä»¥å°†å…¶åŠ å…¥æ‰§è¡Œæ ˆã€‚</p><p>ç°åœ¨çš„è¾“å‡ºæ˜¯ï¼š</p><blockquote><p>p_2<br>end<br>å®šæ—¶å™¨ 1</p></blockquote><p>æœ€ç»ˆï¼Œåªå‰©ä¸‹äº†ä»»åŠ¡é˜Ÿåˆ—çš„å®šæ—¶å™¨ 2 å›è°ƒï¼Œé‡å¤æ—¶é—´å¾ªç¯ï¼Œå°†å®šæ—¶å™¨ 2 çš„å›è°ƒåŠ å…¥æ‰§è¡Œæ ˆå¹¶æ‰§è¡Œã€‚æœ€ç»ˆçš„è¾“å‡ºç»“æœä¸ºï¼š</p><blockquote><p>p_2<br>end<br>å®šæ—¶å™¨ 1<br>å®šæ—¶å™¨ 2</p></blockquote><p>ä¸Šé¢è¿™é¢˜å°±è¯´æ˜äº†ä¸€ä¸ªä»»åŠ¡å¼¹å‡ºä»»åŠ¡é˜Ÿåˆ—åä¼šæ‰§è¡Œå¾®ä»»åŠ¡é˜Ÿåˆ—çš„ä»»åŠ¡ï¼Œå¯æ˜¯åœ¨ä¸Šé¢çš„æ¦‚å¿µä¸€ç« ä¸­è¿˜æåˆ°äº†ä¸€ä¸ªä»»åŠ¡å‡ºé˜Ÿåˆ—åæ˜¯è¦æ‰§è¡Œæ‰€æœ‰çš„å¾®ä»»åŠ¡ï¼Œè€Œä¸Šé¢çš„é‚£ä¸€é¢˜åªæœ‰ä¸€ä¸ªå¾®ä»»åŠ¡çœ‹ä¸å‡ºä»€ä¹ˆè¹Šè··ï¼Œé‚£ä¹ˆæˆ‘ä»¬å†æ”¹ä¸€ä¸‹å§ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> p_2 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">res, rej</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;p_2&quot;</span>);</span><br><span class="line">  <span class="comment">// å®šæ—¶å™¨1</span></span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    res(<span class="string">&quot;å®šæ—¶å™¨1&quot;</span>);</span><br><span class="line">  &#125;, <span class="number">0</span>);</span><br><span class="line">&#125;).then(<span class="function">(<span class="params">v</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;å¾®ä»»åŠ¡å¼€å§‹&quot;</span>);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">    <span class="built_in">window</span>.queueMicrotask(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// å‡½æ•°çš„å†…å®¹</span></span><br><span class="line">      <span class="built_in">console</span>.log(i);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// å®šæ—¶å™¨2</span></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;å®šæ—¶å™¨2&quot;</span>);</span><br><span class="line">&#125;, <span class="number">0</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;end&quot;</span>);</span><br></pre></td></tr></table></figure><p>è¿™æ¬¡æˆ‘ä»¬æ›´æ”¹äº† then çš„å›è°ƒï¼Œä½¿ç”¨äº† window.queueMicrotask()æ¥æ·»åŠ å›è°ƒåˆ°å¾®ä»»åŠ¡é˜Ÿåˆ—ã€‚è¿™æ¬¡æ˜¯æ·»åŠ äº”ä¸ªè¾“å‡ºåˆ°å¾®ä»»åŠ¡é˜Ÿåˆ—é‡Œé¢ã€‚é¡ºç€ä¸Šä¸€é¢˜çš„æ€è·¯ï¼Œæˆ‘ä»¬åªéœ€å°†ä¸Šä¸€é¢˜çš„è¾“å‡º<strong>â€˜å®šæ—¶å™¨ 1â€™</strong>æ›´æ”¹ä¸€ä¸‹å°±è¡Œäº†ã€‚æŒ‰ç…§ä¸€æ¬¡æ‰§è¡Œæ‰æ‰€æœ‰å¾®ä»»åŠ¡çš„ç»“è®ºï¼Œæˆ‘ä»¬å¯ä»¥ä½œå‡ºå¦‚ä¸‹æ›´æ”¹ã€‚</p><blockquote><p>p_2<br>end<br>å¾®ä»»åŠ¡å¼€å§‹<br>0<br>1<br>2<br>3<br>4<br>å®šæ—¶å™¨ 2</p></blockquote><p>åœ¨ chrome é‡Œé¢è¯•ä¸€ä¸‹å§ï¼šï¼‰<br><img src="https://cdn.jsdelivr.net/gh/PancakeDogLLL/imageBed/img/202201122327.png" alt="5"></p><p>å¯ä»¥çœ‹è§ï¼Œç»“è®ºæ­£ç¡®ã€‚</p><p><strong>å‚è€ƒï¼š</strong><br><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/HTML_DOM_API/Microtask_guide">https://developer.mozilla.org/zh-CN/docs/Web/API/HTML_DOM_API/Microtask_guide</a><br><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/HTML_DOM_API/Microtask_guide/In_depth">https://developer.mozilla.org/zh-CN/docs/Web/API/HTML_DOM_API/Microtask_guide/In_depth</a></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;strong&gt;äº‹æƒ…è¿˜å¾—ä»è¿™ä¹ˆä¸€é“é¢˜å¼€å§‹ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight javascript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;let&lt;/span&gt; p = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;Promise&lt;/span&gt;(&lt;span class=&quot;function&quot;&gt;(&lt;span class=&quot;params&quot;&gt;resolve, reject&lt;/span&gt;) =&amp;gt;&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;built_in&quot;&gt;console&lt;/span&gt;.log(&lt;span class=&quot;string&quot;&gt;&amp;quot;p&amp;quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;setTimeout&lt;/span&gt;(&lt;span class=&quot;function&quot;&gt;() =&amp;gt;&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;built_in&quot;&gt;console&lt;/span&gt;.log(&lt;span class=&quot;string&quot;&gt;&amp;quot;setTime&amp;quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;, &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;console&lt;/span&gt;.log(&lt;span class=&quot;string&quot;&gt;&amp;quot;end&amp;quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;å„ä½æƒ³æƒ³ä¸‹é¢çš„è¾“å‡ºé¡ºåºæ˜¯ä»€ä¹ˆå§ï¼Ÿ&lt;br&gt;æˆ‘å…ˆè¯´ä¸€ä¸‹æˆ‘çš„ç­”æ¡ˆå§ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;end&lt;br&gt;p&lt;br&gt;setTime&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ä¸Šé¢çš„è¾“å‡ºæ˜¯é”™è¯¯çš„ ğŸ˜¥ï¼Œæˆ‘æ˜¯æ€ä¹ˆä¹Ÿä¸å¼€å¿ƒå•Šï¼Œäºæ˜¯æˆ‘å°±å¼€å§‹ç¿»éå„ç§èµ„æ–™ï¼Œå…¶ä¸­åŒ…æ‹¬ä»»åŠ¡ã€å¾®ä»»åŠ¡ã€JavaScript äº‹ä»¶å¾ªç¯ã€Promise ç­‰ç­‰èµ„æ–™ã€‚ä¸‹é¢å°±è®©æˆ‘æ¥ç»†è¯´å§ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="javascript" scheme="https://jealh.xyz/categories/javascript/"/>
    
    
  </entry>
  
  <entry>
    <title>2021å¹´ç»ˆæ€»ç»“</title>
    <link href="https://jealh.xyz/2021/12/31/2021%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/"/>
    <id>https://jealh.xyz/2021/12/31/2021%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/</id>
    <published>2021-12-30T17:44:31.000Z</published>
    <updated>2022-12-31T10:26:33.577Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>æ„Ÿæƒ³ï¼š æ—¶é—´è¿‡å¾—çœŸçš„å¾ˆå¿«ï¼Œè€Œéœ€è¦å­¦ä¹ çš„ä¸œè¥¿ä¸€ç›´åœ¨å˜å¤šï¼Œä»å¤§äºŒåˆ°å¤§ä¸‰çš„ï¼Œæ…¢æ…¢åœ°å°±è§‰å¾—è‡ªå·±æ¥è§¦çš„é¢†åŸŸæ‰€æ¸ºå°ã€‚è€Œè¿™ä¸€å¹´é‡Œæ„Ÿå—æœ€æ·±çš„æ€»è¿˜æ˜¯æ—¶é—´ä¸å¤Ÿçš„æ ·å­ã€‚</p></blockquote><hr><span id="more"></span><h3 id="å­¦ä¹ "><a href="#å­¦ä¹ " class="headerlink" title="å­¦ä¹ "></a>å­¦ä¹ </h3><p>åœ¨å­¦ä¹ ä¸Šï¼Œå°½ç®¡ä¸æ˜¯æ‰€æœ‰è¯¾ç¨‹å®‰æ’å¾—å¾ˆå¦¥å½“ï¼Œä½†ä¹Ÿæœ‰ä¸€äº›è¯¾ç¨‹è®©æˆ‘å—ç›Šè‰¯å¤šã€‚è®°å¿†æ¯”è¾ƒæ·±åˆ»å¾—è¿˜æ˜¯æš‘å‡å‰çš„ flutter è¯¾ç¨‹å§ã€‚é‚£ä¸€æ¬¡é¢ä¸´å¾—æŒ‘æˆ˜æ˜¯æœªçŸ¥ã€è¯¾ç¨‹æ—¶é—´çŸ­ã€‚è€Œæœ€ç»ˆçš„ä»»åŠ¡æ˜¯ä½¿ç”¨ flutter å®Œæˆä¸€ä¸ª APPã€‚è€Œæˆ‘åšçš„å°±æ˜¯ä¸€ä¸ªè®°ç¬”è®°çš„ APP äº†<a href="https://github.com/Jealh-h/lightNote">(https://github.com/Jealh-h/lightNote)</a>ï¼Œå°½ç®¡åŠŸèƒ½ä¸æ˜¯é‚£ä¹ˆå®Œå–„ï¼Œä½†è¿™æ¬¡è®©æˆ‘ä½“éªŒåˆ°äº†å…¨æ ˆå¼€å‘çš„ä¸€äº›å›°éš¾å§ï¼Œå¾—ç›Šäº eggjs æ¡†æ¶èƒ½è®©æˆ‘ä¸€ä¸ªä¸å¤ªæ‡‚åç«¯çš„è½»æ¾ä¸€ç‚¹â€¦â€¦.ã€‚æ•°æ®åˆ†æè¿™é—¨è¯¾ä¹ŸæŒºå¥½çš„ï¼Œè‡³å°‘è®©æˆ‘åœ¨æœºå™¨å­¦ä¹ æ–¹é¢èƒ½å¤Ÿè°ƒåº“äº†ï¼Œèƒ½è®­ç»ƒæ¨¡å‹äº†ã€‚ç‰¹åˆ«æ˜¯åœ¨æœ€åçš„æˆ¿ä»·é¢„æµ‹çš„é¡¹ç›®ä¸Šï¼Œä»æ•°æ®è·å–åˆ°æ•°æ®åˆ†æå†åˆ°æ¨¡å‹é¢„æµ‹ï¼Œè¿™ä¸€å¥—ä¸‹æ¥è®©æˆ‘è§‰å¾— python æ›´åŠ å¼ºå¤§äº†ã€‚å…¶æ¬¡å°±æ˜¯æ•°æ®å¯è§†åŒ–äº†ï¼Œè™½ç„¶è¯´ç†è®ºè¯¾ç€å®æœ‰ä¸€ç‚¹æ— èŠï¼Œå¥½åœ¨å®éªŒè¯¾è¿˜æ¯”è¾ƒæœ‰è¶£ï¼Œè¿™æ¬¡è®©æˆ‘ä½“éªŒäº†ä¸€æŠŠ d3js,ç»™æˆ‘çš„æ„Ÿè§‰å°±æ˜¯ jquery çš„ä¸€ä¸ªå…„å¼Ÿä¸€æ ·ï¼Œåªä¸è¿‡æ›´åŠ é€‚åˆäºç»˜åˆ¶å›¾å½¢ã€‚æœ€åè¯´è¯´ç¼–è¯‘åŸç†å§ï¼Œè¿™é—¨è¯¾å°±æ„Ÿè§‰æ¯”è¾ƒç¥å¥‡å§ï¼Ÿï¼ä»è¯æ³•åˆ†æåˆ°è¯­æ³•åˆ†æï¼Œå†åˆ°è¯­ä¹‰åˆ†æç­‰ç­‰ã€‚éƒ½æ„Ÿè§‰æœ‰å¾ˆå¼ºçš„ç†è®ºæ”¯æ’‘ã€‚å•å°±å¯¹äºç»™å®šçš„ test æ¥è¯´ï¼Œåšä¸€ä¸ªè¯æ³•åˆ†æã€è¯­æ³•åˆ†æçš„å·¥ä½œé‡å°±æŒºå¤§çš„ï¼ˆæ±‚ NFAã€DFA,æ”¹å†™ LL(1)æ–‡æ³•ç­‰ç­‰ï¼‰ï¼Œå¯è§å“ªäº›è¯­è¨€ä¹‹çˆ¶æ˜¯æœ‰å¤š ğŸ‚ äº†ã€‚</p><h3 id="ç”Ÿæ´»"><a href="#ç”Ÿæ´»" class="headerlink" title="ç”Ÿæ´»"></a>ç”Ÿæ´»</h3><p>åœ¨è¿™ä¸€å¹´é‡Œä¾ç„¶é‚£ä¹ˆå–œæ¬¢é€› bi ç«™,å–œæ¬¢å¬éŸ³ä¹ã€‚å°è±¡æœ€æ·±çš„è¿˜æ˜¯ã€ŠåŒåŸä¹‹æˆ˜ã€‹äº†,ä¸€æ–¹é¢æ˜¯æˆ‘å–œæ¬¢çš„ç”»é£ï¼Œä½†æ˜¯å‘¢è¿™å‰§æƒ…ç¡®å®æœ‰ç‚¹è™äº†,è¿™å¤§æ¦‚å°±æ˜¯è§’è‰²è®¾å®šå§ã€‚<br><strong>qq éŸ³ä¹å¹´åº¦æŠ¥å‘Š</strong><br><img src="https://cdn.jsdelivr.net/gh/PancakeDogLLL/imageBed/img/qqmusic_2021.PNG" alt="qqéŸ³ä¹"></p><p><strong>bilibili å¹´åº¦æŠ¥å‘Š</strong><br><img src="https://cdn.jsdelivr.net/gh/PancakeDogLLL/imageBed/img/bilibili_2021.PNG" alt="bilibili"></p><h3 id="æŠ€æœ¯æ ˆ"><a href="#æŠ€æœ¯æ ˆ" class="headerlink" title="æŠ€æœ¯æ ˆ"></a>æŠ€æœ¯æ ˆ</h3><p>åœ¨æŠ€æœ¯æ ˆä¸Šï¼Œå¯¹äº react çš„ä½¿ç”¨æ›´åŠ ç†Ÿæ‚‰äº†ï¼Œå°½ç®¡è‡ªå·±æƒ³ç”¨ vue å†™ä¸€ä¸ªä¸ªäººåšå®¢ï¼Œä½†å†™åˆ°ä¸€åŠè¿˜æ˜¯æ”¾å¼ƒäº†ï¼ˆå¯èƒ½é‚£æ—¶å€™è¿˜ä¸çŸ¥é“ä¸€äº›å¼ºå¤§çš„ nodejs æ¡†æ¶å§ï¼‰ã€‚æ‰€ä»¥è¿˜æ˜¯ hexo é¦™å•Šï¼Œå°±è¿™æ ·å‘ç°äº†å†™åšå®¢æ˜¯ä¸€ä»¶å¼ºåŒ–è®°å¿†çš„äº‹æƒ…ã€‚åœ¨è¿™ä¸€å¹´é‡Œï¼Œè™½ç„¶åœ¨çŸ¥è¯†å¹¿åº¦ä¸Šæœ‰äº†æå‡ï¼Œä½†åœ¨æ·±åº¦ä¸Šæ„Ÿè§‰è¿˜å­¦æå‡ã€‚æ¯”è¾ƒçº ç»“çš„è¿˜æ˜¯å¯¹äºä¸€äº›å·¥å…·ä¸çŸ¥åˆ°æ˜¯è¦ä¼šåˆ°ä»€ä¹ˆå±‚åº¦å§ï¼Œæ¯”å¦‚ webpack,vite æ˜¯ä¼šæŒ‰ç…§å®˜æ–¹æ–‡æ¡£é…ç½®ï¼Œè¿˜æ˜¯èƒ½ç†Ÿç»ƒåœ°å†™å‡ºæ¥ã€‚æš‘æœŸåœ¨å®éªŒå®¤æœŸé—´ï¼ŒæŠŠåŸæœ‰çš„ oj3 ç”± webpack æ„å»ºæ”¹æˆäº† vite,åªèƒ½è¯´ vite çœŸå¿«ã€‚ä½¿ç”¨ react é‡å†™äº†ä¸€ä¸ªä¼šè®®å®¤ç®¡ç†ç³»ç»Ÿç«¯ã€‚è€Œå¯¹äºå¾®ä¿¡å°ç¨‹åºé‚£è¾¹ï¼Œè™½ç„¶æ²¡æœ‰è·å¾—å¥–ï¼Œä½†ä¹Ÿæ”¶è·äº†ä¸€äº›å¼€å‘ç»éªŒå§ã€‚è€Œå¯¹äºä¸€äº›å…¶ä»–çŸ¥è¯†ï¼Œæ¯”å¦‚ rustã€electronã€wasmã€ä»¥åŠæ¸¸æˆå¼€å‘éƒ½æ˜¯å¾ˆæƒ³å­¦çš„ï¼Œä½†éƒ½ä¼šæ„Ÿè§‰è‡ªç”±çš„æ—¶é—´å¤ªå°‘ï¼Œè€Œå­¦ä¹ åˆéœ€è¦è€—è´¹å¤§é‡æ—¶é—´ã€‚æ‰€ä»¥è¿˜éœ€è¦æ§åˆ¶è‡ªå·±ã€è®©è‡ªå·±çæƒœæ—¶é—´å•Šã€‚</p><h3 id="æœŸæœ›"><a href="#æœŸæœ›" class="headerlink" title="æœŸæœ›"></a>æœŸæœ›</h3><p>å¸Œæœ›è‡ªå·±è®°å¿†åŠ›å¥½ä¸€ç‚¹ã€‚<br>æ¯ä¸€å¤©éƒ½è¦å´­æ–°çš„ä¸€ç‚¹ã€‚<br>å¯¹æ¸´æœ›çš„äº‹æƒ…æ‰§ç€ä¸€ç‚¹ã€‚<br>è®©è‡ªå·±çš„æƒ³æ³•ä¸°å¯Œä¸€ç‚¹ã€‚</p><p><strong>å°±ä¸Šé¢é‚£ä¹ˆäº¿ç‚¹å°±å¤Ÿäº†</strong></p>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;æ„Ÿæƒ³ï¼š æ—¶é—´è¿‡å¾—çœŸçš„å¾ˆå¿«ï¼Œè€Œéœ€è¦å­¦ä¹ çš„ä¸œè¥¿ä¸€ç›´åœ¨å˜å¤šï¼Œä»å¤§äºŒåˆ°å¤§ä¸‰çš„ï¼Œæ…¢æ…¢åœ°å°±è§‰å¾—è‡ªå·±æ¥è§¦çš„é¢†åŸŸæ‰€æ¸ºå°ã€‚è€Œè¿™ä¸€å¹´é‡Œæ„Ÿå—æœ€æ·±çš„æ€»è¿˜æ˜¯æ—¶é—´ä¸å¤Ÿçš„æ ·å­ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr&gt;</summary>
    
    
    
    <category term="å¹´ç»ˆæ€»ç»“" scheme="https://jealh.xyz/categories/%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/"/>
    
    
  </entry>
  
  <entry>
    <title>è°ˆè°ˆcookieã€sessionä¸token(jwt)</title>
    <link href="https://jealh.xyz/2021/12/07/%E8%B0%88%E8%B0%88cookie%E3%80%81session%E4%B8%8Etoken-jwt/"/>
    <id>https://jealh.xyz/2021/12/07/%E8%B0%88%E8%B0%88cookie%E3%80%81session%E4%B8%8Etoken-jwt/</id>
    <published>2021-12-07T14:04:05.000Z</published>
    <updated>2022-12-31T10:26:33.601Z</updated>
    
    <content type="html"><![CDATA[<p><strong>é¦–å…ˆå‘¢ï¼Œç½‘ä¸Šå…³äºå®ƒä»¬çš„æ–‡ç« å·²ç»å¾ˆå¤šäº†ï¼Œåœ¨è¿™é‡Œæˆ‘å°±åªæ˜¯æ¥è®°å½•ä»¥ä¸‹æˆ‘çš„ç†è§£ï¼Œå…¶å®ä¹Ÿæ˜¯çœ‹å…¶ä»–ç½‘ä¸Šå†…å®¹çš„ä¸€ä¸ªæ€»ç»“å§ã€‚</strong></p><blockquote><p><strong>å‰è¨€ï¼šç”±äº HTTP åè®®æ— çŠ¶æ€çš„ç¼ºé™·ã€‚WEB çš„è®¾è®¡è€…ä»¬æå‡ºäº† Cookie å’Œ Session ä¸¤ç§è§£å†³æœºåˆ¶ã€‚è€Œ token,é€šå¸¸æ˜¯ jwt(json web token)ä½œä¸ºä¸€ç§ç”¨æˆ·èº«ä»½ä»¤ç‰Œï¼Œä¹Ÿå¸¸å¸¸ç”¨äºè®°å½• http çš„çŠ¶æ€å­˜å‚¨ï¼Œé€šå¸¸æ˜¯åœ¨ç”¨æˆ·ç™»å½•åï¼Œä¼´éšæ¯ä¸€æ¬¡è¯·æ±‚å‘é€ç»™ç»™åç«¯ã€‚ä¸‹é¢å°±æ¥èŠèŠå®ƒä»¬ã€‚</strong></p></blockquote> <span id="more"></span><h3 id="cookie"><a href="#cookie" class="headerlink" title="cookie"></a>cookie</h3><h4 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h4><p>Cookie æ˜¯ä¸€æ®µä¸è¶…è¿‡ 4KB çš„å°å‹æ–‡æœ¬æ•°æ®ï¼Œç”±ä¸€ä¸ªåç§°ï¼ˆNameï¼‰ã€ä¸€ä¸ªå€¼ï¼ˆValueï¼‰å’Œå…¶å®ƒå‡ ä¸ªç”¨äºæ§åˆ¶ Cookie æœ‰æ•ˆæœŸã€å®‰å…¨æ€§ã€ä½¿ç”¨èŒƒå›´çš„å¯é€‰å±æ€§ç»„æˆã€‚<br>åŒ…æ‹¬ï¼š</p><ol><li>Name/Valueï¼šè®¾ç½® Cookie çš„åç§°åŠç›¸å¯¹åº”çš„å€¼ï¼Œå¯¹äºè®¤è¯ Cookieï¼ŒValue å€¼åŒ…æ‹¬ Web æœåŠ¡å™¨æ‰€æä¾›çš„è®¿é—®ä»¤ç‰Œã€‚</li><li>Expires å±æ€§ï¼šè®¾ç½® Cookie çš„ç”Ÿå­˜æœŸã€‚æœ‰ä¸¤ç§å­˜å‚¨ç±»å‹çš„ Cookieï¼šä¼šè¯æ€§ä¸æŒä¹…æ€§ã€‚Expires å±æ€§ç¼ºçœæ—¶ï¼Œä¸ºä¼šè¯æ€§ Cookieï¼Œä»…ä¿å­˜åœ¨å®¢æˆ·ç«¯å†…å­˜ä¸­ï¼Œå¹¶åœ¨ç”¨æˆ·å…³é—­æµè§ˆå™¨æ—¶å¤±æ•ˆï¼›æŒä¹…æ€§ Cookie ä¼šä¿å­˜åœ¨ç”¨æˆ·çš„ç¡¬ç›˜ä¸­ï¼Œç›´è‡³ç”Ÿå­˜æœŸåˆ°æˆ–ç”¨æˆ·ç›´æ¥åœ¨ç½‘é¡µä¸­å•å‡»â€œæ³¨é”€â€ç­‰æŒ‰é’®ç»“æŸä¼šè¯æ—¶æ‰ä¼šå¤±æ•ˆã€‚</li><li>Domain å±æ€§ï¼šæŒ‡å®šäº†å¯ä»¥è®¿é—®è¯¥ Cookie çš„ Web ç«™ç‚¹æˆ–åŸŸã€‚Cookie æœºåˆ¶å¹¶æœªéµå¾ªä¸¥æ ¼çš„åŒæºç­–ç•¥ï¼Œå…è®¸ä¸€ä¸ªå­åŸŸï¼ˆåŸŸåå‰ç¼€ä¸åŒï¼‰å¯ä»¥è®¾ç½®æˆ–è·å–å…¶çˆ¶åŸŸçš„ Cookieã€‚</li><li>Secure å±æ€§ï¼šæŒ‡å®šæ˜¯å¦ä½¿ç”¨ HTTPS å®‰å…¨åè®®å‘é€ Cookieã€‚</li><li>Path å±æ€§ï¼šå®šä¹‰äº† Web ç«™ç‚¹ä¸Šå¯ä»¥è®¿é—®è¯¥ Cookie çš„ç›®å½•ã€‚</li><li>HTTPOnly å±æ€§ ï¼šç”¨äºé˜²æ­¢å®¢æˆ·ç«¯è„šæœ¬é€šè¿‡ document.cookie å±æ€§è®¿é—® Cookieï¼Œæœ‰åŠ©äºä¿æŠ¤ Cookie ä¸è¢«è·¨ç«™è„šæœ¬æ”»å‡»çªƒå–æˆ–ç¯¡æ”¹ã€‚ä½†æ˜¯ï¼ŒHTTPOnly çš„åº”ç”¨ä»å­˜åœ¨å±€é™æ€§ï¼Œä¸€äº›æµè§ˆå™¨å¯ä»¥é˜»æ­¢å®¢æˆ·ç«¯è„šæœ¬å¯¹ Cookie çš„è¯»æ“ä½œï¼Œä½†å…è®¸å†™æ“ä½œï¼›æ­¤å¤–å¤§å¤šæ•°æµè§ˆå™¨ä»å…è®¸é€šè¿‡ XMLHTTP å¯¹è±¡è¯»å– HTTP å“åº”ä¸­çš„ Set-Cookie å¤´ã€‚<br><strong>å¥½äº†ï¼Œä»¥ä¸Šå†…å®¹æ˜¯æ¥è‡ªç™¾åº¦ç™¾ç§‘ã€‚ç®€å•åœ°åšä¸ªæ€»ç»“ï¼šcookie æ˜¯ä¸€ç§å­˜å‚¨åœ¨å®¢æˆ·ç«¯çš„å°å‹æ–‡æœ¬æ•°æ®ï¼Œé‡Œé¢çš„ç±»å®¹æœ‰é”®å€¼å¯¹ã€ç”Ÿå­˜å‘¨æœŸã€è®¿é—®åŸŸã€æ˜¯å¦ä½¿ç”¨ http,web ç«™ç‚¹å¯è®¿é—® cookie çš„ç›®å½•ä»¥åŠæ˜¯å¦å…è®¸å®¢æˆ·ç«¯è¯»å– cookieã€‚</strong></li></ol><h4 id="å®‰å…¨æ€§"><a href="#å®‰å…¨æ€§" class="headerlink" title="å®‰å…¨æ€§"></a>å®‰å…¨æ€§</h4><p><strong>XSRF/CSRFï¼ˆè·¨ç«™è¯·æ±‚ä¼ªé€ ï¼‰</strong>ï¼šåˆ©ç”¨çš„æ˜¯ web ä¸­ç”¨æˆ·èº«ä»½éªŒè¯çš„ä¸€ä¸ªæ¼æ´ï¼šç®€å•çš„èº«ä»½éªŒè¯åªèƒ½ä¿è¯è¯·æ±‚å‘è‡ªæŸä¸ªç”¨æˆ·çš„æµè§ˆå™¨,å´ä¸èƒ½ä¿è¯è¯·æ±‚æœ¬èº«æ˜¯ç”¨æˆ·è‡ªæ„¿å‘å‡ºçš„ã€‚è¿™é‡Œæœ‰ä¸€äº›å¦‚ Firefoxã€Opera ç­‰æµè§ˆå™¨ä½¿ç”¨å•è¿›ç¨‹æœºåˆ¶ï¼Œ<strong>å¤šä¸ªçª—å£æˆ–æ ‡ç­¾ä½¿ç”¨åŒä¸€ä¸ªè¿›ç¨‹ï¼Œå…±äº« Cookie ç­‰ä¼šè¯æ•°æ®</strong>ã€‚IE åˆ™æ··åˆä½¿ç”¨å•è¿›ç¨‹ä¸å¤šè¿›ç¨‹æ¨¡å¼ï¼Œä¸€ä¸ªçª—å£ä¸­çš„å¤šä¸ªæ ‡ç­¾ï¼Œä»¥åŠä½¿ç”¨â€œCTRL+Nâ€ æˆ–å•å‡»ç½‘é¡µä¸­çš„é“¾æ¥æ‰“å¼€çš„æ–°çª—å£ä½¿ç”¨åŒä¸€è¿›ç¨‹ï¼Œå…±äº«ä¼šè¯æ•°æ®ï¼›åªæœ‰ç›´æ¥è¿è¡Œ IE å¯æ‰§è¡Œç¨‹åºæ‰“å¼€çª—å£æ—¶ï¼Œæ‰ä¼šåˆ›å»ºæ–°çš„è¿›ç¨‹ã€‚<strong>Chrome è™½ç„¶ä½¿ç”¨å¤šè¿›ç¨‹æœºåˆ¶ï¼Œç„¶è€Œç»æµ‹è¯•å‘ç°ï¼Œå…¶ä¸åŒçš„çª—å£æˆ–æ ‡ç­¾ä¹‹é—´ä»ä¼šå…±äº«ä¼šè¯æ•°æ®ï¼Œé™¤éä½¿ç”¨éšèº«è®¿é—®æ–¹å¼ã€‚</strong>å› è€Œï¼Œç”¨æˆ·åŒæ—¶æ‰“å¼€å¤šä¸ªæµè§ˆå™¨çª—å£æˆ–æ ‡ç­¾è®¿é—®äº’è”ç½‘èµ„æºæ—¶ï¼Œå°±ä¸º CSRF æ”»å‡»ç¯¡å¤ºç”¨æˆ·çš„ä¼šè¯ Cookie åˆ›é€ äº†æ¡ä»¶ã€‚å´ä¸èƒ½ä¿è¯è¯·æ±‚æœ¬èº«æ˜¯ç”¨æˆ·è‡ªæ„¿å‘å‡ºçš„ã€‚å…¶æœ€å…¸å‹çš„ä¾‹å­<strong>å°±æ˜¯å½“ cookie è¿˜æ²¡è¿‡æœŸæ—¶ï¼Œç”¨æˆ·æµè§ˆçš„ç½‘ç«™æœ‰ä¸å…¶æ²¡è¿‡æœŸçš„ç½‘ç«™çš„ä¸€äº› api è¯·æ±‚ï¼Œé‚£ä¹ˆå½“ç”¨æˆ·æµè§ˆè¿™ä¸ªæ¶æ„ç½‘ç«™æ—¶å°±å¯èƒ½ä¼šå—åˆ°å±å®³</strong>ã€‚<br><img src="https://cdn.jsdelivr.net/gh/PancakeDogLLL/imageBed/img/202112161949.png"><br><strong>ä¼šè¯å®šç½®(Session Fixation)æ”»å‡»</strong>æ˜¯æŒ‡ï¼Œæ”»å‡»è€…å‘å—å®³è€…ä¸»æœºæ³¨å…¥è‡ªå·±æ§åˆ¶çš„è®¤è¯ Cookie ç­‰ä¿¡æ¯ï¼Œä½¿å¾—å—å®³è€…ä»¥æ”»å‡»è€…çš„èº«ä»½ç™»å½•ç½‘ç«™ï¼Œä»è€Œçªƒå–å—å®³è€…çš„ä¼šè¯ä¿¡æ¯ã€‚æ³¨å…¥ Cookie çš„æ–¹æ³•åŒ…æ‹¬ï¼šä½¿ç”¨è·¨ç«™è„šæœ¬æˆ–æœ¨é©¬ç­‰æ¶æ„ç¨‹åºï¼›æˆ–ä¼ªé€ ä¸åˆæ³•ç½‘ç«™åŒåŸŸçš„ç«™ç‚¹ï¼Œå¹¶åˆ©ç”¨å„ç§æ–¹æ³•æ¬ºéª—ç”¨æˆ·è®¿é—®è¯¥ä»¿å†’ç½‘ç«™ï¼Œä»è€Œé€šè¿‡ HTTP å“åº”ä¸­çš„ Set-Cookie å¤´å°†æ”»å‡»è€…æ‹¥æœ‰çš„è¯¥åŸŸ Cookie å‘é€ç»™ç”¨æˆ·ç­‰ã€‚å› ä¸º sessionID ä¸€èˆ¬éƒ½ä¼šæ”¾åœ¨ cookie ä¸­å­˜å‚¨ï¼Œæ‰€ä»¥ä¼šå®¹æ˜“å—åˆ°ä¼šè¯å®šåˆ¶æ”»å‡»ã€‚</p><h3 id="Session"><a href="#Session" class="headerlink" title="Session"></a>Session</h3><h4 id="æ¦‚å¿µ-1"><a href="#æ¦‚å¿µ-1" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h4><p>ä¸ cookie ç›¸æ¯”ï¼Œsession å°±æ˜¯å­˜æ”¾åœ¨æœåŠ¡ç«¯äº†ï¼Œå®ƒè¡¨ç¤ºåœ¨å®¢æˆ·ç«¯ç™»å½•æ—¶ï¼ŒæœåŠ¡ç«¯ä¼šå‘æ”¾ä¸€ä¸ª sessionid åˆ°å®¢æˆ·ç«¯ï¼Œå®ƒä¸€èˆ¬å­˜åœ¨ cookie ä¸­ï¼Œæ‰€ä»¥å®¢æˆ·ç«¯ä»¥åçš„è¯·æ±‚å°±ä¼šåœ¨è¯·æ±‚å¤´çš„ cookies å­—æ®µä¸­æºå¸¦è¿™ä¸ªä¿¡æ¯ã€‚è¿™æ ·æœåŠ¡ç«¯å°±å¯ä»¥é€šè¿‡è¿™ä¸ªæ•°æ®åˆ¤æ–­å®¢æˆ·ç«¯çš„ç™»å½•çŠ¶æ€ã€‚è¿™å°±å¥½æ¯”æˆ‘ä»¬å»ç‚¹èœï¼Œç‚¹å¥½äº†åå•†å®¶ç»™æˆ‘ä»¬ä¸€ä¸ªå·ç ç‰Œï¼Œç­‰èœå¥½äº†ï¼Œå°±é€å¾€ç›¸åº”å·ç ç‰Œçš„ä½ç½®ã€‚</p><h4 id="å®‰å…¨æ€§-1"><a href="#å®‰å…¨æ€§-1" class="headerlink" title="å®‰å…¨æ€§"></a>å®‰å…¨æ€§</h4><p>å› ä¸º session æ˜¯æ”¾åœ¨æœåŠ¡å™¨ä¸Šçš„ï¼Œæ‰€ä»¥ä¸€èˆ¬çš„å®‰å…¨æ€§å°±è€ƒè™‘ sessionid çš„ä¼ªé€ ä¸æˆªè·ã€‚å¦‚æœ sessionid æ˜¯æ”¾åœ¨ cookie ä¸­çš„ï¼Œé‚£ä¹ˆ cookie çš„æ—¶æ•ˆå°±å†³å®šäº† sessionid å³ç™»å½•çŠ¶æ€çš„æ—¶æ•ˆã€‚<br>éœ€è¦æ³¨æ„çš„å°±æ˜¯ä¼šè¯å›ºå®šï¼ˆsession fixation)ï¼šæ„æ€æ˜¯æ”»å‡»è€…å…ˆè‡ªå·±è·å–ä¸€ä¸ª sessionid,ç„¶åå‡å†’ä¸€ä¸ªç½‘ç«™å¹¶å°†è¿æ¥å‘ç»™è¢«æ”»å‡»çš„äººï¼Œå½“å—å®³è€…ç™»å½•åï¼Œæ”»å‡»è€…å°±å¯ä»¥åŠ«æŒå—å®³äººçš„ä¼šè¯ã€‚å› ä¸ºåœ¨æ”»å‡»è€…ç™»å½•è·å– sessionid åï¼Œç½‘ç»œæœåŠ¡å™¨çœ‹åˆ°ä¼šè¯å·²ç»å»ºç«‹ï¼Œæ— éœ€åˆ›å»ºæ–°çš„ä¼šè¯ã€‚æ‰€ä»¥æ”»å‡»è€…å°±æˆåŠŸåœ°å†’å……äº†å—å®³è€…ï¼Œä»è€Œè·å–äº†å—å®³è€…çš„ä¿¡æ¯ã€‚</p><h3 id="Tokenï¼ˆJWTï¼‰"><a href="#Tokenï¼ˆJWTï¼‰" class="headerlink" title="Tokenï¼ˆJWTï¼‰"></a>Tokenï¼ˆJWTï¼‰</h3><h4 id="æ¦‚å¿µï¼š"><a href="#æ¦‚å¿µï¼š" class="headerlink" title="æ¦‚å¿µï¼š"></a>æ¦‚å¿µï¼š</h4><p>JSON Web Token (JWT) æ˜¯ä¸€ç§å¼€æ”¾æ ‡å‡† (RFC 7519)ï¼Œå®ƒå®šä¹‰äº†ä¸€ç§ç´§å‡‘ä¸”è‡ªåŒ…å«çš„æ–¹å¼ï¼Œç”¨äºåœ¨å„æ–¹ä¹‹é—´ä½œä¸º JSON å¯¹è±¡å®‰å…¨åœ°ä¼ è¾“ä¿¡æ¯ã€‚ç”±äºæ­¤ä¿¡æ¯ç»è¿‡æ•°å­—ç­¾åï¼Œå› æ­¤å¯ä»¥éªŒè¯å’Œä¿¡ä»»ã€‚ JWT å¯ä»¥ä½¿ç”¨ç§˜å¯†ï¼ˆä½¿ç”¨ HMAC ç®—æ³•ï¼‰æˆ–ä½¿ç”¨ RSA æˆ– ECDSA çš„å…¬é’¥/ç§é’¥å¯¹è¿›è¡Œç­¾åã€‚å°½ç®¡ JWTs å¯ä»¥è¢«åŠ å¯†ï¼Œä»¥ä¾¿åœ¨å„æ–¹ä¹‹é—´æä¾›ä¿å¯†æ€§ï¼Œä½†æˆ‘ä»¬å°†ä¸“æ³¨äºç­¾åçš„ä»¤ç‰Œã€‚ç­¾åçš„ä»¤ç‰Œå¯ä»¥éªŒè¯å…¶ä¸­åŒ…å«çš„ç´¢èµ”çš„å®Œæ•´æ€§ï¼Œè€ŒåŠ å¯†çš„ä»¤ç‰Œåˆ™å¯¹å…¶ä»–å„æ–¹éšè—è¿™äº›ç´¢èµ”ã€‚å½“ä»¤ç‰Œä½¿ç”¨å…¬é’¥/ç§é’¥å¯¹ç­¾åæ—¶ï¼Œç­¾åä¹Ÿè¯æ˜äº†åªæœ‰æŒæœ‰ç§é’¥çš„ä¸€æ–¹æ‰æ˜¯ç­¾åè€…ã€‚ - - - - <a href="https://jwt.io/introduction">https://jwt.io/introduction</a></p><h4 id="ç»„æˆï¼š"><a href="#ç»„æˆï¼š" class="headerlink" title="ç»„æˆï¼š"></a>ç»„æˆï¼š</h4><blockquote><p>å½¢å¦‚ï¼šxxxxx.yyyyy.zzzzz</p></blockquote><ol><li>headerï¼šæ ‡å¤´é€šå¸¸ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼šä»¤ç‰Œçš„ç±»å‹ï¼Œå³ JWTï¼Œä»¥åŠæ­£åœ¨ä½¿ç”¨çš„ç­¾åç®—æ³•ï¼Œä¾‹å¦‚ HMAC SHA256 æˆ– RSAã€‚<strong>ç„¶åï¼Œè¿™ä¸ª JSON è¢« Base64Url ç¼–ç ä»¥å½¢æˆ JWT çš„ç¬¬ä¸€éƒ¨åˆ†ã€‚</strong></li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;alg&quot;</span>: <span class="string">&quot;HS256&quot;</span>,</span><br><span class="line">  <span class="string">&quot;typ&quot;</span>: <span class="string">&quot;JWT&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>payloadï¼šåŒ…å«ä¸€äº›å£°æ˜ï¼Œ å£°æ˜æ˜¯å…³äºå®ä½“ï¼ˆé€šå¸¸æ˜¯ç”¨æˆ·ï¼‰å’Œé™„åŠ æ•°æ®çš„å£°æ˜ã€‚å…±æœ‰ä¸‰ç§ç±»å‹çš„ claimsï¼šæ³¨å†Œè´Ÿè½½ã€å…¬å…±è´Ÿè½½å’Œç§äººè´Ÿè½½ã€‚</li></ol><ul><li>Registered claimsï¼ˆæ³¨å†Œï¼‰: é€šå¸¸æœ‰å››ä¸ªéƒ¨åˆ†ï¼Œiss(issuer)ï¼Œexp (expiration time), sub (subject), aud (audience)ã€‚è¿˜æœ‰ä¸€äº›å…¶ä»–çš„ï¼Œæ¯”å¦‚ï¼šnbf (Not Before)ã€iat (Issued At)ã€jti (JWT ID)ã€‚<br><strong>issï¼ˆissuerï¼‰</strong>ï¼šå£°æ˜æ ‡è¯†å‘è¡Œè¯¥è¯ä¹¦çš„å§”æ‰˜äººã€‚<br>**exp (expiration time)**ï¼šå£°æ˜æ ‡è¯†äº†è¿‡æœŸæ—¶é—´æˆ–ä¹‹åä¸å¾—æ¥å— JWT è¿›è¡Œå¤„ç†<br>**sub (subject)**ï¼šJWT çš„ä¸»é¢˜ã€‚ JWT ä¸­çš„å£°æ˜é€šå¸¸æ˜¯å£°æ˜ï¼Œå…³äºä¸»é¢˜ã€‚ä¸»é¢˜å€¼å¿…é¡»è¦ä¹ˆè¢«é™å®šä¸ºåœ¨å‘è¡Œäººçš„ä¸Šä¸‹æ–‡ä¸­æ˜¯æœ¬åœ°å”¯ä¸€çš„ï¼Œæˆ–è€…æ˜¯å…¨çƒå”¯ä¸€çš„ã€‚<br>**aud (audience)**ï¼šå£°æ˜æ ‡è¯†äº† JWT çš„æ¥æ”¶è€…ã€‚</li><li>Public claimsï¼ˆå…¬å…±ï¼‰ï¼šè¿™äº›å¯ä»¥ç”±ä½¿ç”¨ JWT çš„äººéšæ„å®šä¹‰ã€‚ä½†æ˜¯ä¸ºäº†é¿å…å†²çªï¼Œå®ƒä»¬åº”è¯¥åœ¨ <a href="https://www.iana.org/assignments/jwt/jwt.xhtml">IANA JSON Web Token Registry</a> ä¸­å®šä¹‰ï¼Œæˆ–è€…å®šä¹‰ä¸ºåŒ…å«æŠ—å†²çªå‘½åç©ºé—´çš„ URIã€‚</li><li>Private claimsï¼ˆç§æœ‰ï¼‰ï¼šè¿™äº›æ˜¯ä¸ºäº†åœ¨åŒæ„ä½¿ç”¨å®ƒä»¬çš„å„æ–¹ä¹‹é—´å…±äº«ä¿¡æ¯è€Œåˆ›å»ºçš„è‡ªå®šä¹‰å£°æ˜ï¼Œè¿™äº›å£°æ˜æ—¢ä¸æ˜¯æ³¨å†Œå£°æ˜ä¹Ÿä¸æ˜¯å…¬å¼€å£°æ˜ã€‚æ­¤å£°æ˜çš„å¤„ç†é€šå¸¸æ˜¯<strong>ç‰¹å®šäºåº”ç”¨ç¨‹åº</strong>çš„ã€‚</li></ul><p><strong>ç„¶åï¼Œè¿™ä¸ª JSON è¢« Base64Url ç¼–ç ä»¥å½¢æˆ JWT çš„ç¬¬äºŒéƒ¨åˆ†ã€‚</strong><br><strong>è¿™é‡Œï¼Œheader ä¸ payload éƒ½æ˜¯å¯ä»¥ç›´æ¥é€šè¿‡ base64url è§£ç è·å¾—å…¶ json æ•°æ®çš„ã€‚</strong> 3. signatureï¼šç­¾åï¼Œè¿™æ˜¯ jwt æœ€æ ¸å¿ƒçš„éƒ¨åˆ†ï¼Œå°±æ˜¯åŒ…å« base64 ç¼–ç çš„ header,payload,ä»¥åŠ secretï¼Œæœ€åå†å°†æ•´ä¸ªä½¿ç”¨åŠ å¯†ç®—æ³•è¿›è¡ŒåŠ å¯†ã€‚å…¶ä¸­çš„ secret å°±æ˜¯æœåŠ¡ç«¯å‘æ”¾çš„ç§é’¥ã€‚</p><blockquote><p>å½¢å¦‚ï¼š<br>HMACSHA256(<br>base64UrlEncode(header) + â€œ.â€ +<br>base64UrlEncode(payload),<br>secret<br>)</p></blockquote><h4 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h4><p>æ¯å½“ç”¨æˆ·æƒ³è¦è®¿é—®å—ä¿æŠ¤çš„è·¯ç”±æˆ–èµ„æºæ—¶ï¼Œç”¨æˆ·ä»£ç†åº”å‘é€ JWTï¼Œé€šå¸¸åœ¨ä½¿ç”¨ Bearer æ¨¡å¼çš„ Authorization æ ‡å¤´ä¸­ã€‚æ ‡é¢˜çš„å†…å®¹åº”å¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Authorization: Bearer &lt;token&gt;</span><br></pre></td></tr></table></figure><p>å¦‚æœä»¤ç‰Œåœ¨ Authorization æ ‡å¤´ä¸­å‘é€ï¼Œåˆ™è·¨æºèµ„æºå…±äº« (CORS) ä¸ä¼šæˆä¸ºé—®é¢˜ï¼Œå› ä¸ºå®ƒä¸ä½¿ç”¨ cookieï¼ˆcookie æ˜¯ä¸èƒ½è·¨åŸŸçš„ï¼‰ã€‚è¿™ä¸€ç‚¹å°±éå¸¸é€‚åˆå•ç‚¹ç™»å½•ã€‚</p><h4 id="å®‰å…¨æ€§-2"><a href="#å®‰å…¨æ€§-2" class="headerlink" title="å®‰å…¨æ€§"></a>å®‰å…¨æ€§</h4><p>å› ä¸ºåœ¨ jwt ç­¾å‘çš„æ—¶å€™ï¼Œå¯†é’¥æ˜¯æœåŠ¡ç«¯ç”Ÿæˆçš„ï¼Œæ‰€ä»¥æ¥è¯´æ˜¯æ¯”è¾ƒå®‰å…¨çš„ï¼Œå½“ payload çš„æ•°æ®ä¿®æ”¹åï¼Œå‘é€ç»™æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯ä¼šé‡‡ç”¨ç›¸åŒçš„åŠ å¯†ç®—æ³•ç”Ÿæˆä¸€ä¸ª token å‰¯æœ¬ä¸ä¹‹å‰ç­¾å‘çš„è¿›è¡Œå¯¹æ¯”ï¼Œæ˜¾ç„¶ï¼Œä¿®æ”¹åçš„æ•°æ®å†æ¬¡åŠ å¯†åä¸ä¹‹å‰çš„ token å¯¹æ¯”è‚¯å®šä¸åŒã€‚<br>åœ¨ payload ä¸­ï¼Œå› ä¸ºæ˜¯ base64url ç¼–ç çš„ï¼Œæ‰€ä»¥å¾ˆå®¹æ˜“è§£ç è·å–ä¿¡æ¯ï¼Œå› æ­¤ä¸å®œåœ¨é‡Œé¢æ”¾ä¸€äº›æ¯”è¾ƒé‡è¦çš„ä¿¡æ¯ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;strong&gt;é¦–å…ˆå‘¢ï¼Œç½‘ä¸Šå…³äºå®ƒä»¬çš„æ–‡ç« å·²ç»å¾ˆå¤šäº†ï¼Œåœ¨è¿™é‡Œæˆ‘å°±åªæ˜¯æ¥è®°å½•ä»¥ä¸‹æˆ‘çš„ç†è§£ï¼Œå…¶å®ä¹Ÿæ˜¯çœ‹å…¶ä»–ç½‘ä¸Šå†…å®¹çš„ä¸€ä¸ªæ€»ç»“å§ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;å‰è¨€ï¼šç”±äº HTTP åè®®æ— çŠ¶æ€çš„ç¼ºé™·ã€‚WEB çš„è®¾è®¡è€…ä»¬æå‡ºäº† Cookie å’Œ Session ä¸¤ç§è§£å†³æœºåˆ¶ã€‚è€Œ token,é€šå¸¸æ˜¯ jwt(json web token)ä½œä¸ºä¸€ç§ç”¨æˆ·èº«ä»½ä»¤ç‰Œï¼Œä¹Ÿå¸¸å¸¸ç”¨äºè®°å½• http çš„çŠ¶æ€å­˜å‚¨ï¼Œé€šå¸¸æ˜¯åœ¨ç”¨æˆ·ç™»å½•åï¼Œä¼´éšæ¯ä¸€æ¬¡è¯·æ±‚å‘é€ç»™ç»™åç«¯ã€‚ä¸‹é¢å°±æ¥èŠèŠå®ƒä»¬ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="web" scheme="https://jealh.xyz/categories/web/"/>
    
    
  </entry>
  
  <entry>
    <title>ä¸€æ¬¡base64æŒ‡ä»¤çš„powershell</title>
    <link href="https://jealh.xyz/2021/11/18/%E4%B8%80%E6%AC%A1base64%E6%8C%87%E4%BB%A4%E7%9A%84powershell/"/>
    <id>https://jealh.xyz/2021/11/18/%E4%B8%80%E6%AC%A1base64%E6%8C%87%E4%BB%A4%E7%9A%84powershell/</id>
    <published>2021-11-18T14:33:12.000Z</published>
    <updated>2022-12-31T10:26:33.597Z</updated>
    
    <content type="html"><![CDATA[<p><strong>äº‹æƒ…å‘ç”Ÿæ˜¯åœ¨ä¸€ä¸ªæœˆé»‘é£é«˜çš„æ™šä¸Šã€‚ã€‚ã€‚ã€‚ä¸å¥½æ„æ€æé”™äº† ğŸ˜¬ã€‚</strong><br><strong>äº‹æƒ…æ˜¯è¿™æ ·çš„ï¼Œä»Šå¤©åœ¨ä½¿ç”¨ webpack-dev-middleware æ„å»ºå¼€å‘ç¯å¢ƒçš„æ—¶å€™ï¼Œæƒ³è¦ä½¿ç”¨ node å¯åŠ¨æµè§ˆå™¨å¹¶è‡ªåŠ¨æ‰“å¼€ç›¸å…³çš„æœ¬åœ°ç½‘å€ã€‚äºæ˜¯å°±å‘ç”Ÿäº†ä¸‹é¢çš„ä¸€å¹•ã€‚</strong><br><img src="https://cdn.jsdelivr.net/gh/PancakeDogLLL/imageBed/img/u=1178727920,923148390&fm=26&fmt=auto.webp"></p><span id="more"></span><h1 id="å…³äº-open-è¿™ä¸ª-node-module"><a href="#å…³äº-open-è¿™ä¸ª-node-module" class="headerlink" title="å…³äº open è¿™ä¸ª node_module"></a>å…³äº open è¿™ä¸ª node_module</h1><p><strong>è¿™æ˜¯ä¸€ä¸ª node çš„ä¾èµ–åŒ…ï¼Œä½¿ç”¨å…¶æä¾›çš„ç›¸å…³ api å¯ä»¥ç”¨æµè§ˆå™¨æ‰“å¼€å…·ä½“çš„ç½‘å€ã€‚å…·ä½“ç”¨æ³•å¦‚ä¸‹</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> open = <span class="built_in">require</span>(<span class="string">&quot;open&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Opens the image in the default image viewer and waits for the opened app to quit.</span></span><br><span class="line"><span class="keyword">await</span> open(<span class="string">&quot;unicorn.png&quot;</span>, &#123; <span class="attr">wait</span>: <span class="literal">true</span> &#125;);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;The image viewer app quit&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Opens the URL in the default browser.</span></span><br><span class="line"><span class="keyword">await</span> open(<span class="string">&quot;https://sindresorhus.com&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Opens the URL in a specified browser.</span></span><br><span class="line"><span class="keyword">await</span> open(<span class="string">&quot;https://sindresorhus.com&quot;</span>, &#123; <span class="attr">app</span>: &#123; <span class="attr">name</span>: <span class="string">&quot;firefox&quot;</span> &#125; &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Specify app arguments.</span></span><br><span class="line"><span class="keyword">await</span> open(<span class="string">&quot;https://sindresorhus.com&quot;</span>, &#123;</span><br><span class="line">  <span class="attr">app</span>: &#123; <span class="attr">name</span>: <span class="string">&quot;google chrome&quot;</span>, <span class="attr">arguments</span>: [<span class="string">&quot;--incognito&quot;</span>] &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Open an app</span></span><br><span class="line"><span class="keyword">await</span> open.openApp(<span class="string">&quot;xcode&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Open an app with arguments</span></span><br><span class="line"><span class="keyword">await</span> open.openApp(open.apps.chrome, &#123; <span class="attr">arguments</span>: [<span class="string">&quot;--incognito&quot;</span>] &#125;);</span><br></pre></td></tr></table></figure><p><strong>ä¸ºäº†ä¸€æ¢ç©¶ç«Ÿï¼Œå®ƒæ˜¯æ€æ ·æ‰“å¼€æµè§ˆå™¨çš„ï¼Œæ‰€ä»¥æˆ‘å°±å¼€å§‹äº†æŸ¥çœ‹æºä»£ç ä¹‹æ—…ã€‚ç„¶åå°±å‡ºç°äº† powershell æ‰§è¡Œ base64 ç¼–ç çš„å‘½ä»¤è¿™ä¸ªæœ‰è¶£çš„äº‹æƒ…äº†ã€‚</strong></p><h1 id="åœ¨-powershell-ä¸­ä½¿ç”¨-base64-ç¼–ç çš„æŒ‡ä»¤"><a href="#åœ¨-powershell-ä¸­ä½¿ç”¨-base64-ç¼–ç çš„æŒ‡ä»¤" class="headerlink" title="åœ¨ powershell ä¸­ä½¿ç”¨ base64 ç¼–ç çš„æŒ‡ä»¤"></a>åœ¨ powershell ä¸­ä½¿ç”¨ base64 ç¼–ç çš„æŒ‡ä»¤</h1><p><strong>åœ¨ open çš„æºç ä¸­ï¼Œæœ‰ä¸ª encodeArguments çš„æ•°ç»„ï¼Œå¤§æ¦‚æ˜¯è¿™ä¸ªæ ·å­[â€˜startâ€™, â€˜http://â€¦.â€™ ]ï¼Œå…¶æ‰“å¼€æµè§ˆçš„çš„ä¸»è¦å‘½ä»¤å°±æ˜¯</strong></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">start</span> (application) &lt;ç½‘å€&gt;</span><br></pre></td></tr></table></figure><p><strong>è€Œå®ƒåœ¨ä¼ é€’ powershell å‘½ä»¤æ—¶æœ‰è¿™æ ·ä¸€è¡Œä»£ç ä»£ç ,é€šè¿‡æ³¨é‡Šæˆ‘ä»¬å¯ä»¥æ˜ç™½è¿™æ˜¯ä¸€ä¸ªä½¿ç”¨ base64 ç¼–ç çš„ powershell å‘½ä»¤ã€‚äºæ˜¯ä¹æˆ‘å°±å¼€å§‹äº†æˆ‘çš„å®éªŒæ€§æ¢ç©¶äº†äº†</strong>ğŸ¥³ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Using Base64-encoded command, accepted by PowerShell, to allow special characters.</span></span><br><span class="line">target = Buffer.from(encodedArguments.join(<span class="string">&quot; &quot;</span>), <span class="string">&quot;utf16le&quot;</span>).to;</span><br></pre></td></tr></table></figure><p><strong>æœä¸å…¶ç„¶ï¼Œåœ¨å¾®è½¯çš„æ–‡æ¡£é‡Œç¡®å®æŸ¥åˆ°äº† ğŸ˜ƒ,ä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯éœ€è¦ utf-16le çš„ç¼–ç ã€‚</strong><br><strong><em>é“›é“›é“›é“›ï¼ï¼</em></strong><br><img src="https://cdn.jsdelivr.net/gh/PancakeDogLLL/imageBed/img/encodedCommand.png"></p><h1 id="å®é™…æµ‹è¯•"><a href="#å®é™…æµ‹è¯•" class="headerlink" title="å®é™…æµ‹è¯•"></a>å®é™…æµ‹è¯•</h1><p><strong>ä¸‹é¢æˆ‘å°±ä»¥ node æ‰“å¼€æµè§ˆå™¨ä¸ºä¾‹å­ï¼Œè¿›è¡Œ base64 ç¼–ç å‘½ä»¤çš„æµ‹è¯•ã€‚</strong><br><strong>node æ‰“å¼€æµè§ˆå™¨çš„ä»£ç å¦‚ä¸‹ï¼š</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> cp = <span class="built_in">require</span>(<span class="string">&#x27;child_process&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–base64ç¼–ç çš„æŒ‡ä»¤</span></span><br><span class="line"><span class="keyword">let</span> command = Buffer.from(&lt;ç›®æ ‡æŒ‡ä»¤&gt; <span class="string">&#x27;utf16le&#x27;</span>).toString(<span class="string">&#x27;base64&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> subprocess = cp.spawn(<span class="string">`<span class="subst">$&#123;process.env.SYSTEMROOT&#125;</span>\\System32\\WindowsPowerShell\\v1.0\\powershell`</span>, [</span><br><span class="line">    <span class="string">&quot;-EncodedCommand&quot;</span>,</span><br><span class="line">    <span class="string">&#x27;cwB0AGEAcgB0ACAAaAB0AHQAcAA6AC8ALwBiAGEAaQBkAHUALgBjAG8AbQA=&#x27;</span></span><br><span class="line">    <span class="comment">// &#x27;start http://baidu.com&#x27; ä¸Šé¢æ˜¯è¿™ä¸€è¡Œå‘½ä»¤çš„ç¼–ç </span></span><br><span class="line">], &#123;</span><br><span class="line">    <span class="attr">windowsVerbatimArguments</span>: <span class="literal">true</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><strong>ä¸‹é¢æ˜¯æ•ˆæœå›¾</strong><br><img src="https://cdn.jsdelivr.net/gh/PancakeDogLLL/imageBed/img/20211191146.gif"><br><strong>å¥‡æ€ªçš„çŸ¥è¯†åˆå¢åŠ äº† ğŸŒŸ</strong></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;strong&gt;äº‹æƒ…å‘ç”Ÿæ˜¯åœ¨ä¸€ä¸ªæœˆé»‘é£é«˜çš„æ™šä¸Šã€‚ã€‚ã€‚ã€‚ä¸å¥½æ„æ€æé”™äº† ğŸ˜¬ã€‚&lt;/strong&gt;&lt;br&gt;&lt;strong&gt;äº‹æƒ…æ˜¯è¿™æ ·çš„ï¼Œä»Šå¤©åœ¨ä½¿ç”¨ webpack-dev-middleware æ„å»ºå¼€å‘ç¯å¢ƒçš„æ—¶å€™ï¼Œæƒ³è¦ä½¿ç”¨ node å¯åŠ¨æµè§ˆå™¨å¹¶è‡ªåŠ¨æ‰“å¼€ç›¸å…³çš„æœ¬åœ°ç½‘å€ã€‚äºæ˜¯å°±å‘ç”Ÿäº†ä¸‹é¢çš„ä¸€å¹•ã€‚&lt;/strong&gt;&lt;br&gt;&lt;img src=&quot;https://cdn.jsdelivr.net/gh/PancakeDogLLL/imageBed/img/u=1178727920,923148390&amp;fm=26&amp;fmt=auto.webp&quot;&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="ä¸€äº›è¶£äº‹çš„ğŸŒŸ" scheme="https://jealh.xyz/categories/%E4%B8%80%E4%BA%9B%E8%B6%A3%E4%BA%8B%E7%9A%84%F0%9F%8C%9F/"/>
    
    
  </entry>
  
  <entry>
    <title>ä½¿ç”¨github actionsè¿›è¡Œè½»æœåŠ¡çš„é¡µé¢éƒ¨ç½²</title>
    <link href="https://jealh.xyz/2021/10/22/actions%E8%BF%9B%E8%A1%8C%E8%BD%BB%E6%9C%8D%E5%8A%A1%E7%9A%84%E9%A1%B5%E9%9D%A2%E9%83%A8%E7%BD%B2/"/>
    <id>https://jealh.xyz/2021/10/22/actions%E8%BF%9B%E8%A1%8C%E8%BD%BB%E6%9C%8D%E5%8A%A1%E7%9A%84%E9%A1%B5%E9%9D%A2%E9%83%A8%E7%BD%B2/</id>
    <published>2021-10-22T02:22:14.000Z</published>
    <updated>2022-12-31T10:26:33.581Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ä½¿ç”¨-github-actions-è¿›è¡Œè½»æœåŠ¡çš„é¡µé¢æ‰˜ç®¡"><a href="#ä½¿ç”¨-github-actions-è¿›è¡Œè½»æœåŠ¡çš„é¡µé¢æ‰˜ç®¡" class="headerlink" title="ä½¿ç”¨ github actions è¿›è¡Œè½»æœåŠ¡çš„é¡µé¢æ‰˜ç®¡"></a>ä½¿ç”¨ github actions è¿›è¡Œ<a href="https://qingfuwu.cn/">è½»æœåŠ¡</a>çš„é¡µé¢æ‰˜ç®¡</h1><h3 id="é¦–å…ˆï¼Œè½»æœåŠ¡å®˜æ–¹æ–‡æ¡£ç»™å‡ºäº†æ‰‹åŠ¨éƒ¨ç½²é¡µé¢çš„æ•™ç¨‹é¡µé¢æ‰˜ç®¡ã€‚è€Œæˆ‘è¿™é‡Œå°±ç®€å•åœ°ä»‹ç»ä¸€ä¸‹ä½¿ç”¨-github-actions-çš„è‡ªåŠ¨éƒ¨ç½²ã€‚åªè¦ä¼šä¸€ç‚¹-github-actions-å®ç°èµ·æ¥ä¹Ÿæ¯”è¾ƒç®€å•ã€‚"><a href="#é¦–å…ˆï¼Œè½»æœåŠ¡å®˜æ–¹æ–‡æ¡£ç»™å‡ºäº†æ‰‹åŠ¨éƒ¨ç½²é¡µé¢çš„æ•™ç¨‹é¡µé¢æ‰˜ç®¡ã€‚è€Œæˆ‘è¿™é‡Œå°±ç®€å•åœ°ä»‹ç»ä¸€ä¸‹ä½¿ç”¨-github-actions-çš„è‡ªåŠ¨éƒ¨ç½²ã€‚åªè¦ä¼šä¸€ç‚¹-github-actions-å®ç°èµ·æ¥ä¹Ÿæ¯”è¾ƒç®€å•ã€‚" class="headerlink" title="é¦–å…ˆï¼Œè½»æœåŠ¡å®˜æ–¹æ–‡æ¡£ç»™å‡ºäº†æ‰‹åŠ¨éƒ¨ç½²é¡µé¢çš„æ•™ç¨‹é¡µé¢æ‰˜ç®¡ã€‚è€Œæˆ‘è¿™é‡Œå°±ç®€å•åœ°ä»‹ç»ä¸€ä¸‹ä½¿ç”¨ github actions çš„è‡ªåŠ¨éƒ¨ç½²ã€‚åªè¦ä¼šä¸€ç‚¹ github actions,å®ç°èµ·æ¥ä¹Ÿæ¯”è¾ƒç®€å•ã€‚"></a>é¦–å…ˆï¼Œè½»æœåŠ¡å®˜æ–¹æ–‡æ¡£ç»™å‡ºäº†æ‰‹åŠ¨éƒ¨ç½²é¡µé¢çš„æ•™ç¨‹<a href="https://qingfuwu.cn/docs/openapi/sdk/hosting.html#%E8%8E%B7%E5%8F%96%E9%A1%B5%E9%9D%A2%E6%89%98%E7%AE%A1%E4%BF%A1%E6%81%AF">é¡µé¢æ‰˜ç®¡</a>ã€‚è€Œæˆ‘è¿™é‡Œå°±ç®€å•åœ°ä»‹ç»ä¸€ä¸‹ä½¿ç”¨ github actions çš„è‡ªåŠ¨éƒ¨ç½²ã€‚åªè¦ä¼šä¸€ç‚¹ github actions,å®ç°èµ·æ¥ä¹Ÿæ¯”è¾ƒç®€å•ã€‚</h3><p><a href="https://qcjtoy.web.cloudendpoint.cn/">çœ‹çœ‹æ•ˆæœ</a></p><h3 id="1-github-åˆ›å»ºä»“åº“ï¼Œé…ç½®-github-workflow-yml-åŒæ—¶è®¾ç½®-secrets-å˜é‡-ACCESS-TOKEN-ä¸-SERVICE-ID"><a href="#1-github-åˆ›å»ºä»“åº“ï¼Œé…ç½®-github-workflow-yml-åŒæ—¶è®¾ç½®-secrets-å˜é‡-ACCESS-TOKEN-ä¸-SERVICE-ID" class="headerlink" title="1.github åˆ›å»ºä»“åº“ï¼Œé…ç½®.github/workflow/*.yml,åŒæ—¶è®¾ç½® secrets å˜é‡ ACCESS_TOKEN ä¸ SERVICE_ID."></a>1.github åˆ›å»ºä»“åº“ï¼Œé…ç½®.github/workflow/*.yml,åŒæ—¶è®¾ç½® secrets å˜é‡ ACCESS_TOKEN ä¸ SERVICE_ID.</h3><ul><li><h4 id="é…ç½®-workflow-çš„-yml-æ–‡ä»¶ã€‚"><a href="#é…ç½®-workflow-çš„-yml-æ–‡ä»¶ã€‚" class="headerlink" title="é…ç½® workflow çš„ yml æ–‡ä»¶ã€‚"></a>é…ç½® workflow çš„ yml æ–‡ä»¶ã€‚</h4>ç›´æ¥å¤åˆ¶é‡Œé¢çš„ Usage,<a href="https://github.com/marketplace/actions/deploy-to-byteinspire-hosting">Deploy to ByteInspire Hosting</a></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">name:</span> <span class="string">Deploy</span> <span class="string">Hosting</span></span><br><span class="line"></span><br><span class="line"><span class="attr">on:</span> <span class="string">push</span></span><br><span class="line"></span><br><span class="line"><span class="attr">jobs:</span></span><br><span class="line">  <span class="attr">build_and_deploy:</span></span><br><span class="line">    <span class="attr">runs-on:</span> <span class="string">ubuntu-latest</span></span><br><span class="line">    <span class="attr">steps:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">uses:</span> <span class="string">actions/checkout@v2</span></span><br><span class="line">      <span class="comment"># Add any build steps here. For example:</span></span><br><span class="line">      <span class="comment"># - run: npm ci &amp;&amp; npm run build</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">uses:</span> <span class="string">byteinspire/hosting-deployer-action@v1</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">service-id:</span> <span class="string">&quot;$<span class="template-variable">&#123;&#123; secrets.SERVICE_ID &#125;&#125;</span>&quot;</span></span><br><span class="line">          <span class="attr">token:</span> <span class="string">&quot;$<span class="template-variable">&#123;&#123; secrets.ACCESS_TOKEN &#125;&#125;</span>&quot;</span></span><br><span class="line">          <span class="comment"># Or you can use file param to directly specify the ziped file path</span></span><br><span class="line">          <span class="attr">directory:</span> <span class="string">./</span></span><br></pre></td></tr></table></figure><span id="more"></span><ul><li><h4 id="é…ç½®-secrets-çš„å˜é‡-ACCESS-TOKEN-ä¸-SERVICE-ID"><a href="#é…ç½®-secrets-çš„å˜é‡-ACCESS-TOKEN-ä¸-SERVICE-ID" class="headerlink" title="é…ç½® secrets çš„å˜é‡ ACCESS_TOKEN ä¸ SERVICE_ID"></a>é…ç½® secrets çš„å˜é‡ ACCESS_TOKEN ä¸ SERVICE_ID</h4></li></ul><ol><li>ACCESS_TOKEN<br>å®˜æ–¹å·²ç»å†™å¾—å¾ˆè¯¦ç»†äº†<a href="https://qingfuwu.cn/docs/openapi/personaltoken.html#%E5%88%9B%E5%BB%BA%E4%B8%AA%E4%BA%BA%E8%AE%BF%E9%97%AE%E5%87%AD%E8%AF%81">åˆ›å»ºå’Œç®¡ç†è®¿é—®å‡­è¯</a><br><img src="https://cdn.jsdelivr.net/gh/PancakeDogLLL/imageBed/img/202110221004.png"><br><img src="https://cdn.jsdelivr.net/gh/PancakeDogLLL/imageBed/img/202110221006.png"></li><li>SERVICE_ID<br>ç™»å½•è½»æœåŠ¡å<a href="https://qingfuwu.cn/dashboard">https://qingfuwu.cn/dashboard</a>ï¼Œåœ¨é¦–é¡µå°±èƒ½çœ‹è§ä½ åˆ›å»ºçš„æ‰€æœ‰æœåŠ¡ã€‚<br><img src="https://cdn.jsdelivr.net/gh/PancakeDogLLL/imageBed/img/202110220950.png"><br>è¿™é‡Œå°±é€‰æ‹© hello world è¿™ä¸ªæœåŠ¡ï¼Œç‚¹å‡»è¿›å»ï¼Œå†è¿›å…¥åˆ°è®¾ç½®é‡Œé¢å°±å¯ä»¥çœ‹è§ SERVICE_ID.å½“ç„¶è¿™é‡Œä½ ä¹Ÿå¯ä»¥ç›´æ¥ç‚¹å‡»é¡µé¢æ‰˜ç®¡ï¼Œä¸Šä¼ å‹ç¼©æ–‡ä»¶æ‰‹åŠ¨éƒ¨ç½²ã€‚<img src="https://cdn.jsdelivr.net/gh/PancakeDogLLL/imageBed/img/202110220952.png"></li><li>æ·»åŠ å˜é‡åˆ° secrets é‡Œé¢ï¼Œè¿™é‡Œæˆ‘å·²ç»æ·»åŠ ä¸Šäº†ã€‚è¿™é‡Œè¦æ³¨æ„çš„æ˜¯è®¾ç½® respository secretï¼Œå› ä¸ºæœ€å¼€å§‹è®¾ç½®æˆ environment secret è€Œå¤±è´¥å‡ æ¬¡ ğŸ˜­<br><img src="https://cdn.jsdelivr.net/gh/PancakeDogLLL/imageBed/img/202110220955.png"></li></ol><h3 id="2-ç»è¿‡ä¸Šé¢çš„æ­¥éª¤ï¼Œå¤§è‡´å°±å¯ä»¥å®Œæˆäº†ã€‚"><a href="#2-ç»è¿‡ä¸Šé¢çš„æ­¥éª¤ï¼Œå¤§è‡´å°±å¯ä»¥å®Œæˆäº†ã€‚" class="headerlink" title="2. ç»è¿‡ä¸Šé¢çš„æ­¥éª¤ï¼Œå¤§è‡´å°±å¯ä»¥å®Œæˆäº†ã€‚"></a>2. ç»è¿‡ä¸Šé¢çš„æ­¥éª¤ï¼Œå¤§è‡´å°±å¯ä»¥å®Œæˆäº†ã€‚</h3><p>#####çœ‹çœ‹ actions å§ï¼Œå¿½ç•¥å‰å‡ æ¬¡ environment secret çš„é”… ğŸ˜‚<br><img src="https://cdn.jsdelivr.net/gh/PancakeDogLLL/imageBed/img/202110221013.png"><br>è¿›å…¥é¡µé¢æ‰˜ç®¡ï¼Œç‚¹å‡»ç½‘ç«™åŸŸåï¼Œå°±å¯ä»¥çœ‹è§éƒ¨ç½²åçš„é¡µé¢äº†ã€‚<br><img src="https://cdn.jsdelivr.net/gh/PancakeDogLLL/imageBed/img/202110221016.png"><br>æœ€ç»ˆæ•ˆæœï¼š<br><img src="https://cdn.jsdelivr.net/gh/PancakeDogLLL/imageBed/img/202110221025.png"></p>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;ä½¿ç”¨-github-actions-è¿›è¡Œè½»æœåŠ¡çš„é¡µé¢æ‰˜ç®¡&quot;&gt;&lt;a href=&quot;#ä½¿ç”¨-github-actions-è¿›è¡Œè½»æœåŠ¡çš„é¡µé¢æ‰˜ç®¡&quot; class=&quot;headerlink&quot; title=&quot;ä½¿ç”¨ github actions è¿›è¡Œè½»æœåŠ¡çš„é¡µé¢æ‰˜ç®¡&quot;&gt;&lt;/a&gt;ä½¿ç”¨ github actions è¿›è¡Œ&lt;a href=&quot;https://qingfuwu.cn/&quot;&gt;è½»æœåŠ¡&lt;/a&gt;çš„é¡µé¢æ‰˜ç®¡&lt;/h1&gt;&lt;h3 id=&quot;é¦–å…ˆï¼Œè½»æœåŠ¡å®˜æ–¹æ–‡æ¡£ç»™å‡ºäº†æ‰‹åŠ¨éƒ¨ç½²é¡µé¢çš„æ•™ç¨‹é¡µé¢æ‰˜ç®¡ã€‚è€Œæˆ‘è¿™é‡Œå°±ç®€å•åœ°ä»‹ç»ä¸€ä¸‹ä½¿ç”¨-github-actions-çš„è‡ªåŠ¨éƒ¨ç½²ã€‚åªè¦ä¼šä¸€ç‚¹-github-actions-å®ç°èµ·æ¥ä¹Ÿæ¯”è¾ƒç®€å•ã€‚&quot;&gt;&lt;a href=&quot;#é¦–å…ˆï¼Œè½»æœåŠ¡å®˜æ–¹æ–‡æ¡£ç»™å‡ºäº†æ‰‹åŠ¨éƒ¨ç½²é¡µé¢çš„æ•™ç¨‹é¡µé¢æ‰˜ç®¡ã€‚è€Œæˆ‘è¿™é‡Œå°±ç®€å•åœ°ä»‹ç»ä¸€ä¸‹ä½¿ç”¨-github-actions-çš„è‡ªåŠ¨éƒ¨ç½²ã€‚åªè¦ä¼šä¸€ç‚¹-github-actions-å®ç°èµ·æ¥ä¹Ÿæ¯”è¾ƒç®€å•ã€‚&quot; class=&quot;headerlink&quot; title=&quot;é¦–å…ˆï¼Œè½»æœåŠ¡å®˜æ–¹æ–‡æ¡£ç»™å‡ºäº†æ‰‹åŠ¨éƒ¨ç½²é¡µé¢çš„æ•™ç¨‹é¡µé¢æ‰˜ç®¡ã€‚è€Œæˆ‘è¿™é‡Œå°±ç®€å•åœ°ä»‹ç»ä¸€ä¸‹ä½¿ç”¨ github actions çš„è‡ªåŠ¨éƒ¨ç½²ã€‚åªè¦ä¼šä¸€ç‚¹ github actions,å®ç°èµ·æ¥ä¹Ÿæ¯”è¾ƒç®€å•ã€‚&quot;&gt;&lt;/a&gt;é¦–å…ˆï¼Œè½»æœåŠ¡å®˜æ–¹æ–‡æ¡£ç»™å‡ºäº†æ‰‹åŠ¨éƒ¨ç½²é¡µé¢çš„æ•™ç¨‹&lt;a href=&quot;https://qingfuwu.cn/docs/openapi/sdk/hosting.html#%E8%8E%B7%E5%8F%96%E9%A1%B5%E9%9D%A2%E6%89%98%E7%AE%A1%E4%BF%A1%E6%81%AF&quot;&gt;é¡µé¢æ‰˜ç®¡&lt;/a&gt;ã€‚è€Œæˆ‘è¿™é‡Œå°±ç®€å•åœ°ä»‹ç»ä¸€ä¸‹ä½¿ç”¨ github actions çš„è‡ªåŠ¨éƒ¨ç½²ã€‚åªè¦ä¼šä¸€ç‚¹ github actions,å®ç°èµ·æ¥ä¹Ÿæ¯”è¾ƒç®€å•ã€‚&lt;/h3&gt;&lt;p&gt;&lt;a href=&quot;https://qcjtoy.web.cloudendpoint.cn/&quot;&gt;çœ‹çœ‹æ•ˆæœ&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&quot;1-github-åˆ›å»ºä»“åº“ï¼Œé…ç½®-github-workflow-yml-åŒæ—¶è®¾ç½®-secrets-å˜é‡-ACCESS-TOKEN-ä¸-SERVICE-ID&quot;&gt;&lt;a href=&quot;#1-github-åˆ›å»ºä»“åº“ï¼Œé…ç½®-github-workflow-yml-åŒæ—¶è®¾ç½®-secrets-å˜é‡-ACCESS-TOKEN-ä¸-SERVICE-ID&quot; class=&quot;headerlink&quot; title=&quot;1.github åˆ›å»ºä»“åº“ï¼Œé…ç½®.github/workflow/*.yml,åŒæ—¶è®¾ç½® secrets å˜é‡ ACCESS_TOKEN ä¸ SERVICE_ID.&quot;&gt;&lt;/a&gt;1.github åˆ›å»ºä»“åº“ï¼Œé…ç½®.github/workflow/*.yml,åŒæ—¶è®¾ç½® secrets å˜é‡ ACCESS_TOKEN ä¸ SERVICE_ID.&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;h4 id=&quot;é…ç½®-workflow-çš„-yml-æ–‡ä»¶ã€‚&quot;&gt;&lt;a href=&quot;#é…ç½®-workflow-çš„-yml-æ–‡ä»¶ã€‚&quot; class=&quot;headerlink&quot; title=&quot;é…ç½® workflow çš„ yml æ–‡ä»¶ã€‚&quot;&gt;&lt;/a&gt;é…ç½® workflow çš„ yml æ–‡ä»¶ã€‚&lt;/h4&gt;ç›´æ¥å¤åˆ¶é‡Œé¢çš„ Usage,&lt;a href=&quot;https://github.com/marketplace/actions/deploy-to-byteinspire-hosting&quot;&gt;Deploy to ByteInspire Hosting&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight yaml&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;attr&quot;&gt;name:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;Deploy&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;Hosting&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;attr&quot;&gt;on:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;push&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;attr&quot;&gt;jobs:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;attr&quot;&gt;build_and_deploy:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;attr&quot;&gt;runs-on:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;ubuntu-latest&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;attr&quot;&gt;steps:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;bullet&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;uses:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;actions/checkout@v2&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;comment&quot;&gt;# Add any build steps here. For example:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;comment&quot;&gt;# - run: npm ci &amp;amp;&amp;amp; npm run build&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;bullet&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;uses:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;byteinspire/hosting-deployer-action@v1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;attr&quot;&gt;with:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &lt;span class=&quot;attr&quot;&gt;service-id:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&amp;quot;$&lt;span class=&quot;template-variable&quot;&gt;&amp;#123;&amp;#123; secrets.SERVICE_ID &amp;#125;&amp;#125;&lt;/span&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &lt;span class=&quot;attr&quot;&gt;token:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&amp;quot;$&lt;span class=&quot;template-variable&quot;&gt;&amp;#123;&amp;#123; secrets.ACCESS_TOKEN &amp;#125;&amp;#125;&lt;/span&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &lt;span class=&quot;comment&quot;&gt;# Or you can use file param to directly specify the ziped file path&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &lt;span class=&quot;attr&quot;&gt;directory:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;./&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    
    <category term="deploy qingfuwu" scheme="https://jealh.xyz/tags/deploy-qingfuwu/"/>
    
  </entry>
  
  <entry>
    <title>å¯¹javaScriptäº‹ä»¶å†’æ³¡ä¸äº‹ä»¶æ•è·çš„å†å­¦ä¹ </title>
    <link href="https://jealh.xyz/2021/10/21/%E5%AF%B9javaScript%E4%BA%8B%E4%BB%B6%E5%86%92%E6%B3%A1%E4%B8%8E%E4%BA%8B%E4%BB%B6%E6%8D%95%E8%8E%B7%E7%9A%84%E5%86%8D%E5%AD%A6%E4%B9%A0/"/>
    <id>https://jealh.xyz/2021/10/21/%E5%AF%B9javaScript%E4%BA%8B%E4%BB%B6%E5%86%92%E6%B3%A1%E4%B8%8E%E4%BA%8B%E4%BB%B6%E6%8D%95%E8%8E%B7%E7%9A%84%E5%86%8D%E5%AD%A6%E4%B9%A0/</id>
    <published>2021-10-20T16:39:16.000Z</published>
    <updated>2022-12-31T10:26:33.598Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å¯¹-javaScript-äº‹ä»¶å†’æ³¡ä¸äº‹ä»¶æ•è·çš„å†å­¦ä¹ "><a href="#å¯¹-javaScript-äº‹ä»¶å†’æ³¡ä¸äº‹ä»¶æ•è·çš„å†å­¦ä¹ " class="headerlink" title="å¯¹ javaScript äº‹ä»¶å†’æ³¡ä¸äº‹ä»¶æ•è·çš„å†å­¦ä¹ "></a>å¯¹ javaScript äº‹ä»¶å†’æ³¡ä¸äº‹ä»¶æ•è·çš„å†å­¦ä¹ </h1><h2 id="DOM-æ ‘ç»“æ„"><a href="#DOM-æ ‘ç»“æ„" class="headerlink" title="DOM æ ‘ç»“æ„"></a>DOM æ ‘ç»“æ„</h2><p>æˆ‘ä»¬åœ¨æµè§ˆå™¨ä¸Šä¼šçœ‹è§ä¸€é¢— dom æ ‘ï¼Œè¿™æ ·çš„æ ‘çŠ¶ç»“æ„å†³å®šäº†äº‹ä»¶çš„å†’æ³¡ä¸æ•è·ã€‚</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>hello Github Action<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;out-A&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;out-B&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;out-C&quot;</span>&gt;</span>hello, I&#x27;am C<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><span id="more"></span><h2 id="äº‹ä»¶æ•è·ä¸äº‹ä»¶å†’æ³¡æµç¨‹"><a href="#äº‹ä»¶æ•è·ä¸äº‹ä»¶å†’æ³¡æµç¨‹" class="headerlink" title="äº‹ä»¶æ•è·ä¸äº‹ä»¶å†’æ³¡æµç¨‹"></a>äº‹ä»¶æ•è·ä¸äº‹ä»¶å†’æ³¡æµç¨‹</h2><p><img src="https://cdn.jsdelivr.net/gh/PancakeDogLLL/imageBed/img/bubbling-capturing.png" alt="äº‹ä»¶å†’æ³¡ä¸æ•è·"></p><h4 id="é¦–å…ˆï¼Œäº‹ä»¶å†’æ³¡æ•è·å»ºç«‹åœ¨çˆ¶å­èŠ‚ç‚¹ç»‘å®šäº†ç›¸åŒç±»å‹çš„äº‹ä»¶ã€‚æ¯”å¦‚ï¼šéƒ½ç»‘å®šäº†-onclick-ç‚¹å‡»äº‹ä»¶ã€‚"><a href="#é¦–å…ˆï¼Œäº‹ä»¶å†’æ³¡æ•è·å»ºç«‹åœ¨çˆ¶å­èŠ‚ç‚¹ç»‘å®šäº†ç›¸åŒç±»å‹çš„äº‹ä»¶ã€‚æ¯”å¦‚ï¼šéƒ½ç»‘å®šäº†-onclick-ç‚¹å‡»äº‹ä»¶ã€‚" class="headerlink" title="é¦–å…ˆï¼Œäº‹ä»¶å†’æ³¡æ•è·å»ºç«‹åœ¨çˆ¶å­èŠ‚ç‚¹ç»‘å®šäº†ç›¸åŒç±»å‹çš„äº‹ä»¶ã€‚æ¯”å¦‚ï¼šéƒ½ç»‘å®šäº† onclick ç‚¹å‡»äº‹ä»¶ã€‚"></a>é¦–å…ˆï¼Œäº‹ä»¶å†’æ³¡æ•è·å»ºç«‹åœ¨çˆ¶å­èŠ‚ç‚¹ç»‘å®šäº†ç›¸åŒç±»å‹çš„äº‹ä»¶ã€‚æ¯”å¦‚ï¼šéƒ½ç»‘å®šäº† onclick ç‚¹å‡»äº‹ä»¶ã€‚</h4><h5 id="1-å½“æˆ‘ä»¬ç‚¹å‡»æœ€é‡Œé¢çš„-div-æ ‡ç­¾æ—¶ï¼Œ"><a href="#1-å½“æˆ‘ä»¬ç‚¹å‡»æœ€é‡Œé¢çš„-div-æ ‡ç­¾æ—¶ï¼Œ" class="headerlink" title="1.å½“æˆ‘ä»¬ç‚¹å‡»æœ€é‡Œé¢çš„ div æ ‡ç­¾æ—¶ï¼Œ"></a>1.å½“æˆ‘ä»¬ç‚¹å‡»æœ€é‡Œé¢çš„ div æ ‡ç­¾æ—¶ï¼Œ</h5><p>ä¼šå…ˆæ²¿ç€ window-&gt;document-&gt;parentNodes-&gt;EventTarget è·¯çº¿è¿›è¡Œäº‹ä»¶æ•è·ï¼Œåœ¨æ•è·æ—¶ä¼šè¿›è¡Œå¯¹æ¯ä¸ª html å¯¹è±¡è¯¢é—®æ˜¯å¦ç»‘å®šäº†è¯¥äº‹ä»¶çš„ listener,å¦‚æœæœ‰åˆ™æ‰§è¡Œå®ƒã€‚è€Œäº‹ä»¶å†’æ³¡åˆ™ä¸ä¸Šé¢è·¯çº¿ç›¸åï¼Œä½†è¯¢é—®è¡Œä¸ºç›¸åŒã€‚ ######ä¸€èˆ¬æˆ‘ä»¬ç»™ html å…ƒç´ æ·»åŠ äº‹ä»¶æ—¶ï¼Œä¼šä½¿ç”¨ HTMLElement.addEventListener(type, listener, useCapture)ç»™å…¶æ·»åŠ äº‹ä»¶å¤„ç†å‡½æ•°ï¼Œè¿™é‡Œçš„å‚æ•°è¯¦è§<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/EventTarget/addEventListener">EventTarget.addEventListener</a>ã€‚éœ€è¦ç‰¹åˆ«è¯´æ˜çš„æ˜¯ç¬¬ä¸‰ä¸ªå‚æ•°:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">useCapture:boolean</span><br><span class="line"></span><br><span class="line">OR</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"><span class="attr">capture</span>:boolean,</span><br><span class="line"><span class="attr">once</span>:boolean,</span><br><span class="line"><span class="attr">passive</span>:boolean</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„ useCapture ä»¥åŠ capture å°±æ˜¯è®¾ç½®è¯¥äº‹ä»¶ listener æ˜¯å¦ä¼šåœ¨æ•è·é˜¶æ®µè§¦å‘ï¼Œé»˜è®¤ä¸º falseã€‚</p><h5 id="2-æˆ‘ä»¬ä»¥å¦‚ä¸‹ä¾‹å­ä¸ºä¾‹ï¼š"><a href="#2-æˆ‘ä»¬ä»¥å¦‚ä¸‹ä¾‹å­ä¸ºä¾‹ï¼š" class="headerlink" title="2.æˆ‘ä»¬ä»¥å¦‚ä¸‹ä¾‹å­ä¸ºä¾‹ï¼š"></a>2.æˆ‘ä»¬ä»¥å¦‚ä¸‹ä¾‹å­ä¸ºä¾‹ï¼š</h5><h6 id="è¿™é‡Œç»˜åˆ¶ä¸€ä¸ªä¸‰å±‚åµŒå¥—çš„-divï¼Œå¹¶ç»™å®ƒä»¬æ·»åŠ ç‚¹å‡»äº‹ä»¶ã€‚"><a href="#è¿™é‡Œç»˜åˆ¶ä¸€ä¸ªä¸‰å±‚åµŒå¥—çš„-divï¼Œå¹¶ç»™å®ƒä»¬æ·»åŠ ç‚¹å‡»äº‹ä»¶ã€‚" class="headerlink" title="è¿™é‡Œç»˜åˆ¶ä¸€ä¸ªä¸‰å±‚åµŒå¥—çš„ divï¼Œå¹¶ç»™å®ƒä»¬æ·»åŠ ç‚¹å‡»äº‹ä»¶ã€‚"></a>è¿™é‡Œç»˜åˆ¶ä¸€ä¸ªä¸‰å±‚åµŒå¥—çš„ divï¼Œå¹¶ç»™å®ƒä»¬æ·»åŠ ç‚¹å‡»äº‹ä»¶ã€‚</h6><p><img src="https://cdn.jsdelivr.net/gh/PancakeDogLLL/imageBed/img/div.png" alt="div"></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> diva = <span class="built_in">document</span>.querySelector(<span class="string">&quot;.out-A&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> divb = <span class="built_in">document</span>.querySelector(<span class="string">&quot;.out-B&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> divc = <span class="built_in">document</span>.querySelector(<span class="string">&quot;.out-C&quot;</span>);</span><br><span class="line">diva.addEventListener(<span class="string">&quot;click&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;A&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line">divb.addEventListener(<span class="string">&quot;click&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;B&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line">divc.addEventListener(<span class="string">&quot;click&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;C&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>ç„¶åæˆ‘ä»¬ç‚¹å‡» C,å‡ºç°å¦‚ä¸‹ç»“æœï¼š<br><img src="https://cdn.jsdelivr.net/gh/PancakeDogLLL/imageBed/img/output.png" alt="output"><br>å¯ä»¥çœ‹è§ç‚¹å‡» C åå‡ºç°äº† C-&gt;B-&gt;A çš„è¾“å‡ºé¡ºåºï¼Œä¸ºä»€ä¹ˆä¼šå‡ºç° CBA çš„è¾“å‡ºé¡ºåºå‘¢ï¼Œå› ä¸ºæˆ‘ä»¬åœ¨æ·»åŠ äº‹ä»¶æ—¶ï¼Œä½¿ç”¨äº† capture çš„é»˜è®¤å€¼ false,å³åœ¨äº‹ä»¶æ•è·é˜¶æ®µä¸ä¼šè§¦å‘äº‹ä»¶å¤„ç†å‡½æ•°ã€‚</p><h6 id="å°†-capture-çš„å€¼è®¾ç½®ä¸º-true"><a href="#å°†-capture-çš„å€¼è®¾ç½®ä¸º-true" class="headerlink" title="å°† capture çš„å€¼è®¾ç½®ä¸º true"></a>å°† capture çš„å€¼è®¾ç½®ä¸º true</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">diva.addEventListener(</span><br><span class="line">  <span class="string">&quot;click&quot;</span>,</span><br><span class="line">  <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;A&quot;</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="literal">true</span></span><br><span class="line">);</span><br><span class="line">divb.addEventListener(</span><br><span class="line">  <span class="string">&quot;click&quot;</span>,</span><br><span class="line">  <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;B&quot;</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="literal">true</span></span><br><span class="line">);</span><br><span class="line">divc.addEventListener(</span><br><span class="line">  <span class="string">&quot;click&quot;</span>,</span><br><span class="line">  <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;C&quot;</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="literal">true</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœä¸ºï¼š<br><img src="https://cdn.jsdelivr.net/gh/PancakeDogLLL/imageBed/img/202110202333.png"><br>è¿™é‡Œå¯ä»¥çœ‹è§è¾“å‡ºç»“æœå˜ä¸ºäº† ABCï¼Œè¿™å°±æ˜¯ä»çˆ¶èŠ‚ç‚¹åˆ° EventTarget èŠ‚ç‚¹çš„æ•è·ã€‚åŒæ—¶æˆ‘ä»¬ä¹Ÿå¯ä»¥å‘ç°ï¼Œå¦‚æœåªç»™èŠ‚ç‚¹æ·»åŠ ä¸€ä¸ªäº‹ä»¶å¤„ç†ï¼Œè¿™æ ·åªä¼šè¿›è¡Œæ•è·æˆ–è€…å†’æ³¡ã€‚æ‰€ä»¥ä¸‹é¢æˆ‘ä»¬ç»™ä¸€ä¸ªèŠ‚ç‚¹æ·»åŠ ä¸¤ä¸ª click äº‹ä»¶ï¼Œå¹¶ä¸”æŠŠå…¶ä¸­ä¸€ä¸ªçš„ capture è®¾ç½®ä¸º true,å¦ä¸€ä¸ªä¸º false.</p><h6 id="ç»™ä¸€ä¸ªèŠ‚ç‚¹æ·»åŠ ä¸¤ä¸ª-click-äº‹ä»¶ï¼Œå¹¶ä¸”æŠŠå…¶ä¸­ä¸€ä¸ªçš„-capture-è®¾ç½®ä¸º-true-å¦ä¸€ä¸ªä¸º-false"><a href="#ç»™ä¸€ä¸ªèŠ‚ç‚¹æ·»åŠ ä¸¤ä¸ª-click-äº‹ä»¶ï¼Œå¹¶ä¸”æŠŠå…¶ä¸­ä¸€ä¸ªçš„-capture-è®¾ç½®ä¸º-true-å¦ä¸€ä¸ªä¸º-false" class="headerlink" title="ç»™ä¸€ä¸ªèŠ‚ç‚¹æ·»åŠ ä¸¤ä¸ª click äº‹ä»¶ï¼Œå¹¶ä¸”æŠŠå…¶ä¸­ä¸€ä¸ªçš„ capture è®¾ç½®ä¸º true,å¦ä¸€ä¸ªä¸º false."></a>ç»™ä¸€ä¸ªèŠ‚ç‚¹æ·»åŠ ä¸¤ä¸ª click äº‹ä»¶ï¼Œå¹¶ä¸”æŠŠå…¶ä¸­ä¸€ä¸ªçš„ capture è®¾ç½®ä¸º true,å¦ä¸€ä¸ªä¸º false.</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">diva.addEventListener(</span><br><span class="line">  <span class="string">&quot;click&quot;</span>,</span><br><span class="line">  <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;A:capture=true&quot;</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="literal">true</span></span><br><span class="line">);</span><br><span class="line">divb.addEventListener(</span><br><span class="line">  <span class="string">&quot;click&quot;</span>,</span><br><span class="line">  <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;B:capture=true&quot;</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="literal">true</span></span><br><span class="line">);</span><br><span class="line">divc.addEventListener(</span><br><span class="line">  <span class="string">&quot;click&quot;</span>,</span><br><span class="line">  <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;C:capture=true&quot;</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="literal">true</span></span><br><span class="line">);</span><br><span class="line"><span class="comment">//   é»˜è®¤false</span></span><br><span class="line">diva.addEventListener(<span class="string">&quot;click&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;A:capture=false&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line">divb.addEventListener(<span class="string">&quot;click&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;B:capture=false&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line">divc.addEventListener(<span class="string">&quot;click&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;C:capture=false&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å†æ¬¡ç‚¹å‡» C,è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š<br><img src="https://cdn.jsdelivr.net/gh/PancakeDogLLL/imageBed/img/202110202341.png"><br>çœ‹çœ‹ï¼Œè¿™é‡Œçš„ç»“æœè¡¨ç¤ºåŒæ—¶å‡ºç°äº†äº‹ä»¶æ•è·ä¸äº‹ä»¶å†’æ³¡ã€‚<br><font color="green">åˆ°äº†è¿™é‡Œï¼Œæƒ³å¿…å¤§å®¶å¯¹äºäº‹ä»¶çš„æ•è·ä¸å†’æ³¡æµç¨‹æœ‰äº†ä¸€å®šçš„äº†è§£å§ã€‚</font>ä¸‹é¢æˆ‘ä»¬å†æ¥èŠèŠ Event.stopPropagation()ä¸ Event.preventDefault()</p><h2 id="Event-stopPropagation-ä¸-Event-preventDefault"><a href="#Event-stopPropagation-ä¸-Event-preventDefault" class="headerlink" title="Event.stopPropagation()ä¸ Event.preventDefault()"></a>Event.stopPropagation()ä¸ Event.preventDefault()</h2><h4 id="Event-stopPropagation"><a href="#Event-stopPropagation" class="headerlink" title="Event.stopPropagation()"></a>Event.stopPropagation()</h4><h6 id="åŒæ ·æ˜¯ä¸Šé¢çš„ä¾‹å­ã€‚æˆ‘ä»¬ç»™-A-capture-trueï¼ˆæ•è·é˜¶æ®µï¼‰çš„é‚£ä¸ªäº‹ä»¶å¤„ç†åŠ ä¸Š-stopPropagation-çœ‹çœ‹ä¸‹é¢çš„è¾“å‡ºï¼š"><a href="#åŒæ ·æ˜¯ä¸Šé¢çš„ä¾‹å­ã€‚æˆ‘ä»¬ç»™-A-capture-trueï¼ˆæ•è·é˜¶æ®µï¼‰çš„é‚£ä¸ªäº‹ä»¶å¤„ç†åŠ ä¸Š-stopPropagation-çœ‹çœ‹ä¸‹é¢çš„è¾“å‡ºï¼š" class="headerlink" title="åŒæ ·æ˜¯ä¸Šé¢çš„ä¾‹å­ã€‚æˆ‘ä»¬ç»™ A:capture=trueï¼ˆæ•è·é˜¶æ®µï¼‰çš„é‚£ä¸ªäº‹ä»¶å¤„ç†åŠ ä¸Š stopPropagation().çœ‹çœ‹ä¸‹é¢çš„è¾“å‡ºï¼š"></a>åŒæ ·æ˜¯ä¸Šé¢çš„ä¾‹å­ã€‚æˆ‘ä»¬ç»™ A:capture=trueï¼ˆæ•è·é˜¶æ®µï¼‰çš„é‚£ä¸ªäº‹ä»¶å¤„ç†åŠ ä¸Š stopPropagation().çœ‹çœ‹ä¸‹é¢çš„è¾“å‡ºï¼š</h6><p><img src="https://cdn.jsdelivr.net/gh/PancakeDogLLL/imageBed/img/202110202353.png"></p><h6 id="åªè¾“å‡ºäº†æ•è·é˜¶æ®µçš„-A-å¤„ç†å‡½æ•°ï¼Œåé¢å­èŠ‚ç‚¹çš„äº‹ä»¶å‡½æ•°éƒ½æ²¡æœ‰è§¦å‘ã€‚é‚£æˆ‘ä»¬åœ¨å†’æ³¡é˜¶æ®µæ·»åŠ è¿™ä¸€è¡Œåˆä¼šå‘ç”Ÿä»€ä¹ˆå‘¢ï¼Ÿä¸‹é¢å°†æ·»åŠ -stopPropagation-åˆ°-C-çš„å†’æ³¡å¤„ç†å‡½æ•°é‡Œï¼Œå³åœ¨-C-capture-false-é‡Œé¢ã€‚ä¸‹é¢æ˜¯è¾“å‡ºç»“æœï¼š"><a href="#åªè¾“å‡ºäº†æ•è·é˜¶æ®µçš„-A-å¤„ç†å‡½æ•°ï¼Œåé¢å­èŠ‚ç‚¹çš„äº‹ä»¶å‡½æ•°éƒ½æ²¡æœ‰è§¦å‘ã€‚é‚£æˆ‘ä»¬åœ¨å†’æ³¡é˜¶æ®µæ·»åŠ è¿™ä¸€è¡Œåˆä¼šå‘ç”Ÿä»€ä¹ˆå‘¢ï¼Ÿä¸‹é¢å°†æ·»åŠ -stopPropagation-åˆ°-C-çš„å†’æ³¡å¤„ç†å‡½æ•°é‡Œï¼Œå³åœ¨-C-capture-false-é‡Œé¢ã€‚ä¸‹é¢æ˜¯è¾“å‡ºç»“æœï¼š" class="headerlink" title="åªè¾“å‡ºäº†æ•è·é˜¶æ®µçš„ A å¤„ç†å‡½æ•°ï¼Œåé¢å­èŠ‚ç‚¹çš„äº‹ä»¶å‡½æ•°éƒ½æ²¡æœ‰è§¦å‘ã€‚é‚£æˆ‘ä»¬åœ¨å†’æ³¡é˜¶æ®µæ·»åŠ è¿™ä¸€è¡Œåˆä¼šå‘ç”Ÿä»€ä¹ˆå‘¢ï¼Ÿä¸‹é¢å°†æ·»åŠ  stopPropagation åˆ° C çš„å†’æ³¡å¤„ç†å‡½æ•°é‡Œï¼Œå³åœ¨ C:capture=false é‡Œé¢ã€‚ä¸‹é¢æ˜¯è¾“å‡ºç»“æœï¼š"></a>åªè¾“å‡ºäº†æ•è·é˜¶æ®µçš„ A å¤„ç†å‡½æ•°ï¼Œåé¢å­èŠ‚ç‚¹çš„äº‹ä»¶å‡½æ•°éƒ½æ²¡æœ‰è§¦å‘ã€‚é‚£æˆ‘ä»¬åœ¨å†’æ³¡é˜¶æ®µæ·»åŠ è¿™ä¸€è¡Œåˆä¼šå‘ç”Ÿä»€ä¹ˆå‘¢ï¼Ÿä¸‹é¢å°†æ·»åŠ  stopPropagation åˆ° C çš„å†’æ³¡å¤„ç†å‡½æ•°é‡Œï¼Œå³åœ¨ C:capture=false é‡Œé¢ã€‚ä¸‹é¢æ˜¯è¾“å‡ºç»“æœï¼š</h6><p><img src="https://cdn.jsdelivr.net/gh/PancakeDogLLL/imageBed/img/202110210005.png"></p><h6 id="åŒæ ·çš„ï¼Œäº‹ä»¶æ•è·ä¸äº‹ä»¶å†’æ³¡æµç¨‹è¢«æˆªæ–­äº†ã€‚"><a href="#åŒæ ·çš„ï¼Œäº‹ä»¶æ•è·ä¸äº‹ä»¶å†’æ³¡æµç¨‹è¢«æˆªæ–­äº†ã€‚" class="headerlink" title="åŒæ ·çš„ï¼Œäº‹ä»¶æ•è·ä¸äº‹ä»¶å†’æ³¡æµç¨‹è¢«æˆªæ–­äº†ã€‚"></a>åŒæ ·çš„ï¼Œäº‹ä»¶æ•è·ä¸äº‹ä»¶å†’æ³¡æµç¨‹è¢«æˆªæ–­äº†ã€‚</h6><h5 id="çœ‹åˆ°è¿™é‡Œï¼Œæƒ³å¿…æ˜ç™½äº†å§ï¼ŒstopPropagation-å°±å¥½æ¯”ä¸€æŠŠâ€˜åˆ€â€™ï¼Œä½ æŠŠå®ƒæ·»åŠ åˆ°ä»€ä¹ˆé˜¶æ®µï¼Œé‚£ä¹ˆè¿™ä¸ªé˜¶æ®µåé¢çš„å°±ä¼šè¢«æˆªå»ã€‚"><a href="#çœ‹åˆ°è¿™é‡Œï¼Œæƒ³å¿…æ˜ç™½äº†å§ï¼ŒstopPropagation-å°±å¥½æ¯”ä¸€æŠŠâ€˜åˆ€â€™ï¼Œä½ æŠŠå®ƒæ·»åŠ åˆ°ä»€ä¹ˆé˜¶æ®µï¼Œé‚£ä¹ˆè¿™ä¸ªé˜¶æ®µåé¢çš„å°±ä¼šè¢«æˆªå»ã€‚" class="headerlink" title="çœ‹åˆ°è¿™é‡Œï¼Œæƒ³å¿…æ˜ç™½äº†å§ï¼ŒstopPropagation å°±å¥½æ¯”ä¸€æŠŠâ€˜åˆ€â€™ï¼Œä½ æŠŠå®ƒæ·»åŠ åˆ°ä»€ä¹ˆé˜¶æ®µï¼Œé‚£ä¹ˆè¿™ä¸ªé˜¶æ®µåé¢çš„å°±ä¼šè¢«æˆªå»ã€‚"></a>çœ‹åˆ°è¿™é‡Œï¼Œæƒ³å¿…æ˜ç™½äº†å§ï¼ŒstopPropagation å°±å¥½æ¯”ä¸€æŠŠâ€˜åˆ€â€™ï¼Œä½ æŠŠå®ƒæ·»åŠ åˆ°ä»€ä¹ˆé˜¶æ®µï¼Œé‚£ä¹ˆè¿™ä¸ªé˜¶æ®µåé¢çš„å°±ä¼šè¢«æˆªå»ã€‚</h5><ul><li>è€Œæ•´ä¸ªæµç¨‹æ˜¯ï¼š</li></ul><h6 id="äº‹ä»¶æ•è·åˆ°äº‹ä»¶å†’æ³¡"><a href="#äº‹ä»¶æ•è·åˆ°äº‹ä»¶å†’æ³¡" class="headerlink" title="äº‹ä»¶æ•è·åˆ°äº‹ä»¶å†’æ³¡"></a>äº‹ä»¶æ•è·åˆ°äº‹ä»¶å†’æ³¡</h6><h6 id="çˆ¶èŠ‚ç‚¹åˆ°-EventTarget-èŠ‚ç‚¹å†åˆ°çˆ¶èŠ‚ç‚¹"><a href="#çˆ¶èŠ‚ç‚¹åˆ°-EventTarget-èŠ‚ç‚¹å†åˆ°çˆ¶èŠ‚ç‚¹" class="headerlink" title="çˆ¶èŠ‚ç‚¹åˆ° EventTarget èŠ‚ç‚¹å†åˆ°çˆ¶èŠ‚ç‚¹"></a>çˆ¶èŠ‚ç‚¹åˆ° EventTarget èŠ‚ç‚¹å†åˆ°çˆ¶èŠ‚ç‚¹</h6><h4 id="Event-preventDefault"><a href="#Event-preventDefault" class="headerlink" title="Event.preventDefault()"></a>Event.preventDefault()</h4><p>é‚£æŠŠä¸Šé¢çš„æ”¹æˆ preventDefault åˆä¼šæ˜¯æ€æ ·çš„ç»“æœå‘¢ï¼Ÿé‚£å°±è¯•è¯•çœ‹å’¯ï¼š<br><img src="https://cdn.jsdelivr.net/gh/PancakeDogLLL/imageBed/img/202110202356.png"><br>æ²¡æœ‰å½±å“ï¼ï¼ï¼preventDefault åœ¨æ²¡æœ‰å¯¹äº‹ä»¶æ•è·äº§ç”Ÿå½±å“ï¼Œé‚£å†’æ³¡é˜¶æ®µå‘¢ï¼Ÿä¹Ÿæ²¡æœ‰å½±å“ã€‚æ‰€ä»¥ preventDefault åªæ˜¯å•çº¯çš„é˜»æ­¢äº† html å…ƒç´ çš„é»˜è®¤äº‹ä»¶ï¼Œæ¯”å¦‚ä¸€ä¸ª a æ ‡ç­¾èƒ½å¤Ÿè·³è½¬é“¾æ¥ï¼ŒåŠ ä¸Š preventDefault åå°±ä¸èƒ½è·³è½¬äº†ã€‚</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><h6 id="æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå¯ä»¥ä½¿ç”¨-stopPropagation-é˜»æ­¢äº‹ä»¶çš„å†’æ³¡ã€‚é€šå¸¸æˆ‘ä»¬åœ¨ç»™-html-å…ƒç´ æ·»åŠ äº‹ä»¶æ—¶ï¼Œä¸€èˆ¬éƒ½ä¼šä½¿ç”¨-capture-çš„é»˜è®¤å€¼ï¼šfalse-è¿™æ ·å°±åªä¼šåœ¨å†’æ³¡é˜¶æ®µè§¦å‘äº‹ä»¶å¤„ç†å‡½æ•°ï¼Œè¿™æ ·é€šå¸¸æˆ‘ä»¬åªéœ€è¦åœ¨-capture-ä¸º-false-çš„æƒ…å†µä¸‹ï¼Œç»™-EventTarget-å…ƒç´ æ·»åŠ -stopPropagation-å°±è¡Œäº†ï¼Œè¿™æ ·ï¼Œæ— è®ºåœ¨æ•è·é˜¶æ®µè¿˜æ˜¯åœ¨å†’æ³¡é˜¶æ®µéƒ½åªä¼šè§¦å‘-EventTarget-çš„äº‹ä»¶å¤„ç†å‡½æ•°ï¼Œä»è€Œå‡å°‘ä¸å¿…è¦çš„å‰¯ä½œç”¨ã€‚"><a href="#æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå¯ä»¥ä½¿ç”¨-stopPropagation-é˜»æ­¢äº‹ä»¶çš„å†’æ³¡ã€‚é€šå¸¸æˆ‘ä»¬åœ¨ç»™-html-å…ƒç´ æ·»åŠ äº‹ä»¶æ—¶ï¼Œä¸€èˆ¬éƒ½ä¼šä½¿ç”¨-capture-çš„é»˜è®¤å€¼ï¼šfalse-è¿™æ ·å°±åªä¼šåœ¨å†’æ³¡é˜¶æ®µè§¦å‘äº‹ä»¶å¤„ç†å‡½æ•°ï¼Œè¿™æ ·é€šå¸¸æˆ‘ä»¬åªéœ€è¦åœ¨-capture-ä¸º-false-çš„æƒ…å†µä¸‹ï¼Œç»™-EventTarget-å…ƒç´ æ·»åŠ -stopPropagation-å°±è¡Œäº†ï¼Œè¿™æ ·ï¼Œæ— è®ºåœ¨æ•è·é˜¶æ®µè¿˜æ˜¯åœ¨å†’æ³¡é˜¶æ®µéƒ½åªä¼šè§¦å‘-EventTarget-çš„äº‹ä»¶å¤„ç†å‡½æ•°ï¼Œä»è€Œå‡å°‘ä¸å¿…è¦çš„å‰¯ä½œç”¨ã€‚" class="headerlink" title="æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå¯ä»¥ä½¿ç”¨ stopPropagation é˜»æ­¢äº‹ä»¶çš„å†’æ³¡ã€‚é€šå¸¸æˆ‘ä»¬åœ¨ç»™ html å…ƒç´ æ·»åŠ äº‹ä»¶æ—¶ï¼Œä¸€èˆ¬éƒ½ä¼šä½¿ç”¨ capture çš„é»˜è®¤å€¼ï¼šfalse,è¿™æ ·å°±åªä¼šåœ¨å†’æ³¡é˜¶æ®µè§¦å‘äº‹ä»¶å¤„ç†å‡½æ•°ï¼Œè¿™æ ·é€šå¸¸æˆ‘ä»¬åªéœ€è¦åœ¨ capture ä¸º false çš„æƒ…å†µä¸‹ï¼Œç»™ EventTarget å…ƒç´ æ·»åŠ  stopPropagation å°±è¡Œäº†ï¼Œè¿™æ ·ï¼Œæ— è®ºåœ¨æ•è·é˜¶æ®µè¿˜æ˜¯åœ¨å†’æ³¡é˜¶æ®µéƒ½åªä¼šè§¦å‘ EventTarget çš„äº‹ä»¶å¤„ç†å‡½æ•°ï¼Œä»è€Œå‡å°‘ä¸å¿…è¦çš„å‰¯ä½œç”¨ã€‚"></a>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå¯ä»¥ä½¿ç”¨ stopPropagation é˜»æ­¢äº‹ä»¶çš„å†’æ³¡ã€‚é€šå¸¸æˆ‘ä»¬åœ¨ç»™ html å…ƒç´ æ·»åŠ äº‹ä»¶æ—¶ï¼Œä¸€èˆ¬éƒ½ä¼šä½¿ç”¨ capture çš„é»˜è®¤å€¼ï¼šfalse,è¿™æ ·å°±åªä¼šåœ¨å†’æ³¡é˜¶æ®µè§¦å‘äº‹ä»¶å¤„ç†å‡½æ•°ï¼Œè¿™æ ·é€šå¸¸æˆ‘ä»¬åªéœ€è¦åœ¨ capture ä¸º false çš„æƒ…å†µä¸‹ï¼Œç»™ EventTarget å…ƒç´ æ·»åŠ  stopPropagation å°±è¡Œäº†ï¼Œè¿™æ ·ï¼Œæ— è®ºåœ¨æ•è·é˜¶æ®µè¿˜æ˜¯åœ¨å†’æ³¡é˜¶æ®µéƒ½åªä¼šè§¦å‘ EventTarget çš„äº‹ä»¶å¤„ç†å‡½æ•°ï¼Œä»è€Œå‡å°‘ä¸å¿…è¦çš„å‰¯ä½œç”¨ã€‚</h6><p>å‚è€ƒï¼š<a href="https://web.dev/eventing-deepdive/">JavaScript eventing deep dive</a></p>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;å¯¹-javaScript-äº‹ä»¶å†’æ³¡ä¸äº‹ä»¶æ•è·çš„å†å­¦ä¹ &quot;&gt;&lt;a href=&quot;#å¯¹-javaScript-äº‹ä»¶å†’æ³¡ä¸äº‹ä»¶æ•è·çš„å†å­¦ä¹ &quot; class=&quot;headerlink&quot; title=&quot;å¯¹ javaScript äº‹ä»¶å†’æ³¡ä¸äº‹ä»¶æ•è·çš„å†å­¦ä¹ &quot;&gt;&lt;/a&gt;å¯¹ javaScript äº‹ä»¶å†’æ³¡ä¸äº‹ä»¶æ•è·çš„å†å­¦ä¹ &lt;/h1&gt;&lt;h2 id=&quot;DOM-æ ‘ç»“æ„&quot;&gt;&lt;a href=&quot;#DOM-æ ‘ç»“æ„&quot; class=&quot;headerlink&quot; title=&quot;DOM æ ‘ç»“æ„&quot;&gt;&lt;/a&gt;DOM æ ‘ç»“æ„&lt;/h2&gt;&lt;p&gt;æˆ‘ä»¬åœ¨æµè§ˆå™¨ä¸Šä¼šçœ‹è§ä¸€é¢— dom æ ‘ï¼Œè¿™æ ·çš„æ ‘çŠ¶ç»“æ„å†³å®šäº†äº‹ä»¶çš„å†’æ³¡ä¸æ•è·ã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight html&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;&amp;lt;!DOCTYPE &lt;span class=&quot;meta-keyword&quot;&gt;html&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;html&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;lang&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&amp;quot;en&amp;quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;head&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;meta&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;charset&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&amp;quot;UTF-8&amp;quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;meta&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;http-equiv&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&amp;quot;X-UA-Compatible&amp;quot;&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;content&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&amp;quot;IE=edge&amp;quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;meta&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;name&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&amp;quot;viewport&amp;quot;&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;content&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&amp;quot;width=device-width, initial-scale=1.0&amp;quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;title&lt;/span&gt;&amp;gt;&lt;/span&gt;Document&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;title&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;head&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;body&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;h1&lt;/span&gt;&amp;gt;&lt;/span&gt;hello Github Action&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;h1&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;div&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;class&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&amp;quot;out-A&amp;quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;div&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;class&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&amp;quot;out-B&amp;quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;div&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;class&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&amp;quot;out-C&amp;quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;hello, I&amp;#x27;am C&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;div&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;div&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;div&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;body&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;html&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="javascript" scheme="https://jealh.xyz/categories/javascript/"/>
    
    
    <category term="Event" scheme="https://jealh.xyz/tags/Event/"/>
    
  </entry>
  
  <entry>
    <title>numpyæ¡ä»¶é€‰æ‹©</title>
    <link href="https://jealh.xyz/2021/10/13/numpy%E6%9D%A1%E4%BB%B6%E9%80%89%E6%8B%A9/"/>
    <id>https://jealh.xyz/2021/10/13/numpy%E6%9D%A1%E4%BB%B6%E9%80%89%E6%8B%A9/</id>
    <published>2021-10-12T16:38:35.000Z</published>
    <updated>2022-12-31T10:26:33.587Z</updated>
    
    <content type="html"><![CDATA[<h2 id="numpy-çš„æ¡ä»¶ç­›é€‰"><a href="#numpy-çš„æ¡ä»¶ç­›é€‰" class="headerlink" title="numpy çš„æ¡ä»¶ç­›é€‰"></a>numpy çš„æ¡ä»¶ç­›é€‰</h2><h3 id="ç­›é€‰åŸºç¡€"><a href="#ç­›é€‰åŸºç¡€" class="headerlink" title="ç­›é€‰åŸºç¡€"></a>ç­›é€‰åŸºç¡€</h3><h4 id="æ•°ç»„åˆ‡ç‰‡"><a href="#æ•°ç»„åˆ‡ç‰‡" class="headerlink" title="æ•°ç»„åˆ‡ç‰‡"></a>æ•°ç»„åˆ‡ç‰‡</h4><p>æˆ‘ä»¬ä¸€èˆ¬éƒ½çŸ¥é“ python çš„ [ ] æ“ä½œç¬¦å¯ä»¥è¿›è¡Œåˆ‡ç‰‡æ“ä½œ,ä¸¾ä¾‹å¦‚ä¸‹:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">arr = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</span><br><span class="line"><span class="comment">#åˆ‡ç‰‡æ“ä½œå‚æ•°ä»‹ç»ï¼š[èµ·å§‹ä½ç½®ä¸‹æ ‡ï¼ˆé»˜è®¤æœ€å¼€å§‹ï¼‰:ç»“æŸä½ç½®ä¸‹æ ‡(é»˜è®¤æœ€å):æ­¥é•¿(é»˜è®¤ä¸ºä¸€)]</span></span><br><span class="line">arr[<span class="number">0</span>:<span class="number">2</span>]</span><br><span class="line"><span class="comment"># [1,2]</span></span><br><span class="line"></span><br><span class="line">arr[<span class="number">0</span>:<span class="number">2</span>:<span class="number">2</span>]</span><br><span class="line"><span class="comment"># [1,3]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å½“æ­¥é•¿ä¸º-1æ—¶ï¼Œèƒ½å¤Ÿé€†ç½®æ•°ç»„</span></span><br><span class="line">arr[::-<span class="number">1</span>]</span><br><span class="line"><span class="comment"># [3,2,1]</span></span><br></pre></td></tr></table></figure><span id="more"></span><h4 id="ä¸‹é¢æ˜¯-ndarray-äºŒç»´æ•°ç»„çš„ä¾‹å­"><a href="#ä¸‹é¢æ˜¯-ndarray-äºŒç»´æ•°ç»„çš„ä¾‹å­" class="headerlink" title="ä¸‹é¢æ˜¯ ndarray äºŒç»´æ•°ç»„çš„ä¾‹å­"></a>ä¸‹é¢æ˜¯ ndarray äºŒç»´æ•°ç»„çš„ä¾‹å­</h4><h5 id="å•åˆ—-è¡Œç­›é€‰"><a href="#å•åˆ—-è¡Œç­›é€‰" class="headerlink" title="å•åˆ—/è¡Œç­›é€‰"></a>å•åˆ—/è¡Œç­›é€‰</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">arr = [</span><br><span class="line">[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>],</span><br><span class="line">[<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>]</span><br><span class="line">]</span><br><span class="line">arr = np.array(arr)</span><br><span class="line"><span class="comment"># å•åˆ—ç­›é€‰</span></span><br><span class="line"><span class="comment"># åˆ—ç­›é€‰ï¼Œç¬¬ä¸€ä¸ªå†’å·ä¸èƒ½çœç•¥</span></span><br><span class="line">arr[:,<span class="number">0</span>] <span class="comment"># é€‰æ‹©ä¸‹æ ‡ä¸º0çš„åˆ—</span></span><br><span class="line"><span class="comment"># [1,4]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å•è¡Œç­›é€‰</span></span><br><span class="line">arr[<span class="number">0</span>] <span class="comment"># é€‰æ‹©ä¸‹æ ‡ä¸º0çš„è¡Œï¼Œå°±åƒæ™®é€šçš„äºŒç»´æ•°ç»„è®¿é—®ç¬¬ä¸€ä¸ªä¸€ç»´æ•°ç»„ä¸€æ ·</span></span><br><span class="line"><span class="comment"># [1,2,3,4]</span></span><br></pre></td></tr></table></figure><h5 id="å¤šè¡Œ-åˆ—ç­›é€‰"><a href="#å¤šè¡Œ-åˆ—ç­›é€‰" class="headerlink" title="å¤šè¡Œ/åˆ—ç­›é€‰"></a>å¤šè¡Œ/åˆ—ç­›é€‰</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">arr = [</span><br><span class="line">[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>],</span><br><span class="line">[<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>]</span><br><span class="line">]</span><br><span class="line">arr = np.array(arr)</span><br><span class="line"><span class="comment"># å¤šåˆ—ç­›é€‰</span></span><br><span class="line"><span class="comment"># é€‰æ‹©æŸä¸ªä¸‹æ ‡åŒºé—´çš„åˆ—</span></span><br><span class="line">arr[:,<span class="number">0</span>:<span class="number">2</span>]</span><br><span class="line"><span class="comment"># [</span></span><br><span class="line"><span class="comment"># [1,2],</span></span><br><span class="line"><span class="comment"># [4,5]</span></span><br><span class="line"><span class="comment"># ]</span></span><br><span class="line"><span class="comment"># é€‰æ‹©æŸäº›åˆ—</span></span><br><span class="line">arr[:,[<span class="number">0</span>,<span class="number">3</span>]] <span class="comment"># é€‰æ‹©ä¸‹æ ‡ä¸º 0ï¼Œ3çš„åˆ—</span></span><br><span class="line"><span class="comment"># [</span></span><br><span class="line"><span class="comment"># [1,4],</span></span><br><span class="line"><span class="comment"># [4,7]</span></span><br><span class="line"><span class="comment"># ]</span></span><br><span class="line"><span class="comment"># boolé€‰æ‹©</span></span><br><span class="line"><span class="comment"># boolæ•°ç»„çš„  é•¿åº¦  å¿…é¡»è¦ä¸åˆ—çš„  ç»´æ•°ç›¸åŒ</span></span><br><span class="line">arr[:,[<span class="literal">True</span>,<span class="literal">False</span>,<span class="literal">False</span>,<span class="literal">False</span>]]</span><br><span class="line"><span class="comment"># [</span></span><br><span class="line"><span class="comment"># [1],</span></span><br><span class="line"><span class="comment"># [4]</span></span><br><span class="line"><span class="comment"># ]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¤šè¡Œç­›é€‰</span></span><br><span class="line"><span class="comment"># ä¸å¤šåˆ—ç­›é€‰ç±»ä¼¼</span></span><br><span class="line">arr = np.array([</span><br><span class="line">[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>],</span><br><span class="line">[<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>],</span><br><span class="line">[<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>,<span class="number">11</span>]</span><br><span class="line">])</span><br><span class="line"><span class="comment"># é€‰æ‹©æŸäº›è¡Œ</span></span><br><span class="line">arr[[<span class="number">0</span>,<span class="number">1</span>]]</span><br><span class="line"><span class="comment"># [[</span></span><br><span class="line"><span class="comment"># [1,2,3,4],</span></span><br><span class="line"><span class="comment"># [4,5,6,7]</span></span><br><span class="line"><span class="comment"># ]]</span></span><br><span class="line"><span class="comment"># å…¶ä½™å°±ä¸åœ¨èµ˜è¿°ï¼Œå¯ä»¥å­—è¡Œæµ‹è¯•</span></span><br></pre></td></tr></table></figure><h3 id="æ¡ä»¶ç­›é€‰"><a href="#æ¡ä»¶ç­›é€‰" class="headerlink" title="æ¡ä»¶ç­›é€‰"></a>æ¡ä»¶ç­›é€‰</h3><p>é€šè¿‡ä¸Šé¢çš„ä¸€äº›åŸºæœ¬çš„ç­›é€‰è§„åˆ™ï¼Œå¯ä»¥å¤§è‡´äº†è§£äº† numpy çš„ç­›é€‰åŸåˆ™äº†ï¼Œé‚£ä¹ˆä¸‹é¢å°±çœ‹ä¸€ numpy æ¯”è¾ƒå¼ºå¤§çš„æ¡ä»¶ç­›é€‰å§ã€‚è€Œæ¡ä»¶ç­›é€‰å°±æ˜¯ä¾èµ– bool ç­›é€‰å®ç°çš„ã€‚</p><h4 id="æ¡ä»¶ç­›é€‰è¡Œ"><a href="#æ¡ä»¶ç­›é€‰è¡Œ" class="headerlink" title="æ¡ä»¶ç­›é€‰è¡Œ"></a>æ¡ä»¶ç­›é€‰è¡Œ</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">arr = np.array([</span><br><span class="line">[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>],</span><br><span class="line">[<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>],</span><br><span class="line">[<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>,<span class="number">11</span>]</span><br><span class="line">])</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¾‹å¦‚ï¼šé€‰æ‹©ç¬¬ä¸€ä¸ªå…ƒç´ ä¸ºå¶æ•°çš„è¡Œ</span></span><br><span class="line">arr[arr[:,<span class="number">0</span>]%<span class="number">2</span>==<span class="number">0</span>]</span><br><span class="line"><span class="comment"># [[ 4,  5,  6,  7],</span></span><br><span class="line"><span class="comment">#  [ 8,  9, 10, 11]]</span></span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥çœ‹ä¸€ä¸‹ä¸Šé¢å‘ç”Ÿäº†ä»€ä¹ˆã€‚<br>é¦–å…ˆ: arr[:,0]x é€‰æ‹©é™¤äº†äºŒç»´æ•°ç»„çš„ç¬¬ä¸€åˆ—â€”â€“[1,4,8]<br>ç„¶å: arr[:,0]%2==0 å¾—åˆ°äº†ä¸€ä¸ª bool æ•°ç»„â€”â€“[False,True,True]<br>æœ€å arr[[False,True,True]],è¿™ä¸ªæ ·å­æ˜¯ä¸æ˜¯æœ‰ç‚¹ç†Ÿæ‚‰äº†ï¼Œä¹Ÿå°±æ˜¯ä¸Šé¢çš„ bool ç­›é€‰ã€‚</p><h4 id="æ¡ä»¶ç­›é€‰åˆ—"><a href="#æ¡ä»¶ç­›é€‰åˆ—" class="headerlink" title="æ¡ä»¶ç­›é€‰åˆ—"></a>æ¡ä»¶ç­›é€‰åˆ—</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¸è¡Œç­›é€‰ç±»ä¼¼</span></span><br><span class="line">arr[:,arr[<span class="number">1</span>]&gt;<span class="number">5</span>] <span class="comment"># é€‰æ‹©ç¬¬äºŒè¡Œä¸­å¤§äº5çš„åˆ—</span></span><br><span class="line"><span class="comment"># [[ 3,  4],</span></span><br><span class="line"><span class="comment">#  [ 6,  7],</span></span><br><span class="line"><span class="comment">#  [10, 11]]</span></span><br></pre></td></tr></table></figure><h4 id="è¡Œåˆ—ä¸€èµ·é€‰æ‹©"><a href="#è¡Œåˆ—ä¸€èµ·é€‰æ‹©" class="headerlink" title="è¡Œåˆ—ä¸€èµ·é€‰æ‹©"></a>è¡Œåˆ—ä¸€èµ·é€‰æ‹©</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">arr[arr&gt;<span class="number">5</span>] <span class="comment"># é€‰æ‹©arrä¸­ï¼Œå¤§äº5çš„å…ƒç´ </span></span><br><span class="line"><span class="comment"># å…¶ä¸­arr&gt;5å¾—åˆ°ä¸€ä¸ªäºŒç»´çš„boolæ•°ç»„</span></span><br><span class="line"><span class="comment"># [[False, False, False, False],</span></span><br><span class="line"><span class="comment">#  [False, False,  True,  True],</span></span><br><span class="line"><span class="comment">#  [ True,  True,  True,  True]]</span></span><br><span class="line"><span class="comment"># æœ€ç»ˆç»“æœæ˜¯ä¸€ä¸ªä¸€ç»´æ•°ç»„</span></span><br><span class="line"><span class="comment"># [ 6,  7,  8,  9, 10, 11]</span></span><br></pre></td></tr></table></figure><h5 id="æ³¨æ„ï¼šåœ¨è¿›è¡Œè¡Œåˆ—ä¸€èµ·é€‰æ‹©æ—¶ï¼Œå¯èƒ½ä¼šæœ‰å…ƒç´ ç±»å‹ä¸ä¸€è‡´çš„æƒ…å†µï¼Œå¦‚ç¬¬ä¸€åˆ—-intï¼Œç¬¬äºŒåˆ—æ˜¯-strï¼Œè¿™æ ·å†ç”¨-arr-gt-5-å°±ä¼šå‡ºç°é”™è¯¯ã€‚"><a href="#æ³¨æ„ï¼šåœ¨è¿›è¡Œè¡Œåˆ—ä¸€èµ·é€‰æ‹©æ—¶ï¼Œå¯èƒ½ä¼šæœ‰å…ƒç´ ç±»å‹ä¸ä¸€è‡´çš„æƒ…å†µï¼Œå¦‚ç¬¬ä¸€åˆ—-intï¼Œç¬¬äºŒåˆ—æ˜¯-strï¼Œè¿™æ ·å†ç”¨-arr-gt-5-å°±ä¼šå‡ºç°é”™è¯¯ã€‚" class="headerlink" title="æ³¨æ„ï¼šåœ¨è¿›è¡Œè¡Œåˆ—ä¸€èµ·é€‰æ‹©æ—¶ï¼Œå¯èƒ½ä¼šæœ‰å…ƒç´ ç±»å‹ä¸ä¸€è‡´çš„æƒ…å†µï¼Œå¦‚ç¬¬ä¸€åˆ— intï¼Œç¬¬äºŒåˆ—æ˜¯ strï¼Œè¿™æ ·å†ç”¨ arr&gt;5 å°±ä¼šå‡ºç°é”™è¯¯ã€‚"></a>æ³¨æ„ï¼šåœ¨è¿›è¡Œè¡Œåˆ—ä¸€èµ·é€‰æ‹©æ—¶ï¼Œå¯èƒ½ä¼šæœ‰å…ƒç´ ç±»å‹ä¸ä¸€è‡´çš„æƒ…å†µï¼Œå¦‚ç¬¬ä¸€åˆ— intï¼Œç¬¬äºŒåˆ—æ˜¯ strï¼Œè¿™æ ·å†ç”¨ arr&gt;5 å°±ä¼šå‡ºç°é”™è¯¯ã€‚</h5><h4 id="å¤šæ¡ä»¶é€‰æ‹©"><a href="#å¤šæ¡ä»¶é€‰æ‹©" class="headerlink" title="å¤šæ¡ä»¶é€‰æ‹©"></a>å¤šæ¡ä»¶é€‰æ‹©</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">arr[(arr&gt;<span class="number">5</span>) &amp; (arr%<span class="number">2</span>==<span class="number">0</span>)] <span class="comment"># é€‰æ‹©å¤§äº5ä¸”ä¸ºå¶æ•°çš„å…ƒç´ </span></span><br><span class="line"><span class="comment"># [ 6,  8, 10]</span></span><br></pre></td></tr></table></figure><h5 id="æ³¨æ„ï¼šå¤šæ¡ä»¶è¦ç”¨ï¼ˆï¼‰æ‹¬èµ·æ¯ä¸€ä¸ªæ¡ä»¶ï¼Œé€»è¾‘å…³ç³»ç”¨-æˆ–è€…-amp-ï¼Œä¸èƒ½ç”¨-and-or-è¿™æ ·ã€‚"><a href="#æ³¨æ„ï¼šå¤šæ¡ä»¶è¦ç”¨ï¼ˆï¼‰æ‹¬èµ·æ¯ä¸€ä¸ªæ¡ä»¶ï¼Œé€»è¾‘å…³ç³»ç”¨-æˆ–è€…-amp-ï¼Œä¸èƒ½ç”¨-and-or-è¿™æ ·ã€‚" class="headerlink" title="æ³¨æ„ï¼šå¤šæ¡ä»¶è¦ç”¨ï¼ˆï¼‰æ‹¬èµ·æ¯ä¸€ä¸ªæ¡ä»¶ï¼Œé€»è¾‘å…³ç³»ç”¨ | æˆ–è€… &amp;ï¼Œä¸èƒ½ç”¨ and,or è¿™æ ·ã€‚"></a>æ³¨æ„ï¼šå¤šæ¡ä»¶è¦ç”¨ï¼ˆï¼‰æ‹¬èµ·æ¯ä¸€ä¸ªæ¡ä»¶ï¼Œé€»è¾‘å…³ç³»ç”¨ | æˆ–è€… &amp;ï¼Œä¸èƒ½ç”¨ and,or è¿™æ ·ã€‚</h5>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;numpy-çš„æ¡ä»¶ç­›é€‰&quot;&gt;&lt;a href=&quot;#numpy-çš„æ¡ä»¶ç­›é€‰&quot; class=&quot;headerlink&quot; title=&quot;numpy çš„æ¡ä»¶ç­›é€‰&quot;&gt;&lt;/a&gt;numpy çš„æ¡ä»¶ç­›é€‰&lt;/h2&gt;&lt;h3 id=&quot;ç­›é€‰åŸºç¡€&quot;&gt;&lt;a href=&quot;#ç­›é€‰åŸºç¡€&quot; class=&quot;headerlink&quot; title=&quot;ç­›é€‰åŸºç¡€&quot;&gt;&lt;/a&gt;ç­›é€‰åŸºç¡€&lt;/h3&gt;&lt;h4 id=&quot;æ•°ç»„åˆ‡ç‰‡&quot;&gt;&lt;a href=&quot;#æ•°ç»„åˆ‡ç‰‡&quot; class=&quot;headerlink&quot; title=&quot;æ•°ç»„åˆ‡ç‰‡&quot;&gt;&lt;/a&gt;æ•°ç»„åˆ‡ç‰‡&lt;/h4&gt;&lt;p&gt;æˆ‘ä»¬ä¸€èˆ¬éƒ½çŸ¥é“ python çš„ [ ] æ“ä½œç¬¦å¯ä»¥è¿›è¡Œåˆ‡ç‰‡æ“ä½œ,ä¸¾ä¾‹å¦‚ä¸‹:&lt;/p&gt;
&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;arr = [&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#åˆ‡ç‰‡æ“ä½œå‚æ•°ä»‹ç»ï¼š[èµ·å§‹ä½ç½®ä¸‹æ ‡ï¼ˆé»˜è®¤æœ€å¼€å§‹ï¼‰:ç»“æŸä½ç½®ä¸‹æ ‡(é»˜è®¤æœ€å):æ­¥é•¿(é»˜è®¤ä¸ºä¸€)]&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;arr[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# [1,2]&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;arr[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# [1,3]&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# å½“æ­¥é•¿ä¸º-1æ—¶ï¼Œèƒ½å¤Ÿé€†ç½®æ•°ç»„&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;arr[::-&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# [3,2,1]&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="python" scheme="https://jealh.xyz/categories/python/"/>
    
    
    <category term="numpy" scheme="https://jealh.xyz/tags/numpy/"/>
    
  </entry>
  
  <entry>
    <title>Hello World</title>
    <link href="https://jealh.xyz/2021/07/21/hello-world/"/>
    <id>https://jealh.xyz/2021/07/21/hello-world/</id>
    <published>2021-07-20T16:00:00.000Z</published>
    <updated>2022-12-31T10:26:33.583Z</updated>
    
    <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><span id="more"></span><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;Welcome to &lt;a href=&quot;https://hexo.io/&quot;&gt;Hexo&lt;/a&gt;! This is your very first post. Check &lt;a href=&quot;https://hexo.io/docs/&quot;&gt;documentation&lt;/a&gt; for more info. If you get any problems when using Hexo, you can find the answer in &lt;a href=&quot;https://hexo.io/docs/troubleshooting.html&quot;&gt;troubleshooting&lt;/a&gt; or you can ask me on &lt;a href=&quot;https://github.com/hexojs/hexo/issues&quot;&gt;GitHub&lt;/a&gt;.&lt;/p&gt;</summary>
    
    
    
    
  </entry>
  
</feed>
